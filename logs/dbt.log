[0m10:38:07.110335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDB6008B10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDB600A450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDB600BF90>]}


============================== 10:38:07.126434 | 97a9ea6d-2c84-403a-827c-174e06c4ba97 ==============================
[0m10:38:07.126434 [info ] [MainThread]: Running with dbt=1.11.2
[0m10:38:07.129042 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'C:\\lakehouse\\default\\Files\\dbt', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\lakehouse\\default\\Files\\dbt\\logs', 'introspect': 'True', 'invocation_command': 'dbt run', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'use_experimental_parser': 'False'}
[0m10:38:07.480931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '97a9ea6d-2c84-403a-827c-174e06c4ba97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDB60DD3D0>]}
[0m10:38:07.534212 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '97a9ea6d-2c84-403a-827c-174e06c4ba97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDB0A98910>]}
[0m10:38:07.538779 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m10:38:07.909122 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m10:38:07.911127 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m10:38:07.911127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '97a9ea6d-2c84-403a-827c-174e06c4ba97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDB6099090>]}
[0m10:38:09.302913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '97a9ea6d-2c84-403a-827c-174e06c4ba97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDB684EA90>]}
[0m10:38:09.370593 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m10:38:09.375605 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m10:38:09.427897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '97a9ea6d-2c84-403a-827c-174e06c4ba97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDB67369D0>]}
[0m10:38:09.429742 [info ] [MainThread]: Found 8 models, 1 operation, 474 macros
[0m10:38:09.429742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '97a9ea6d-2c84-403a-827c-174e06c4ba97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDB6903550>]}
[0m10:38:09.433543 [info ] [MainThread]: 
[0m10:38:09.435053 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:38:09.437237 [info ] [MainThread]: 
[0m10:38:09.438815 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m10:38:09.442694 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake'
[0m10:38:09.644495 [debug] [ThreadPool]: Using duckdb connection "list_ducklake"
[0m10:38:09.644495 [debug] [ThreadPool]: On list_ducklake: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"ducklake"'
    
  
  
[0m10:38:09.644495 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:38:10.075427 [debug] [ThreadPool]: SQL status: OK in 0.424 seconds
[0m10:38:10.075427 [debug] [ThreadPool]: On list_ducklake: Close
[0m10:38:10.075427 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ducklake, now create_ducklake_aemo)
[0m10:38:10.092380 [debug] [ThreadPool]: Creating schema "database: "ducklake"
schema: "aemo"
"
[0m10:38:10.107613 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:38:10.109617 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
        select type from duckdb_databases()
        where lower(database_name)='ducklake'
        and type='sqlite'
    
  
[0m10:38:10.110613 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:38:10.113577 [debug] [ThreadPool]: SQL status: OK in 0.003 seconds
[0m10:38:10.113577 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:38:10.113577 [debug] [ThreadPool]: On create_ducklake_aemo: BEGIN
[0m10:38:10.113577 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m10:38:10.113577 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:38:10.113577 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
    
        create schema if not exists "ducklake"."aemo"
    
[0m10:38:10.126307 [debug] [ThreadPool]: SQL status: OK in 0.008 seconds
[0m10:38:10.126307 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m10:38:10.126307 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:38:10.126307 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m10:38:10.142061 [debug] [ThreadPool]: SQL status: OK in 0.014 seconds
[0m10:38:10.142061 [debug] [ThreadPool]: On create_ducklake_aemo: Close
[0m10:38:10.142061 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake_aemo'
[0m10:38:10.164012 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m10:38:10.164012 [debug] [ThreadPool]: On list_ducklake_aemo: BEGIN
[0m10:38:10.167030 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:38:10.169039 [debug] [ThreadPool]: SQL status: OK in 0.002 seconds
[0m10:38:10.171049 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m10:38:10.173058 [debug] [ThreadPool]: On list_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake_aemo"} */
select
      'ducklake' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'aemo'
    and lower(table_catalog) = 'ducklake'
  
[0m10:38:10.216467 [debug] [ThreadPool]: SQL status: OK in 0.042 seconds
[0m10:38:10.218473 [debug] [ThreadPool]: On list_ducklake_aemo: ROLLBACK
[0m10:38:10.218473 [debug] [ThreadPool]: Failed to rollback 'list_ducklake_aemo'
[0m10:38:10.218473 [debug] [ThreadPool]: On list_ducklake_aemo: Close
[0m10:38:10.221299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '97a9ea6d-2c84-403a-827c-174e06c4ba97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDB6A38450>]}
[0m10:38:10.221299 [debug] [MainThread]: Using duckdb connection "master"
[0m10:38:10.221299 [debug] [MainThread]: On master: BEGIN
[0m10:38:10.221299 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:38:10.221299 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:38:10.221299 [debug] [MainThread]: On master: COMMIT
[0m10:38:10.221299 [debug] [MainThread]: Using duckdb connection "master"
[0m10:38:10.221299 [debug] [MainThread]: On master: COMMIT
[0m10:38:10.221299 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:38:10.221299 [info ] [MainThread]: [DOWNLOAD] Starting download with PATH_ROOT=/lakehouse/default, download_limit=2
[0m10:38:10.237448 [debug] [MainThread]: Using duckdb connection "master"
[0m10:38:10.237448 [debug] [MainThread]: On master: BEGIN
[0m10:38:10.237448 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m10:38:10.237448 [debug] [MainThread]: Using duckdb connection "master"
[0m10:38:10.237448 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "master"} */

SET VARIABLE PATH_ROOT = '/lakehouse/default'

[0m10:38:10.237448 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:38:10.237448 [debug] [MainThread]: Using duckdb connection "master"
[0m10:38:10.237448 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "master"} */

SET VARIABLE download_limit = 2

[0m10:38:10.237448 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:38:10.249026 [debug] [MainThread]: Using duckdb connection "master"
[0m10:38:10.249026 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "master"} */

SET VARIABLE csv_archive_path = getvariable('PATH_ROOT') || '/Files/csv'

[0m10:38:10.251034 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:38:10.251034 [debug] [MainThread]: Using duckdb connection "master"
[0m10:38:10.253040 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "master"} */

CREATE SCHEMA IF NOT EXISTS ducklake.aemo

[0m10:38:10.260288 [debug] [MainThread]: SQL status: OK in 0.007 seconds
[0m10:38:10.260913 [debug] [MainThread]: Using duckdb connection "master"
[0m10:38:10.260913 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "master"} */

USE ducklake.aemo

[0m10:38:10.260913 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:38:10.267072 [info ] [MainThread]: [DOWNLOAD] Daily source: aemo
[0m10:38:10.267072 [debug] [MainThread]: Using duckdb connection "master"
[0m10:38:10.267072 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "master"} */

CREATE OR REPLACE TEMP TABLE daily_files_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('https://nemweb.com.au/Reports/Current/Daily_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'https://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DAILY%.zip%'
ORDER BY full_url DESC

[0m10:38:10.398132 [debug] [MainThread]: SQL status: OK in 0.133 seconds
[0m10:38:10.408233 [debug] [MainThread]: Using duckdb connection "master"
[0m10:38:10.408233 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "master"} */

CREATE OR REPLACE TEMP TABLE daily_to_archive AS
SELECT full_url, filename
FROM daily_files_web
WHERE filename NOT IN (SELECT source_filename FROM ducklake.aemo.csv_archive_log WHERE source_type = 'daily')
LIMIT getvariable('download_limit')

[0m10:38:10.411962 [debug] [MainThread]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "master"} */

CREATE OR REPLACE TEMP TABLE daily_to_archive AS
SELECT full_url, filename
FROM daily_files_web
WHERE filename NOT IN (SELECT source_filename FROM ducklake.aemo.csv_archive_log WHERE source_type = 'daily')
LIMIT getvariable('download_limit')

[0m10:38:10.411962 [debug] [MainThread]: DuckDB adapter: Rolling back transaction.
[0m10:38:10.443801 [debug] [MainThread]: On master: ROLLBACK
[0m10:38:10.509455 [debug] [MainThread]: Failed to rollback 'master'
[0m10:38:10.509455 [debug] [MainThread]: On master: Close
[0m10:38:10.509455 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:38:10.509455 [debug] [MainThread]: Connection 'create_ducklake_aemo' was properly closed.
[0m10:38:10.509455 [debug] [MainThread]: Connection 'list_ducklake_aemo' was properly closed.
[0m10:38:10.509455 [info ] [MainThread]: 
[0m10:38:10.509455 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 1.07 seconds (1.07s).
[0m10:38:10.509455 [error] [MainThread]: Encountered an error:
Runtime Error
  Catalog Error: Table with name csv_archive_log does not exist!
  Did you mean "information_schema.constraint_column_usage"?
  
  LINE 6: WHERE filename NOT IN (SELECT source_filename FROM ducklake.aemo.csv_archive_log WHERE source_type = 'daily')
                                                             ^
[0m10:38:10.509455 [debug] [MainThread]: Command `dbt run` failed at 10:38:10.509455 after 3.51 seconds
[0m10:38:10.509455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDB6068290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDAFD70310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DDB6DA89D0>]}
[0m10:38:10.523334 [debug] [MainThread]: Flushing usage events
[0m10:38:11.517759 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:40:32.877206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000145C1B12550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000145C1B117D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000145C1B11B90>]}


============================== 10:40:32.885603 | db787692-e6ce-4640-b261-eb415799f316 ==============================
[0m10:40:32.885603 [info ] [MainThread]: Running with dbt=1.11.2
[0m10:40:32.885603 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\lakehouse\\default\\Files\\dbt', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\lakehouse\\default\\Files\\dbt\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True'}
[0m10:40:33.170665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'db787692-e6ce-4640-b261-eb415799f316', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000145C1B6A310>]}
[0m10:40:33.218542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'db787692-e6ce-4640-b261-eb415799f316', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000145C1BE1210>]}
[0m10:40:33.235076 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m10:40:33.596658 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m10:40:33.676486 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m10:40:33.676486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'db787692-e6ce-4640-b261-eb415799f316', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000145BFC9E2D0>]}
[0m10:40:34.762908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'db787692-e6ce-4640-b261-eb415799f316', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000145C3111350>]}
[0m10:40:34.850289 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m10:40:34.858194 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m10:40:34.931097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'db787692-e6ce-4640-b261-eb415799f316', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000145C32F0910>]}
[0m10:40:34.932131 [info ] [MainThread]: Found 8 models, 474 macros
[0m10:40:34.934423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db787692-e6ce-4640-b261-eb415799f316', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000145C1BC3810>]}
[0m10:40:34.938802 [info ] [MainThread]: 
[0m10:40:34.940522 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:40:34.941887 [info ] [MainThread]: 
[0m10:40:34.944294 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m10:40:34.951504 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake'
[0m10:40:35.245810 [debug] [ThreadPool]: Using duckdb connection "list_ducklake"
[0m10:40:35.245810 [debug] [ThreadPool]: On list_ducklake: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"ducklake"'
    
  
  
[0m10:40:35.245810 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:40:35.671684 [debug] [ThreadPool]: SQL status: OK in 0.415 seconds
[0m10:40:35.671684 [debug] [ThreadPool]: On list_ducklake: Close
[0m10:40:35.671684 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ducklake, now create_ducklake_aemo)
[0m10:40:35.671684 [debug] [ThreadPool]: Creating schema "database: "ducklake"
schema: "aemo"
"
[0m10:40:35.671684 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:40:35.671684 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
        select type from duckdb_databases()
        where lower(database_name)='ducklake'
        and type='sqlite'
    
  
[0m10:40:35.671684 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:40:35.671684 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m10:40:35.687349 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:40:35.687349 [debug] [ThreadPool]: On create_ducklake_aemo: BEGIN
[0m10:40:35.687349 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m10:40:35.687349 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:40:35.687349 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
    
        create schema if not exists "ducklake"."aemo"
    
[0m10:40:35.687349 [debug] [ThreadPool]: SQL status: OK in 0.005 seconds
[0m10:40:35.687349 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m10:40:35.687349 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:40:35.687349 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m10:40:35.705931 [debug] [ThreadPool]: SQL status: OK in 0.007 seconds
[0m10:40:35.705931 [debug] [ThreadPool]: On create_ducklake_aemo: Close
[0m10:40:35.705931 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake_aemo'
[0m10:40:35.705931 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m10:40:35.705931 [debug] [ThreadPool]: On list_ducklake_aemo: BEGIN
[0m10:40:35.705931 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:40:35.705931 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m10:40:35.705931 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m10:40:35.718935 [debug] [ThreadPool]: On list_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake_aemo"} */
select
      'ducklake' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'aemo'
    and lower(table_catalog) = 'ducklake'
  
[0m10:40:35.770305 [debug] [ThreadPool]: SQL status: OK in 0.055 seconds
[0m10:40:35.770305 [debug] [ThreadPool]: On list_ducklake_aemo: ROLLBACK
[0m10:40:35.770305 [debug] [ThreadPool]: Failed to rollback 'list_ducklake_aemo'
[0m10:40:35.770305 [debug] [ThreadPool]: On list_ducklake_aemo: Close
[0m10:40:35.782995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db787692-e6ce-4640-b261-eb415799f316', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000145C32689D0>]}
[0m10:40:35.782995 [debug] [MainThread]: Using duckdb connection "master"
[0m10:40:35.782995 [debug] [MainThread]: On master: BEGIN
[0m10:40:35.782995 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:40:35.782995 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:40:35.782995 [debug] [MainThread]: On master: COMMIT
[0m10:40:35.782995 [debug] [MainThread]: Using duckdb connection "master"
[0m10:40:35.782995 [debug] [MainThread]: On master: COMMIT
[0m10:40:35.782995 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m10:40:35.782995 [debug] [MainThread]: On master: Close
[0m10:40:35.797815 [debug] [Thread-1 (]: Began running node model.aemo_electricity.csv_archive_log
[0m10:40:35.797815 [info ] [Thread-1 (]: 1 of 8 START sql incremental model aemo.csv_archive_log ........................ [RUN]
[0m10:40:35.797815 [debug] [Thread-1 (]: Acquiring new duckdb connection 'model.aemo_electricity.csv_archive_log'
[0m10:40:35.797815 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.csv_archive_log
[0m10:40:35.814932 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.csv_archive_log"
[0m10:40:35.819313 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.csv_archive_log
[0m10:40:35.902575 [info ] [Thread-1 (]: [DOWNLOAD] Starting download with PATH_ROOT=/lakehouse/default, download_limit=2
[0m10:40:35.902575 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:35.902575 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: BEGIN
[0m10:40:35.902575 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:40:35.902575 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m10:40:35.902575 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:35.902575 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

SET VARIABLE PATH_ROOT = '/lakehouse/default'

[0m10:40:35.902575 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m10:40:35.902575 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:35.902575 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

SET VARIABLE download_limit = 2

[0m10:40:35.918834 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m10:40:35.919345 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:35.920355 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

SET VARIABLE csv_archive_path = getvariable('PATH_ROOT') || '/Files/csv'

[0m10:40:35.921933 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m10:40:35.923171 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:35.924302 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

CREATE SCHEMA IF NOT EXISTS ducklake.aemo

[0m10:40:35.926987 [debug] [Thread-1 (]: SQL status: OK in 0.007 seconds
[0m10:40:35.926987 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:35.926987 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

USE ducklake.aemo

[0m10:40:35.934510 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m10:40:35.935523 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:35.936631 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

CREATE TABLE IF NOT EXISTS ducklake.aemo.csv_archive_log (
  source_type VARCHAR,
  source_filename VARCHAR,
  archive_path VARCHAR,
  archived_at TIMESTAMP,
  row_count BIGINT,
  source_url VARCHAR,
  etag VARCHAR
)

[0m10:40:35.937517 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m10:40:35.938522 [info ] [Thread-1 (]: [DOWNLOAD] Daily source: aemo
[0m10:40:35.939523 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:35.940524 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE daily_files_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('https://nemweb.com.au/Reports/Current/Daily_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'https://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DAILY%.zip%'
ORDER BY full_url DESC

[0m10:40:36.066140 [debug] [Thread-1 (]: SQL status: OK in 0.134 seconds
[0m10:40:36.066140 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:36.066140 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE daily_to_archive AS
SELECT full_url, filename
FROM daily_files_web
WHERE filename NOT IN (SELECT source_filename FROM ducklake.aemo.csv_archive_log WHERE source_type = 'daily')
LIMIT getvariable('download_limit')

[0m10:40:36.082167 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m10:40:36.082167 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:36.082167 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

SET VARIABLE has_daily_to_archive = (SELECT count(*) > 0 FROM daily_to_archive)

[0m10:40:36.082167 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m10:40:36.082167 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:36.082167 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

SET VARIABLE daily_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM daily_to_archive)

[0m10:40:36.098333 [debug] [Thread-1 (]: SQL status: OK in 0.006 seconds
[0m10:40:36.098333 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:36.098333 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

SET VARIABLE daily_expected = (SELECT count(*) FROM daily_to_archive)

[0m10:40:36.098333 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m10:40:36.114058 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:36.114058 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

SET VARIABLE daily_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM daily_to_archive)

[0m10:40:36.120327 [debug] [Thread-1 (]: SQL status: OK in 0.007 seconds
[0m10:40:36.120327 [info ] [Thread-1 (]: [DOWNLOAD] Processing daily files...
[0m10:40:36.120327 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:36.120327 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    CAST(substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 4) AS INT) AS year
  FROM read_blob(getvariable('daily_urls'))
  WHERE getvariable('has_daily_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/daily')
(FORMAT BLOB, PARTITION_BY (year, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m10:40:36.783886 [debug] [Thread-1 (]: SQL status: OK in 0.658 seconds
[0m10:40:36.789542 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:36.789542 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'daily' AS source_type,
  filename AS source_filename,
  '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM daily_to_archive
WHERE getvariable('daily_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('daily_paths'))) = getvariable('daily_expected')

[0m10:40:47.433056 [debug] [Thread-1 (]: SQL status: OK in 10.639 seconds
[0m10:40:47.433056 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:47.433056 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE intraday_scada_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('http://nemweb.com.au/Reports/Current/Dispatch_SCADA/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'http://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DISPATCHSCADA%'
ORDER BY full_url DESC
LIMIT 500

[0m10:40:47.579116 [debug] [Thread-1 (]: SQL status: OK in 0.152 seconds
[0m10:40:47.579116 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:47.579116 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE scada_today_to_archive AS
SELECT full_url, filename
FROM intraday_scada_web
WHERE filename NOT IN (SELECT source_filename FROM ducklake.aemo.csv_archive_log WHERE source_type = 'scada_today')
LIMIT getvariable('download_limit')

[0m10:40:50.410810 [debug] [Thread-1 (]: SQL status: OK in 2.818 seconds
[0m10:40:50.412029 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:50.413298 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

SET VARIABLE has_scada_today_to_archive = (SELECT count(*) > 0 FROM scada_today_to_archive)

[0m10:40:50.414891 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m10:40:50.417234 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:50.418490 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

SET VARIABLE scada_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM scada_today_to_archive)

[0m10:40:50.420967 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m10:40:50.420967 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:50.420967 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

SET VARIABLE scada_expected = (SELECT count(*) FROM scada_today_to_archive)

[0m10:40:50.428631 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m10:40:50.430404 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:50.431651 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

SET VARIABLE scada_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/scada_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM scada_today_to_archive)

[0m10:40:50.436606 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m10:40:50.438548 [info ] [Thread-1 (]: [DOWNLOAD] Processing intraday SCADA files...
[0m10:40:50.439077 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:50.439077 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 8) AS day
  FROM read_blob(getvariable('scada_urls'))
  WHERE getvariable('has_scada_today_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/scada_today')
(FORMAT BLOB, PARTITION_BY (day, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m10:40:50.568073 [debug] [Thread-1 (]: SQL status: OK in 0.127 seconds
[0m10:40:50.569027 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:50.569027 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'scada_today' AS source_type,
  filename AS source_filename,
  '/scada_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM scada_today_to_archive
WHERE getvariable('scada_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('scada_paths'))) = getvariable('scada_expected')

[0m10:40:55.897220 [debug] [Thread-1 (]: SQL status: OK in 5.332 seconds
[0m10:40:55.897220 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:55.908262 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE intraday_price_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('http://nemweb.com.au/Reports/Current/DispatchIS_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'http://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DISPATCHIS_%.zip%'
ORDER BY full_url DESC
LIMIT 500

[0m10:40:56.055491 [debug] [Thread-1 (]: SQL status: OK in 0.148 seconds
[0m10:40:56.060064 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:56.060064 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE price_today_to_archive AS
SELECT full_url, filename
FROM intraday_price_web
WHERE filename NOT IN (SELECT source_filename FROM ducklake.aemo.csv_archive_log WHERE source_type = 'price_today')
LIMIT getvariable('download_limit')

[0m10:40:58.273198 [debug] [Thread-1 (]: SQL status: OK in 2.214 seconds
[0m10:40:58.273198 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:58.273198 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

SET VARIABLE has_price_today_to_archive = (SELECT count(*) > 0 FROM price_today_to_archive)

[0m10:40:58.279843 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m10:40:58.279843 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:58.279843 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

SET VARIABLE price_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM price_today_to_archive)

[0m10:40:58.279843 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m10:40:58.279843 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:58.279843 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

SET VARIABLE price_expected = (SELECT count(*) FROM price_today_to_archive)

[0m10:40:58.279843 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m10:40:58.279843 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:58.279843 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

SET VARIABLE price_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/price_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM price_today_to_archive)

[0m10:40:58.279843 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m10:40:58.279843 [info ] [Thread-1 (]: [DOWNLOAD] Processing intraday PRICE files...
[0m10:40:58.295910 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:58.296696 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 8) AS day
  FROM read_blob(getvariable('price_urls'))
  WHERE getvariable('has_price_today_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/price_today')
(FORMAT BLOB, PARTITION_BY (day, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m10:40:58.450560 [debug] [Thread-1 (]: SQL status: OK in 0.158 seconds
[0m10:40:58.450560 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:40:58.458778 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'price_today' AS source_type,
  filename AS source_filename,
  '/price_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM price_today_to_archive
WHERE getvariable('price_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('price_paths'))) = getvariable('price_expected')

[0m10:41:03.305081 [debug] [Thread-1 (]: SQL status: OK in 4.854 seconds
[0m10:41:03.305081 [info ] [Thread-1 (]: [DOWNLOAD] Refreshing 4 DUID reference files...
[0m10:41:03.321015 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:41:03.321015 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

COPY (SELECT 1 AS id, 'init' AS dummy) TO (getvariable('csv_archive_path') || '/duid')
(FORMAT csv, PARTITION_BY (dummy), FILE_EXTENSION 'csv', OVERWRITE_OR_IGNORE)

[0m10:41:03.321015 [debug] [Thread-1 (]: SQL status: OK in 0.006 seconds
[0m10:41:03.321015 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:41:03.336997 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/djouallah-patch-1/duid_data.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/duid_data.csv') (FORMAT CSV, HEADER)

[0m10:41:03.642451 [debug] [Thread-1 (]: SQL status: OK in 0.303 seconds
[0m10:41:03.644459 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:41:03.644459 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://data.wa.aemo.com.au/datafiles/post-facilities/facilities.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/facilities.csv') (FORMAT CSV, HEADER)

[0m10:41:03.850117 [debug] [Thread-1 (]: SQL status: OK in 0.218 seconds
[0m10:41:03.867875 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:41:03.867875 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/main/WA_ENERGY.csv', header=true, null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/WA_ENERGY.csv') (FORMAT CSV, HEADER)

[0m10:41:04.150724 [debug] [Thread-1 (]: SQL status: OK in 0.279 seconds
[0m10:41:04.154753 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:41:04.157782 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/main/geo_data.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/geo_data.csv') (FORMAT CSV, HEADER)

[0m10:41:04.445632 [debug] [Thread-1 (]: SQL status: OK in 0.297 seconds
[0m10:41:04.445632 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:41:04.461274 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

DELETE FROM ducklake.aemo.csv_archive_log WHERE source_type LIKE 'duid_%'

[0m10:41:06.755724 [debug] [Thread-1 (]: SQL status: OK in 2.295 seconds
[0m10:41:06.755724 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:41:06.755724 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT * FROM (VALUES
  ('duid_data', 'duid_data', '/duid/duid_data.csv', now()),
  ('duid_facilities', 'facilities', '/duid/facilities.csv', now()),
  ('duid_wa_energy', 'WA_ENERGY', '/duid/WA_ENERGY.csv', now()),
  ('duid_geo_data', 'geo_data', '/duid/geo_data.csv', now())
) AS t(source_type, source_filename, archive_path, archived_at)

[0m10:41:11.604654 [debug] [Thread-1 (]: SQL status: OK in 4.853 seconds
[0m10:41:11.604654 [info ] [Thread-1 (]: [DOWNLOAD] DUID files written: 4
[0m10:41:11.604654 [info ] [Thread-1 (]: [DOWNLOAD COMPLETE]
[0m10:41:11.640060 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.csv_archive_log"
[0m10:41:11.645631 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.csv_archive_log"
[0m10:41:11.646838 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

  
    
    

    create  table
      "ducklake"."aemo"."csv_archive_log"
  
    as (
      



SELECT 
  source_type,
  source_filename,
  archive_path,
  archived_at,
  row_count,
  source_url,
  etag
FROM ducklake.aemo.csv_archive_log

    );
  
  
  
[0m10:41:11.656125 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.csv_archive_log"} */

  
    
    

    create  table
      "ducklake"."aemo"."csv_archive_log"
  
    as (
      



SELECT 
  source_type,
  source_filename,
  archive_path,
  archived_at,
  row_count,
  source_url,
  etag
FROM ducklake.aemo.csv_archive_log

    );
  
  
  
[0m10:41:11.657835 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m10:41:11.658202 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: ROLLBACK
[0m10:41:11.675607 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.csv_archive_log'
[0m10:41:11.676608 [debug] [Thread-1 (]: On model.aemo_electricity.csv_archive_log: Close
[0m10:41:22.278627 [debug] [Thread-1 (]: Runtime Error in model csv_archive_log (models\staging\csv_archive_log.sql)
  Catalog Error: Table with name "csv_archive_log" already exists
[0m10:41:22.284678 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db787692-e6ce-4640-b261-eb415799f316', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000145C37E8B10>]}
[0m10:41:22.288488 [error] [Thread-1 (]: 1 of 8 ERROR creating sql incremental model aemo.csv_archive_log ............... [[31mERROR[0m in 46.48s]
[0m10:41:22.288488 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.csv_archive_log
[0m10:41:22.288488 [debug] [Thread-1 (]: Began running node model.aemo_electricity.dim_calendar
[0m10:41:22.288488 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.csv_archive_log' to be skipped because of status 'error'.  Reason: Runtime Error in model csv_archive_log (models\staging\csv_archive_log.sql)
  Catalog Error: Table with name "csv_archive_log" already exists.
[0m10:41:22.288488 [info ] [Thread-1 (]: 2 of 8 START sql incremental model aemo.dim_calendar ........................... [RUN]
[0m10:41:22.302338 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.csv_archive_log, now model.aemo_electricity.dim_calendar)
[0m10:41:22.303426 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.dim_calendar
[0m10:41:22.303426 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.dim_calendar"
[0m10:41:22.303426 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.dim_calendar
[0m10:41:22.321209 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.dim_calendar"
[0m10:41:22.332050 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m10:41:22.333047 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: BEGIN
[0m10:41:22.335046 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:41:22.337415 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m10:41:22.338289 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m10:41:22.340404 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

  
    
    

    create  table
      "ducklake"."aemo"."dim_calendar"
  
    as (
      

SELECT
  CAST(date AS DATE) as date,
  CAST(EXTRACT(year FROM date) AS INT) as year,
  CAST(EXTRACT(month FROM date) AS INT) as month
FROM (
  SELECT unnest(generate_series(
    CAST('2018-04-01' AS DATE),
    CAST('2026-12-31' AS DATE),
    INTERVAL 1 DAY
  )) as date
)
    );
  
  
  
[0m10:41:26.703009 [debug] [Thread-1 (]: SQL status: OK in 4.363 seconds
[0m10:41:26.715392 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: COMMIT
[0m10:41:26.715392 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m10:41:26.715392 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: COMMIT
[0m10:41:26.734547 [debug] [Thread-1 (]: SQL status: OK in 0.017 seconds
[0m10:41:26.734547 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: Close
[0m10:41:26.734547 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db787692-e6ce-4640-b261-eb415799f316', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000145C38753D0>]}
[0m10:41:26.734547 [info ] [Thread-1 (]: 2 of 8 OK created sql incremental model aemo.dim_calendar ...................... [[32mOK[0m in 4.43s]
[0m10:41:26.734547 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.dim_calendar
[0m10:41:26.734547 [debug] [Thread-1 (]: Began running node model.aemo_electricity.dim_duid
[0m10:41:26.734547 [info ] [Thread-1 (]: 3 of 8 START sql table model aemo.dim_duid ..................................... [RUN]
[0m10:41:26.734547 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.dim_calendar, now model.aemo_electricity.dim_duid)
[0m10:41:26.734547 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.dim_duid
[0m10:41:26.746557 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.dim_duid"
[0m10:41:26.746557 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.dim_duid
[0m10:41:26.757424 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.dim_duid"
[0m10:41:26.757424 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m10:41:26.757424 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: BEGIN
[0m10:41:26.757424 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:41:26.757424 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m10:41:26.757424 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m10:41:26.757424 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

  
    
    

    create  table
      "ducklake"."aemo"."dim_duid__dbt_tmp"
  
    as (
      

WITH
  states AS (
    SELECT 'WA1' AS RegionID, 'Western Australia' AS State
    UNION ALL SELECT 'QLD1', 'Queensland'
    UNION ALL SELECT 'NSW1', 'New South Wales'
    UNION ALL SELECT 'TAS1', 'Tasmania'
    UNION ALL SELECT 'SA1', 'South Australia'
    UNION ALL SELECT 'VIC1', 'Victoria'
  ),

  duid_aemo AS (
    SELECT
      DUID AS DUID,
      first(Region) AS Region,
      first("Fuel Source - Descriptor") AS FuelSourceDescriptor,
      first(Participant) AS Participant
    FROM
      read_csv('/lakehouse/default/Files/csv/duid/duid_data.csv')
    WHERE
      length(DUID) > 2
    GROUP BY
      DUID
  ),

  wa_facilities AS (
    SELECT
      'WA1' AS Region,
      "Facility Code" AS DUID,
      "Participant Name" AS Participant
    FROM
      read_csv_auto('/lakehouse/default/Files/csv/duid/facilities.csv')
  ),

  wa_energy AS (
    SELECT *
    FROM read_csv_auto('/lakehouse/default/Files/csv/duid/WA_ENERGY.csv', header = 1)
  ),

  duid_wa AS (
    SELECT
      wa_facilities.DUID,
      wa_facilities.Region,
      wa_energy.Technology AS FuelSourceDescriptor,
      wa_facilities.Participant
    FROM wa_facilities
    LEFT JOIN wa_energy ON wa_facilities.DUID = wa_energy.DUID
  ),

  duid_all AS (
    SELECT * FROM duid_aemo
    UNION ALL
    SELECT * FROM duid_wa
  ),

  geo AS (
    SELECT
      duid,
      max(latitude) as latitude,
      max(longitude) as longitude
    FROM read_csv('/lakehouse/default/Files/csv/duid/geo_data.csv')
    WHERE latitude IS NOT NULL
    GROUP BY duid
  )

SELECT
  a.DUID,
  a.Region,
  UPPER(LEFT(TRIM(FuelSourceDescriptor), 1)) || LOWER(SUBSTR(TRIM(FuelSourceDescriptor), 2)) AS FuelSourceDescriptor,
  a.Participant,
  states.State,
  geo.latitude,
  geo.longitude
FROM duid_all a
JOIN states ON a.Region = states.RegionID
LEFT JOIN geo ON a.duid = geo.duid
    );
  
  
[0m10:41:30.992715 [debug] [Thread-1 (]: SQL status: OK in 4.231 seconds
[0m10:41:31.011965 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m10:41:31.011965 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */
alter table "ducklake"."aemo"."dim_duid__dbt_tmp" rename to "dim_duid"
[0m10:41:31.019918 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m10:41:31.019918 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: COMMIT
[0m10:41:31.019918 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m10:41:31.019918 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: COMMIT
[0m10:41:31.043729 [debug] [Thread-1 (]: SQL status: OK in 0.025 seconds
[0m10:41:31.043729 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m10:41:31.043729 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

      drop table if exists "ducklake"."aemo"."dim_duid__dbt_backup"
    
[0m10:41:31.090940 [debug] [Thread-1 (]: SQL status: OK in 0.035 seconds
[0m10:41:31.090940 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: Close
[0m10:41:31.090940 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db787692-e6ce-4640-b261-eb415799f316', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000145C3324F10>]}
[0m10:41:31.090940 [info ] [Thread-1 (]: 3 of 8 OK created sql table model aemo.dim_duid ................................ [[32mOK[0m in 4.36s]
[0m10:41:31.090940 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.dim_duid
[0m10:41:31.090940 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_price
[0m10:41:31.098220 [info ] [Thread-1 (]: 4 of 8 SKIP relation aemo.fct_price ............................................ [[33mSKIP[0m]
[0m10:41:31.098220 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_price
[0m10:41:31.098220 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_price_today
[0m10:41:31.098220 [info ] [Thread-1 (]: 5 of 8 SKIP relation aemo.fct_price_today ...................................... [[33mSKIP[0m]
[0m10:41:31.098220 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_price_today
[0m10:41:31.098220 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_scada
[0m10:41:31.102762 [info ] [Thread-1 (]: 6 of 8 SKIP relation aemo.fct_scada ............................................ [[33mSKIP[0m]
[0m10:41:31.103773 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_scada
[0m10:41:31.103773 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_scada_today
[0m10:41:31.103773 [info ] [Thread-1 (]: 7 of 8 SKIP relation aemo.fct_scada_today ...................................... [[33mSKIP[0m]
[0m10:41:31.103773 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_scada_today
[0m10:41:31.106657 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_summary
[0m10:41:31.107025 [info ] [Thread-1 (]: 8 of 8 SKIP relation aemo.fct_summary .......................................... [[33mSKIP[0m]
[0m10:41:31.108038 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_summary
[0m10:41:31.108038 [debug] [MainThread]: Using duckdb connection "master"
[0m10:41:31.108038 [debug] [MainThread]: On master: BEGIN
[0m10:41:31.108038 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:41:31.108038 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:41:31.108038 [debug] [MainThread]: On master: COMMIT
[0m10:41:31.108038 [debug] [MainThread]: Using duckdb connection "master"
[0m10:41:31.108038 [debug] [MainThread]: On master: COMMIT
[0m10:41:31.108038 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m10:41:31.108038 [debug] [MainThread]: On master: Close
[0m10:41:31.108038 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:41:31.108038 [debug] [MainThread]: Connection 'create_ducklake_aemo' was properly closed.
[0m10:41:31.108038 [debug] [MainThread]: Connection 'list_ducklake_aemo' was properly closed.
[0m10:41:31.108038 [debug] [MainThread]: Connection 'model.aemo_electricity.dim_duid' was properly closed.
[0m10:41:31.108038 [info ] [MainThread]: 
[0m10:41:31.119911 [info ] [MainThread]: Finished running 7 incremental models, 1 table model in 0 hours 0 minutes and 56.16 seconds (56.16s).
[0m10:41:31.121524 [debug] [MainThread]: Command end result
[0m10:41:31.139505 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m10:41:31.147780 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m10:41:31.156168 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\lakehouse\default\Files\dbt\target\run_results.json
[0m10:41:31.156168 [info ] [MainThread]: 
[0m10:41:31.156168 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m10:41:31.156168 [info ] [MainThread]: 
[0m10:41:31.156168 [error] [MainThread]: [31mFailure in model csv_archive_log (models\staging\csv_archive_log.sql)[0m
[0m10:41:31.156168 [error] [MainThread]:   Runtime Error in model csv_archive_log (models\staging\csv_archive_log.sql)
  Catalog Error: Table with name "csv_archive_log" already exists
[0m10:41:31.156168 [info ] [MainThread]: 
[0m10:41:31.163939 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\staging\csv_archive_log.sql
[0m10:41:31.163939 [info ] [MainThread]: 
[0m10:41:31.164947 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=5 NO-OP=0 TOTAL=8
[0m10:41:31.167947 [debug] [MainThread]: Command `dbt run` failed at 10:41:31.166947 after 58.41 seconds
[0m10:41:31.167947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000145C1886610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000145BB930310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000145BB762650>]}
[0m10:41:31.168948 [debug] [MainThread]: Flushing usage events
[0m10:41:32.134462 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:45:33.833429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023BC75864D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023BC780B290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023BC7809E50>]}


============================== 10:45:33.849395 | 0c0ac848-1cb7-4273-9061-0e89fd117e09 ==============================
[0m10:45:33.849395 [info ] [MainThread]: Running with dbt=1.11.2
[0m10:45:33.851406 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\lakehouse\\default\\Files\\dbt', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'None', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\lakehouse\\default\\Files\\dbt\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'invocation_command': 'dbt run-operation download', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'target_path': 'None'}
[0m10:45:34.180971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0c0ac848-1cb7-4273-9061-0e89fd117e09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023BC7A74890>]}
[0m10:45:34.226373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0c0ac848-1cb7-4273-9061-0e89fd117e09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023BC33E8A50>]}
[0m10:45:34.238878 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m10:45:34.665488 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m10:45:34.883464 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 0 files added, 6 files changed.
[0m10:45:34.883464 [debug] [MainThread]: Partial parsing: updated file: aemo_electricity://models\sources.yml
[0m10:45:34.885470 [debug] [MainThread]: Partial parsing: deleted file: aemo_electricity://models\staging\csv_archive_log.sql
[0m10:45:34.885470 [debug] [MainThread]: Partial parsing: updated file: aemo_electricity://models\marts\fct_price.sql
[0m10:45:34.885470 [debug] [MainThread]: Partial parsing: updated file: aemo_electricity://macros\download.sql
[0m10:45:34.885470 [debug] [MainThread]: Partial parsing: updated file: aemo_electricity://models\marts\fct_scada_today.sql
[0m10:45:34.885470 [debug] [MainThread]: Partial parsing: updated file: aemo_electricity://models\marts\fct_price_today.sql
[0m10:45:34.885470 [debug] [MainThread]: Partial parsing: updated file: aemo_electricity://models\marts\fct_scada.sql
[0m10:45:35.308663 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.aemo_electricity.staging
[0m10:45:35.319887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0c0ac848-1cb7-4273-9061-0e89fd117e09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023BC7184FD0>]}
[0m10:45:35.390177 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m10:45:35.393193 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m10:45:35.456282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0c0ac848-1cb7-4273-9061-0e89fd117e09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023BC908AE10>]}
[0m10:45:35.456282 [info ] [MainThread]: Found 7 models, 1 source, 474 macros
[0m10:45:35.456282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0c0ac848-1cb7-4273-9061-0e89fd117e09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023BC7F8A190>]}
[0m10:45:35.456282 [debug] [MainThread]: Acquiring new duckdb connection 'macro_download'
[0m10:45:35.456282 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:35.456282 [debug] [MainThread]: On macro_download: BEGIN
[0m10:45:35.456282 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:45:35.873556 [debug] [MainThread]: SQL status: OK in 0.408 seconds
[0m10:45:35.873556 [debug] [MainThread]: On macro_download: COMMIT
[0m10:45:35.875563 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:35.875563 [debug] [MainThread]: On macro_download: COMMIT
[0m10:45:35.875563 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m10:45:35.895345 [info ] [MainThread]: [DOWNLOAD] Starting download with PATH_ROOT=/lakehouse/default, download_limit=2
[0m10:45:36.092671 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:36.108763 [debug] [MainThread]: On macro_download: BEGIN
[0m10:45:36.108763 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m10:45:36.110772 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:36.110772 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE PATH_ROOT = '/lakehouse/default'

[0m10:45:36.110772 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:45:36.110772 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:36.110772 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE download_limit = 2

[0m10:45:36.110772 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:45:36.110772 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:36.119377 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE csv_archive_path = getvariable('PATH_ROOT') || '/Files/csv'

[0m10:45:36.119377 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:45:36.121383 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:36.121383 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE SCHEMA IF NOT EXISTS ducklake.aemo

[0m10:45:36.155565 [debug] [MainThread]: SQL status: OK in 0.033 seconds
[0m10:45:36.158331 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:36.158331 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

USE ducklake.aemo

[0m10:45:36.158331 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m10:45:36.158331 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:36.158331 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE TABLE IF NOT EXISTS ducklake.aemo.csv_archive_log (
  source_type VARCHAR,
  source_filename VARCHAR,
  archive_path VARCHAR,
  archived_at TIMESTAMP,
  row_count BIGINT,
  source_url VARCHAR,
  etag VARCHAR
)

[0m10:45:36.158331 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:45:36.158331 [info ] [MainThread]: [DOWNLOAD] Daily source: aemo
[0m10:45:36.158331 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:36.158331 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE daily_files_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('https://nemweb.com.au/Reports/Current/Daily_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'https://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DAILY%.zip%'
ORDER BY full_url DESC

[0m10:45:36.276754 [debug] [MainThread]: SQL status: OK in 0.110 seconds
[0m10:45:36.276754 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:36.276754 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE daily_to_archive AS
SELECT full_url, filename
FROM daily_files_web
WHERE filename NOT IN (SELECT source_filename FROM ducklake.aemo.csv_archive_log WHERE source_type = 'daily')
LIMIT getvariable('download_limit')

[0m10:45:36.280739 [debug] [MainThread]: SQL status: OK in 0.002 seconds
[0m10:45:36.283321 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:36.283321 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE has_daily_to_archive = (SELECT count(*) > 0 FROM daily_to_archive)

[0m10:45:36.283321 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:45:36.283321 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:36.283321 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE daily_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM daily_to_archive)

[0m10:45:36.283321 [debug] [MainThread]: SQL status: OK in 0.003 seconds
[0m10:45:36.291846 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:36.291846 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE daily_expected = (SELECT count(*) FROM daily_to_archive)

[0m10:45:36.293852 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:45:36.293852 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:36.293852 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE daily_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM daily_to_archive)

[0m10:45:36.299704 [debug] [MainThread]: SQL status: OK in 0.004 seconds
[0m10:45:36.299704 [info ] [MainThread]: [DOWNLOAD] Processing daily files...
[0m10:45:36.299704 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:36.299704 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    CAST(substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 4) AS INT) AS year
  FROM read_blob(getvariable('daily_urls'))
  WHERE getvariable('has_daily_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/daily')
(FORMAT BLOB, PARTITION_BY (year, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m10:45:36.929128 [debug] [MainThread]: SQL status: OK in 0.636 seconds
[0m10:45:36.943835 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:36.943835 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'daily' AS source_type,
  filename AS source_filename,
  '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM daily_to_archive
WHERE getvariable('daily_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('daily_paths'))) = getvariable('daily_expected')

[0m10:45:46.368313 [debug] [MainThread]: SQL status: OK in 9.435 seconds
[0m10:45:46.384440 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:46.384440 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE intraday_scada_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('http://nemweb.com.au/Reports/Current/Dispatch_SCADA/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'http://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DISPATCHSCADA%'
ORDER BY full_url DESC
LIMIT 500

[0m10:45:46.515317 [debug] [MainThread]: SQL status: OK in 0.129 seconds
[0m10:45:46.515317 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:46.515317 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE scada_today_to_archive AS
SELECT full_url, filename
FROM intraday_scada_web
WHERE filename NOT IN (SELECT source_filename FROM ducklake.aemo.csv_archive_log WHERE source_type = 'scada_today')
LIMIT getvariable('download_limit')

[0m10:45:49.203696 [debug] [MainThread]: SQL status: OK in 2.685 seconds
[0m10:45:49.203696 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:49.203696 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE has_scada_today_to_archive = (SELECT count(*) > 0 FROM scada_today_to_archive)

[0m10:45:49.203696 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:45:49.203696 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:49.203696 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE scada_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM scada_today_to_archive)

[0m10:45:49.211825 [debug] [MainThread]: SQL status: OK in 0.004 seconds
[0m10:45:49.216788 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:49.216788 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE scada_expected = (SELECT count(*) FROM scada_today_to_archive)

[0m10:45:49.219873 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:45:49.220392 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:49.220392 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE scada_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/scada_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM scada_today_to_archive)

[0m10:45:49.220392 [debug] [MainThread]: SQL status: OK in 0.004 seconds
[0m10:45:49.228577 [info ] [MainThread]: [DOWNLOAD] Processing intraday SCADA files...
[0m10:45:49.228577 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:49.228577 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 8) AS day
  FROM read_blob(getvariable('scada_urls'))
  WHERE getvariable('has_scada_today_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/scada_today')
(FORMAT BLOB, PARTITION_BY (day, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m10:45:49.354317 [debug] [MainThread]: SQL status: OK in 0.127 seconds
[0m10:45:49.354317 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:49.361487 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'scada_today' AS source_type,
  filename AS source_filename,
  '/scada_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM scada_today_to_archive
WHERE getvariable('scada_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('scada_paths'))) = getvariable('scada_expected')

[0m10:45:55.873941 [debug] [MainThread]: SQL status: OK in 6.511 seconds
[0m10:45:55.875607 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:55.875607 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE intraday_price_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('http://nemweb.com.au/Reports/Current/DispatchIS_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'http://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DISPATCHIS_%.zip%'
ORDER BY full_url DESC
LIMIT 500

[0m10:45:56.006770 [debug] [MainThread]: SQL status: OK in 0.129 seconds
[0m10:45:56.007692 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:56.007692 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE price_today_to_archive AS
SELECT full_url, filename
FROM intraday_price_web
WHERE filename NOT IN (SELECT source_filename FROM ducklake.aemo.csv_archive_log WHERE source_type = 'price_today')
LIMIT getvariable('download_limit')

[0m10:45:58.358033 [debug] [MainThread]: SQL status: OK in 2.346 seconds
[0m10:45:58.358033 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:58.358033 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE has_price_today_to_archive = (SELECT count(*) > 0 FROM price_today_to_archive)

[0m10:45:58.358033 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:45:58.358033 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:58.358033 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE price_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM price_today_to_archive)

[0m10:45:58.370503 [debug] [MainThread]: SQL status: OK in 0.003 seconds
[0m10:45:58.371944 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:58.373953 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE price_expected = (SELECT count(*) FROM price_today_to_archive)

[0m10:45:58.375688 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:45:58.377251 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:58.377770 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE price_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/price_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM price_today_to_archive)

[0m10:45:58.382313 [debug] [MainThread]: SQL status: OK in 0.004 seconds
[0m10:45:58.383346 [info ] [MainThread]: [DOWNLOAD] Processing intraday PRICE files...
[0m10:45:58.384967 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:58.386009 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 8) AS day
  FROM read_blob(getvariable('price_urls'))
  WHERE getvariable('has_price_today_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/price_today')
(FORMAT BLOB, PARTITION_BY (day, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m10:45:58.547836 [debug] [MainThread]: SQL status: OK in 0.166 seconds
[0m10:45:58.556581 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:45:58.557583 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'price_today' AS source_type,
  filename AS source_filename,
  '/price_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM price_today_to_archive
WHERE getvariable('price_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('price_paths'))) = getvariable('price_expected')

[0m10:46:04.736932 [debug] [MainThread]: SQL status: OK in 6.176 seconds
[0m10:46:04.740022 [info ] [MainThread]: [DOWNLOAD] Refreshing 4 DUID reference files...
[0m10:46:04.742025 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:46:04.743999 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (SELECT 1 AS id, 'init' AS dummy) TO (getvariable('csv_archive_path') || '/duid')
(FORMAT csv, PARTITION_BY (dummy), FILE_EXTENSION 'csv', OVERWRITE_OR_IGNORE)

[0m10:46:04.747019 [debug] [MainThread]: SQL status: OK in 0.005 seconds
[0m10:46:04.751787 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:46:04.751787 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/djouallah-patch-1/duid_data.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/duid_data.csv') (FORMAT CSV, HEADER)

[0m10:46:05.073423 [debug] [MainThread]: SQL status: OK in 0.316 seconds
[0m10:46:05.075513 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:46:05.075513 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT * FROM read_csv_auto('https://data.wa.aemo.com.au/datafiles/post-facilities/facilities.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/facilities.csv') (FORMAT CSV, HEADER)

[0m10:46:05.292056 [debug] [MainThread]: SQL status: OK in 0.214 seconds
[0m10:46:05.296179 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:46:05.296179 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/main/WA_ENERGY.csv', header=true, null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/WA_ENERGY.csv') (FORMAT CSV, HEADER)

[0m10:46:05.572482 [debug] [MainThread]: SQL status: OK in 0.274 seconds
[0m10:46:05.578254 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:46:05.578254 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/main/geo_data.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/geo_data.csv') (FORMAT CSV, HEADER)

[0m10:46:05.863526 [debug] [MainThread]: SQL status: OK in 0.288 seconds
[0m10:46:05.863526 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:46:05.863526 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

DELETE FROM ducklake.aemo.csv_archive_log WHERE source_type LIKE 'duid_%'

[0m10:46:08.515149 [debug] [MainThread]: SQL status: OK in 2.637 seconds
[0m10:46:08.516411 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:46:08.517398 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT * FROM (VALUES
  ('duid_data', 'duid_data', '/duid/duid_data.csv', now()),
  ('duid_facilities', 'facilities', '/duid/facilities.csv', now()),
  ('duid_wa_energy', 'WA_ENERGY', '/duid/WA_ENERGY.csv', now()),
  ('duid_geo_data', 'geo_data', '/duid/geo_data.csv', now())
) AS t(source_type, source_filename, archive_path, archived_at)

[0m10:46:14.389752 [debug] [MainThread]: SQL status: OK in 5.877 seconds
[0m10:46:14.389752 [info ] [MainThread]: [DOWNLOAD] DUID files written: 4
[0m10:46:14.400452 [info ] [MainThread]: [DOWNLOAD COMPLETE]
[0m10:46:14.400452 [debug] [MainThread]: On macro_download: ROLLBACK
[0m10:46:14.408205 [debug] [MainThread]: Failed to rollback 'macro_download'
[0m10:46:14.409200 [debug] [MainThread]: On macro_download: Close
[0m10:46:24.041058 [debug] [MainThread]: Wrote artifact RunResultsArtifact to C:\lakehouse\default\Files\dbt\target\run_results.json
[0m10:46:24.047956 [debug] [MainThread]: Command `dbt run-operation` succeeded at 10:46:24.047956 after 50.36 seconds
[0m10:46:24.049972 [debug] [MainThread]: Connection 'macro_download' was properly closed.
[0m10:46:24.051989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023BC16D0250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023BC7586590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023BC56520D0>]}
[0m10:46:24.054008 [debug] [MainThread]: Flushing usage events
[0m10:46:25.049240 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:46:57.314965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226CA908C10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226CA90BC10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226CA90BBD0>]}


============================== 10:46:57.320038 | d5907708-d689-444a-9779-2e4ad7b20335 ==============================
[0m10:46:57.320038 [info ] [MainThread]: Running with dbt=1.11.2
[0m10:46:57.320038 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\lakehouse\\default\\Files\\dbt', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\lakehouse\\default\\Files\\dbt\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m10:46:57.622697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd5907708-d689-444a-9779-2e4ad7b20335', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226CAA9A990>]}
[0m10:46:57.667877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd5907708-d689-444a-9779-2e4ad7b20335', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226C64F9A90>]}
[0m10:46:57.683920 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m10:46:58.057122 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m10:46:58.221212 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:46:58.221212 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m10:46:58.223218 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:46:58.227231 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.aemo_electricity.staging
[0m10:46:58.253480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd5907708-d689-444a-9779-2e4ad7b20335', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226CA9085D0>]}
[0m10:46:58.309052 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m10:46:58.323438 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m10:46:58.376334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd5907708-d689-444a-9779-2e4ad7b20335', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226CC161B50>]}
[0m10:46:58.376334 [info ] [MainThread]: Found 7 models, 1 source, 474 macros
[0m10:46:58.380109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd5907708-d689-444a-9779-2e4ad7b20335', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226CA9E8A50>]}
[0m10:46:58.382115 [info ] [MainThread]: 
[0m10:46:58.382115 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:46:58.384120 [info ] [MainThread]: 
[0m10:46:58.385332 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m10:46:58.394638 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake'
[0m10:46:58.665745 [debug] [ThreadPool]: Using duckdb connection "list_ducklake"
[0m10:46:58.665745 [debug] [ThreadPool]: On list_ducklake: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"ducklake"'
    
  
  
[0m10:46:58.665745 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:46:59.065309 [debug] [ThreadPool]: SQL status: OK in 0.398 seconds
[0m10:46:59.065309 [debug] [ThreadPool]: On list_ducklake: Close
[0m10:46:59.065309 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ducklake, now create_ducklake_aemo)
[0m10:46:59.065309 [debug] [ThreadPool]: Creating schema "database: "ducklake"
schema: "aemo"
"
[0m10:46:59.081453 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:46:59.081453 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
        select type from duckdb_databases()
        where lower(database_name)='ducklake'
        and type='sqlite'
    
  
[0m10:46:59.081453 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:46:59.081453 [debug] [ThreadPool]: SQL status: OK in 0.003 seconds
[0m10:46:59.081453 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:46:59.081453 [debug] [ThreadPool]: On create_ducklake_aemo: BEGIN
[0m10:46:59.097121 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m10:46:59.099364 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:46:59.101376 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
    
        create schema if not exists "ducklake"."aemo"
    
[0m10:46:59.106745 [debug] [ThreadPool]: SQL status: OK in 0.010 seconds
[0m10:46:59.113350 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m10:46:59.113350 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:46:59.113350 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m10:46:59.133446 [debug] [ThreadPool]: SQL status: OK in 0.017 seconds
[0m10:46:59.133446 [debug] [ThreadPool]: On create_ducklake_aemo: Close
[0m10:46:59.133446 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake_aemo'
[0m10:46:59.145470 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m10:46:59.145470 [debug] [ThreadPool]: On list_ducklake_aemo: BEGIN
[0m10:46:59.145470 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:46:59.145470 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m10:46:59.145470 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m10:46:59.145470 [debug] [ThreadPool]: On list_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake_aemo"} */
select
      'ducklake' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'aemo'
    and lower(table_catalog) = 'ducklake'
  
[0m10:46:59.192924 [debug] [ThreadPool]: SQL status: OK in 0.051 seconds
[0m10:46:59.192924 [debug] [ThreadPool]: On list_ducklake_aemo: ROLLBACK
[0m10:46:59.192924 [debug] [ThreadPool]: Failed to rollback 'list_ducklake_aemo'
[0m10:46:59.192924 [debug] [ThreadPool]: On list_ducklake_aemo: Close
[0m10:46:59.192924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd5907708-d689-444a-9779-2e4ad7b20335', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226CA9BCE10>]}
[0m10:46:59.192924 [debug] [MainThread]: Using duckdb connection "master"
[0m10:46:59.208738 [debug] [MainThread]: On master: BEGIN
[0m10:46:59.208738 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:46:59.208738 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:46:59.210748 [debug] [MainThread]: On master: COMMIT
[0m10:46:59.210748 [debug] [MainThread]: Using duckdb connection "master"
[0m10:46:59.210748 [debug] [MainThread]: On master: COMMIT
[0m10:46:59.210748 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m10:46:59.212756 [debug] [MainThread]: On master: Close
[0m10:46:59.218776 [debug] [Thread-1 (]: Began running node model.aemo_electricity.dim_calendar
[0m10:46:59.220781 [info ] [Thread-1 (]: 1 of 7 START sql incremental model aemo.dim_calendar ........................... [RUN]
[0m10:46:59.221787 [debug] [Thread-1 (]: Acquiring new duckdb connection 'model.aemo_electricity.dim_calendar'
[0m10:46:59.221787 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.dim_calendar
[0m10:46:59.228809 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.dim_calendar"
[0m10:46:59.230812 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.dim_calendar
[0m10:46:59.279009 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.dim_calendar"
[0m10:46:59.279009 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m10:46:59.279009 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: BEGIN
[0m10:46:59.279009 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:46:59.279009 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m10:46:59.279009 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m10:46:59.279009 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

  
    
    

    create  table
      "ducklake"."aemo"."dim_calendar"
  
    as (
      

SELECT
  CAST(date AS DATE) as date,
  CAST(EXTRACT(year FROM date) AS INT) as year,
  CAST(EXTRACT(month FROM date) AS INT) as month
FROM (
  SELECT unnest(generate_series(
    CAST('2018-04-01' AS DATE),
    CAST('2026-12-31' AS DATE),
    INTERVAL 1 DAY
  )) as date
)
    );
  
  
  
[0m10:47:10.084478 [debug] [Thread-1 (]: SQL status: OK in 10.797 seconds
[0m10:47:10.096677 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: COMMIT
[0m10:47:10.097367 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m10:47:10.098502 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: COMMIT
[0m10:47:10.116899 [debug] [Thread-1 (]: SQL status: OK in 0.018 seconds
[0m10:47:10.118994 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: Close
[0m10:47:10.123108 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5907708-d689-444a-9779-2e4ad7b20335', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226CAB7DC50>]}
[0m10:47:10.124061 [info ] [Thread-1 (]: 1 of 7 OK created sql incremental model aemo.dim_calendar ...................... [[32mOK[0m in 10.90s]
[0m10:47:10.125162 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.dim_calendar
[0m10:47:10.125162 [debug] [Thread-1 (]: Began running node model.aemo_electricity.dim_duid
[0m10:47:10.126162 [info ] [Thread-1 (]: 2 of 7 START sql table model aemo.dim_duid ..................................... [RUN]
[0m10:47:10.126850 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.dim_calendar, now model.aemo_electricity.dim_duid)
[0m10:47:10.127855 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.dim_duid
[0m10:47:10.132097 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.dim_duid"
[0m10:47:10.134201 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.dim_duid
[0m10:47:10.148603 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.dim_duid"
[0m10:47:10.150412 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m10:47:10.151403 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: BEGIN
[0m10:47:10.152401 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:10.152401 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m10:47:10.153400 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m10:47:10.153400 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

  
    
    

    create  table
      "ducklake"."aemo"."dim_duid__dbt_tmp"
  
    as (
      

WITH
  states AS (
    SELECT 'WA1' AS RegionID, 'Western Australia' AS State
    UNION ALL SELECT 'QLD1', 'Queensland'
    UNION ALL SELECT 'NSW1', 'New South Wales'
    UNION ALL SELECT 'TAS1', 'Tasmania'
    UNION ALL SELECT 'SA1', 'South Australia'
    UNION ALL SELECT 'VIC1', 'Victoria'
  ),

  duid_aemo AS (
    SELECT
      DUID AS DUID,
      first(Region) AS Region,
      first("Fuel Source - Descriptor") AS FuelSourceDescriptor,
      first(Participant) AS Participant
    FROM
      read_csv('/lakehouse/default/Files/csv/duid/duid_data.csv')
    WHERE
      length(DUID) > 2
    GROUP BY
      DUID
  ),

  wa_facilities AS (
    SELECT
      'WA1' AS Region,
      "Facility Code" AS DUID,
      "Participant Name" AS Participant
    FROM
      read_csv_auto('/lakehouse/default/Files/csv/duid/facilities.csv')
  ),

  wa_energy AS (
    SELECT *
    FROM read_csv_auto('/lakehouse/default/Files/csv/duid/WA_ENERGY.csv', header = 1)
  ),

  duid_wa AS (
    SELECT
      wa_facilities.DUID,
      wa_facilities.Region,
      wa_energy.Technology AS FuelSourceDescriptor,
      wa_facilities.Participant
    FROM wa_facilities
    LEFT JOIN wa_energy ON wa_facilities.DUID = wa_energy.DUID
  ),

  duid_all AS (
    SELECT * FROM duid_aemo
    UNION ALL
    SELECT * FROM duid_wa
  ),

  geo AS (
    SELECT
      duid,
      max(latitude) as latitude,
      max(longitude) as longitude
    FROM read_csv('/lakehouse/default/Files/csv/duid/geo_data.csv')
    WHERE latitude IS NOT NULL
    GROUP BY duid
  )

SELECT
  a.DUID,
  a.Region,
  UPPER(LEFT(TRIM(FuelSourceDescriptor), 1)) || LOWER(SUBSTR(TRIM(FuelSourceDescriptor), 2)) AS FuelSourceDescriptor,
  a.Participant,
  states.State,
  geo.latitude,
  geo.longitude
FROM duid_all a
JOIN states ON a.Region = states.RegionID
LEFT JOIN geo ON a.duid = geo.duid
    );
  
  
[0m10:47:14.632462 [debug] [Thread-1 (]: SQL status: OK in 4.482 seconds
[0m10:47:14.632462 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m10:47:14.632462 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */
alter table "ducklake"."aemo"."dim_duid__dbt_tmp" rename to "dim_duid"
[0m10:47:14.632462 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m10:47:14.632462 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: COMMIT
[0m10:47:14.632462 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m10:47:14.632462 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: COMMIT
[0m10:47:14.663953 [debug] [Thread-1 (]: SQL status: OK in 0.019 seconds
[0m10:47:14.663953 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m10:47:14.663953 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

      drop table if exists "ducklake"."aemo"."dim_duid__dbt_backup"
    
[0m10:47:14.695551 [debug] [Thread-1 (]: SQL status: OK in 0.036 seconds
[0m10:47:14.711464 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: Close
[0m10:47:14.711464 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5907708-d689-444a-9779-2e4ad7b20335', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226CC161890>]}
[0m10:47:14.711464 [info ] [Thread-1 (]: 2 of 7 OK created sql table model aemo.dim_duid ................................ [[32mOK[0m in 4.58s]
[0m10:47:14.711464 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.dim_duid
[0m10:47:14.711464 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_price
[0m10:47:14.711464 [info ] [Thread-1 (]: 3 of 7 START sql incremental model aemo.fct_price .............................. [RUN]
[0m10:47:14.711464 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.dim_duid, now model.aemo_electricity.fct_price)
[0m10:47:14.711464 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_price
[0m10:47:14.711464 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_price"
[0m10:47:14.727375 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_price
[0m10:47:14.734426 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_price"
[0m10:47:14.734426 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price"
[0m10:47:14.734426 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: BEGIN
[0m10:47:14.739150 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:14.739150 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m10:47:14.742040 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price"
[0m10:47:14.742040 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."csv_archive_log"
  WHERE source_type = 'daily'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/daily/year=' || substring(source_filename, 14, 4) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

price_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'TOTALDEMAND': 'VARCHAR',
      'DEMANDFORECAST': 'VARCHAR',
      'DISPATCHABLEGENERATION': 'VARCHAR',
      'DISPATCHABLELOAD': 'VARCHAR',
      'NETINTERCHANGE': 'VARCHAR',
      'EXCESSGENERATION': 'VARCHAR',
      'LOWER5MINDISPATCH': 'VARCHAR',
      'LOWER5MINIMPORT': 'VARCHAR',
      'LOWER5MINLOCALDISPATCH': 'VARCHAR',
      'LOWER5MINLOCALPRICE': 'VARCHAR',
      'LOWER5MINLOCALREQ': 'VARCHAR',
      'LOWER5MINPRICE': 'VARCHAR',
      'LOWER5MINREQ': 'VARCHAR',
      'LOWER5MINSUPPLYPRICE': 'VARCHAR',
      'LOWER60SECDISPATCH': 'VARCHAR',
      'LOWER60SECIMPORT': 'VARCHAR',
      'LOWER60SECLOCALDISPATCH': 'VARCHAR',
      'LOWER60SECLOCALPRICE': 'VARCHAR',
      'LOWER60SECLOCALREQ': 'VARCHAR',
      'LOWER60SECPRICE': 'VARCHAR',
      'LOWER60SECREQ': 'VARCHAR',
      'LOWER60SECSUPPLYPRICE': 'VARCHAR',
      'LOWER6SECDISPATCH': 'VARCHAR',
      'LOWER6SECIMPORT': 'VARCHAR',
      'LOWER6SECLOCALDISPATCH': 'VARCHAR',
      'LOWER6SECLOCALPRICE': 'VARCHAR',
      'LOWER6SECLOCALREQ': 'VARCHAR',
      'LOWER6SECPRICE': 'VARCHAR',
      'LOWER6SECREQ': 'VARCHAR',
      'LOWER6SECSUPPLYPRICE': 'VARCHAR',
      'RAISE5MINDISPATCH': 'VARCHAR',
      'RAISE5MINIMPORT': 'VARCHAR',
      'RAISE5MINLOCALDISPATCH': 'VARCHAR',
      'RAISE5MINLOCALPRICE': 'VARCHAR',
      'RAISE5MINLOCALREQ': 'VARCHAR',
      'RAISE5MINPRICE': 'VARCHAR',
      'RAISE5MINREQ': 'VARCHAR',
      'RAISE5MINSUPPLYPRICE': 'VARCHAR',
      'RAISE60SECDISPATCH': 'VARCHAR',
      'RAISE60SECIMPORT': 'VARCHAR',
      'RAISE60SECLOCALDISPATCH': 'VARCHAR',
      'RAISE60SECLOCALPRICE': 'VARCHAR',
      'RAISE60SECLOCALREQ': 'VARCHAR',
      'RAISE60SECPRICE': 'VARCHAR',
      'RAISE60SECREQ': 'VARCHAR',
      'RAISE60SECSUPPLYPRICE': 'VARCHAR',
      'RAISE6SECDISPATCH': 'VARCHAR',
      'RAISE6SECIMPORT': 'VARCHAR',
      'RAISE6SECLOCALDISPATCH': 'VARCHAR',
      'RAISE6SECLOCALPRICE': 'VARCHAR',
      'RAISE6SECLOCALREQ': 'VARCHAR',
      'RAISE6SECPRICE': 'VARCHAR',
      'RAISE6SECREQ': 'VARCHAR',
      'RAISE6SECSUPPLYPRICE': 'VARCHAR',
      'AGGREGATEDISPATCHERROR': 'VARCHAR',
      'AVAILABLEGENERATION': 'VARCHAR',
      'AVAILABLELOAD': 'VARCHAR',
      'INITIALSUPPLY': 'VARCHAR',
      'CLEAREDSUPPLY': 'VARCHAR',
      'LOWERREGIMPORT': 'VARCHAR',
      'LOWERREGLOCALDISPATCH': 'VARCHAR',
      'LOWERREGLOCALREQ': 'VARCHAR',
      'LOWERREGREQ': 'VARCHAR',
      'RAISEREGIMPORT': 'VARCHAR',
      'RAISEREGLOCALDISPATCH': 'VARCHAR',
      'RAISEREGLOCALREQ': 'VARCHAR',
      'RAISEREGREQ': 'VARCHAR',
      'RAISE5MINLOCALVIOLATION': 'VARCHAR',
      'RAISEREGLOCALVIOLATION': 'VARCHAR',
      'RAISE60SECLOCALVIOLATION': 'VARCHAR',
      'RAISE6SECLOCALVIOLATION': 'VARCHAR',
      'LOWER5MINLOCALVIOLATION': 'VARCHAR',
      'LOWERREGLOCALVIOLATION': 'VARCHAR',
      'LOWER60SECLOCALVIOLATION': 'VARCHAR',
      'LOWER6SECLOCALVIOLATION': 'VARCHAR',
      'RAISE5MINVIOLATION': 'VARCHAR',
      'RAISEREGVIOLATION': 'VARCHAR',
      'RAISE60SECVIOLATION': 'VARCHAR',
      'RAISE6SECVIOLATION': 'VARCHAR',
      'LOWER5MINVIOLATION': 'VARCHAR',
      'LOWERREGVIOLATION': 'VARCHAR',
      'LOWER60SECVIOLATION': 'VARCHAR',
      'LOWER6SECVIOLATION': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR',
      'LORSURPLUS': 'VARCHAR',
      'LRCSURPLUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DREGION' AND VERSION = '3'
)

SELECT
  UNIT,
  REGIONID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(TOTALDEMAND AS DOUBLE) AS TOTALDEMAND,
  CAST(DEMANDFORECAST AS DOUBLE) AS DEMANDFORECAST,
  CAST(DISPATCHABLEGENERATION AS DOUBLE) AS DISPATCHABLEGENERATION,
  CAST(DISPATCHABLELOAD AS DOUBLE) AS DISPATCHABLELOAD,
  CAST(NETINTERCHANGE AS DOUBLE) AS NETINTERCHANGE,
  CAST(EXCESSGENERATION AS DOUBLE) AS EXCESSGENERATION,
  CAST(LOWER5MINDISPATCH AS DOUBLE) AS LOWER5MINDISPATCH,
  CAST(LOWER5MINIMPORT AS DOUBLE) AS LOWER5MINIMPORT,
  CAST(LOWER5MINLOCALDISPATCH AS DOUBLE) AS LOWER5MINLOCALDISPATCH,
  CAST(LOWER5MINLOCALPRICE AS DOUBLE) AS LOWER5MINLOCALPRICE,
  CAST(LOWER5MINLOCALREQ AS DOUBLE) AS LOWER5MINLOCALREQ,
  CAST(LOWER5MINPRICE AS DOUBLE) AS LOWER5MINPRICE,
  CAST(LOWER5MINREQ AS DOUBLE) AS LOWER5MINREQ,
  CAST(LOWER5MINSUPPLYPRICE AS DOUBLE) AS LOWER5MINSUPPLYPRICE,
  CAST(LOWER60SECDISPATCH AS DOUBLE) AS LOWER60SECDISPATCH,
  CAST(LOWER60SECIMPORT AS DOUBLE) AS LOWER60SECIMPORT,
  CAST(LOWER60SECLOCALDISPATCH AS DOUBLE) AS LOWER60SECLOCALDISPATCH,
  CAST(LOWER60SECLOCALPRICE AS DOUBLE) AS LOWER60SECLOCALPRICE,
  CAST(LOWER60SECLOCALREQ AS DOUBLE) AS LOWER60SECLOCALREQ,
  CAST(LOWER60SECPRICE AS DOUBLE) AS LOWER60SECPRICE,
  CAST(LOWER60SECREQ AS DOUBLE) AS LOWER60SECREQ,
  CAST(LOWER60SECSUPPLYPRICE AS DOUBLE) AS LOWER60SECSUPPLYPRICE,
  CAST(LOWER6SECDISPATCH AS DOUBLE) AS LOWER6SECDISPATCH,
  CAST(LOWER6SECIMPORT AS DOUBLE) AS LOWER6SECIMPORT,
  CAST(LOWER6SECLOCALDISPATCH AS DOUBLE) AS LOWER6SECLOCALDISPATCH,
  CAST(LOWER6SECLOCALPRICE AS DOUBLE) AS LOWER6SECLOCALPRICE,
  CAST(LOWER6SECLOCALREQ AS DOUBLE) AS LOWER6SECLOCALREQ,
  CAST(LOWER6SECPRICE AS DOUBLE) AS LOWER6SECPRICE,
  CAST(LOWER6SECREQ AS DOUBLE) AS LOWER6SECREQ,
  CAST(LOWER6SECSUPPLYPRICE AS DOUBLE) AS LOWER6SECSUPPLYPRICE,
  CAST(RAISE5MINDISPATCH AS DOUBLE) AS RAISE5MINDISPATCH,
  CAST(RAISE5MINIMPORT AS DOUBLE) AS RAISE5MINIMPORT,
  CAST(RAISE5MINLOCALDISPATCH AS DOUBLE) AS RAISE5MINLOCALDISPATCH,
  CAST(RAISE5MINLOCALPRICE AS DOUBLE) AS RAISE5MINLOCALPRICE,
  CAST(RAISE5MINLOCALREQ AS DOUBLE) AS RAISE5MINLOCALREQ,
  CAST(RAISE5MINPRICE AS DOUBLE) AS RAISE5MINPRICE,
  CAST(RAISE5MINREQ AS DOUBLE) AS RAISE5MINREQ,
  CAST(RAISE5MINSUPPLYPRICE AS DOUBLE) AS RAISE5MINSUPPLYPRICE,
  CAST(RAISE60SECDISPATCH AS DOUBLE) AS RAISE60SECDISPATCH,
  CAST(RAISE60SECIMPORT AS DOUBLE) AS RAISE60SECIMPORT,
  CAST(RAISE60SECLOCALDISPATCH AS DOUBLE) AS RAISE60SECLOCALDISPATCH,
  CAST(RAISE60SECLOCALPRICE AS DOUBLE) AS RAISE60SECLOCALPRICE,
  CAST(RAISE60SECLOCALREQ AS DOUBLE) AS RAISE60SECLOCALREQ,
  CAST(RAISE60SECPRICE AS DOUBLE) AS RAISE60SECPRICE,
  CAST(RAISE60SECREQ AS DOUBLE) AS RAISE60SECREQ,
  CAST(RAISE60SECSUPPLYPRICE AS DOUBLE) AS RAISE60SECSUPPLYPRICE,
  CAST(RAISE6SECDISPATCH AS DOUBLE) AS RAISE6SECDISPATCH,
  CAST(RAISE6SECIMPORT AS DOUBLE) AS RAISE6SECIMPORT,
  CAST(RAISE6SECLOCALDISPATCH AS DOUBLE) AS RAISE6SECLOCALDISPATCH,
  CAST(RAISE6SECLOCALPRICE AS DOUBLE) AS RAISE6SECLOCALPRICE,
  CAST(RAISE6SECLOCALREQ AS DOUBLE) AS RAISE6SECLOCALREQ,
  CAST(RAISE6SECPRICE AS DOUBLE) AS RAISE6SECPRICE,
  CAST(RAISE6SECREQ AS DOUBLE) AS RAISE6SECREQ,
  CAST(RAISE6SECSUPPLYPRICE AS DOUBLE) AS RAISE6SECSUPPLYPRICE,
  CAST(AGGREGATEDISPATCHERROR AS DOUBLE) AS AGGREGATEDISPATCHERROR,
  CAST(AVAILABLEGENERATION AS DOUBLE) AS AVAILABLEGENERATION,
  CAST(AVAILABLELOAD AS DOUBLE) AS AVAILABLELOAD,
  CAST(INITIALSUPPLY AS DOUBLE) AS INITIALSUPPLY,
  CAST(CLEAREDSUPPLY AS DOUBLE) AS CLEAREDSUPPLY,
  CAST(LOWERREGIMPORT AS DOUBLE) AS LOWERREGIMPORT,
  CAST(LOWERREGLOCALDISPATCH AS DOUBLE) AS LOWERREGLOCALDISPATCH,
  CAST(LOWERREGLOCALREQ AS DOUBLE) AS LOWERREGLOCALREQ,
  CAST(LOWERREGREQ AS DOUBLE) AS LOWERREGREQ,
  CAST(RAISEREGIMPORT AS DOUBLE) AS RAISEREGIMPORT,
  CAST(RAISEREGLOCALDISPATCH AS DOUBLE) AS RAISEREGLOCALDISPATCH,
  CAST(RAISEREGLOCALREQ AS DOUBLE) AS RAISEREGLOCALREQ,
  CAST(RAISEREGREQ AS DOUBLE) AS RAISEREGREQ,
  CAST(RAISE5MINLOCALVIOLATION AS DOUBLE) AS RAISE5MINLOCALVIOLATION,
  CAST(RAISEREGLOCALVIOLATION AS DOUBLE) AS RAISEREGLOCALVIOLATION,
  CAST(RAISE60SECLOCALVIOLATION AS DOUBLE) AS RAISE60SECLOCALVIOLATION,
  CAST(RAISE6SECLOCALVIOLATION AS DOUBLE) AS RAISE6SECLOCALVIOLATION,
  CAST(LOWER5MINLOCALVIOLATION AS DOUBLE) AS LOWER5MINLOCALVIOLATION,
  CAST(LOWERREGLOCALVIOLATION AS DOUBLE) AS LOWERREGLOCALVIOLATION,
  CAST(LOWER60SECLOCALVIOLATION AS DOUBLE) AS LOWER60SECLOCALVIOLATION,
  CAST(LOWER6SECLOCALVIOLATION AS DOUBLE) AS LOWER6SECLOCALVIOLATION,
  CAST(RAISE5MINVIOLATION AS DOUBLE) AS RAISE5MINVIOLATION,
  CAST(RAISEREGVIOLATION AS DOUBLE) AS RAISEREGVIOLATION,
  CAST(RAISE60SECVIOLATION AS DOUBLE) AS RAISE60SECVIOLATION,
  CAST(RAISE6SECVIOLATION AS DOUBLE) AS RAISE6SECVIOLATION,
  CAST(LOWER5MINVIOLATION AS DOUBLE) AS LOWER5MINVIOLATION,
  CAST(LOWERREGVIOLATION AS DOUBLE) AS LOWERREGVIOLATION,
  CAST(LOWER60SECVIOLATION AS DOUBLE) AS LOWER60SECVIOLATION,
  CAST(LOWER6SECVIOLATION AS DOUBLE) AS LOWER6SECVIOLATION,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  CAST(LORSURPLUS AS DOUBLE) AS LORSURPLUS,
  CAST(LRCSURPLUS AS DOUBLE) AS LRCSURPLUS,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m10:47:14.753884 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."csv_archive_log"
  WHERE source_type = 'daily'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/daily/year=' || substring(source_filename, 14, 4) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

price_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'TOTALDEMAND': 'VARCHAR',
      'DEMANDFORECAST': 'VARCHAR',
      'DISPATCHABLEGENERATION': 'VARCHAR',
      'DISPATCHABLELOAD': 'VARCHAR',
      'NETINTERCHANGE': 'VARCHAR',
      'EXCESSGENERATION': 'VARCHAR',
      'LOWER5MINDISPATCH': 'VARCHAR',
      'LOWER5MINIMPORT': 'VARCHAR',
      'LOWER5MINLOCALDISPATCH': 'VARCHAR',
      'LOWER5MINLOCALPRICE': 'VARCHAR',
      'LOWER5MINLOCALREQ': 'VARCHAR',
      'LOWER5MINPRICE': 'VARCHAR',
      'LOWER5MINREQ': 'VARCHAR',
      'LOWER5MINSUPPLYPRICE': 'VARCHAR',
      'LOWER60SECDISPATCH': 'VARCHAR',
      'LOWER60SECIMPORT': 'VARCHAR',
      'LOWER60SECLOCALDISPATCH': 'VARCHAR',
      'LOWER60SECLOCALPRICE': 'VARCHAR',
      'LOWER60SECLOCALREQ': 'VARCHAR',
      'LOWER60SECPRICE': 'VARCHAR',
      'LOWER60SECREQ': 'VARCHAR',
      'LOWER60SECSUPPLYPRICE': 'VARCHAR',
      'LOWER6SECDISPATCH': 'VARCHAR',
      'LOWER6SECIMPORT': 'VARCHAR',
      'LOWER6SECLOCALDISPATCH': 'VARCHAR',
      'LOWER6SECLOCALPRICE': 'VARCHAR',
      'LOWER6SECLOCALREQ': 'VARCHAR',
      'LOWER6SECPRICE': 'VARCHAR',
      'LOWER6SECREQ': 'VARCHAR',
      'LOWER6SECSUPPLYPRICE': 'VARCHAR',
      'RAISE5MINDISPATCH': 'VARCHAR',
      'RAISE5MINIMPORT': 'VARCHAR',
      'RAISE5MINLOCALDISPATCH': 'VARCHAR',
      'RAISE5MINLOCALPRICE': 'VARCHAR',
      'RAISE5MINLOCALREQ': 'VARCHAR',
      'RAISE5MINPRICE': 'VARCHAR',
      'RAISE5MINREQ': 'VARCHAR',
      'RAISE5MINSUPPLYPRICE': 'VARCHAR',
      'RAISE60SECDISPATCH': 'VARCHAR',
      'RAISE60SECIMPORT': 'VARCHAR',
      'RAISE60SECLOCALDISPATCH': 'VARCHAR',
      'RAISE60SECLOCALPRICE': 'VARCHAR',
      'RAISE60SECLOCALREQ': 'VARCHAR',
      'RAISE60SECPRICE': 'VARCHAR',
      'RAISE60SECREQ': 'VARCHAR',
      'RAISE60SECSUPPLYPRICE': 'VARCHAR',
      'RAISE6SECDISPATCH': 'VARCHAR',
      'RAISE6SECIMPORT': 'VARCHAR',
      'RAISE6SECLOCALDISPATCH': 'VARCHAR',
      'RAISE6SECLOCALPRICE': 'VARCHAR',
      'RAISE6SECLOCALREQ': 'VARCHAR',
      'RAISE6SECPRICE': 'VARCHAR',
      'RAISE6SECREQ': 'VARCHAR',
      'RAISE6SECSUPPLYPRICE': 'VARCHAR',
      'AGGREGATEDISPATCHERROR': 'VARCHAR',
      'AVAILABLEGENERATION': 'VARCHAR',
      'AVAILABLELOAD': 'VARCHAR',
      'INITIALSUPPLY': 'VARCHAR',
      'CLEAREDSUPPLY': 'VARCHAR',
      'LOWERREGIMPORT': 'VARCHAR',
      'LOWERREGLOCALDISPATCH': 'VARCHAR',
      'LOWERREGLOCALREQ': 'VARCHAR',
      'LOWERREGREQ': 'VARCHAR',
      'RAISEREGIMPORT': 'VARCHAR',
      'RAISEREGLOCALDISPATCH': 'VARCHAR',
      'RAISEREGLOCALREQ': 'VARCHAR',
      'RAISEREGREQ': 'VARCHAR',
      'RAISE5MINLOCALVIOLATION': 'VARCHAR',
      'RAISEREGLOCALVIOLATION': 'VARCHAR',
      'RAISE60SECLOCALVIOLATION': 'VARCHAR',
      'RAISE6SECLOCALVIOLATION': 'VARCHAR',
      'LOWER5MINLOCALVIOLATION': 'VARCHAR',
      'LOWERREGLOCALVIOLATION': 'VARCHAR',
      'LOWER60SECLOCALVIOLATION': 'VARCHAR',
      'LOWER6SECLOCALVIOLATION': 'VARCHAR',
      'RAISE5MINVIOLATION': 'VARCHAR',
      'RAISEREGVIOLATION': 'VARCHAR',
      'RAISE60SECVIOLATION': 'VARCHAR',
      'RAISE6SECVIOLATION': 'VARCHAR',
      'LOWER5MINVIOLATION': 'VARCHAR',
      'LOWERREGVIOLATION': 'VARCHAR',
      'LOWER60SECVIOLATION': 'VARCHAR',
      'LOWER6SECVIOLATION': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR',
      'LORSURPLUS': 'VARCHAR',
      'LRCSURPLUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DREGION' AND VERSION = '3'
)

SELECT
  UNIT,
  REGIONID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(TOTALDEMAND AS DOUBLE) AS TOTALDEMAND,
  CAST(DEMANDFORECAST AS DOUBLE) AS DEMANDFORECAST,
  CAST(DISPATCHABLEGENERATION AS DOUBLE) AS DISPATCHABLEGENERATION,
  CAST(DISPATCHABLELOAD AS DOUBLE) AS DISPATCHABLELOAD,
  CAST(NETINTERCHANGE AS DOUBLE) AS NETINTERCHANGE,
  CAST(EXCESSGENERATION AS DOUBLE) AS EXCESSGENERATION,
  CAST(LOWER5MINDISPATCH AS DOUBLE) AS LOWER5MINDISPATCH,
  CAST(LOWER5MINIMPORT AS DOUBLE) AS LOWER5MINIMPORT,
  CAST(LOWER5MINLOCALDISPATCH AS DOUBLE) AS LOWER5MINLOCALDISPATCH,
  CAST(LOWER5MINLOCALPRICE AS DOUBLE) AS LOWER5MINLOCALPRICE,
  CAST(LOWER5MINLOCALREQ AS DOUBLE) AS LOWER5MINLOCALREQ,
  CAST(LOWER5MINPRICE AS DOUBLE) AS LOWER5MINPRICE,
  CAST(LOWER5MINREQ AS DOUBLE) AS LOWER5MINREQ,
  CAST(LOWER5MINSUPPLYPRICE AS DOUBLE) AS LOWER5MINSUPPLYPRICE,
  CAST(LOWER60SECDISPATCH AS DOUBLE) AS LOWER60SECDISPATCH,
  CAST(LOWER60SECIMPORT AS DOUBLE) AS LOWER60SECIMPORT,
  CAST(LOWER60SECLOCALDISPATCH AS DOUBLE) AS LOWER60SECLOCALDISPATCH,
  CAST(LOWER60SECLOCALPRICE AS DOUBLE) AS LOWER60SECLOCALPRICE,
  CAST(LOWER60SECLOCALREQ AS DOUBLE) AS LOWER60SECLOCALREQ,
  CAST(LOWER60SECPRICE AS DOUBLE) AS LOWER60SECPRICE,
  CAST(LOWER60SECREQ AS DOUBLE) AS LOWER60SECREQ,
  CAST(LOWER60SECSUPPLYPRICE AS DOUBLE) AS LOWER60SECSUPPLYPRICE,
  CAST(LOWER6SECDISPATCH AS DOUBLE) AS LOWER6SECDISPATCH,
  CAST(LOWER6SECIMPORT AS DOUBLE) AS LOWER6SECIMPORT,
  CAST(LOWER6SECLOCALDISPATCH AS DOUBLE) AS LOWER6SECLOCALDISPATCH,
  CAST(LOWER6SECLOCALPRICE AS DOUBLE) AS LOWER6SECLOCALPRICE,
  CAST(LOWER6SECLOCALREQ AS DOUBLE) AS LOWER6SECLOCALREQ,
  CAST(LOWER6SECPRICE AS DOUBLE) AS LOWER6SECPRICE,
  CAST(LOWER6SECREQ AS DOUBLE) AS LOWER6SECREQ,
  CAST(LOWER6SECSUPPLYPRICE AS DOUBLE) AS LOWER6SECSUPPLYPRICE,
  CAST(RAISE5MINDISPATCH AS DOUBLE) AS RAISE5MINDISPATCH,
  CAST(RAISE5MINIMPORT AS DOUBLE) AS RAISE5MINIMPORT,
  CAST(RAISE5MINLOCALDISPATCH AS DOUBLE) AS RAISE5MINLOCALDISPATCH,
  CAST(RAISE5MINLOCALPRICE AS DOUBLE) AS RAISE5MINLOCALPRICE,
  CAST(RAISE5MINLOCALREQ AS DOUBLE) AS RAISE5MINLOCALREQ,
  CAST(RAISE5MINPRICE AS DOUBLE) AS RAISE5MINPRICE,
  CAST(RAISE5MINREQ AS DOUBLE) AS RAISE5MINREQ,
  CAST(RAISE5MINSUPPLYPRICE AS DOUBLE) AS RAISE5MINSUPPLYPRICE,
  CAST(RAISE60SECDISPATCH AS DOUBLE) AS RAISE60SECDISPATCH,
  CAST(RAISE60SECIMPORT AS DOUBLE) AS RAISE60SECIMPORT,
  CAST(RAISE60SECLOCALDISPATCH AS DOUBLE) AS RAISE60SECLOCALDISPATCH,
  CAST(RAISE60SECLOCALPRICE AS DOUBLE) AS RAISE60SECLOCALPRICE,
  CAST(RAISE60SECLOCALREQ AS DOUBLE) AS RAISE60SECLOCALREQ,
  CAST(RAISE60SECPRICE AS DOUBLE) AS RAISE60SECPRICE,
  CAST(RAISE60SECREQ AS DOUBLE) AS RAISE60SECREQ,
  CAST(RAISE60SECSUPPLYPRICE AS DOUBLE) AS RAISE60SECSUPPLYPRICE,
  CAST(RAISE6SECDISPATCH AS DOUBLE) AS RAISE6SECDISPATCH,
  CAST(RAISE6SECIMPORT AS DOUBLE) AS RAISE6SECIMPORT,
  CAST(RAISE6SECLOCALDISPATCH AS DOUBLE) AS RAISE6SECLOCALDISPATCH,
  CAST(RAISE6SECLOCALPRICE AS DOUBLE) AS RAISE6SECLOCALPRICE,
  CAST(RAISE6SECLOCALREQ AS DOUBLE) AS RAISE6SECLOCALREQ,
  CAST(RAISE6SECPRICE AS DOUBLE) AS RAISE6SECPRICE,
  CAST(RAISE6SECREQ AS DOUBLE) AS RAISE6SECREQ,
  CAST(RAISE6SECSUPPLYPRICE AS DOUBLE) AS RAISE6SECSUPPLYPRICE,
  CAST(AGGREGATEDISPATCHERROR AS DOUBLE) AS AGGREGATEDISPATCHERROR,
  CAST(AVAILABLEGENERATION AS DOUBLE) AS AVAILABLEGENERATION,
  CAST(AVAILABLELOAD AS DOUBLE) AS AVAILABLELOAD,
  CAST(INITIALSUPPLY AS DOUBLE) AS INITIALSUPPLY,
  CAST(CLEAREDSUPPLY AS DOUBLE) AS CLEAREDSUPPLY,
  CAST(LOWERREGIMPORT AS DOUBLE) AS LOWERREGIMPORT,
  CAST(LOWERREGLOCALDISPATCH AS DOUBLE) AS LOWERREGLOCALDISPATCH,
  CAST(LOWERREGLOCALREQ AS DOUBLE) AS LOWERREGLOCALREQ,
  CAST(LOWERREGREQ AS DOUBLE) AS LOWERREGREQ,
  CAST(RAISEREGIMPORT AS DOUBLE) AS RAISEREGIMPORT,
  CAST(RAISEREGLOCALDISPATCH AS DOUBLE) AS RAISEREGLOCALDISPATCH,
  CAST(RAISEREGLOCALREQ AS DOUBLE) AS RAISEREGLOCALREQ,
  CAST(RAISEREGREQ AS DOUBLE) AS RAISEREGREQ,
  CAST(RAISE5MINLOCALVIOLATION AS DOUBLE) AS RAISE5MINLOCALVIOLATION,
  CAST(RAISEREGLOCALVIOLATION AS DOUBLE) AS RAISEREGLOCALVIOLATION,
  CAST(RAISE60SECLOCALVIOLATION AS DOUBLE) AS RAISE60SECLOCALVIOLATION,
  CAST(RAISE6SECLOCALVIOLATION AS DOUBLE) AS RAISE6SECLOCALVIOLATION,
  CAST(LOWER5MINLOCALVIOLATION AS DOUBLE) AS LOWER5MINLOCALVIOLATION,
  CAST(LOWERREGLOCALVIOLATION AS DOUBLE) AS LOWERREGLOCALVIOLATION,
  CAST(LOWER60SECLOCALVIOLATION AS DOUBLE) AS LOWER60SECLOCALVIOLATION,
  CAST(LOWER6SECLOCALVIOLATION AS DOUBLE) AS LOWER6SECLOCALVIOLATION,
  CAST(RAISE5MINVIOLATION AS DOUBLE) AS RAISE5MINVIOLATION,
  CAST(RAISEREGVIOLATION AS DOUBLE) AS RAISEREGVIOLATION,
  CAST(RAISE60SECVIOLATION AS DOUBLE) AS RAISE60SECVIOLATION,
  CAST(RAISE6SECVIOLATION AS DOUBLE) AS RAISE6SECVIOLATION,
  CAST(LOWER5MINVIOLATION AS DOUBLE) AS LOWER5MINVIOLATION,
  CAST(LOWERREGVIOLATION AS DOUBLE) AS LOWERREGVIOLATION,
  CAST(LOWER60SECVIOLATION AS DOUBLE) AS LOWER60SECVIOLATION,
  CAST(LOWER6SECVIOLATION AS DOUBLE) AS LOWER6SECVIOLATION,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  CAST(LORSURPLUS AS DOUBLE) AS LORSURPLUS,
  CAST(LRCSURPLUS AS DOUBLE) AS LRCSURPLUS,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m10:47:14.756816 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m10:47:14.756816 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: ROLLBACK
[0m10:47:14.766420 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_price'
[0m10:47:14.773364 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: Close
[0m10:47:14.777370 [debug] [Thread-1 (]: Runtime Error in model fct_price (models\marts\fct_price.sql)
  Catalog Error: Table with name csv_archive_log does not exist!
  Did you mean "dim_calendar"?
  
  LINE 17:   FROM "ducklake"."aemo"."csv_archive_log"
                  ^
[0m10:47:14.777370 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5907708-d689-444a-9779-2e4ad7b20335', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226CC59FAD0>]}
[0m10:47:14.778465 [error] [Thread-1 (]: 3 of 7 ERROR creating sql incremental model aemo.fct_price ..................... [[31mERROR[0m in 0.07s]
[0m10:47:14.779371 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_price
[0m10:47:14.780456 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_price_today
[0m10:47:14.781370 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_price' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_price (models\marts\fct_price.sql)
  Catalog Error: Table with name csv_archive_log does not exist!
  Did you mean "dim_calendar"?
  
  LINE 17:   FROM "ducklake"."aemo"."csv_archive_log"
                  ^.
[0m10:47:14.781749 [info ] [Thread-1 (]: 4 of 7 START sql incremental model aemo.fct_price_today ........................ [RUN]
[0m10:47:14.783781 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.fct_price, now model.aemo_electricity.fct_price_today)
[0m10:47:14.783781 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_price_today
[0m10:47:14.788870 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_price_today"
[0m10:47:14.789782 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_price_today
[0m10:47:14.789782 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_price_today"
[0m10:47:14.789782 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price_today"
[0m10:47:14.789782 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: BEGIN
[0m10:47:14.789782 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:14.798216 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m10:47:14.798216 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price_today"
[0m10:47:14.799225 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price_today"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."csv_archive_log"
  WHERE source_type = 'price_today'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/price_today/day=' || substring(source_filename, 19, 8) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

price_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'PRICE': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'DISPATCHINTERVAL': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'LASTCHANGED': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'PRICE_STATUS': 'VARCHAR',
      'PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'RAISE1SECRRP': 'VARCHAR',
      'RAISE1SECROP': 'VARCHAR',
      'RAISE1SECAPCFLAG': 'VARCHAR',
      'LOWER1SECRRP': 'VARCHAR',
      'LOWER1SECROP': 'VARCHAR',
      'LOWER1SECAPCFLAG': 'VARCHAR',
      'PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'OCD_STATUS': 'VARCHAR',
      'MII_STATUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND PRICE = 'PRICE'
)

SELECT
  REGIONID,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(DISPATCHINTERVAL AS DOUBLE) AS DISPATCHINTERVAL,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(PRE_AP_ENERGY_PRICE AS DOUBLE) AS PRE_AP_ENERGY_PRICE,
  CAST(PRE_AP_RAISE6_PRICE AS DOUBLE) AS PRE_AP_RAISE6_PRICE,
  CAST(PRE_AP_RAISE60_PRICE AS DOUBLE) AS PRE_AP_RAISE60_PRICE,
  CAST(PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS PRE_AP_RAISE5MIN_PRICE,
  CAST(PRE_AP_RAISEREG_PRICE AS DOUBLE) AS PRE_AP_RAISEREG_PRICE,
  CAST(PRE_AP_LOWER6_PRICE AS DOUBLE) AS PRE_AP_LOWER6_PRICE,
  CAST(PRE_AP_LOWER60_PRICE AS DOUBLE) AS PRE_AP_LOWER60_PRICE,
  CAST(PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS PRE_AP_LOWER5MIN_PRICE,
  CAST(PRE_AP_LOWERREG_PRICE AS DOUBLE) AS PRE_AP_LOWERREG_PRICE,
  CAST(RAISE1SECRRP AS DOUBLE) AS RAISE1SECRRP,
  CAST(RAISE1SECROP AS DOUBLE) AS RAISE1SECROP,
  CAST(RAISE1SECAPCFLAG AS DOUBLE) AS RAISE1SECAPCFLAG,
  CAST(LOWER1SECRRP AS DOUBLE) AS LOWER1SECRRP,
  CAST(LOWER1SECROP AS DOUBLE) AS LOWER1SECROP,
  CAST(LOWER1SECAPCFLAG AS DOUBLE) AS LOWER1SECAPCFLAG,
  CAST(PRE_AP_RAISE1_PRICE AS DOUBLE) AS PRE_AP_RAISE1_PRICE,
  CAST(PRE_AP_LOWER1_PRICE AS DOUBLE) AS PRE_AP_LOWER1_PRICE,
  CAST(CUMUL_PRE_AP_ENERGY_PRICE AS DOUBLE) AS CUMUL_PRE_AP_ENERGY_PRICE,
  CAST(CUMUL_PRE_AP_RAISE6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE6_PRICE,
  CAST(CUMUL_PRE_AP_RAISE60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE60_PRICE,
  CAST(CUMUL_PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE5MIN_PRICE,
  CAST(CUMUL_PRE_AP_RAISEREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISEREG_PRICE,
  CAST(CUMUL_PRE_AP_LOWER6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER6_PRICE,
  CAST(CUMUL_PRE_AP_LOWER60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER60_PRICE,
  CAST(CUMUL_PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER5MIN_PRICE,
  CAST(CUMUL_PRE_AP_LOWERREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWERREG_PRICE,
  CAST(CUMUL_PRE_AP_RAISE1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE1_PRICE,
  CAST(CUMUL_PRE_AP_LOWER1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER1_PRICE,
  SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m10:47:14.803288 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price_today"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."csv_archive_log"
  WHERE source_type = 'price_today'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/price_today/day=' || substring(source_filename, 19, 8) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

price_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'PRICE': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'DISPATCHINTERVAL': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'LASTCHANGED': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'PRICE_STATUS': 'VARCHAR',
      'PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'RAISE1SECRRP': 'VARCHAR',
      'RAISE1SECROP': 'VARCHAR',
      'RAISE1SECAPCFLAG': 'VARCHAR',
      'LOWER1SECRRP': 'VARCHAR',
      'LOWER1SECROP': 'VARCHAR',
      'LOWER1SECAPCFLAG': 'VARCHAR',
      'PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'OCD_STATUS': 'VARCHAR',
      'MII_STATUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND PRICE = 'PRICE'
)

SELECT
  REGIONID,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(DISPATCHINTERVAL AS DOUBLE) AS DISPATCHINTERVAL,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(PRE_AP_ENERGY_PRICE AS DOUBLE) AS PRE_AP_ENERGY_PRICE,
  CAST(PRE_AP_RAISE6_PRICE AS DOUBLE) AS PRE_AP_RAISE6_PRICE,
  CAST(PRE_AP_RAISE60_PRICE AS DOUBLE) AS PRE_AP_RAISE60_PRICE,
  CAST(PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS PRE_AP_RAISE5MIN_PRICE,
  CAST(PRE_AP_RAISEREG_PRICE AS DOUBLE) AS PRE_AP_RAISEREG_PRICE,
  CAST(PRE_AP_LOWER6_PRICE AS DOUBLE) AS PRE_AP_LOWER6_PRICE,
  CAST(PRE_AP_LOWER60_PRICE AS DOUBLE) AS PRE_AP_LOWER60_PRICE,
  CAST(PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS PRE_AP_LOWER5MIN_PRICE,
  CAST(PRE_AP_LOWERREG_PRICE AS DOUBLE) AS PRE_AP_LOWERREG_PRICE,
  CAST(RAISE1SECRRP AS DOUBLE) AS RAISE1SECRRP,
  CAST(RAISE1SECROP AS DOUBLE) AS RAISE1SECROP,
  CAST(RAISE1SECAPCFLAG AS DOUBLE) AS RAISE1SECAPCFLAG,
  CAST(LOWER1SECRRP AS DOUBLE) AS LOWER1SECRRP,
  CAST(LOWER1SECROP AS DOUBLE) AS LOWER1SECROP,
  CAST(LOWER1SECAPCFLAG AS DOUBLE) AS LOWER1SECAPCFLAG,
  CAST(PRE_AP_RAISE1_PRICE AS DOUBLE) AS PRE_AP_RAISE1_PRICE,
  CAST(PRE_AP_LOWER1_PRICE AS DOUBLE) AS PRE_AP_LOWER1_PRICE,
  CAST(CUMUL_PRE_AP_ENERGY_PRICE AS DOUBLE) AS CUMUL_PRE_AP_ENERGY_PRICE,
  CAST(CUMUL_PRE_AP_RAISE6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE6_PRICE,
  CAST(CUMUL_PRE_AP_RAISE60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE60_PRICE,
  CAST(CUMUL_PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE5MIN_PRICE,
  CAST(CUMUL_PRE_AP_RAISEREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISEREG_PRICE,
  CAST(CUMUL_PRE_AP_LOWER6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER6_PRICE,
  CAST(CUMUL_PRE_AP_LOWER60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER60_PRICE,
  CAST(CUMUL_PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER5MIN_PRICE,
  CAST(CUMUL_PRE_AP_LOWERREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWERREG_PRICE,
  CAST(CUMUL_PRE_AP_RAISE1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE1_PRICE,
  CAST(CUMUL_PRE_AP_LOWER1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER1_PRICE,
  SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m10:47:14.809628 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m10:47:14.810635 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: ROLLBACK
[0m10:47:14.813547 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_price_today'
[0m10:47:14.814543 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: Close
[0m10:47:14.817823 [debug] [Thread-1 (]: Runtime Error in model fct_price_today (models\marts\fct_price_today.sql)
  Catalog Error: Table with name csv_archive_log does not exist!
  Did you mean "dim_calendar"?
  
  LINE 17:   FROM "ducklake"."aemo"."csv_archive_log"
                  ^
[0m10:47:14.818924 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5907708-d689-444a-9779-2e4ad7b20335', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226CC4FB7D0>]}
[0m10:47:14.819915 [error] [Thread-1 (]: 4 of 7 ERROR creating sql incremental model aemo.fct_price_today ............... [[31mERROR[0m in 0.04s]
[0m10:47:14.820832 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_price_today
[0m10:47:14.820832 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_scada
[0m10:47:14.820832 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_price_today' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_price_today (models\marts\fct_price_today.sql)
  Catalog Error: Table with name csv_archive_log does not exist!
  Did you mean "dim_calendar"?
  
  LINE 17:   FROM "ducklake"."aemo"."csv_archive_log"
                  ^.
[0m10:47:14.820832 [info ] [Thread-1 (]: 5 of 7 START sql incremental model aemo.fct_scada .............................. [RUN]
[0m10:47:14.820832 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.fct_price_today, now model.aemo_electricity.fct_scada)
[0m10:47:14.820832 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_scada
[0m10:47:14.830690 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_scada"
[0m10:47:14.832607 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_scada
[0m10:47:14.837388 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_scada"
[0m10:47:14.839304 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada"
[0m10:47:14.840310 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: BEGIN
[0m10:47:14.841309 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:14.842238 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m10:47:14.843310 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada"
[0m10:47:14.844336 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."csv_archive_log"
  WHERE source_type = 'daily'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/daily/year=' || substring(source_filename, 14, 4) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

scada_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'DUID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'DISPATCHMODE': 'VARCHAR',
      'AGCSTATUS': 'VARCHAR',
      'INITIALMW': 'VARCHAR',
      'TOTALCLEARED': 'VARCHAR',
      'RAMPDOWNRATE': 'VARCHAR',
      'RAMPUPRATE': 'VARCHAR',
      'LOWER5MIN': 'VARCHAR',
      'LOWER60SEC': 'VARCHAR',
      'LOWER6SEC': 'VARCHAR',
      'RAISE5MIN': 'VARCHAR',
      'RAISE60SEC': 'VARCHAR',
      'RAISE6SEC': 'VARCHAR',
      'MARGINAL5MINVALUE': 'VARCHAR',
      'MARGINAL60SECVALUE': 'VARCHAR',
      'MARGINAL6SECVALUE': 'VARCHAR',
      'MARGINALVALUE': 'VARCHAR',
      'VIOLATION5MINDEGREE': 'VARCHAR',
      'VIOLATION60SECDEGREE': 'VARCHAR',
      'VIOLATION6SECDEGREE': 'VARCHAR',
      'VIOLATIONDEGREE': 'VARCHAR',
      'LOWERREG': 'VARCHAR',
      'RAISEREG': 'VARCHAR',
      'AVAILABILITY': 'VARCHAR',
      'RAISE6SECFLAGS': 'VARCHAR',
      'RAISE60SECFLAGS': 'VARCHAR',
      'RAISE5MINFLAGS': 'VARCHAR',
      'RAISEREGFLAGS': 'VARCHAR',
      'LOWER6SECFLAGS': 'VARCHAR',
      'LOWER60SECFLAGS': 'VARCHAR',
      'LOWER5MINFLAGS': 'VARCHAR',
      'LOWERREGFLAGS': 'VARCHAR',
      'RAISEREGAVAILABILITY': 'VARCHAR',
      'RAISEREGENABLEMENTMAX': 'VARCHAR',
      'RAISEREGENABLEMENTMIN': 'VARCHAR',
      'LOWERREGAVAILABILITY': 'VARCHAR',
      'LOWERREGENABLEMENTMAX': 'VARCHAR',
      'LOWERREGENABLEMENTMIN': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DUNIT' AND VERSION = '3'
)

SELECT
  UNIT,
  DUID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(DISPATCHMODE AS DOUBLE) AS DISPATCHMODE,
  CAST(AGCSTATUS AS DOUBLE) AS AGCSTATUS,
  CAST(INITIALMW AS DOUBLE) AS INITIALMW,
  CAST(TOTALCLEARED AS DOUBLE) AS TOTALCLEARED,
  CAST(RAMPDOWNRATE AS DOUBLE) AS RAMPDOWNRATE,
  CAST(RAMPUPRATE AS DOUBLE) AS RAMPUPRATE,
  CAST(LOWER5MIN AS DOUBLE) AS LOWER5MIN,
  CAST(LOWER60SEC AS DOUBLE) AS LOWER60SEC,
  CAST(LOWER6SEC AS DOUBLE) AS LOWER6SEC,
  CAST(RAISE5MIN AS DOUBLE) AS RAISE5MIN,
  CAST(RAISE60SEC AS DOUBLE) AS RAISE60SEC,
  CAST(RAISE6SEC AS DOUBLE) AS RAISE6SEC,
  CAST(MARGINAL5MINVALUE AS DOUBLE) AS MARGINAL5MINVALUE,
  CAST(MARGINAL60SECVALUE AS DOUBLE) AS MARGINAL60SECVALUE,
  CAST(MARGINAL6SECVALUE AS DOUBLE) AS MARGINAL6SECVALUE,
  CAST(MARGINALVALUE AS DOUBLE) AS MARGINALVALUE,
  CAST(VIOLATION5MINDEGREE AS DOUBLE) AS VIOLATION5MINDEGREE,
  CAST(VIOLATION60SECDEGREE AS DOUBLE) AS VIOLATION60SECDEGREE,
  CAST(VIOLATION6SECDEGREE AS DOUBLE) AS VIOLATION6SECDEGREE,
  CAST(VIOLATIONDEGREE AS DOUBLE) AS VIOLATIONDEGREE,
  CAST(LOWERREG AS DOUBLE) AS LOWERREG,
  CAST(RAISEREG AS DOUBLE) AS RAISEREG,
  CAST(AVAILABILITY AS DOUBLE) AS AVAILABILITY,
  CAST(RAISE6SECFLAGS AS DOUBLE) AS RAISE6SECFLAGS,
  CAST(RAISE60SECFLAGS AS DOUBLE) AS RAISE60SECFLAGS,
  CAST(RAISE5MINFLAGS AS DOUBLE) AS RAISE5MINFLAGS,
  CAST(RAISEREGFLAGS AS DOUBLE) AS RAISEREGFLAGS,
  CAST(LOWER6SECFLAGS AS DOUBLE) AS LOWER6SECFLAGS,
  CAST(LOWER60SECFLAGS AS DOUBLE) AS LOWER60SECFLAGS,
  CAST(LOWER5MINFLAGS AS DOUBLE) AS LOWER5MINFLAGS,
  CAST(LOWERREGFLAGS AS DOUBLE) AS LOWERREGFLAGS,
  CAST(RAISEREGAVAILABILITY AS DOUBLE) AS RAISEREGAVAILABILITY,
  CAST(RAISEREGENABLEMENTMAX AS DOUBLE) AS RAISEREGENABLEMENTMAX,
  CAST(RAISEREGENABLEMENTMIN AS DOUBLE) AS RAISEREGENABLEMENTMIN,
  CAST(LOWERREGAVAILABILITY AS DOUBLE) AS LOWERREGAVAILABILITY,
  CAST(LOWERREGENABLEMENTMAX AS DOUBLE) AS LOWERREGENABLEMENTMAX,
  CAST(LOWERREGENABLEMENTMIN AS DOUBLE) AS LOWERREGENABLEMENTMIN,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m10:47:14.852681 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."csv_archive_log"
  WHERE source_type = 'daily'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/daily/year=' || substring(source_filename, 14, 4) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

scada_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'DUID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'DISPATCHMODE': 'VARCHAR',
      'AGCSTATUS': 'VARCHAR',
      'INITIALMW': 'VARCHAR',
      'TOTALCLEARED': 'VARCHAR',
      'RAMPDOWNRATE': 'VARCHAR',
      'RAMPUPRATE': 'VARCHAR',
      'LOWER5MIN': 'VARCHAR',
      'LOWER60SEC': 'VARCHAR',
      'LOWER6SEC': 'VARCHAR',
      'RAISE5MIN': 'VARCHAR',
      'RAISE60SEC': 'VARCHAR',
      'RAISE6SEC': 'VARCHAR',
      'MARGINAL5MINVALUE': 'VARCHAR',
      'MARGINAL60SECVALUE': 'VARCHAR',
      'MARGINAL6SECVALUE': 'VARCHAR',
      'MARGINALVALUE': 'VARCHAR',
      'VIOLATION5MINDEGREE': 'VARCHAR',
      'VIOLATION60SECDEGREE': 'VARCHAR',
      'VIOLATION6SECDEGREE': 'VARCHAR',
      'VIOLATIONDEGREE': 'VARCHAR',
      'LOWERREG': 'VARCHAR',
      'RAISEREG': 'VARCHAR',
      'AVAILABILITY': 'VARCHAR',
      'RAISE6SECFLAGS': 'VARCHAR',
      'RAISE60SECFLAGS': 'VARCHAR',
      'RAISE5MINFLAGS': 'VARCHAR',
      'RAISEREGFLAGS': 'VARCHAR',
      'LOWER6SECFLAGS': 'VARCHAR',
      'LOWER60SECFLAGS': 'VARCHAR',
      'LOWER5MINFLAGS': 'VARCHAR',
      'LOWERREGFLAGS': 'VARCHAR',
      'RAISEREGAVAILABILITY': 'VARCHAR',
      'RAISEREGENABLEMENTMAX': 'VARCHAR',
      'RAISEREGENABLEMENTMIN': 'VARCHAR',
      'LOWERREGAVAILABILITY': 'VARCHAR',
      'LOWERREGENABLEMENTMAX': 'VARCHAR',
      'LOWERREGENABLEMENTMIN': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DUNIT' AND VERSION = '3'
)

SELECT
  UNIT,
  DUID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(DISPATCHMODE AS DOUBLE) AS DISPATCHMODE,
  CAST(AGCSTATUS AS DOUBLE) AS AGCSTATUS,
  CAST(INITIALMW AS DOUBLE) AS INITIALMW,
  CAST(TOTALCLEARED AS DOUBLE) AS TOTALCLEARED,
  CAST(RAMPDOWNRATE AS DOUBLE) AS RAMPDOWNRATE,
  CAST(RAMPUPRATE AS DOUBLE) AS RAMPUPRATE,
  CAST(LOWER5MIN AS DOUBLE) AS LOWER5MIN,
  CAST(LOWER60SEC AS DOUBLE) AS LOWER60SEC,
  CAST(LOWER6SEC AS DOUBLE) AS LOWER6SEC,
  CAST(RAISE5MIN AS DOUBLE) AS RAISE5MIN,
  CAST(RAISE60SEC AS DOUBLE) AS RAISE60SEC,
  CAST(RAISE6SEC AS DOUBLE) AS RAISE6SEC,
  CAST(MARGINAL5MINVALUE AS DOUBLE) AS MARGINAL5MINVALUE,
  CAST(MARGINAL60SECVALUE AS DOUBLE) AS MARGINAL60SECVALUE,
  CAST(MARGINAL6SECVALUE AS DOUBLE) AS MARGINAL6SECVALUE,
  CAST(MARGINALVALUE AS DOUBLE) AS MARGINALVALUE,
  CAST(VIOLATION5MINDEGREE AS DOUBLE) AS VIOLATION5MINDEGREE,
  CAST(VIOLATION60SECDEGREE AS DOUBLE) AS VIOLATION60SECDEGREE,
  CAST(VIOLATION6SECDEGREE AS DOUBLE) AS VIOLATION6SECDEGREE,
  CAST(VIOLATIONDEGREE AS DOUBLE) AS VIOLATIONDEGREE,
  CAST(LOWERREG AS DOUBLE) AS LOWERREG,
  CAST(RAISEREG AS DOUBLE) AS RAISEREG,
  CAST(AVAILABILITY AS DOUBLE) AS AVAILABILITY,
  CAST(RAISE6SECFLAGS AS DOUBLE) AS RAISE6SECFLAGS,
  CAST(RAISE60SECFLAGS AS DOUBLE) AS RAISE60SECFLAGS,
  CAST(RAISE5MINFLAGS AS DOUBLE) AS RAISE5MINFLAGS,
  CAST(RAISEREGFLAGS AS DOUBLE) AS RAISEREGFLAGS,
  CAST(LOWER6SECFLAGS AS DOUBLE) AS LOWER6SECFLAGS,
  CAST(LOWER60SECFLAGS AS DOUBLE) AS LOWER60SECFLAGS,
  CAST(LOWER5MINFLAGS AS DOUBLE) AS LOWER5MINFLAGS,
  CAST(LOWERREGFLAGS AS DOUBLE) AS LOWERREGFLAGS,
  CAST(RAISEREGAVAILABILITY AS DOUBLE) AS RAISEREGAVAILABILITY,
  CAST(RAISEREGENABLEMENTMAX AS DOUBLE) AS RAISEREGENABLEMENTMAX,
  CAST(RAISEREGENABLEMENTMIN AS DOUBLE) AS RAISEREGENABLEMENTMIN,
  CAST(LOWERREGAVAILABILITY AS DOUBLE) AS LOWERREGAVAILABILITY,
  CAST(LOWERREGENABLEMENTMAX AS DOUBLE) AS LOWERREGENABLEMENTMAX,
  CAST(LOWERREGENABLEMENTMIN AS DOUBLE) AS LOWERREGENABLEMENTMIN,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m10:47:14.855191 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m10:47:14.855191 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: ROLLBACK
[0m10:47:14.855191 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_scada'
[0m10:47:14.855191 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: Close
[0m10:47:14.862690 [debug] [Thread-1 (]: Runtime Error in model fct_scada (models\marts\fct_scada.sql)
  Catalog Error: Table with name csv_archive_log does not exist!
  Did you mean "dim_calendar"?
  
  LINE 17:   FROM "ducklake"."aemo"."csv_archive_log"
                  ^
[0m10:47:14.862690 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5907708-d689-444a-9779-2e4ad7b20335', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226CC471E50>]}
[0m10:47:14.863690 [error] [Thread-1 (]: 5 of 7 ERROR creating sql incremental model aemo.fct_scada ..................... [[31mERROR[0m in 0.04s]
[0m10:47:14.865858 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_scada
[0m10:47:14.865858 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_scada_today
[0m10:47:14.866809 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_scada' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_scada (models\marts\fct_scada.sql)
  Catalog Error: Table with name csv_archive_log does not exist!
  Did you mean "dim_calendar"?
  
  LINE 17:   FROM "ducklake"."aemo"."csv_archive_log"
                  ^.
[0m10:47:14.866809 [info ] [Thread-1 (]: 6 of 7 START sql incremental model aemo.fct_scada_today ........................ [RUN]
[0m10:47:14.868212 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.fct_scada, now model.aemo_electricity.fct_scada_today)
[0m10:47:14.869340 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_scada_today
[0m10:47:14.873363 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_scada_today"
[0m10:47:14.879595 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_scada_today
[0m10:47:14.879595 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_scada_today"
[0m10:47:14.879595 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada_today"
[0m10:47:14.879595 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: BEGIN
[0m10:47:14.879595 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:14.892653 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m10:47:14.893692 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada_today"
[0m10:47:14.894927 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada_today"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."csv_archive_log"
  WHERE source_type = 'scada_today'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/scada_today/day=' || substring(source_filename, 22, 8) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

scada_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'UNIT_SCADA': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'DUID': 'VARCHAR',
      'SCADAVALUE': 'double',
      'LASTCHANGED': 'timestamp'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND SCADAVALUE != 0
)

SELECT
  DUID,
  SCADAVALUE AS INITIALMW,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  SETTLEMENTDATE,
  LASTCHANGED,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m10:47:14.904246 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada_today"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."csv_archive_log"
  WHERE source_type = 'scada_today'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/scada_today/day=' || substring(source_filename, 22, 8) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

scada_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'UNIT_SCADA': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'DUID': 'VARCHAR',
      'SCADAVALUE': 'double',
      'LASTCHANGED': 'timestamp'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND SCADAVALUE != 0
)

SELECT
  DUID,
  SCADAVALUE AS INITIALMW,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  SETTLEMENTDATE,
  LASTCHANGED,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m10:47:14.904246 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m10:47:14.905243 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: ROLLBACK
[0m10:47:14.909641 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_scada_today'
[0m10:47:14.910651 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: Close
[0m10:47:14.910651 [debug] [Thread-1 (]: Runtime Error in model fct_scada_today (models\marts\fct_scada_today.sql)
  Catalog Error: Table with name csv_archive_log does not exist!
  Did you mean "dim_calendar"?
  
  LINE 17:   FROM "ducklake"."aemo"."csv_archive_log"
                  ^
[0m10:47:14.910651 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5907708-d689-444a-9779-2e4ad7b20335', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226CC493C50>]}
[0m10:47:14.910651 [error] [Thread-1 (]: 6 of 7 ERROR creating sql incremental model aemo.fct_scada_today ............... [[31mERROR[0m in 0.04s]
[0m10:47:14.910651 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_scada_today
[0m10:47:14.917881 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_summary
[0m10:47:14.917881 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_scada_today' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_scada_today (models\marts\fct_scada_today.sql)
  Catalog Error: Table with name csv_archive_log does not exist!
  Did you mean "dim_calendar"?
  
  LINE 17:   FROM "ducklake"."aemo"."csv_archive_log"
                  ^.
[0m10:47:14.918890 [info ] [Thread-1 (]: 7 of 7 SKIP relation aemo.fct_summary .......................................... [[33mSKIP[0m]
[0m10:47:14.919916 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_summary
[0m10:47:14.921411 [debug] [MainThread]: Using duckdb connection "master"
[0m10:47:14.922424 [debug] [MainThread]: On master: BEGIN
[0m10:47:14.922424 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:47:14.923434 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:47:14.923434 [debug] [MainThread]: On master: COMMIT
[0m10:47:14.924513 [debug] [MainThread]: Using duckdb connection "master"
[0m10:47:14.924513 [debug] [MainThread]: On master: COMMIT
[0m10:47:14.925481 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:47:14.926430 [debug] [MainThread]: On master: Close
[0m10:47:14.927598 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:47:14.927598 [debug] [MainThread]: Connection 'create_ducklake_aemo' was properly closed.
[0m10:47:14.928686 [debug] [MainThread]: Connection 'list_ducklake_aemo' was properly closed.
[0m10:47:14.928686 [debug] [MainThread]: Connection 'model.aemo_electricity.fct_scada_today' was properly closed.
[0m10:47:14.929690 [info ] [MainThread]: 
[0m10:47:14.930597 [info ] [MainThread]: Finished running 6 incremental models, 1 table model in 0 hours 0 minutes and 16.54 seconds (16.54s).
[0m10:47:14.932681 [debug] [MainThread]: Command end result
[0m10:47:14.962847 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m10:47:14.967825 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m10:47:14.978348 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\lakehouse\default\Files\dbt\target\run_results.json
[0m10:47:14.979346 [info ] [MainThread]: 
[0m10:47:14.998280 [info ] [MainThread]: [31mCompleted with 4 errors, 0 partial successes, and 0 warnings:[0m
[0m10:47:15.002506 [info ] [MainThread]: 
[0m10:47:15.003514 [error] [MainThread]: [31mFailure in model fct_price (models\marts\fct_price.sql)[0m
[0m10:47:15.005514 [error] [MainThread]:   Runtime Error in model fct_price (models\marts\fct_price.sql)
  Catalog Error: Table with name csv_archive_log does not exist!
  Did you mean "dim_calendar"?
  
  LINE 17:   FROM "ducklake"."aemo"."csv_archive_log"
                  ^
[0m10:47:15.006515 [info ] [MainThread]: 
[0m10:47:15.007515 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_price.sql
[0m10:47:15.008526 [info ] [MainThread]: 
[0m10:47:15.010692 [error] [MainThread]: [31mFailure in model fct_price_today (models\marts\fct_price_today.sql)[0m
[0m10:47:15.023073 [error] [MainThread]:   Runtime Error in model fct_price_today (models\marts\fct_price_today.sql)
  Catalog Error: Table with name csv_archive_log does not exist!
  Did you mean "dim_calendar"?
  
  LINE 17:   FROM "ducklake"."aemo"."csv_archive_log"
                  ^
[0m10:47:15.024081 [info ] [MainThread]: 
[0m10:47:15.027870 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_price_today.sql
[0m10:47:15.027870 [info ] [MainThread]: 
[0m10:47:15.027870 [error] [MainThread]: [31mFailure in model fct_scada (models\marts\fct_scada.sql)[0m
[0m10:47:15.027870 [error] [MainThread]:   Runtime Error in model fct_scada (models\marts\fct_scada.sql)
  Catalog Error: Table with name csv_archive_log does not exist!
  Did you mean "dim_calendar"?
  
  LINE 17:   FROM "ducklake"."aemo"."csv_archive_log"
                  ^
[0m10:47:15.027870 [info ] [MainThread]: 
[0m10:47:15.027870 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_scada.sql
[0m10:47:15.027870 [info ] [MainThread]: 
[0m10:47:15.034547 [error] [MainThread]: [31mFailure in model fct_scada_today (models\marts\fct_scada_today.sql)[0m
[0m10:47:15.036877 [error] [MainThread]:   Runtime Error in model fct_scada_today (models\marts\fct_scada_today.sql)
  Catalog Error: Table with name csv_archive_log does not exist!
  Did you mean "dim_calendar"?
  
  LINE 17:   FROM "ducklake"."aemo"."csv_archive_log"
                  ^
[0m10:47:15.038081 [info ] [MainThread]: 
[0m10:47:15.039628 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_scada_today.sql
[0m10:47:15.040157 [info ] [MainThread]: 
[0m10:47:15.041165 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=4 SKIP=1 NO-OP=0 TOTAL=7
[0m10:47:15.042799 [debug] [MainThread]: Command `dbt run` failed at 10:47:15.042799 after 17.82 seconds
[0m10:47:15.045077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226C4730310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226CA686610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000226CA686110>]}
[0m10:47:15.045077 [debug] [MainThread]: Flushing usage events
[0m10:47:16.278859 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:52:58.350757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C4EE0B190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C4EB86E50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C4EE0AFD0>]}


============================== 10:52:58.358700 | e1e7f530-1a94-4dbd-b114-819cfa2e5034 ==============================
[0m10:52:58.358700 [info ] [MainThread]: Running with dbt=1.11.2
[0m10:52:58.358700 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'None', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'C:\\lakehouse\\default\\Files\\dbt', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\lakehouse\\default\\Files\\dbt\\logs', 'introspect': 'True', 'invocation_command': 'dbt run-operation download', 'fail_fast': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True'}
[0m10:52:58.691205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e1e7f530-1a94-4dbd-b114-819cfa2e5034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C4EEB0F10>]}
[0m10:52:58.756981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e1e7f530-1a94-4dbd-b114-819cfa2e5034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C498A4710>]}
[0m10:52:58.756981 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m10:52:59.164408 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m10:52:59.351900 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:52:59.351900 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m10:52:59.351900 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:52:59.351900 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.aemo_electricity.staging
[0m10:52:59.384413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e1e7f530-1a94-4dbd-b114-819cfa2e5034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C5046A7D0>]}
[0m10:52:59.457795 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m10:52:59.463846 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m10:52:59.512659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e1e7f530-1a94-4dbd-b114-819cfa2e5034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C5065BDD0>]}
[0m10:52:59.514082 [info ] [MainThread]: Found 7 models, 1 source, 474 macros
[0m10:52:59.515090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e1e7f530-1a94-4dbd-b114-819cfa2e5034', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C4EEE0810>]}
[0m10:52:59.516090 [debug] [MainThread]: Acquiring new duckdb connection 'macro_download'
[0m10:52:59.516686 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:52:59.517491 [debug] [MainThread]: On macro_download: BEGIN
[0m10:52:59.517491 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:52:59.891181 [debug] [MainThread]: SQL status: OK in 0.380 seconds
[0m10:52:59.891181 [debug] [MainThread]: On macro_download: COMMIT
[0m10:52:59.900049 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:52:59.900049 [debug] [MainThread]: On macro_download: COMMIT
[0m10:52:59.900049 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m10:52:59.921914 [info ] [MainThread]: [DOWNLOAD] Starting download with PATH_ROOT=/lakehouse/default, download_limit=2
[0m10:53:00.187830 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:00.188831 [debug] [MainThread]: On macro_download: BEGIN
[0m10:53:00.189830 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m10:53:00.189830 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:00.191186 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE PATH_ROOT = '/lakehouse/default'

[0m10:53:00.191186 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:53:00.191186 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:00.191186 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE download_limit = 2

[0m10:53:00.191186 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m10:53:00.191186 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:00.191186 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE csv_archive_path = getvariable('PATH_ROOT') || '/Files/csv'

[0m10:53:00.191186 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m10:53:00.191186 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:00.191186 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE SCHEMA IF NOT EXISTS ducklake.aemo

[0m10:53:00.238299 [debug] [MainThread]: SQL status: OK in 0.043 seconds
[0m10:53:00.238299 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:00.238299 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

USE ducklake.aemo

[0m10:53:00.238299 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m10:53:00.238299 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:00.238299 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE TABLE IF NOT EXISTS ducklake.aemo.csv_archive_log (
  source_type VARCHAR,
  source_filename VARCHAR,
  archive_path VARCHAR,
  archived_at TIMESTAMP,
  row_count BIGINT,
  source_url VARCHAR,
  etag VARCHAR
)

[0m10:53:00.238299 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m10:53:00.248579 [info ] [MainThread]: [DOWNLOAD] Daily source: aemo
[0m10:53:00.248579 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:00.248579 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE daily_files_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('https://nemweb.com.au/Reports/Current/Daily_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'https://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DAILY%.zip%'
ORDER BY full_url DESC

[0m10:53:00.378023 [debug] [MainThread]: SQL status: OK in 0.127 seconds
[0m10:53:00.380022 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:00.382024 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE daily_to_archive AS
SELECT full_url, filename
FROM daily_files_web
WHERE filename NOT IN (SELECT source_filename FROM ducklake.aemo.csv_archive_log WHERE source_type = 'daily')
LIMIT getvariable('download_limit')

[0m10:53:00.382961 [debug] [MainThread]: SQL status: OK in 0.002 seconds
[0m10:53:00.382961 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:00.389254 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE has_daily_to_archive = (SELECT count(*) > 0 FROM daily_to_archive)

[0m10:53:00.391263 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:53:00.391263 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:00.391263 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE daily_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM daily_to_archive)

[0m10:53:00.397717 [debug] [MainThread]: SQL status: OK in 0.003 seconds
[0m10:53:00.397717 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:00.397717 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE daily_expected = (SELECT count(*) FROM daily_to_archive)

[0m10:53:00.400867 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:53:00.400867 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:00.400867 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE daily_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM daily_to_archive)

[0m10:53:00.405285 [debug] [MainThread]: SQL status: OK in 0.003 seconds
[0m10:53:00.405285 [info ] [MainThread]: [DOWNLOAD] Processing daily files...
[0m10:53:00.405285 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:00.405285 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    CAST(substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 4) AS INT) AS year
  FROM read_blob(getvariable('daily_urls'))
  WHERE getvariable('has_daily_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/daily')
(FORMAT BLOB, PARTITION_BY (year, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m10:53:01.061068 [debug] [MainThread]: SQL status: OK in 0.652 seconds
[0m10:53:01.063082 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:01.065098 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'daily' AS source_type,
  filename AS source_filename,
  '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM daily_to_archive
WHERE getvariable('daily_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('daily_paths'))) = getvariable('daily_expected')

[0m10:53:10.563637 [debug] [MainThread]: SQL status: OK in 9.496 seconds
[0m10:53:10.565649 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:10.568918 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE intraday_scada_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('http://nemweb.com.au/Reports/Current/Dispatch_SCADA/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'http://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DISPATCHSCADA%'
ORDER BY full_url DESC
LIMIT 500

[0m10:53:10.701279 [debug] [MainThread]: SQL status: OK in 0.130 seconds
[0m10:53:10.701279 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:10.701279 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE scada_today_to_archive AS
SELECT full_url, filename
FROM intraday_scada_web
WHERE filename NOT IN (SELECT source_filename FROM ducklake.aemo.csv_archive_log WHERE source_type = 'scada_today')
LIMIT getvariable('download_limit')

[0m10:53:13.690738 [debug] [MainThread]: SQL status: OK in 2.991 seconds
[0m10:53:13.690738 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:13.690738 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE has_scada_today_to_archive = (SELECT count(*) > 0 FROM scada_today_to_archive)

[0m10:53:13.690738 [debug] [MainThread]: SQL status: OK in 0.002 seconds
[0m10:53:13.704254 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:13.704254 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE scada_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM scada_today_to_archive)

[0m10:53:13.704254 [debug] [MainThread]: SQL status: OK in 0.006 seconds
[0m10:53:13.717138 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:13.720171 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE scada_expected = (SELECT count(*) FROM scada_today_to_archive)

[0m10:53:13.722206 [debug] [MainThread]: SQL status: OK in 0.002 seconds
[0m10:53:13.725473 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:13.727489 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE scada_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/scada_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM scada_today_to_archive)

[0m10:53:13.735824 [debug] [MainThread]: SQL status: OK in 0.009 seconds
[0m10:53:13.735824 [info ] [MainThread]: [DOWNLOAD] Processing intraday SCADA files...
[0m10:53:13.735824 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:13.735824 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 8) AS day
  FROM read_blob(getvariable('scada_urls'))
  WHERE getvariable('has_scada_today_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/scada_today')
(FORMAT BLOB, PARTITION_BY (day, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m10:53:13.900243 [debug] [MainThread]: SQL status: OK in 0.157 seconds
[0m10:53:13.904268 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:13.906278 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'scada_today' AS source_type,
  filename AS source_filename,
  '/scada_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM scada_today_to_archive
WHERE getvariable('scada_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('scada_paths'))) = getvariable('scada_expected')

[0m10:53:19.135081 [debug] [MainThread]: SQL status: OK in 5.230 seconds
[0m10:53:19.135081 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:19.135081 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE intraday_price_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('http://nemweb.com.au/Reports/Current/DispatchIS_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'http://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DISPATCHIS_%.zip%'
ORDER BY full_url DESC
LIMIT 500

[0m10:53:19.290105 [debug] [MainThread]: SQL status: OK in 0.148 seconds
[0m10:53:19.292087 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:19.292670 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE price_today_to_archive AS
SELECT full_url, filename
FROM intraday_price_web
WHERE filename NOT IN (SELECT source_filename FROM ducklake.aemo.csv_archive_log WHERE source_type = 'price_today')
LIMIT getvariable('download_limit')

[0m10:53:22.005465 [debug] [MainThread]: SQL status: OK in 2.713 seconds
[0m10:53:22.008341 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:22.008341 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE has_price_today_to_archive = (SELECT count(*) > 0 FROM price_today_to_archive)

[0m10:53:22.010348 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:53:22.010348 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:22.010348 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE price_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM price_today_to_archive)

[0m10:53:22.010348 [debug] [MainThread]: SQL status: OK in 0.002 seconds
[0m10:53:22.010348 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:22.010348 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE price_expected = (SELECT count(*) FROM price_today_to_archive)

[0m10:53:22.010348 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:53:22.010348 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:22.020139 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE price_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/price_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM price_today_to_archive)

[0m10:53:22.021144 [debug] [MainThread]: SQL status: OK in 0.003 seconds
[0m10:53:22.021144 [info ] [MainThread]: [DOWNLOAD] Processing intraday PRICE files...
[0m10:53:22.021144 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:22.021144 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 8) AS day
  FROM read_blob(getvariable('price_urls'))
  WHERE getvariable('has_price_today_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/price_today')
(FORMAT BLOB, PARTITION_BY (day, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m10:53:22.256190 [debug] [MainThread]: SQL status: OK in 0.229 seconds
[0m10:53:22.262055 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:22.264366 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'price_today' AS source_type,
  filename AS source_filename,
  '/price_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM price_today_to_archive
WHERE getvariable('price_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('price_paths'))) = getvariable('price_expected')

[0m10:53:27.885805 [debug] [MainThread]: SQL status: OK in 5.621 seconds
[0m10:53:27.888895 [info ] [MainThread]: [DOWNLOAD] Refreshing 4 DUID reference files...
[0m10:53:27.888895 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:27.891757 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (SELECT 1 AS id, 'init' AS dummy) TO (getvariable('csv_archive_path') || '/duid')
(FORMAT csv, PARTITION_BY (dummy), FILE_EXTENSION 'csv', OVERWRITE_OR_IGNORE)

[0m10:53:27.891757 [debug] [MainThread]: SQL status: OK in 0.003 seconds
[0m10:53:27.897214 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:27.897214 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/djouallah-patch-1/duid_data.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/duid_data.csv') (FORMAT CSV, HEADER)

[0m10:53:28.220422 [debug] [MainThread]: SQL status: OK in 0.321 seconds
[0m10:53:28.221742 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:28.226247 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT * FROM read_csv_auto('https://data.wa.aemo.com.au/datafiles/post-facilities/facilities.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/facilities.csv') (FORMAT CSV, HEADER)

[0m10:53:28.450091 [debug] [MainThread]: SQL status: OK in 0.223 seconds
[0m10:53:28.450091 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:28.450091 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/main/WA_ENERGY.csv', header=true, null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/WA_ENERGY.csv') (FORMAT CSV, HEADER)

[0m10:53:28.761951 [debug] [MainThread]: SQL status: OK in 0.306 seconds
[0m10:53:28.764952 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:28.767236 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/main/geo_data.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/geo_data.csv') (FORMAT CSV, HEADER)

[0m10:53:29.083087 [debug] [MainThread]: SQL status: OK in 0.314 seconds
[0m10:53:29.088694 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:29.092154 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

DELETE FROM ducklake.aemo.csv_archive_log WHERE source_type LIKE 'duid_%'

[0m10:53:31.636575 [debug] [MainThread]: SQL status: OK in 2.543 seconds
[0m10:53:31.640677 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m10:53:31.642580 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT * FROM (VALUES
  ('duid_data', 'duid_data', '/duid/duid_data.csv', now()),
  ('duid_facilities', 'facilities', '/duid/facilities.csv', now()),
  ('duid_wa_energy', 'WA_ENERGY', '/duid/WA_ENERGY.csv', now()),
  ('duid_geo_data', 'geo_data', '/duid/geo_data.csv', now())
) AS t(source_type, source_filename, archive_path, archived_at)

[0m10:53:38.357952 [debug] [MainThread]: SQL status: OK in 6.715 seconds
[0m10:53:38.357952 [info ] [MainThread]: [DOWNLOAD] DUID files written: 4
[0m10:53:38.365140 [info ] [MainThread]: [DOWNLOAD COMPLETE]
[0m10:53:38.367141 [debug] [MainThread]: On macro_download: ROLLBACK
[0m10:53:38.370992 [debug] [MainThread]: Failed to rollback 'macro_download'
[0m10:53:38.373412 [debug] [MainThread]: On macro_download: Close
[0m10:53:49.294741 [debug] [MainThread]: Wrote artifact RunResultsArtifact to C:\lakehouse\default\Files\dbt\target\run_results.json
[0m10:53:49.300245 [debug] [MainThread]: Command `dbt run-operation` succeeded at 10:53:49.300245 after 51.07 seconds
[0m10:53:49.302978 [debug] [MainThread]: Connection 'macro_download' was properly closed.
[0m10:53:49.304055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C4EA9C350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C50658F90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020C50317F50>]}
[0m10:53:49.306433 [debug] [MainThread]: Flushing usage events
[0m10:53:50.304328 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:57:31.173662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019FFAB122D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019FFAB0BC90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019FFAB08990>]}


============================== 10:57:31.173662 | 6ee3ea36-dc9f-4156-a0fd-418abdec5397 ==============================
[0m10:57:31.173662 [info ] [MainThread]: Running with dbt=1.11.2
[0m10:57:31.173662 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\lakehouse\\default\\Files\\dbt', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\lakehouse\\default\\Files\\dbt\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'invocation_command': 'dbt run --select price', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'use_experimental_parser': 'False'}
[0m10:57:31.497751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6ee3ea36-dc9f-4156-a0fd-418abdec5397', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019FFAB09090>]}
[0m10:57:31.545708 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6ee3ea36-dc9f-4156-a0fd-418abdec5397', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019FF558CCD0>]}
[0m10:57:31.566061 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m10:57:32.004244 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m10:57:32.264809 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m10:57:32.266817 [debug] [MainThread]: Partial parsing: added file: aemo_electricity://models\staging\csv_archive_log.sql
[0m10:57:32.266817 [debug] [MainThread]: Partial parsing: updated file: aemo_electricity://macros\download.sql
[0m10:57:32.593150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6ee3ea36-dc9f-4156-a0fd-418abdec5397', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019FFC2A55D0>]}
[0m10:57:32.654436 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m10:57:32.654436 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m10:57:32.713689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6ee3ea36-dc9f-4156-a0fd-418abdec5397', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019FF8BC3AD0>]}
[0m10:57:32.713689 [info ] [MainThread]: Found 8 models, 1 source, 474 macros
[0m10:57:32.713689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6ee3ea36-dc9f-4156-a0fd-418abdec5397', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019FFC424E90>]}
[0m10:57:32.713689 [warn ] [MainThread]: The selection criterion 'price' does not match any enabled nodes
[0m10:57:32.718004 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m10:57:32.720010 [debug] [MainThread]: Command end result
[0m10:57:32.749683 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m10:57:32.754977 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m10:57:32.759296 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\lakehouse\default\Files\dbt\target\run_results.json
[0m10:57:32.762310 [debug] [MainThread]: Command `dbt run` succeeded at 10:57:32.759296 after 1.69 seconds
[0m10:57:32.762310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019FFC3DFD10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019FF47627D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019FF4762390>]}
[0m10:57:32.763461 [debug] [MainThread]: Flushing usage events
[0m10:57:33.814040 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:57:47.649770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017DA5B10710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017DA5B697D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017DA5B6AAD0>]}


============================== 10:57:47.658609 | 0305efa4-b04b-4afe-9dbd-97b5aa7f6adc ==============================
[0m10:57:47.658609 [info ] [MainThread]: Running with dbt=1.11.2
[0m10:57:47.658609 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\lakehouse\\default\\Files\\dbt', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\lakehouse\\default\\Files\\dbt\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'invocation_command': 'dbt run --select dim_calendar', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'target_path': 'None'}
[0m10:57:47.979913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0305efa4-b04b-4afe-9dbd-97b5aa7f6adc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017DA5B44050>]}
[0m10:57:48.032220 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0305efa4-b04b-4afe-9dbd-97b5aa7f6adc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017DA0624C10>]}
[0m10:57:48.035924 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m10:57:48.437113 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m10:57:48.596146 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:57:48.596146 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m10:57:48.612003 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:57:48.641622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0305efa4-b04b-4afe-9dbd-97b5aa7f6adc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017DA703DC90>]}
[0m10:57:48.712145 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m10:57:48.712145 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m10:57:48.763077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0305efa4-b04b-4afe-9dbd-97b5aa7f6adc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017DA735F290>]}
[0m10:57:48.763077 [info ] [MainThread]: Found 8 models, 1 source, 474 macros
[0m10:57:48.766018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0305efa4-b04b-4afe-9dbd-97b5aa7f6adc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017DA5C33410>]}
[0m10:57:48.766018 [info ] [MainThread]: 
[0m10:57:48.766018 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:57:48.766018 [info ] [MainThread]: 
[0m10:57:48.772786 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m10:57:48.773797 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake'
[0m10:57:49.036003 [debug] [ThreadPool]: Using duckdb connection "list_ducklake"
[0m10:57:49.036941 [debug] [ThreadPool]: On list_ducklake: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"ducklake"'
    
  
  
[0m10:57:49.036941 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:57:49.443369 [debug] [ThreadPool]: SQL status: OK in 0.406 seconds
[0m10:57:49.445363 [debug] [ThreadPool]: On list_ducklake: Close
[0m10:57:49.446311 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ducklake, now create_ducklake_aemo)
[0m10:57:49.446311 [debug] [ThreadPool]: Creating schema "database: "ducklake"
schema: "aemo"
"
[0m10:57:49.452256 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:57:49.452256 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
        select type from duckdb_databases()
        where lower(database_name)='ducklake'
        and type='sqlite'
    
  
[0m10:57:49.452256 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:57:49.452256 [debug] [ThreadPool]: SQL status: OK in 0.002 seconds
[0m10:57:49.452256 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:57:49.452256 [debug] [ThreadPool]: On create_ducklake_aemo: BEGIN
[0m10:57:49.452256 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m10:57:49.462152 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:57:49.462152 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
    
        create schema if not exists "ducklake"."aemo"
    
[0m10:57:49.462152 [debug] [ThreadPool]: SQL status: OK in 0.005 seconds
[0m10:57:49.462152 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m10:57:49.462152 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:57:49.462152 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m10:57:49.462152 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m10:57:49.462152 [debug] [ThreadPool]: On create_ducklake_aemo: Close
[0m10:57:49.478155 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake_aemo'
[0m10:57:49.483904 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m10:57:49.484901 [debug] [ThreadPool]: On list_ducklake_aemo: BEGIN
[0m10:57:49.485907 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:57:49.486905 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m10:57:49.486905 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m10:57:49.488364 [debug] [ThreadPool]: On list_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake_aemo"} */
select
      'ducklake' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'aemo'
    and lower(table_catalog) = 'ducklake'
  
[0m10:57:49.518194 [debug] [ThreadPool]: SQL status: OK in 0.031 seconds
[0m10:57:49.518194 [debug] [ThreadPool]: On list_ducklake_aemo: ROLLBACK
[0m10:57:49.527102 [debug] [ThreadPool]: Failed to rollback 'list_ducklake_aemo'
[0m10:57:49.527102 [debug] [ThreadPool]: On list_ducklake_aemo: Close
[0m10:57:49.531072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0305efa4-b04b-4afe-9dbd-97b5aa7f6adc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017DA5A4F110>]}
[0m10:57:49.533049 [debug] [MainThread]: Using duckdb connection "master"
[0m10:57:49.534052 [debug] [MainThread]: On master: BEGIN
[0m10:57:49.536077 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:57:49.537093 [debug] [MainThread]: SQL status: OK in 0.002 seconds
[0m10:57:49.538648 [debug] [MainThread]: On master: COMMIT
[0m10:57:49.539699 [debug] [MainThread]: Using duckdb connection "master"
[0m10:57:49.540703 [debug] [MainThread]: On master: COMMIT
[0m10:57:49.542701 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:57:49.543714 [debug] [MainThread]: On master: Close
[0m10:57:49.552391 [debug] [Thread-1 (]: Began running node model.aemo_electricity.dim_calendar
[0m10:57:49.552391 [info ] [Thread-1 (]: 1 of 1 START sql incremental model aemo.dim_calendar ........................... [RUN]
[0m10:57:49.561602 [debug] [Thread-1 (]: Acquiring new duckdb connection 'model.aemo_electricity.dim_calendar'
[0m10:57:49.561602 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.dim_calendar
[0m10:57:49.582951 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.dim_calendar"
[0m10:57:49.587264 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.dim_calendar
[0m10:57:49.672538 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m10:57:49.672538 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

    
  
    
    

    create temporary table
      "dim_calendar__dbt_tmp20260202105749652561"
  
    as (
      

SELECT
  CAST(date AS DATE) as date,
  CAST(EXTRACT(year FROM date) AS INT) as year,
  CAST(EXTRACT(month FROM date) AS INT) as month
FROM (
  SELECT unnest(generate_series(
    CAST('2018-04-01' AS DATE),
    CAST('2026-12-31' AS DATE),
    INTERVAL 1 DAY
  )) as date
)
    );
  
  
  
[0m10:57:49.672538 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:57:49.684105 [debug] [Thread-1 (]: SQL status: OK in 0.010 seconds
[0m10:57:49.690810 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m10:57:49.691817 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: BEGIN
[0m10:57:49.692732 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m10:57:49.692732 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m10:57:49.693827 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar__dbt_tmp20260202105749652561'
      
      
      order by ordinal_position

  
[0m10:57:49.702488 [debug] [Thread-1 (]: SQL status: OK in 0.012 seconds
[0m10:57:49.711571 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m10:57:49.711571 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar'
      
      and lower(table_schema) = 'aemo'
      
      
      and lower(table_catalog) = 'ducklake'
      
      order by ordinal_position

  
[0m10:57:49.715581 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m10:57:49.729360 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m10:57:49.729739 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar__dbt_tmp20260202105749652561'
      
      
      order by ordinal_position

  
[0m10:57:49.733943 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m10:57:49.736946 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m10:57:49.736946 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar'
      
      and lower(table_schema) = 'aemo'
      
      
      and lower(table_catalog) = 'ducklake'
      
      order by ordinal_position

  
[0m10:57:49.741324 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m10:57:49.752914 [debug] [Thread-1 (]: 
    In "ducklake"."aemo"."dim_calendar":
        Schema changed: False
        Source columns not in target: []
        Target columns not in source: []
        New column types: []
  
[0m10:57:49.754606 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m10:57:49.755004 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */
SELECT version()
[0m10:57:49.756778 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m10:57:49.762881 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.dim_calendar"
[0m10:57:49.762881 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m10:57:49.762881 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

        
            delete from "ducklake"."aemo"."dim_calendar"
            where (
                date) in (
                select (date)
                from "dim_calendar__dbt_tmp20260202105749652561"
            );

        
    

    insert into "ducklake"."aemo"."dim_calendar" ("date", "year", "month")
    (
        select "date", "year", "month"
        from "dim_calendar__dbt_tmp20260202105749652561"
    )
  
[0m10:58:06.608878 [debug] [Thread-1 (]: SQL status: OK in 16.836 seconds
[0m10:58:06.619419 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: COMMIT
[0m10:58:06.635359 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m10:58:06.636048 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: COMMIT
[0m10:58:06.669108 [debug] [Thread-1 (]: SQL status: OK in 0.033 seconds
[0m10:58:06.672589 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: Close
[0m10:58:06.672589 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0305efa4-b04b-4afe-9dbd-97b5aa7f6adc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017DA75C4AD0>]}
[0m10:58:06.684971 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model aemo.dim_calendar ...................... [[32mOK[0m in 17.11s]
[0m10:58:06.687418 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.dim_calendar
[0m10:58:06.691523 [debug] [MainThread]: Using duckdb connection "master"
[0m10:58:06.692520 [debug] [MainThread]: On master: BEGIN
[0m10:58:06.693524 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:58:06.696065 [debug] [MainThread]: SQL status: OK in 0.002 seconds
[0m10:58:06.697564 [debug] [MainThread]: On master: COMMIT
[0m10:58:06.698738 [debug] [MainThread]: Using duckdb connection "master"
[0m10:58:06.699846 [debug] [MainThread]: On master: COMMIT
[0m10:58:06.701841 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:58:06.703823 [debug] [MainThread]: On master: Close
[0m10:58:06.704839 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:58:06.705846 [debug] [MainThread]: Connection 'create_ducklake_aemo' was properly closed.
[0m10:58:06.705846 [debug] [MainThread]: Connection 'list_ducklake_aemo' was properly closed.
[0m10:58:06.707300 [debug] [MainThread]: Connection 'model.aemo_electricity.dim_calendar' was properly closed.
[0m10:58:06.707300 [info ] [MainThread]: 
[0m10:58:06.709867 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 17.94 seconds (17.94s).
[0m10:58:06.710727 [debug] [MainThread]: Command end result
[0m10:58:06.737341 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m10:58:06.741991 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m10:58:06.750276 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\lakehouse\default\Files\dbt\target\run_results.json
[0m10:58:06.750276 [info ] [MainThread]: 
[0m10:58:06.752560 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:58:06.752560 [info ] [MainThread]: 
[0m10:58:06.753955 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m10:58:06.755361 [debug] [MainThread]: Command `dbt run` succeeded at 10:58:06.755361 after 19.23 seconds
[0m10:58:06.755361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017DA5B07CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017D9F762390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000017D9F762610>]}
[0m10:58:06.755361 [debug] [MainThread]: Flushing usage events
[0m10:58:07.785917 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m10:58:53.985529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000125FE508CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000125FE508F50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000125FE508690>]}


============================== 10:58:53.991800 | 850ea1fc-3c50-44e5-90bd-5ae59ada77fc ==============================
[0m10:58:53.991800 [info ] [MainThread]: Running with dbt=1.11.2
[0m10:58:53.991800 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\lakehouse\\default\\Files\\dbt', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'None', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\lakehouse\\default\\Files\\dbt\\logs', 'introspect': 'True', 'invocation_command': 'dbt seed --select csv_archive_log', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'target_path': 'None'}
[0m10:58:54.297102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '850ea1fc-3c50-44e5-90bd-5ae59ada77fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000125FE7D0610>]}
[0m10:58:54.347876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '850ea1fc-3c50-44e5-90bd-5ae59ada77fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000125F8F7A310>]}
[0m10:58:54.352737 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m10:58:54.731114 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m10:58:55.031233 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m10:58:55.033057 [debug] [MainThread]: Partial parsing: added file: aemo_electricity://seeds\csv_archive_log.csv
[0m10:58:55.033057 [debug] [MainThread]: Partial parsing: deleted file: aemo_electricity://models\staging\csv_archive_log.sql
[0m10:58:55.224810 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.aemo_electricity.staging
[0m10:58:55.238223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '850ea1fc-3c50-44e5-90bd-5ae59ada77fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000125FE5C3A90>]}
[0m10:58:55.365928 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m10:58:55.365928 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m10:58:55.449233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '850ea1fc-3c50-44e5-90bd-5ae59ada77fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000125FE7C9A10>]}
[0m10:58:55.449233 [info ] [MainThread]: Found 7 models, 1 seed, 1 source, 474 macros
[0m10:58:55.451241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '850ea1fc-3c50-44e5-90bd-5ae59ada77fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000125FED57FD0>]}
[0m10:58:55.453249 [info ] [MainThread]: 
[0m10:58:55.453249 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:58:55.455257 [info ] [MainThread]: 
[0m10:58:55.455257 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m10:58:55.457981 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake'
[0m10:58:55.712793 [debug] [ThreadPool]: Using duckdb connection "list_ducklake"
[0m10:58:55.713815 [debug] [ThreadPool]: On list_ducklake: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"ducklake"'
    
  
  
[0m10:58:55.714814 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:58:56.132838 [debug] [ThreadPool]: SQL status: OK in 0.419 seconds
[0m10:58:56.132838 [debug] [ThreadPool]: On list_ducklake: Close
[0m10:58:56.132838 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ducklake, now create_ducklake_aemo)
[0m10:58:56.132838 [debug] [ThreadPool]: Creating schema "database: "ducklake"
schema: "aemo"
"
[0m10:58:56.141351 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:58:56.141351 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
        select type from duckdb_databases()
        where lower(database_name)='ducklake'
        and type='sqlite'
    
  
[0m10:58:56.141351 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:58:56.141351 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m10:58:56.141351 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:58:56.141351 [debug] [ThreadPool]: On create_ducklake_aemo: BEGIN
[0m10:58:56.141351 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m10:58:56.141351 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:58:56.149284 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
    
        create schema if not exists "ducklake"."aemo"
    
[0m10:58:56.149790 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m10:58:56.149790 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m10:58:56.149790 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m10:58:56.149790 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m10:58:56.157522 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m10:58:56.158095 [debug] [ThreadPool]: On create_ducklake_aemo: Close
[0m10:58:56.158095 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake_aemo'
[0m10:58:56.166459 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m10:58:56.166459 [debug] [ThreadPool]: On list_ducklake_aemo: BEGIN
[0m10:58:56.166459 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:58:56.166459 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m10:58:56.166459 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m10:58:56.174259 [debug] [ThreadPool]: On list_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake_aemo"} */
select
      'ducklake' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'aemo'
    and lower(table_catalog) = 'ducklake'
  
[0m10:58:56.200186 [debug] [ThreadPool]: SQL status: OK in 0.027 seconds
[0m10:58:56.200186 [debug] [ThreadPool]: On list_ducklake_aemo: ROLLBACK
[0m10:58:56.208596 [debug] [ThreadPool]: Failed to rollback 'list_ducklake_aemo'
[0m10:58:56.208596 [debug] [ThreadPool]: On list_ducklake_aemo: Close
[0m10:58:56.214077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '850ea1fc-3c50-44e5-90bd-5ae59ada77fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000125FEC98AD0>]}
[0m10:58:56.216093 [debug] [MainThread]: Using duckdb connection "master"
[0m10:58:56.217121 [debug] [MainThread]: On master: BEGIN
[0m10:58:56.217121 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:58:56.217121 [debug] [MainThread]: SQL status: OK in 0.002 seconds
[0m10:58:56.217121 [debug] [MainThread]: On master: COMMIT
[0m10:58:56.224486 [debug] [MainThread]: Using duckdb connection "master"
[0m10:58:56.225457 [debug] [MainThread]: On master: COMMIT
[0m10:58:56.225457 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:58:56.225457 [debug] [MainThread]: On master: Close
[0m10:58:56.250206 [debug] [Thread-1 (]: Began running node seed.aemo_electricity.csv_archive_log
[0m10:58:56.250206 [info ] [Thread-1 (]: 1 of 1 START seed file aemo.csv_archive_log .................................... [RUN]
[0m10:58:56.250206 [debug] [Thread-1 (]: Acquiring new duckdb connection 'seed.aemo_electricity.csv_archive_log'
[0m10:58:56.257655 [debug] [Thread-1 (]: Began compiling node seed.aemo_electricity.csv_archive_log
[0m10:58:56.258614 [debug] [Thread-1 (]: Began executing node seed.aemo_electricity.csv_archive_log
[0m10:58:56.315793 [debug] [Thread-1 (]: Using duckdb connection "seed.aemo_electricity.csv_archive_log"
[0m10:58:56.316800 [debug] [Thread-1 (]: On seed.aemo_electricity.csv_archive_log: BEGIN
[0m10:58:56.317802 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:58:56.318807 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m10:58:56.319550 [debug] [Thread-1 (]: Using duckdb connection "seed.aemo_electricity.csv_archive_log"
[0m10:58:56.319550 [debug] [Thread-1 (]: On seed.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "seed.aemo_electricity.csv_archive_log"} */

    create table "ducklake"."aemo"."csv_archive_log" ("source_type" integer,"source_filename" integer,"archive_path" integer,"archived_at" integer,"row_count" integer,"source_url" integer,"etag" integer)
  
[0m10:58:56.327563 [debug] [Thread-1 (]: SQL status: OK in 0.006 seconds
[0m10:58:56.339243 [debug] [Thread-1 (]: Using duckdb connection "seed.aemo_electricity.csv_archive_log"
[0m10:58:56.339775 [debug] [Thread-1 (]: On seed.aemo_electricity.csv_archive_log: 
          COPY "ducklake"."aemo"."csv_archive_log" FROM 'C:\lakehouse\default\Files\dbt\seeds\csv_archive_log.csv' (FORMAT CSV, HEADER TRUE, DELIMITER ',')
        ...
[0m10:59:01.916845 [debug] [Thread-1 (]: SQL status: OK in 5.578 seconds
[0m10:59:01.926876 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.aemo_electricity.csv_archive_log"
[0m10:59:01.949144 [debug] [Thread-1 (]: On seed.aemo_electricity.csv_archive_log: COMMIT
[0m10:59:01.949144 [debug] [Thread-1 (]: Using duckdb connection "seed.aemo_electricity.csv_archive_log"
[0m10:59:01.952766 [debug] [Thread-1 (]: On seed.aemo_electricity.csv_archive_log: COMMIT
[0m10:59:01.972974 [debug] [Thread-1 (]: SQL status: OK in 0.019 seconds
[0m10:59:01.974983 [debug] [Thread-1 (]: On seed.aemo_electricity.csv_archive_log: Close
[0m10:59:01.978355 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '850ea1fc-3c50-44e5-90bd-5ae59ada77fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000125FE5D8C10>]}
[0m10:59:01.980095 [info ] [Thread-1 (]: 1 of 1 OK loaded seed file aemo.csv_archive_log ................................ [[32mINSERT 0[0m in 5.72s]
[0m10:59:01.980095 [debug] [Thread-1 (]: Finished running node seed.aemo_electricity.csv_archive_log
[0m10:59:01.982572 [debug] [MainThread]: Using duckdb connection "master"
[0m10:59:01.983583 [debug] [MainThread]: On master: BEGIN
[0m10:59:01.983583 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:59:01.984907 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m10:59:01.985958 [debug] [MainThread]: On master: COMMIT
[0m10:59:01.985958 [debug] [MainThread]: Using duckdb connection "master"
[0m10:59:01.986864 [debug] [MainThread]: On master: COMMIT
[0m10:59:01.987370 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m10:59:01.988376 [debug] [MainThread]: On master: Close
[0m10:59:01.988376 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:59:01.989484 [debug] [MainThread]: Connection 'create_ducklake_aemo' was properly closed.
[0m10:59:01.990375 [debug] [MainThread]: Connection 'list_ducklake_aemo' was properly closed.
[0m10:59:01.990375 [debug] [MainThread]: Connection 'seed.aemo_electricity.csv_archive_log' was properly closed.
[0m10:59:01.991408 [info ] [MainThread]: 
[0m10:59:01.992377 [info ] [MainThread]: Finished running 1 seed in 0 hours 0 minutes and 6.54 seconds (6.54s).
[0m10:59:01.993375 [debug] [MainThread]: Command end result
[0m10:59:02.016428 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m10:59:02.016428 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m10:59:02.032509 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\lakehouse\default\Files\dbt\target\run_results.json
[0m10:59:02.033296 [info ] [MainThread]: 
[0m10:59:02.033296 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:59:02.033296 [info ] [MainThread]: 
[0m10:59:02.033296 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m10:59:02.033296 [debug] [MainThread]: Command `dbt seed` succeeded at 10:59:02.033296 after 8.17 seconds
[0m10:59:02.033296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000125F8248510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000125FE442710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000125FE286690>]}
[0m10:59:02.033296 [debug] [MainThread]: Flushing usage events
[0m10:59:03.029176 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:01:53.503726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1F5686C10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1F55856D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1F590AAD0>]}


============================== 11:01:53.545202 | 0117d015-6f67-4f4c-a810-39c8759bcb18 ==============================
[0m11:01:53.545202 [info ] [MainThread]: Running with dbt=1.11.2
[0m11:01:53.545202 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'None', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'C:\\lakehouse\\default\\Files\\dbt', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\lakehouse\\default\\Files\\dbt\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run-operation download', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'target_path': 'None'}
[0m11:01:54.566386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0117d015-6f67-4f4c-a810-39c8759bcb18', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1F5B31950>]}
[0m11:01:54.614429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0117d015-6f67-4f4c-a810-39c8759bcb18', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1F13E8A90>]}
[0m11:01:54.691003 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m11:01:55.432026 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m11:01:59.150639 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:01:59.153735 [debug] [MainThread]: Partial parsing: updated file: aemo_electricity://macros\download.sql
[0m11:01:59.263091 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.aemo_electricity.staging
[0m11:01:59.290144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0117d015-6f67-4f4c-a810-39c8759bcb18', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1F5E35AD0>]}
[0m11:01:59.439684 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m11:01:59.478750 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m11:02:00.202517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0117d015-6f67-4f4c-a810-39c8759bcb18', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1F5BC6390>]}
[0m11:02:00.204516 [info ] [MainThread]: Found 7 models, 1 seed, 1 source, 474 macros
[0m11:02:00.205518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0117d015-6f67-4f4c-a810-39c8759bcb18', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1F7137250>]}
[0m11:02:00.207622 [debug] [MainThread]: Acquiring new duckdb connection 'macro_download'
[0m11:02:00.209613 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:02:00.211610 [debug] [MainThread]: On macro_download: BEGIN
[0m11:02:00.213518 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:02:01.427808 [debug] [MainThread]: SQL status: OK in 1.214 seconds
[0m11:02:01.427808 [debug] [MainThread]: On macro_download: COMMIT
[0m11:02:01.427808 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:02:01.427808 [debug] [MainThread]: On macro_download: COMMIT
[0m11:02:01.427808 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m11:02:01.563791 [info ] [MainThread]: [DOWNLOAD] Starting download with PATH_ROOT=/lakehouse/default, download_limit=2
[0m11:02:10.970814 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:02:10.970814 [debug] [MainThread]: On macro_download: BEGIN
[0m11:02:10.970814 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:02:10.970814 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:02:10.970814 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE PATH_ROOT = '/lakehouse/default'

[0m11:02:10.970814 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m11:02:10.970814 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:02:10.979479 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE download_limit = 2

[0m11:02:10.979479 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m11:02:10.979479 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:02:10.982767 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE csv_archive_path = getvariable('PATH_ROOT') || '/Files/csv'

[0m11:02:10.982767 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m11:02:10.984773 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:02:10.984773 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE SCHEMA IF NOT EXISTS ducklake.aemo

[0m11:02:11.046072 [debug] [MainThread]: SQL status: OK in 0.060 seconds
[0m11:02:11.046072 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:02:11.046072 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

USE ducklake.aemo

[0m11:02:11.046072 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:02:11.053828 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:02:11.053828 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE _csv_archive_staging (
  source_type VARCHAR,
  source_filename VARCHAR,
  archive_path VARCHAR,
  archived_at TIMESTAMP,
  row_count BIGINT,
  source_url VARCHAR,
  etag VARCHAR
)

[0m11:02:11.055836 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m11:02:11.057870 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:02:11.059864 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE _existing_archive_log (
  source_type VARCHAR,
  source_filename VARCHAR
)

[0m11:02:11.061863 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m11:02:11.063860 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:02:11.064944 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

INSERT INTO _existing_archive_log 
SELECT source_type, source_filename 
FROM ducklake.aemo.csv_archive_log

[0m11:02:11.081076 [debug] [MainThread]: SQL status: OK in 0.015 seconds
[0m11:02:11.083014 [info ] [MainThread]: [DOWNLOAD] Daily source: aemo
[0m11:02:11.084092 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:02:11.086000 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE daily_files_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('https://nemweb.com.au/Reports/Current/Daily_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'https://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DAILY%.zip%'
ORDER BY full_url DESC

[0m11:02:11.309253 [debug] [MainThread]: SQL status: OK in 0.223 seconds
[0m11:02:11.312178 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:02:11.312178 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE daily_to_archive AS
SELECT full_url, filename
FROM daily_files_web
WHERE filename NOT IN (SELECT source_filename FROM _existing_archive_log WHERE source_type = 'daily')
LIMIT getvariable('download_limit')

[0m11:02:11.312178 [debug] [MainThread]: SQL status: OK in 0.005 seconds
[0m11:02:11.325332 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:02:11.325332 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE has_daily_to_archive = (SELECT count(*) > 0 FROM daily_to_archive)

[0m11:02:11.325332 [debug] [MainThread]: SQL status: OK in 0.003 seconds
[0m11:02:11.336589 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:02:11.338580 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE daily_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM daily_to_archive)

[0m11:02:11.346575 [debug] [MainThread]: SQL status: OK in 0.006 seconds
[0m11:02:11.350580 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:02:11.351582 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE daily_expected = (SELECT count(*) FROM daily_to_archive)

[0m11:02:11.356538 [debug] [MainThread]: SQL status: OK in 0.002 seconds
[0m11:02:11.360836 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:02:11.362681 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE daily_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM daily_to_archive)

[0m11:02:11.372531 [debug] [MainThread]: SQL status: OK in 0.008 seconds
[0m11:02:11.375533 [info ] [MainThread]: [DOWNLOAD] Processing daily files...
[0m11:02:11.378584 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:02:11.379158 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    CAST(substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 4) AS INT) AS year
  FROM read_blob(getvariable('daily_urls'))
  WHERE getvariable('has_daily_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/daily')
(FORMAT BLOB, PARTITION_BY (year, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m11:02:12.117179 [debug] [MainThread]: SQL status: OK in 0.736 seconds
[0m11:02:12.120670 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:02:12.122591 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'daily' AS source_type,
  filename AS source_filename,
  '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM daily_to_archive
WHERE getvariable('daily_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('daily_paths'))) = getvariable('daily_expected')

[0m11:02:19.634191 [debug] [MainThread]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'daily' AS source_type,
  filename AS source_filename,
  '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM daily_to_archive
WHERE getvariable('daily_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('daily_paths'))) = getvariable('daily_expected')

[0m11:02:19.639315 [debug] [MainThread]: DuckDB adapter: Rolling back transaction.
[0m11:02:19.639315 [debug] [MainThread]: On macro_download: ROLLBACK
[0m11:02:20.013937 [debug] [MainThread]: Failed to rollback 'macro_download'
[0m11:02:20.015947 [debug] [MainThread]: On macro_download: Close
[0m11:02:20.019969 [error] [MainThread]: Encountered an error while running operation: Runtime Error
  Conversion Error: Could not convert string 'daily' to INT32 when casting from source column source_type
  
  LINE 5:   'daily' AS source_type,
            ^
[0m11:02:20.026298 [debug] [MainThread]: Traceback (most recent call last):
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\dbt\adapters\duckdb\connections.py", line 95, in exception_handler
    yield
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\dbt\adapters\sql\connections.py", line 148, in add_query
    _execute_query_with_retry(
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\dbt\adapters\sql\connections.py", line 97, in _execute_query_with_retry
    cursor.execute(sql, bindings)
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\dbt\adapters\duckdb\environments\local.py", line 23, in execute
    return self._cursor.execute(sql)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
_duckdb.ConversionException: Conversion Error: Could not convert string 'daily' to INT32 when casting from source column source_type

LINE 5:   'daily' AS source_type,
          ^

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\dbt\task\run_operation.py", line 64, in run
    self._run_unsafe(package_name, macro_name)
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\dbt\task\run_operation.py", line 45, in _run_unsafe
    res = adapter.execute_macro(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\dbt\adapters\base\impl.py", line 1320, in execute_macro
    result = macro_function(**kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\dbt_common\clients\jinja.py", line 427, in __call__
    return self.call_macro(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\dbt_common\clients\jinja.py", line 395, in call_macro
    return macro(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\jinja2\runtime.py", line 770, in __call__
    return self._invoke(arguments, autoescape)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\jinja2\runtime.py", line 784, in _invoke
    rv = self._func(*arguments)
         ^^^^^^^^^^^^^^^^^^^^^^
  File "<template>", line 271, in macro
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\jinja2\sandbox.py", line 401, in call
    return __context.call(__obj, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\jinja2\runtime.py", line 303, in call
    return __obj(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\dbt\clients\jinja.py", line 82, in __call__
    return self.call_macro(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\dbt_common\clients\jinja.py", line 395, in call_macro
    return macro(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\jinja2\runtime.py", line 770, in __call__
    return self._invoke(arguments, autoescape)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\jinja2\runtime.py", line 784, in _invoke
    rv = self._func(*arguments)
         ^^^^^^^^^^^^^^^^^^^^^^
  File "<template>", line 52, in macro
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\jinja2\sandbox.py", line 401, in call
    return __context.call(__obj, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\jinja2\runtime.py", line 303, in call
    return __obj(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\dbt_common\record.py", line 538, in record_replay_wrapper
    return func_to_record(*call_args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\dbt\adapters\base\impl.py", line 471, in execute
    return self.connections.execute(sql=sql, auto_begin=auto_begin, fetch=fetch, limit=limit)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\dbt\adapters\duckdb\connections.py", line 133, in execute
    return super().execute(sql, auto_begin, fetch, limit)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\dbt\adapters\sql\connections.py", line 219, in execute
    _, cursor = self.add_query(sql, auto_begin)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\dbt\adapters\sql\connections.py", line 131, in add_query
    with self.exception_handler(sql):
  File "C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__qbz5n2kfra8p0\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(typ, value, traceback)
  File "C:\Users\mdjouallah\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\dbt\adapters\duckdb\connections.py", line 106, in exception_handler
    raise dbt.exceptions.DbtRuntimeError(str(exc)) from exc
dbt_common.exceptions.base.DbtRuntimeError: Runtime Error
  Conversion Error: Could not convert string 'daily' to INT32 when casting from source column source_type
  
  LINE 5:   'daily' AS source_type,
            ^

[0m11:02:20.039027 [debug] [MainThread]: Wrote artifact RunResultsArtifact to C:\lakehouse\default\Files\dbt\target\run_results.json
[0m11:02:20.049656 [debug] [MainThread]: Command `dbt run-operation` failed at 11:02:20.048653 after 26.79 seconds
[0m11:02:20.051656 [debug] [MainThread]: Connection 'macro_download' was properly closed.
[0m11:02:20.052653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1EF6D0250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1F596EC10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1F70A4250>]}
[0m11:02:20.054229 [debug] [MainThread]: Flushing usage events
[0m11:02:21.100459 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:03:03.609059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002551F311B90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002551F311F50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002551F310D90>]}


============================== 11:03:03.619747 | 73c9c454-bf21-435e-9b0a-c56fb7ba7a61 ==============================
[0m11:03:03.619747 [info ] [MainThread]: Running with dbt=1.11.2
[0m11:03:03.621137 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'None', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'C:\\lakehouse\\default\\Files\\dbt', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\lakehouse\\default\\Files\\dbt\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'no_print': 'None', 'invocation_command': 'dbt seed --select csv_archive_log --full-refresh', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m11:03:03.947841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '73c9c454-bf21-435e-9b0a-c56fb7ba7a61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002551F511550>]}
[0m11:03:04.004150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '73c9c454-bf21-435e-9b0a-c56fb7ba7a61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025519DAC950>]}
[0m11:03:04.015055 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m11:03:04.398519 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m11:03:04.478049 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:03:04.478049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '73c9c454-bf21-435e-9b0a-c56fb7ba7a61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002551D49E490>]}
[0m11:03:05.786883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '73c9c454-bf21-435e-9b0a-c56fb7ba7a61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002551FCA8DD0>]}
[0m11:03:05.866066 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m11:03:05.871445 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m11:03:06.136387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '73c9c454-bf21-435e-9b0a-c56fb7ba7a61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002551FBF2390>]}
[0m11:03:06.137390 [info ] [MainThread]: Found 7 models, 1 seed, 1 source, 474 macros
[0m11:03:06.137390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73c9c454-bf21-435e-9b0a-c56fb7ba7a61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002551FCAB0D0>]}
[0m11:03:06.140085 [info ] [MainThread]: 
[0m11:03:06.140085 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:03:06.140085 [info ] [MainThread]: 
[0m11:03:06.145231 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m11:03:06.147230 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake'
[0m11:03:06.544648 [debug] [ThreadPool]: Using duckdb connection "list_ducklake"
[0m11:03:06.553204 [debug] [ThreadPool]: On list_ducklake: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"ducklake"'
    
  
  
[0m11:03:06.553995 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:03:06.962396 [debug] [ThreadPool]: SQL status: OK in 0.410 seconds
[0m11:03:06.962396 [debug] [ThreadPool]: On list_ducklake: Close
[0m11:03:06.962396 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ducklake, now create_ducklake_aemo)
[0m11:03:06.962396 [debug] [ThreadPool]: Creating schema "database: "ducklake"
schema: "aemo"
"
[0m11:03:06.970372 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:03:06.970372 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
        select type from duckdb_databases()
        where lower(database_name)='ducklake'
        and type='sqlite'
    
  
[0m11:03:06.970372 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:03:06.970372 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:03:06.970372 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:03:06.978186 [debug] [ThreadPool]: On create_ducklake_aemo: BEGIN
[0m11:03:06.978725 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m11:03:06.978725 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:03:06.978725 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
    
        create schema if not exists "ducklake"."aemo"
    
[0m11:03:06.978725 [debug] [ThreadPool]: SQL status: OK in 0.005 seconds
[0m11:03:06.978725 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m11:03:06.986454 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:03:06.987021 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m11:03:06.987021 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:03:06.987021 [debug] [ThreadPool]: On create_ducklake_aemo: Close
[0m11:03:06.987021 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake_aemo'
[0m11:03:06.999706 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m11:03:07.000094 [debug] [ThreadPool]: On list_ducklake_aemo: BEGIN
[0m11:03:07.000094 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:03:07.000094 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:03:07.000094 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m11:03:07.003017 [debug] [ThreadPool]: On list_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake_aemo"} */
select
      'ducklake' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'aemo'
    and lower(table_catalog) = 'ducklake'
  
[0m11:03:07.028520 [debug] [ThreadPool]: SQL status: OK in 0.026 seconds
[0m11:03:07.028520 [debug] [ThreadPool]: On list_ducklake_aemo: ROLLBACK
[0m11:03:07.036951 [debug] [ThreadPool]: Failed to rollback 'list_ducklake_aemo'
[0m11:03:07.036951 [debug] [ThreadPool]: On list_ducklake_aemo: Close
[0m11:03:07.036951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73c9c454-bf21-435e-9b0a-c56fb7ba7a61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002551FA05010>]}
[0m11:03:07.036951 [debug] [MainThread]: Using duckdb connection "master"
[0m11:03:07.036951 [debug] [MainThread]: On master: BEGIN
[0m11:03:07.044826 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:03:07.045605 [debug] [MainThread]: SQL status: OK in 0.002 seconds
[0m11:03:07.045605 [debug] [MainThread]: On master: COMMIT
[0m11:03:07.045605 [debug] [MainThread]: Using duckdb connection "master"
[0m11:03:07.049343 [debug] [MainThread]: On master: COMMIT
[0m11:03:07.049343 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:03:07.051355 [debug] [MainThread]: On master: Close
[0m11:03:07.172271 [debug] [Thread-1 (]: Began running node seed.aemo_electricity.csv_archive_log
[0m11:03:07.174272 [info ] [Thread-1 (]: 1 of 1 START seed file aemo.csv_archive_log .................................... [RUN]
[0m11:03:07.176270 [debug] [Thread-1 (]: Acquiring new duckdb connection 'seed.aemo_electricity.csv_archive_log'
[0m11:03:07.177269 [debug] [Thread-1 (]: Began compiling node seed.aemo_electricity.csv_archive_log
[0m11:03:07.178007 [debug] [Thread-1 (]: Began executing node seed.aemo_electricity.csv_archive_log
[0m11:03:07.245757 [debug] [Thread-1 (]: Using duckdb connection "seed.aemo_electricity.csv_archive_log"
[0m11:03:07.245757 [debug] [Thread-1 (]: On seed.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "seed.aemo_electricity.csv_archive_log"} */

      drop table if exists "ducklake"."aemo"."csv_archive_log"
    
[0m11:03:07.245757 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m11:03:07.270011 [debug] [Thread-1 (]: SQL status: OK in 0.020 seconds
[0m11:03:07.278213 [debug] [Thread-1 (]: Using duckdb connection "seed.aemo_electricity.csv_archive_log"
[0m11:03:07.279100 [debug] [Thread-1 (]: On seed.aemo_electricity.csv_archive_log: BEGIN
[0m11:03:07.279100 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:03:07.279100 [debug] [Thread-1 (]: Using duckdb connection "seed.aemo_electricity.csv_archive_log"
[0m11:03:07.279100 [debug] [Thread-1 (]: On seed.aemo_electricity.csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "seed.aemo_electricity.csv_archive_log"} */

    create table "ducklake"."aemo"."csv_archive_log" ("source_type" varchar,"source_filename" varchar,"archive_path" varchar,"archived_at" timestamp,"row_count" bigint,"source_url" varchar,"etag" varchar)
  
[0m11:03:07.336547 [debug] [Thread-1 (]: SQL status: OK in 0.067 seconds
[0m11:03:07.361686 [debug] [Thread-1 (]: Using duckdb connection "seed.aemo_electricity.csv_archive_log"
[0m11:03:07.362705 [debug] [Thread-1 (]: On seed.aemo_electricity.csv_archive_log: 
          COPY "ducklake"."aemo"."csv_archive_log" FROM 'C:\lakehouse\default\Files\dbt\seeds\csv_archive_log.csv' (FORMAT CSV, HEADER TRUE, DELIMITER ',')
        ...
[0m11:03:13.463393 [debug] [Thread-1 (]: SQL status: OK in 6.113 seconds
[0m11:03:13.488298 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.aemo_electricity.csv_archive_log"
[0m11:03:13.549961 [debug] [Thread-1 (]: On seed.aemo_electricity.csv_archive_log: COMMIT
[0m11:03:13.555032 [debug] [Thread-1 (]: Using duckdb connection "seed.aemo_electricity.csv_archive_log"
[0m11:03:13.555687 [debug] [Thread-1 (]: On seed.aemo_electricity.csv_archive_log: COMMIT
[0m11:03:13.577583 [debug] [Thread-1 (]: SQL status: OK in 0.019 seconds
[0m11:03:13.580710 [debug] [Thread-1 (]: On seed.aemo_electricity.csv_archive_log: Close
[0m11:03:13.618054 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73c9c454-bf21-435e-9b0a-c56fb7ba7a61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002551FA9B450>]}
[0m11:03:13.621239 [info ] [Thread-1 (]: 1 of 1 OK loaded seed file aemo.csv_archive_log ................................ [[32mCREATE 0[0m in 6.41s]
[0m11:03:13.621239 [debug] [Thread-1 (]: Finished running node seed.aemo_electricity.csv_archive_log
[0m11:03:13.621239 [debug] [MainThread]: Using duckdb connection "master"
[0m11:03:13.621239 [debug] [MainThread]: On master: BEGIN
[0m11:03:13.621239 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:03:13.628846 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m11:03:13.630152 [debug] [MainThread]: On master: COMMIT
[0m11:03:13.630152 [debug] [MainThread]: Using duckdb connection "master"
[0m11:03:13.631317 [debug] [MainThread]: On master: COMMIT
[0m11:03:13.632591 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:03:13.632591 [debug] [MainThread]: On master: Close
[0m11:03:13.633875 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:03:13.634651 [debug] [MainThread]: Connection 'create_ducklake_aemo' was properly closed.
[0m11:03:13.634651 [debug] [MainThread]: Connection 'list_ducklake_aemo' was properly closed.
[0m11:03:13.634651 [debug] [MainThread]: Connection 'seed.aemo_electricity.csv_archive_log' was properly closed.
[0m11:03:13.636403 [info ] [MainThread]: 
[0m11:03:13.637691 [info ] [MainThread]: Finished running 1 seed in 0 hours 0 minutes and 7.49 seconds (7.49s).
[0m11:03:13.638700 [debug] [MainThread]: Command end result
[0m11:03:13.671524 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m11:03:13.677289 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m11:03:13.678297 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\lakehouse\default\Files\dbt\target\run_results.json
[0m11:03:13.686792 [info ] [MainThread]: 
[0m11:03:13.688187 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:03:13.689448 [info ] [MainThread]: 
[0m11:03:13.689448 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m11:03:13.691453 [debug] [MainThread]: Command `dbt seed` succeeded at 11:03:13.691453 after 10.22 seconds
[0m11:03:13.691453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002551F08A210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002551F307F50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002551F3077D0>]}
[0m11:03:13.691453 [debug] [MainThread]: Flushing usage events
[0m11:03:14.679715 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:03:51.643572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022398010C50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022398010B10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022398010490>]}


============================== 11:03:51.653233 | f7f5770f-93c2-4d4e-bc86-96876d0a33ab ==============================
[0m11:03:51.653233 [info ] [MainThread]: Running with dbt=1.11.2
[0m11:03:51.654230 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\lakehouse\\default\\Files\\dbt', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'None', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\lakehouse\\default\\Files\\dbt\\logs', 'introspect': 'True', 'no_print': 'None', 'fail_fast': 'False', 'invocation_command': 'dbt run-operation download', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'target_path': 'None'}
[0m11:03:51.984209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f7f5770f-93c2-4d4e-bc86-96876d0a33ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002239808D250>]}
[0m11:03:52.034350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f7f5770f-93c2-4d4e-bc86-96876d0a33ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022392B007D0>]}
[0m11:03:52.034350 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m11:03:52.459157 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m11:03:52.684146 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:03:52.684146 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m11:03:52.684146 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:03:52.725148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f7f5770f-93c2-4d4e-bc86-96876d0a33ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223980C7550>]}
[0m11:03:52.809038 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m11:03:52.809038 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m11:03:52.859629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f7f5770f-93c2-4d4e-bc86-96876d0a33ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223985CF8D0>]}
[0m11:03:52.859629 [info ] [MainThread]: Found 7 models, 1 seed, 1 source, 474 macros
[0m11:03:52.859629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f7f5770f-93c2-4d4e-bc86-96876d0a33ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000223980B2690>]}
[0m11:03:52.859629 [debug] [MainThread]: Acquiring new duckdb connection 'macro_download'
[0m11:03:52.859629 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:03:52.859629 [debug] [MainThread]: On macro_download: BEGIN
[0m11:03:52.859629 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:03:53.300059 [debug] [MainThread]: SQL status: OK in 0.436 seconds
[0m11:03:53.300059 [debug] [MainThread]: On macro_download: COMMIT
[0m11:03:53.300059 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:03:53.300059 [debug] [MainThread]: On macro_download: COMMIT
[0m11:03:53.300059 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:03:53.325472 [info ] [MainThread]: [DOWNLOAD] Starting download with PATH_ROOT=/lakehouse/default, download_limit=2
[0m11:03:53.623175 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:03:53.624176 [debug] [MainThread]: On macro_download: BEGIN
[0m11:03:53.625175 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:03:53.625175 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:03:53.625175 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE PATH_ROOT = '/lakehouse/default'

[0m11:03:53.625175 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:03:53.625175 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:03:53.625175 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE download_limit = 2

[0m11:03:53.625175 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:03:53.625175 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:03:53.625175 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE csv_archive_path = getvariable('PATH_ROOT') || '/Files/csv'

[0m11:03:53.625175 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:03:53.625175 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:03:53.625175 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE SCHEMA IF NOT EXISTS ducklake.aemo

[0m11:03:53.669221 [debug] [MainThread]: SQL status: OK in 0.035 seconds
[0m11:03:53.670284 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:03:53.671287 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

USE ducklake.aemo

[0m11:03:53.672245 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:03:53.672245 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:03:53.673820 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE _csv_archive_staging (
  source_type VARCHAR,
  source_filename VARCHAR,
  archive_path VARCHAR,
  archived_at TIMESTAMP,
  row_count BIGINT,
  source_url VARCHAR,
  etag VARCHAR
)

[0m11:03:53.674727 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:03:53.675646 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:03:53.675646 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE _existing_archive_log (
  source_type VARCHAR,
  source_filename VARCHAR
)

[0m11:03:53.676716 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:03:53.677678 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:03:53.677678 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

INSERT INTO _existing_archive_log 
SELECT source_type, source_filename 
FROM ducklake.aemo.csv_archive_log

[0m11:03:53.684537 [debug] [MainThread]: SQL status: OK in 0.009 seconds
[0m11:03:53.684537 [info ] [MainThread]: [DOWNLOAD] Daily source: aemo
[0m11:03:53.684537 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:03:53.684537 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE daily_files_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('https://nemweb.com.au/Reports/Current/Daily_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'https://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DAILY%.zip%'
ORDER BY full_url DESC

[0m11:03:53.841718 [debug] [MainThread]: SQL status: OK in 0.157 seconds
[0m11:03:53.841718 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:03:53.841718 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE daily_to_archive AS
SELECT full_url, filename
FROM daily_files_web
WHERE filename NOT IN (SELECT source_filename FROM _existing_archive_log WHERE source_type = 'daily')
LIMIT getvariable('download_limit')

[0m11:03:53.856841 [debug] [MainThread]: SQL status: OK in 0.004 seconds
[0m11:03:53.861337 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:03:53.862379 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE has_daily_to_archive = (SELECT count(*) > 0 FROM daily_to_archive)

[0m11:03:53.865377 [debug] [MainThread]: SQL status: OK in 0.002 seconds
[0m11:03:53.867604 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:03:53.868737 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE daily_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM daily_to_archive)

[0m11:03:53.873257 [debug] [MainThread]: SQL status: OK in 0.004 seconds
[0m11:03:53.874331 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:03:53.875245 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE daily_expected = (SELECT count(*) FROM daily_to_archive)

[0m11:03:53.875245 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m11:03:53.875245 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:03:53.875245 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE daily_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM daily_to_archive)

[0m11:03:53.875245 [debug] [MainThread]: SQL status: OK in 0.006 seconds
[0m11:03:53.875245 [info ] [MainThread]: [DOWNLOAD] Processing daily files...
[0m11:03:53.890000 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:03:53.890000 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    CAST(substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 4) AS INT) AS year
  FROM read_blob(getvariable('daily_urls'))
  WHERE getvariable('has_daily_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/daily')
(FORMAT BLOB, PARTITION_BY (year, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m11:03:54.542294 [debug] [MainThread]: SQL status: OK in 0.649 seconds
[0m11:03:54.546929 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:03:54.548944 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'daily' AS source_type,
  filename AS source_filename,
  '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM daily_to_archive
WHERE getvariable('daily_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('daily_paths'))) = getvariable('daily_expected')

[0m11:04:04.519520 [debug] [MainThread]: SQL status: OK in 9.973 seconds
[0m11:04:04.525290 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:04.527350 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE intraday_scada_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('http://nemweb.com.au/Reports/Current/Dispatch_SCADA/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'http://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DISPATCHSCADA%'
ORDER BY full_url DESC
LIMIT 500

[0m11:04:04.751194 [debug] [MainThread]: SQL status: OK in 0.223 seconds
[0m11:04:04.754106 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:04.756150 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE scada_today_to_archive AS
SELECT full_url, filename
FROM intraday_scada_web
WHERE filename NOT IN (SELECT source_filename FROM _existing_archive_log WHERE source_type = 'scada_today')
LIMIT getvariable('download_limit')

[0m11:04:04.760189 [debug] [MainThread]: SQL status: OK in 0.003 seconds
[0m11:04:04.764106 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:04.766106 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE has_scada_today_to_archive = (SELECT count(*) > 0 FROM scada_today_to_archive)

[0m11:04:04.770116 [debug] [MainThread]: SQL status: OK in 0.002 seconds
[0m11:04:04.775126 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:04.777128 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE scada_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM scada_today_to_archive)

[0m11:04:04.785777 [debug] [MainThread]: SQL status: OK in 0.007 seconds
[0m11:04:04.789330 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:04.791312 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE scada_expected = (SELECT count(*) FROM scada_today_to_archive)

[0m11:04:04.794703 [debug] [MainThread]: SQL status: OK in 0.002 seconds
[0m11:04:04.797704 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:04.799706 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE scada_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/scada_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM scada_today_to_archive)

[0m11:04:04.809667 [debug] [MainThread]: SQL status: OK in 0.008 seconds
[0m11:04:04.812673 [info ] [MainThread]: [DOWNLOAD] Processing intraday SCADA files...
[0m11:04:04.815670 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:04.818217 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 8) AS day
  FROM read_blob(getvariable('scada_urls'))
  WHERE getvariable('has_scada_today_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/scada_today')
(FORMAT BLOB, PARTITION_BY (day, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m11:04:04.992044 [debug] [MainThread]: SQL status: OK in 0.172 seconds
[0m11:04:04.997050 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:05.002152 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'scada_today' AS source_type,
  filename AS source_filename,
  '/scada_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM scada_today_to_archive
WHERE getvariable('scada_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('scada_paths'))) = getvariable('scada_expected')

[0m11:04:10.960016 [debug] [MainThread]: SQL status: OK in 5.955 seconds
[0m11:04:10.963993 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:10.965998 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE intraday_price_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('http://nemweb.com.au/Reports/Current/DispatchIS_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'http://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DISPATCHIS_%.zip%'
ORDER BY full_url DESC
LIMIT 500

[0m11:04:11.142866 [debug] [MainThread]: SQL status: OK in 0.175 seconds
[0m11:04:11.144888 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:11.146890 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

CREATE OR REPLACE TEMP TABLE price_today_to_archive AS
SELECT full_url, filename
FROM intraday_price_web
WHERE filename NOT IN (SELECT source_filename FROM _existing_archive_log WHERE source_type = 'price_today')
LIMIT getvariable('download_limit')

[0m11:04:11.153337 [debug] [MainThread]: SQL status: OK in 0.004 seconds
[0m11:04:11.158683 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:11.159683 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE has_price_today_to_archive = (SELECT count(*) > 0 FROM price_today_to_archive)

[0m11:04:11.161685 [debug] [MainThread]: SQL status: OK in 0.002 seconds
[0m11:04:11.164686 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:11.165686 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE price_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM price_today_to_archive)

[0m11:04:11.172929 [debug] [MainThread]: SQL status: OK in 0.005 seconds
[0m11:04:11.176488 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:11.177480 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE price_expected = (SELECT count(*) FROM price_today_to_archive)

[0m11:04:11.180485 [debug] [MainThread]: SQL status: OK in 0.002 seconds
[0m11:04:11.182584 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:11.184744 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

SET VARIABLE price_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/price_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM price_today_to_archive)

[0m11:04:11.192312 [debug] [MainThread]: SQL status: OK in 0.007 seconds
[0m11:04:11.194406 [info ] [MainThread]: [DOWNLOAD] Processing intraday PRICE files...
[0m11:04:11.197114 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:11.199128 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 8) AS day
  FROM read_blob(getvariable('price_urls'))
  WHERE getvariable('has_price_today_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/price_today')
(FORMAT BLOB, PARTITION_BY (day, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m11:04:11.380508 [debug] [MainThread]: SQL status: OK in 0.180 seconds
[0m11:04:11.383519 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:11.384783 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'price_today' AS source_type,
  filename AS source_filename,
  '/price_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM price_today_to_archive
WHERE getvariable('price_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('price_paths'))) = getvariable('price_expected')

[0m11:04:18.885836 [debug] [MainThread]: SQL status: OK in 7.500 seconds
[0m11:04:18.887841 [info ] [MainThread]: [DOWNLOAD] Refreshing 4 DUID reference files...
[0m11:04:18.891593 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:18.892540 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (SELECT 1 AS id, 'init' AS dummy) TO (getvariable('csv_archive_path') || '/duid')
(FORMAT csv, PARTITION_BY (dummy), FILE_EXTENSION 'csv', OVERWRITE_OR_IGNORE)

[0m11:04:18.896608 [debug] [MainThread]: SQL status: OK in 0.003 seconds
[0m11:04:18.899344 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:18.901350 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/djouallah-patch-1/duid_data.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/duid_data.csv') (FORMAT CSV, HEADER)

[0m11:04:19.240888 [debug] [MainThread]: SQL status: OK in 0.338 seconds
[0m11:04:19.242887 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:19.242887 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT * FROM read_csv_auto('https://data.wa.aemo.com.au/datafiles/post-facilities/facilities.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/facilities.csv') (FORMAT CSV, HEADER)

[0m11:04:19.457646 [debug] [MainThread]: SQL status: OK in 0.212 seconds
[0m11:04:19.459783 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:19.460790 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/main/WA_ENERGY.csv', header=true, null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/WA_ENERGY.csv') (FORMAT CSV, HEADER)

[0m11:04:19.744705 [debug] [MainThread]: SQL status: OK in 0.283 seconds
[0m11:04:19.744705 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:19.744705 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/main/geo_data.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/geo_data.csv') (FORMAT CSV, HEADER)

[0m11:04:20.019118 [debug] [MainThread]: SQL status: OK in 0.275 seconds
[0m11:04:20.019118 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:20.035138 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

DELETE FROM ducklake.aemo.csv_archive_log WHERE source_type LIKE 'duid_%'

[0m11:04:26.426075 [debug] [MainThread]: SQL status: OK in 6.391 seconds
[0m11:04:26.426075 [debug] [MainThread]: Using duckdb connection "macro_download"
[0m11:04:26.426075 [debug] [MainThread]: On macro_download: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "macro_download"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT * FROM (VALUES
  ('duid_data', 'duid_data', '/duid/duid_data.csv', now()),
  ('duid_facilities', 'facilities', '/duid/facilities.csv', now()),
  ('duid_wa_energy', 'WA_ENERGY', '/duid/WA_ENERGY.csv', now()),
  ('duid_geo_data', 'geo_data', '/duid/geo_data.csv', now())
) AS t(source_type, source_filename, archive_path, archived_at)

[0m11:04:31.832539 [debug] [MainThread]: SQL status: OK in 5.406 seconds
[0m11:04:31.837674 [info ] [MainThread]: [DOWNLOAD] DUID files written: 4
[0m11:04:31.838788 [info ] [MainThread]: [DOWNLOAD COMPLETE]
[0m11:04:31.840772 [debug] [MainThread]: On macro_download: ROLLBACK
[0m11:04:31.845022 [debug] [MainThread]: Failed to rollback 'macro_download'
[0m11:04:31.847579 [debug] [MainThread]: On macro_download: Close
[0m11:04:45.250882 [debug] [MainThread]: Wrote artifact RunResultsArtifact to C:\lakehouse\default\Files\dbt\target\run_results.json
[0m11:04:45.255969 [debug] [MainThread]: Command `dbt run-operation` succeeded at 11:04:45.255969 after 53.72 seconds
[0m11:04:45.255969 [debug] [MainThread]: Connection 'macro_download' was properly closed.
[0m11:04:45.255969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002239806F350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002239806F5D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022398534190>]}
[0m11:04:45.255969 [debug] [MainThread]: Flushing usage events
[0m11:04:46.269948 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:05:24.091154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AEF810310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AEF811C90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AEF810390>]}


============================== 11:05:24.098741 | df2ac2ff-342b-4222-94ae-bc14525ea3f8 ==============================
[0m11:05:24.098741 [info ] [MainThread]: Running with dbt=1.11.2
[0m11:05:24.099712 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\lakehouse\\default\\Files\\dbt', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\lakehouse\\default\\Files\\dbt\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'invocation_command': 'dbt run', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'target_path': 'None'}
[0m11:05:24.526804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'df2ac2ff-342b-4222-94ae-bc14525ea3f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AEF8D1A50>]}
[0m11:05:24.629150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'df2ac2ff-342b-4222-94ae-bc14525ea3f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AEB3F6710>]}
[0m11:05:24.635169 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m11:05:25.089473 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m11:05:25.353988 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:05:25.353988 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m11:05:25.354988 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:05:25.394587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'df2ac2ff-342b-4222-94ae-bc14525ea3f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AEF8D3990>]}
[0m11:05:25.475728 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m11:05:25.480423 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m11:05:25.528348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'df2ac2ff-342b-4222-94ae-bc14525ea3f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AEFA70290>]}
[0m11:05:25.535990 [info ] [MainThread]: Found 7 models, 1 seed, 1 source, 474 macros
[0m11:05:25.538142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'df2ac2ff-342b-4222-94ae-bc14525ea3f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AEF813B10>]}
[0m11:05:25.541995 [info ] [MainThread]: 
[0m11:05:25.543374 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:05:25.544611 [info ] [MainThread]: 
[0m11:05:25.546066 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m11:05:25.556810 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake'
[0m11:05:25.860059 [debug] [ThreadPool]: Using duckdb connection "list_ducklake"
[0m11:05:25.860059 [debug] [ThreadPool]: On list_ducklake: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"ducklake"'
    
  
  
[0m11:05:25.860059 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:05:26.317455 [debug] [ThreadPool]: SQL status: OK in 0.452 seconds
[0m11:05:26.317455 [debug] [ThreadPool]: On list_ducklake: Close
[0m11:05:26.317455 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ducklake, now create_ducklake_aemo)
[0m11:05:26.317455 [debug] [ThreadPool]: Creating schema "database: "ducklake"
schema: "aemo"
"
[0m11:05:26.327487 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:05:26.330119 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
        select type from duckdb_databases()
        where lower(database_name)='ducklake'
        and type='sqlite'
    
  
[0m11:05:26.330119 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:05:26.330119 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:05:26.330119 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:05:26.330119 [debug] [ThreadPool]: On create_ducklake_aemo: BEGIN
[0m11:05:26.330119 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m11:05:26.330119 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:05:26.330119 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
    
        create schema if not exists "ducklake"."aemo"
    
[0m11:05:26.340537 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m11:05:26.340537 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m11:05:26.340537 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:05:26.340537 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m11:05:26.343374 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:05:26.343374 [debug] [ThreadPool]: On create_ducklake_aemo: Close
[0m11:05:26.345576 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake_aemo'
[0m11:05:26.350576 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m11:05:26.351882 [debug] [ThreadPool]: On list_ducklake_aemo: BEGIN
[0m11:05:26.351882 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:05:26.352926 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:05:26.353906 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m11:05:26.353906 [debug] [ThreadPool]: On list_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake_aemo"} */
select
      'ducklake' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'aemo'
    and lower(table_catalog) = 'ducklake'
  
[0m11:05:26.371144 [debug] [ThreadPool]: SQL status: OK in 0.016 seconds
[0m11:05:26.372150 [debug] [ThreadPool]: On list_ducklake_aemo: ROLLBACK
[0m11:05:26.374162 [debug] [ThreadPool]: Failed to rollback 'list_ducklake_aemo'
[0m11:05:26.375151 [debug] [ThreadPool]: On list_ducklake_aemo: Close
[0m11:05:26.376916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'df2ac2ff-342b-4222-94ae-bc14525ea3f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AEF94DCD0>]}
[0m11:05:26.376916 [debug] [MainThread]: Using duckdb connection "master"
[0m11:05:26.377946 [debug] [MainThread]: On master: BEGIN
[0m11:05:26.377946 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:05:26.378948 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m11:05:26.379946 [debug] [MainThread]: On master: COMMIT
[0m11:05:26.379946 [debug] [MainThread]: Using duckdb connection "master"
[0m11:05:26.379946 [debug] [MainThread]: On master: COMMIT
[0m11:05:26.380971 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:05:26.381946 [debug] [MainThread]: On master: Close
[0m11:05:26.384928 [debug] [Thread-1 (]: Began running node model.aemo_electricity.dim_calendar
[0m11:05:26.384928 [info ] [Thread-1 (]: 1 of 7 START sql incremental model aemo.dim_calendar ........................... [RUN]
[0m11:05:26.384928 [debug] [Thread-1 (]: Acquiring new duckdb connection 'model.aemo_electricity.dim_calendar'
[0m11:05:26.384928 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.dim_calendar
[0m11:05:26.400466 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.dim_calendar"
[0m11:05:26.401472 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.dim_calendar
[0m11:05:26.452060 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:05:26.453093 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

    
  
    
    

    create temporary table
      "dim_calendar__dbt_tmp20260202110526432154"
  
    as (
      

SELECT
  CAST(date AS DATE) as date,
  CAST(EXTRACT(year FROM date) AS INT) as year,
  CAST(EXTRACT(month FROM date) AS INT) as month
FROM (
  SELECT unnest(generate_series(
    CAST('2018-04-01' AS DATE),
    CAST('2026-12-31' AS DATE),
    INTERVAL 1 DAY
  )) as date
)
    );
  
  
  
[0m11:05:26.453093 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m11:05:26.456093 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:05:26.459997 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:05:26.459997 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: BEGIN
[0m11:05:26.459997 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:05:26.459997 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:05:26.459997 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar__dbt_tmp20260202110526432154'
      
      
      order by ordinal_position

  
[0m11:05:26.475216 [debug] [Thread-1 (]: SQL status: OK in 0.008 seconds
[0m11:05:26.475216 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:05:26.475216 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar'
      
      and lower(table_schema) = 'aemo'
      
      
      and lower(table_catalog) = 'ducklake'
      
      order by ordinal_position

  
[0m11:05:26.484506 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:05:26.498619 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:05:26.499718 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar__dbt_tmp20260202110526432154'
      
      
      order by ordinal_position

  
[0m11:05:26.502996 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:05:26.505998 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:05:26.507194 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar'
      
      and lower(table_schema) = 'aemo'
      
      
      and lower(table_catalog) = 'ducklake'
      
      order by ordinal_position

  
[0m11:05:26.509991 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:05:26.509991 [debug] [Thread-1 (]: 
    In "ducklake"."aemo"."dim_calendar":
        Schema changed: False
        Source columns not in target: []
        Target columns not in source: []
        New column types: []
  
[0m11:05:26.509991 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:05:26.509991 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */
SELECT version()
[0m11:05:26.509991 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:05:26.525067 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.dim_calendar"
[0m11:05:26.525067 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:05:26.525067 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

        
            delete from "ducklake"."aemo"."dim_calendar"
            where (
                date) in (
                select (date)
                from "dim_calendar__dbt_tmp20260202110526432154"
            );

        
    

    insert into "ducklake"."aemo"."dim_calendar" ("date", "year", "month")
    (
        select "date", "year", "month"
        from "dim_calendar__dbt_tmp20260202110526432154"
    )
  
[0m11:05:43.123282 [debug] [Thread-1 (]: SQL status: OK in 16.591 seconds
[0m11:05:43.139297 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: COMMIT
[0m11:05:43.139297 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:05:43.139297 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: COMMIT
[0m11:05:43.156945 [debug] [Thread-1 (]: SQL status: OK in 0.014 seconds
[0m11:05:43.156945 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: Close
[0m11:05:43.156945 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df2ac2ff-342b-4222-94ae-bc14525ea3f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AF1331810>]}
[0m11:05:43.156945 [info ] [Thread-1 (]: 1 of 7 OK created sql incremental model aemo.dim_calendar ...................... [[32mOK[0m in 16.77s]
[0m11:05:43.156945 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.dim_calendar
[0m11:05:43.156945 [debug] [Thread-1 (]: Began running node model.aemo_electricity.dim_duid
[0m11:05:43.156945 [info ] [Thread-1 (]: 2 of 7 START sql table model aemo.dim_duid ..................................... [RUN]
[0m11:05:43.156945 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.dim_calendar, now model.aemo_electricity.dim_duid)
[0m11:05:43.156945 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.dim_duid
[0m11:05:43.171866 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.dim_duid"
[0m11:05:43.173872 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.dim_duid
[0m11:05:43.186422 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.dim_duid"
[0m11:05:43.188428 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:05:43.189429 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: BEGIN
[0m11:05:43.189429 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:05:43.190427 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:05:43.191465 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:05:43.191465 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

  
    
    

    create  table
      "ducklake"."aemo"."dim_duid__dbt_tmp"
  
    as (
      

WITH
  states AS (
    SELECT 'WA1' AS RegionID, 'Western Australia' AS State
    UNION ALL SELECT 'QLD1', 'Queensland'
    UNION ALL SELECT 'NSW1', 'New South Wales'
    UNION ALL SELECT 'TAS1', 'Tasmania'
    UNION ALL SELECT 'SA1', 'South Australia'
    UNION ALL SELECT 'VIC1', 'Victoria'
  ),

  duid_aemo AS (
    SELECT
      DUID AS DUID,
      first(Region) AS Region,
      first("Fuel Source - Descriptor") AS FuelSourceDescriptor,
      first(Participant) AS Participant
    FROM
      read_csv('/lakehouse/default/Files/csv/duid/duid_data.csv')
    WHERE
      length(DUID) > 2
    GROUP BY
      DUID
  ),

  wa_facilities AS (
    SELECT
      'WA1' AS Region,
      "Facility Code" AS DUID,
      "Participant Name" AS Participant
    FROM
      read_csv_auto('/lakehouse/default/Files/csv/duid/facilities.csv')
  ),

  wa_energy AS (
    SELECT *
    FROM read_csv_auto('/lakehouse/default/Files/csv/duid/WA_ENERGY.csv', header = 1)
  ),

  duid_wa AS (
    SELECT
      wa_facilities.DUID,
      wa_facilities.Region,
      wa_energy.Technology AS FuelSourceDescriptor,
      wa_facilities.Participant
    FROM wa_facilities
    LEFT JOIN wa_energy ON wa_facilities.DUID = wa_energy.DUID
  ),

  duid_all AS (
    SELECT * FROM duid_aemo
    UNION ALL
    SELECT * FROM duid_wa
  ),

  geo AS (
    SELECT
      duid,
      max(latitude) as latitude,
      max(longitude) as longitude
    FROM read_csv('/lakehouse/default/Files/csv/duid/geo_data.csv')
    WHERE latitude IS NOT NULL
    GROUP BY duid
  )

SELECT
  a.DUID,
  a.Region,
  UPPER(LEFT(TRIM(FuelSourceDescriptor), 1)) || LOWER(SUBSTR(TRIM(FuelSourceDescriptor), 2)) AS FuelSourceDescriptor,
  a.Participant,
  states.State,
  geo.latitude,
  geo.longitude
FROM duid_all a
JOIN states ON a.Region = states.RegionID
LEFT JOIN geo ON a.duid = geo.duid
    );
  
  
[0m11:05:47.160359 [debug] [Thread-1 (]: SQL status: OK in 3.967 seconds
[0m11:05:47.165712 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:05:47.166343 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'aemo'
      AND table_name = 'dim_duid'
  
[0m11:05:47.169154 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:05:47.170325 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:05:47.170947 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'aemo'
      AND table_name = 'dim_duid'
  
[0m11:05:47.172640 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:05:47.178342 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:05:47.178969 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */
alter table "ducklake"."aemo"."dim_duid" rename to "dim_duid__dbt_backup"
[0m11:05:47.180599 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:05:47.183405 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:05:47.183405 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */
alter table "ducklake"."aemo"."dim_duid__dbt_tmp" rename to "dim_duid"
[0m11:05:47.183405 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:05:47.183405 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: COMMIT
[0m11:05:47.183405 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:05:47.183405 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: COMMIT
[0m11:05:47.210667 [debug] [Thread-1 (]: SQL status: OK in 0.020 seconds
[0m11:05:47.210667 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:05:47.210667 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

      drop table if exists "ducklake"."aemo"."dim_duid__dbt_backup"
    
[0m11:05:47.263135 [debug] [Thread-1 (]: SQL status: OK in 0.045 seconds
[0m11:05:47.263135 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: Close
[0m11:05:47.269656 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df2ac2ff-342b-4222-94ae-bc14525ea3f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AF14F64D0>]}
[0m11:05:47.269656 [info ] [Thread-1 (]: 2 of 7 OK created sql table model aemo.dim_duid ................................ [[32mOK[0m in 4.11s]
[0m11:05:47.270863 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.dim_duid
[0m11:05:47.271846 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_price
[0m11:05:47.272873 [info ] [Thread-1 (]: 3 of 7 START sql incremental model aemo.fct_price .............................. [RUN]
[0m11:05:47.273845 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.dim_duid, now model.aemo_electricity.fct_price)
[0m11:05:47.273845 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_price
[0m11:05:47.281980 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_price"
[0m11:05:47.284488 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_price
[0m11:05:47.288693 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_price"
[0m11:05:47.289434 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price"
[0m11:05:47.289434 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: BEGIN
[0m11:05:47.289434 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:05:47.294830 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:05:47.296532 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price"
[0m11:05:47.297540 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."csv_archive_log"
  WHERE source_type = 'daily'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/daily/year=' || substring(source_filename, 14, 4) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

price_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'TOTALDEMAND': 'VARCHAR',
      'DEMANDFORECAST': 'VARCHAR',
      'DISPATCHABLEGENERATION': 'VARCHAR',
      'DISPATCHABLELOAD': 'VARCHAR',
      'NETINTERCHANGE': 'VARCHAR',
      'EXCESSGENERATION': 'VARCHAR',
      'LOWER5MINDISPATCH': 'VARCHAR',
      'LOWER5MINIMPORT': 'VARCHAR',
      'LOWER5MINLOCALDISPATCH': 'VARCHAR',
      'LOWER5MINLOCALPRICE': 'VARCHAR',
      'LOWER5MINLOCALREQ': 'VARCHAR',
      'LOWER5MINPRICE': 'VARCHAR',
      'LOWER5MINREQ': 'VARCHAR',
      'LOWER5MINSUPPLYPRICE': 'VARCHAR',
      'LOWER60SECDISPATCH': 'VARCHAR',
      'LOWER60SECIMPORT': 'VARCHAR',
      'LOWER60SECLOCALDISPATCH': 'VARCHAR',
      'LOWER60SECLOCALPRICE': 'VARCHAR',
      'LOWER60SECLOCALREQ': 'VARCHAR',
      'LOWER60SECPRICE': 'VARCHAR',
      'LOWER60SECREQ': 'VARCHAR',
      'LOWER60SECSUPPLYPRICE': 'VARCHAR',
      'LOWER6SECDISPATCH': 'VARCHAR',
      'LOWER6SECIMPORT': 'VARCHAR',
      'LOWER6SECLOCALDISPATCH': 'VARCHAR',
      'LOWER6SECLOCALPRICE': 'VARCHAR',
      'LOWER6SECLOCALREQ': 'VARCHAR',
      'LOWER6SECPRICE': 'VARCHAR',
      'LOWER6SECREQ': 'VARCHAR',
      'LOWER6SECSUPPLYPRICE': 'VARCHAR',
      'RAISE5MINDISPATCH': 'VARCHAR',
      'RAISE5MINIMPORT': 'VARCHAR',
      'RAISE5MINLOCALDISPATCH': 'VARCHAR',
      'RAISE5MINLOCALPRICE': 'VARCHAR',
      'RAISE5MINLOCALREQ': 'VARCHAR',
      'RAISE5MINPRICE': 'VARCHAR',
      'RAISE5MINREQ': 'VARCHAR',
      'RAISE5MINSUPPLYPRICE': 'VARCHAR',
      'RAISE60SECDISPATCH': 'VARCHAR',
      'RAISE60SECIMPORT': 'VARCHAR',
      'RAISE60SECLOCALDISPATCH': 'VARCHAR',
      'RAISE60SECLOCALPRICE': 'VARCHAR',
      'RAISE60SECLOCALREQ': 'VARCHAR',
      'RAISE60SECPRICE': 'VARCHAR',
      'RAISE60SECREQ': 'VARCHAR',
      'RAISE60SECSUPPLYPRICE': 'VARCHAR',
      'RAISE6SECDISPATCH': 'VARCHAR',
      'RAISE6SECIMPORT': 'VARCHAR',
      'RAISE6SECLOCALDISPATCH': 'VARCHAR',
      'RAISE6SECLOCALPRICE': 'VARCHAR',
      'RAISE6SECLOCALREQ': 'VARCHAR',
      'RAISE6SECPRICE': 'VARCHAR',
      'RAISE6SECREQ': 'VARCHAR',
      'RAISE6SECSUPPLYPRICE': 'VARCHAR',
      'AGGREGATEDISPATCHERROR': 'VARCHAR',
      'AVAILABLEGENERATION': 'VARCHAR',
      'AVAILABLELOAD': 'VARCHAR',
      'INITIALSUPPLY': 'VARCHAR',
      'CLEAREDSUPPLY': 'VARCHAR',
      'LOWERREGIMPORT': 'VARCHAR',
      'LOWERREGLOCALDISPATCH': 'VARCHAR',
      'LOWERREGLOCALREQ': 'VARCHAR',
      'LOWERREGREQ': 'VARCHAR',
      'RAISEREGIMPORT': 'VARCHAR',
      'RAISEREGLOCALDISPATCH': 'VARCHAR',
      'RAISEREGLOCALREQ': 'VARCHAR',
      'RAISEREGREQ': 'VARCHAR',
      'RAISE5MINLOCALVIOLATION': 'VARCHAR',
      'RAISEREGLOCALVIOLATION': 'VARCHAR',
      'RAISE60SECLOCALVIOLATION': 'VARCHAR',
      'RAISE6SECLOCALVIOLATION': 'VARCHAR',
      'LOWER5MINLOCALVIOLATION': 'VARCHAR',
      'LOWERREGLOCALVIOLATION': 'VARCHAR',
      'LOWER60SECLOCALVIOLATION': 'VARCHAR',
      'LOWER6SECLOCALVIOLATION': 'VARCHAR',
      'RAISE5MINVIOLATION': 'VARCHAR',
      'RAISEREGVIOLATION': 'VARCHAR',
      'RAISE60SECVIOLATION': 'VARCHAR',
      'RAISE6SECVIOLATION': 'VARCHAR',
      'LOWER5MINVIOLATION': 'VARCHAR',
      'LOWERREGVIOLATION': 'VARCHAR',
      'LOWER60SECVIOLATION': 'VARCHAR',
      'LOWER6SECVIOLATION': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR',
      'LORSURPLUS': 'VARCHAR',
      'LRCSURPLUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DREGION' AND VERSION = '3'
)

SELECT
  UNIT,
  REGIONID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(TOTALDEMAND AS DOUBLE) AS TOTALDEMAND,
  CAST(DEMANDFORECAST AS DOUBLE) AS DEMANDFORECAST,
  CAST(DISPATCHABLEGENERATION AS DOUBLE) AS DISPATCHABLEGENERATION,
  CAST(DISPATCHABLELOAD AS DOUBLE) AS DISPATCHABLELOAD,
  CAST(NETINTERCHANGE AS DOUBLE) AS NETINTERCHANGE,
  CAST(EXCESSGENERATION AS DOUBLE) AS EXCESSGENERATION,
  CAST(LOWER5MINDISPATCH AS DOUBLE) AS LOWER5MINDISPATCH,
  CAST(LOWER5MINIMPORT AS DOUBLE) AS LOWER5MINIMPORT,
  CAST(LOWER5MINLOCALDISPATCH AS DOUBLE) AS LOWER5MINLOCALDISPATCH,
  CAST(LOWER5MINLOCALPRICE AS DOUBLE) AS LOWER5MINLOCALPRICE,
  CAST(LOWER5MINLOCALREQ AS DOUBLE) AS LOWER5MINLOCALREQ,
  CAST(LOWER5MINPRICE AS DOUBLE) AS LOWER5MINPRICE,
  CAST(LOWER5MINREQ AS DOUBLE) AS LOWER5MINREQ,
  CAST(LOWER5MINSUPPLYPRICE AS DOUBLE) AS LOWER5MINSUPPLYPRICE,
  CAST(LOWER60SECDISPATCH AS DOUBLE) AS LOWER60SECDISPATCH,
  CAST(LOWER60SECIMPORT AS DOUBLE) AS LOWER60SECIMPORT,
  CAST(LOWER60SECLOCALDISPATCH AS DOUBLE) AS LOWER60SECLOCALDISPATCH,
  CAST(LOWER60SECLOCALPRICE AS DOUBLE) AS LOWER60SECLOCALPRICE,
  CAST(LOWER60SECLOCALREQ AS DOUBLE) AS LOWER60SECLOCALREQ,
  CAST(LOWER60SECPRICE AS DOUBLE) AS LOWER60SECPRICE,
  CAST(LOWER60SECREQ AS DOUBLE) AS LOWER60SECREQ,
  CAST(LOWER60SECSUPPLYPRICE AS DOUBLE) AS LOWER60SECSUPPLYPRICE,
  CAST(LOWER6SECDISPATCH AS DOUBLE) AS LOWER6SECDISPATCH,
  CAST(LOWER6SECIMPORT AS DOUBLE) AS LOWER6SECIMPORT,
  CAST(LOWER6SECLOCALDISPATCH AS DOUBLE) AS LOWER6SECLOCALDISPATCH,
  CAST(LOWER6SECLOCALPRICE AS DOUBLE) AS LOWER6SECLOCALPRICE,
  CAST(LOWER6SECLOCALREQ AS DOUBLE) AS LOWER6SECLOCALREQ,
  CAST(LOWER6SECPRICE AS DOUBLE) AS LOWER6SECPRICE,
  CAST(LOWER6SECREQ AS DOUBLE) AS LOWER6SECREQ,
  CAST(LOWER6SECSUPPLYPRICE AS DOUBLE) AS LOWER6SECSUPPLYPRICE,
  CAST(RAISE5MINDISPATCH AS DOUBLE) AS RAISE5MINDISPATCH,
  CAST(RAISE5MINIMPORT AS DOUBLE) AS RAISE5MINIMPORT,
  CAST(RAISE5MINLOCALDISPATCH AS DOUBLE) AS RAISE5MINLOCALDISPATCH,
  CAST(RAISE5MINLOCALPRICE AS DOUBLE) AS RAISE5MINLOCALPRICE,
  CAST(RAISE5MINLOCALREQ AS DOUBLE) AS RAISE5MINLOCALREQ,
  CAST(RAISE5MINPRICE AS DOUBLE) AS RAISE5MINPRICE,
  CAST(RAISE5MINREQ AS DOUBLE) AS RAISE5MINREQ,
  CAST(RAISE5MINSUPPLYPRICE AS DOUBLE) AS RAISE5MINSUPPLYPRICE,
  CAST(RAISE60SECDISPATCH AS DOUBLE) AS RAISE60SECDISPATCH,
  CAST(RAISE60SECIMPORT AS DOUBLE) AS RAISE60SECIMPORT,
  CAST(RAISE60SECLOCALDISPATCH AS DOUBLE) AS RAISE60SECLOCALDISPATCH,
  CAST(RAISE60SECLOCALPRICE AS DOUBLE) AS RAISE60SECLOCALPRICE,
  CAST(RAISE60SECLOCALREQ AS DOUBLE) AS RAISE60SECLOCALREQ,
  CAST(RAISE60SECPRICE AS DOUBLE) AS RAISE60SECPRICE,
  CAST(RAISE60SECREQ AS DOUBLE) AS RAISE60SECREQ,
  CAST(RAISE60SECSUPPLYPRICE AS DOUBLE) AS RAISE60SECSUPPLYPRICE,
  CAST(RAISE6SECDISPATCH AS DOUBLE) AS RAISE6SECDISPATCH,
  CAST(RAISE6SECIMPORT AS DOUBLE) AS RAISE6SECIMPORT,
  CAST(RAISE6SECLOCALDISPATCH AS DOUBLE) AS RAISE6SECLOCALDISPATCH,
  CAST(RAISE6SECLOCALPRICE AS DOUBLE) AS RAISE6SECLOCALPRICE,
  CAST(RAISE6SECLOCALREQ AS DOUBLE) AS RAISE6SECLOCALREQ,
  CAST(RAISE6SECPRICE AS DOUBLE) AS RAISE6SECPRICE,
  CAST(RAISE6SECREQ AS DOUBLE) AS RAISE6SECREQ,
  CAST(RAISE6SECSUPPLYPRICE AS DOUBLE) AS RAISE6SECSUPPLYPRICE,
  CAST(AGGREGATEDISPATCHERROR AS DOUBLE) AS AGGREGATEDISPATCHERROR,
  CAST(AVAILABLEGENERATION AS DOUBLE) AS AVAILABLEGENERATION,
  CAST(AVAILABLELOAD AS DOUBLE) AS AVAILABLELOAD,
  CAST(INITIALSUPPLY AS DOUBLE) AS INITIALSUPPLY,
  CAST(CLEAREDSUPPLY AS DOUBLE) AS CLEAREDSUPPLY,
  CAST(LOWERREGIMPORT AS DOUBLE) AS LOWERREGIMPORT,
  CAST(LOWERREGLOCALDISPATCH AS DOUBLE) AS LOWERREGLOCALDISPATCH,
  CAST(LOWERREGLOCALREQ AS DOUBLE) AS LOWERREGLOCALREQ,
  CAST(LOWERREGREQ AS DOUBLE) AS LOWERREGREQ,
  CAST(RAISEREGIMPORT AS DOUBLE) AS RAISEREGIMPORT,
  CAST(RAISEREGLOCALDISPATCH AS DOUBLE) AS RAISEREGLOCALDISPATCH,
  CAST(RAISEREGLOCALREQ AS DOUBLE) AS RAISEREGLOCALREQ,
  CAST(RAISEREGREQ AS DOUBLE) AS RAISEREGREQ,
  CAST(RAISE5MINLOCALVIOLATION AS DOUBLE) AS RAISE5MINLOCALVIOLATION,
  CAST(RAISEREGLOCALVIOLATION AS DOUBLE) AS RAISEREGLOCALVIOLATION,
  CAST(RAISE60SECLOCALVIOLATION AS DOUBLE) AS RAISE60SECLOCALVIOLATION,
  CAST(RAISE6SECLOCALVIOLATION AS DOUBLE) AS RAISE6SECLOCALVIOLATION,
  CAST(LOWER5MINLOCALVIOLATION AS DOUBLE) AS LOWER5MINLOCALVIOLATION,
  CAST(LOWERREGLOCALVIOLATION AS DOUBLE) AS LOWERREGLOCALVIOLATION,
  CAST(LOWER60SECLOCALVIOLATION AS DOUBLE) AS LOWER60SECLOCALVIOLATION,
  CAST(LOWER6SECLOCALVIOLATION AS DOUBLE) AS LOWER6SECLOCALVIOLATION,
  CAST(RAISE5MINVIOLATION AS DOUBLE) AS RAISE5MINVIOLATION,
  CAST(RAISEREGVIOLATION AS DOUBLE) AS RAISEREGVIOLATION,
  CAST(RAISE60SECVIOLATION AS DOUBLE) AS RAISE60SECVIOLATION,
  CAST(RAISE6SECVIOLATION AS DOUBLE) AS RAISE6SECVIOLATION,
  CAST(LOWER5MINVIOLATION AS DOUBLE) AS LOWER5MINVIOLATION,
  CAST(LOWERREGVIOLATION AS DOUBLE) AS LOWERREGVIOLATION,
  CAST(LOWER60SECVIOLATION AS DOUBLE) AS LOWER60SECVIOLATION,
  CAST(LOWER6SECVIOLATION AS DOUBLE) AS LOWER6SECVIOLATION,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  CAST(LORSURPLUS AS DOUBLE) AS LORSURPLUS,
  CAST(LRCSURPLUS AS DOUBLE) AS LRCSURPLUS,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m11:05:47.337062 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."csv_archive_log"
  WHERE source_type = 'daily'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/daily/year=' || substring(source_filename, 14, 4) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

price_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'TOTALDEMAND': 'VARCHAR',
      'DEMANDFORECAST': 'VARCHAR',
      'DISPATCHABLEGENERATION': 'VARCHAR',
      'DISPATCHABLELOAD': 'VARCHAR',
      'NETINTERCHANGE': 'VARCHAR',
      'EXCESSGENERATION': 'VARCHAR',
      'LOWER5MINDISPATCH': 'VARCHAR',
      'LOWER5MINIMPORT': 'VARCHAR',
      'LOWER5MINLOCALDISPATCH': 'VARCHAR',
      'LOWER5MINLOCALPRICE': 'VARCHAR',
      'LOWER5MINLOCALREQ': 'VARCHAR',
      'LOWER5MINPRICE': 'VARCHAR',
      'LOWER5MINREQ': 'VARCHAR',
      'LOWER5MINSUPPLYPRICE': 'VARCHAR',
      'LOWER60SECDISPATCH': 'VARCHAR',
      'LOWER60SECIMPORT': 'VARCHAR',
      'LOWER60SECLOCALDISPATCH': 'VARCHAR',
      'LOWER60SECLOCALPRICE': 'VARCHAR',
      'LOWER60SECLOCALREQ': 'VARCHAR',
      'LOWER60SECPRICE': 'VARCHAR',
      'LOWER60SECREQ': 'VARCHAR',
      'LOWER60SECSUPPLYPRICE': 'VARCHAR',
      'LOWER6SECDISPATCH': 'VARCHAR',
      'LOWER6SECIMPORT': 'VARCHAR',
      'LOWER6SECLOCALDISPATCH': 'VARCHAR',
      'LOWER6SECLOCALPRICE': 'VARCHAR',
      'LOWER6SECLOCALREQ': 'VARCHAR',
      'LOWER6SECPRICE': 'VARCHAR',
      'LOWER6SECREQ': 'VARCHAR',
      'LOWER6SECSUPPLYPRICE': 'VARCHAR',
      'RAISE5MINDISPATCH': 'VARCHAR',
      'RAISE5MINIMPORT': 'VARCHAR',
      'RAISE5MINLOCALDISPATCH': 'VARCHAR',
      'RAISE5MINLOCALPRICE': 'VARCHAR',
      'RAISE5MINLOCALREQ': 'VARCHAR',
      'RAISE5MINPRICE': 'VARCHAR',
      'RAISE5MINREQ': 'VARCHAR',
      'RAISE5MINSUPPLYPRICE': 'VARCHAR',
      'RAISE60SECDISPATCH': 'VARCHAR',
      'RAISE60SECIMPORT': 'VARCHAR',
      'RAISE60SECLOCALDISPATCH': 'VARCHAR',
      'RAISE60SECLOCALPRICE': 'VARCHAR',
      'RAISE60SECLOCALREQ': 'VARCHAR',
      'RAISE60SECPRICE': 'VARCHAR',
      'RAISE60SECREQ': 'VARCHAR',
      'RAISE60SECSUPPLYPRICE': 'VARCHAR',
      'RAISE6SECDISPATCH': 'VARCHAR',
      'RAISE6SECIMPORT': 'VARCHAR',
      'RAISE6SECLOCALDISPATCH': 'VARCHAR',
      'RAISE6SECLOCALPRICE': 'VARCHAR',
      'RAISE6SECLOCALREQ': 'VARCHAR',
      'RAISE6SECPRICE': 'VARCHAR',
      'RAISE6SECREQ': 'VARCHAR',
      'RAISE6SECSUPPLYPRICE': 'VARCHAR',
      'AGGREGATEDISPATCHERROR': 'VARCHAR',
      'AVAILABLEGENERATION': 'VARCHAR',
      'AVAILABLELOAD': 'VARCHAR',
      'INITIALSUPPLY': 'VARCHAR',
      'CLEAREDSUPPLY': 'VARCHAR',
      'LOWERREGIMPORT': 'VARCHAR',
      'LOWERREGLOCALDISPATCH': 'VARCHAR',
      'LOWERREGLOCALREQ': 'VARCHAR',
      'LOWERREGREQ': 'VARCHAR',
      'RAISEREGIMPORT': 'VARCHAR',
      'RAISEREGLOCALDISPATCH': 'VARCHAR',
      'RAISEREGLOCALREQ': 'VARCHAR',
      'RAISEREGREQ': 'VARCHAR',
      'RAISE5MINLOCALVIOLATION': 'VARCHAR',
      'RAISEREGLOCALVIOLATION': 'VARCHAR',
      'RAISE60SECLOCALVIOLATION': 'VARCHAR',
      'RAISE6SECLOCALVIOLATION': 'VARCHAR',
      'LOWER5MINLOCALVIOLATION': 'VARCHAR',
      'LOWERREGLOCALVIOLATION': 'VARCHAR',
      'LOWER60SECLOCALVIOLATION': 'VARCHAR',
      'LOWER6SECLOCALVIOLATION': 'VARCHAR',
      'RAISE5MINVIOLATION': 'VARCHAR',
      'RAISEREGVIOLATION': 'VARCHAR',
      'RAISE60SECVIOLATION': 'VARCHAR',
      'RAISE6SECVIOLATION': 'VARCHAR',
      'LOWER5MINVIOLATION': 'VARCHAR',
      'LOWERREGVIOLATION': 'VARCHAR',
      'LOWER60SECVIOLATION': 'VARCHAR',
      'LOWER6SECVIOLATION': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR',
      'LORSURPLUS': 'VARCHAR',
      'LRCSURPLUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DREGION' AND VERSION = '3'
)

SELECT
  UNIT,
  REGIONID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(TOTALDEMAND AS DOUBLE) AS TOTALDEMAND,
  CAST(DEMANDFORECAST AS DOUBLE) AS DEMANDFORECAST,
  CAST(DISPATCHABLEGENERATION AS DOUBLE) AS DISPATCHABLEGENERATION,
  CAST(DISPATCHABLELOAD AS DOUBLE) AS DISPATCHABLELOAD,
  CAST(NETINTERCHANGE AS DOUBLE) AS NETINTERCHANGE,
  CAST(EXCESSGENERATION AS DOUBLE) AS EXCESSGENERATION,
  CAST(LOWER5MINDISPATCH AS DOUBLE) AS LOWER5MINDISPATCH,
  CAST(LOWER5MINIMPORT AS DOUBLE) AS LOWER5MINIMPORT,
  CAST(LOWER5MINLOCALDISPATCH AS DOUBLE) AS LOWER5MINLOCALDISPATCH,
  CAST(LOWER5MINLOCALPRICE AS DOUBLE) AS LOWER5MINLOCALPRICE,
  CAST(LOWER5MINLOCALREQ AS DOUBLE) AS LOWER5MINLOCALREQ,
  CAST(LOWER5MINPRICE AS DOUBLE) AS LOWER5MINPRICE,
  CAST(LOWER5MINREQ AS DOUBLE) AS LOWER5MINREQ,
  CAST(LOWER5MINSUPPLYPRICE AS DOUBLE) AS LOWER5MINSUPPLYPRICE,
  CAST(LOWER60SECDISPATCH AS DOUBLE) AS LOWER60SECDISPATCH,
  CAST(LOWER60SECIMPORT AS DOUBLE) AS LOWER60SECIMPORT,
  CAST(LOWER60SECLOCALDISPATCH AS DOUBLE) AS LOWER60SECLOCALDISPATCH,
  CAST(LOWER60SECLOCALPRICE AS DOUBLE) AS LOWER60SECLOCALPRICE,
  CAST(LOWER60SECLOCALREQ AS DOUBLE) AS LOWER60SECLOCALREQ,
  CAST(LOWER60SECPRICE AS DOUBLE) AS LOWER60SECPRICE,
  CAST(LOWER60SECREQ AS DOUBLE) AS LOWER60SECREQ,
  CAST(LOWER60SECSUPPLYPRICE AS DOUBLE) AS LOWER60SECSUPPLYPRICE,
  CAST(LOWER6SECDISPATCH AS DOUBLE) AS LOWER6SECDISPATCH,
  CAST(LOWER6SECIMPORT AS DOUBLE) AS LOWER6SECIMPORT,
  CAST(LOWER6SECLOCALDISPATCH AS DOUBLE) AS LOWER6SECLOCALDISPATCH,
  CAST(LOWER6SECLOCALPRICE AS DOUBLE) AS LOWER6SECLOCALPRICE,
  CAST(LOWER6SECLOCALREQ AS DOUBLE) AS LOWER6SECLOCALREQ,
  CAST(LOWER6SECPRICE AS DOUBLE) AS LOWER6SECPRICE,
  CAST(LOWER6SECREQ AS DOUBLE) AS LOWER6SECREQ,
  CAST(LOWER6SECSUPPLYPRICE AS DOUBLE) AS LOWER6SECSUPPLYPRICE,
  CAST(RAISE5MINDISPATCH AS DOUBLE) AS RAISE5MINDISPATCH,
  CAST(RAISE5MINIMPORT AS DOUBLE) AS RAISE5MINIMPORT,
  CAST(RAISE5MINLOCALDISPATCH AS DOUBLE) AS RAISE5MINLOCALDISPATCH,
  CAST(RAISE5MINLOCALPRICE AS DOUBLE) AS RAISE5MINLOCALPRICE,
  CAST(RAISE5MINLOCALREQ AS DOUBLE) AS RAISE5MINLOCALREQ,
  CAST(RAISE5MINPRICE AS DOUBLE) AS RAISE5MINPRICE,
  CAST(RAISE5MINREQ AS DOUBLE) AS RAISE5MINREQ,
  CAST(RAISE5MINSUPPLYPRICE AS DOUBLE) AS RAISE5MINSUPPLYPRICE,
  CAST(RAISE60SECDISPATCH AS DOUBLE) AS RAISE60SECDISPATCH,
  CAST(RAISE60SECIMPORT AS DOUBLE) AS RAISE60SECIMPORT,
  CAST(RAISE60SECLOCALDISPATCH AS DOUBLE) AS RAISE60SECLOCALDISPATCH,
  CAST(RAISE60SECLOCALPRICE AS DOUBLE) AS RAISE60SECLOCALPRICE,
  CAST(RAISE60SECLOCALREQ AS DOUBLE) AS RAISE60SECLOCALREQ,
  CAST(RAISE60SECPRICE AS DOUBLE) AS RAISE60SECPRICE,
  CAST(RAISE60SECREQ AS DOUBLE) AS RAISE60SECREQ,
  CAST(RAISE60SECSUPPLYPRICE AS DOUBLE) AS RAISE60SECSUPPLYPRICE,
  CAST(RAISE6SECDISPATCH AS DOUBLE) AS RAISE6SECDISPATCH,
  CAST(RAISE6SECIMPORT AS DOUBLE) AS RAISE6SECIMPORT,
  CAST(RAISE6SECLOCALDISPATCH AS DOUBLE) AS RAISE6SECLOCALDISPATCH,
  CAST(RAISE6SECLOCALPRICE AS DOUBLE) AS RAISE6SECLOCALPRICE,
  CAST(RAISE6SECLOCALREQ AS DOUBLE) AS RAISE6SECLOCALREQ,
  CAST(RAISE6SECPRICE AS DOUBLE) AS RAISE6SECPRICE,
  CAST(RAISE6SECREQ AS DOUBLE) AS RAISE6SECREQ,
  CAST(RAISE6SECSUPPLYPRICE AS DOUBLE) AS RAISE6SECSUPPLYPRICE,
  CAST(AGGREGATEDISPATCHERROR AS DOUBLE) AS AGGREGATEDISPATCHERROR,
  CAST(AVAILABLEGENERATION AS DOUBLE) AS AVAILABLEGENERATION,
  CAST(AVAILABLELOAD AS DOUBLE) AS AVAILABLELOAD,
  CAST(INITIALSUPPLY AS DOUBLE) AS INITIALSUPPLY,
  CAST(CLEAREDSUPPLY AS DOUBLE) AS CLEAREDSUPPLY,
  CAST(LOWERREGIMPORT AS DOUBLE) AS LOWERREGIMPORT,
  CAST(LOWERREGLOCALDISPATCH AS DOUBLE) AS LOWERREGLOCALDISPATCH,
  CAST(LOWERREGLOCALREQ AS DOUBLE) AS LOWERREGLOCALREQ,
  CAST(LOWERREGREQ AS DOUBLE) AS LOWERREGREQ,
  CAST(RAISEREGIMPORT AS DOUBLE) AS RAISEREGIMPORT,
  CAST(RAISEREGLOCALDISPATCH AS DOUBLE) AS RAISEREGLOCALDISPATCH,
  CAST(RAISEREGLOCALREQ AS DOUBLE) AS RAISEREGLOCALREQ,
  CAST(RAISEREGREQ AS DOUBLE) AS RAISEREGREQ,
  CAST(RAISE5MINLOCALVIOLATION AS DOUBLE) AS RAISE5MINLOCALVIOLATION,
  CAST(RAISEREGLOCALVIOLATION AS DOUBLE) AS RAISEREGLOCALVIOLATION,
  CAST(RAISE60SECLOCALVIOLATION AS DOUBLE) AS RAISE60SECLOCALVIOLATION,
  CAST(RAISE6SECLOCALVIOLATION AS DOUBLE) AS RAISE6SECLOCALVIOLATION,
  CAST(LOWER5MINLOCALVIOLATION AS DOUBLE) AS LOWER5MINLOCALVIOLATION,
  CAST(LOWERREGLOCALVIOLATION AS DOUBLE) AS LOWERREGLOCALVIOLATION,
  CAST(LOWER60SECLOCALVIOLATION AS DOUBLE) AS LOWER60SECLOCALVIOLATION,
  CAST(LOWER6SECLOCALVIOLATION AS DOUBLE) AS LOWER6SECLOCALVIOLATION,
  CAST(RAISE5MINVIOLATION AS DOUBLE) AS RAISE5MINVIOLATION,
  CAST(RAISEREGVIOLATION AS DOUBLE) AS RAISEREGVIOLATION,
  CAST(RAISE60SECVIOLATION AS DOUBLE) AS RAISE60SECVIOLATION,
  CAST(RAISE6SECVIOLATION AS DOUBLE) AS RAISE6SECVIOLATION,
  CAST(LOWER5MINVIOLATION AS DOUBLE) AS LOWER5MINVIOLATION,
  CAST(LOWERREGVIOLATION AS DOUBLE) AS LOWERREGVIOLATION,
  CAST(LOWER60SECVIOLATION AS DOUBLE) AS LOWER60SECVIOLATION,
  CAST(LOWER6SECVIOLATION AS DOUBLE) AS LOWER6SECVIOLATION,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  CAST(LORSURPLUS AS DOUBLE) AS LORSURPLUS,
  CAST(LRCSURPLUS AS DOUBLE) AS LRCSURPLUS,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m11:05:47.337062 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m11:05:47.337062 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: ROLLBACK
[0m11:05:47.424469 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_price'
[0m11:05:47.424469 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: Close
[0m11:05:47.434143 [debug] [Thread-1 (]: Runtime Error in model fct_price (models\marts\fct_price.sql)
  Binder Error: Table function cannot contain subqueries
[0m11:05:47.434143 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df2ac2ff-342b-4222-94ae-bc14525ea3f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AF133E750>]}
[0m11:05:47.434143 [error] [Thread-1 (]: 3 of 7 ERROR creating sql incremental model aemo.fct_price ..................... [[31mERROR[0m in 0.16s]
[0m11:05:47.434143 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_price
[0m11:05:47.434143 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_price_today
[0m11:05:47.434143 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_price' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_price (models\marts\fct_price.sql)
  Binder Error: Table function cannot contain subqueries.
[0m11:05:47.446130 [info ] [Thread-1 (]: 4 of 7 START sql incremental model aemo.fct_price_today ........................ [RUN]
[0m11:05:47.450178 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.fct_price, now model.aemo_electricity.fct_price_today)
[0m11:05:47.451213 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_price_today
[0m11:05:47.464032 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_price_today"
[0m11:05:47.467137 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_price_today
[0m11:05:47.475018 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_price_today"
[0m11:05:47.478443 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price_today"
[0m11:05:47.479835 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: BEGIN
[0m11:05:47.479835 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:05:47.481843 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:05:47.481843 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price_today"
[0m11:05:47.481843 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price_today"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."csv_archive_log"
  WHERE source_type = 'price_today'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/price_today/day=' || substring(source_filename, 19, 8) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

price_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'PRICE': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'DISPATCHINTERVAL': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'LASTCHANGED': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'PRICE_STATUS': 'VARCHAR',
      'PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'RAISE1SECRRP': 'VARCHAR',
      'RAISE1SECROP': 'VARCHAR',
      'RAISE1SECAPCFLAG': 'VARCHAR',
      'LOWER1SECRRP': 'VARCHAR',
      'LOWER1SECROP': 'VARCHAR',
      'LOWER1SECAPCFLAG': 'VARCHAR',
      'PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'OCD_STATUS': 'VARCHAR',
      'MII_STATUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND PRICE = 'PRICE'
)

SELECT
  REGIONID,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(DISPATCHINTERVAL AS DOUBLE) AS DISPATCHINTERVAL,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(PRE_AP_ENERGY_PRICE AS DOUBLE) AS PRE_AP_ENERGY_PRICE,
  CAST(PRE_AP_RAISE6_PRICE AS DOUBLE) AS PRE_AP_RAISE6_PRICE,
  CAST(PRE_AP_RAISE60_PRICE AS DOUBLE) AS PRE_AP_RAISE60_PRICE,
  CAST(PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS PRE_AP_RAISE5MIN_PRICE,
  CAST(PRE_AP_RAISEREG_PRICE AS DOUBLE) AS PRE_AP_RAISEREG_PRICE,
  CAST(PRE_AP_LOWER6_PRICE AS DOUBLE) AS PRE_AP_LOWER6_PRICE,
  CAST(PRE_AP_LOWER60_PRICE AS DOUBLE) AS PRE_AP_LOWER60_PRICE,
  CAST(PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS PRE_AP_LOWER5MIN_PRICE,
  CAST(PRE_AP_LOWERREG_PRICE AS DOUBLE) AS PRE_AP_LOWERREG_PRICE,
  CAST(RAISE1SECRRP AS DOUBLE) AS RAISE1SECRRP,
  CAST(RAISE1SECROP AS DOUBLE) AS RAISE1SECROP,
  CAST(RAISE1SECAPCFLAG AS DOUBLE) AS RAISE1SECAPCFLAG,
  CAST(LOWER1SECRRP AS DOUBLE) AS LOWER1SECRRP,
  CAST(LOWER1SECROP AS DOUBLE) AS LOWER1SECROP,
  CAST(LOWER1SECAPCFLAG AS DOUBLE) AS LOWER1SECAPCFLAG,
  CAST(PRE_AP_RAISE1_PRICE AS DOUBLE) AS PRE_AP_RAISE1_PRICE,
  CAST(PRE_AP_LOWER1_PRICE AS DOUBLE) AS PRE_AP_LOWER1_PRICE,
  CAST(CUMUL_PRE_AP_ENERGY_PRICE AS DOUBLE) AS CUMUL_PRE_AP_ENERGY_PRICE,
  CAST(CUMUL_PRE_AP_RAISE6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE6_PRICE,
  CAST(CUMUL_PRE_AP_RAISE60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE60_PRICE,
  CAST(CUMUL_PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE5MIN_PRICE,
  CAST(CUMUL_PRE_AP_RAISEREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISEREG_PRICE,
  CAST(CUMUL_PRE_AP_LOWER6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER6_PRICE,
  CAST(CUMUL_PRE_AP_LOWER60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER60_PRICE,
  CAST(CUMUL_PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER5MIN_PRICE,
  CAST(CUMUL_PRE_AP_LOWERREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWERREG_PRICE,
  CAST(CUMUL_PRE_AP_RAISE1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE1_PRICE,
  CAST(CUMUL_PRE_AP_LOWER1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER1_PRICE,
  SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m11:05:47.491612 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price_today"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."csv_archive_log"
  WHERE source_type = 'price_today'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/price_today/day=' || substring(source_filename, 19, 8) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

price_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'PRICE': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'DISPATCHINTERVAL': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'LASTCHANGED': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'PRICE_STATUS': 'VARCHAR',
      'PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'RAISE1SECRRP': 'VARCHAR',
      'RAISE1SECROP': 'VARCHAR',
      'RAISE1SECAPCFLAG': 'VARCHAR',
      'LOWER1SECRRP': 'VARCHAR',
      'LOWER1SECROP': 'VARCHAR',
      'LOWER1SECAPCFLAG': 'VARCHAR',
      'PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'OCD_STATUS': 'VARCHAR',
      'MII_STATUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND PRICE = 'PRICE'
)

SELECT
  REGIONID,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(DISPATCHINTERVAL AS DOUBLE) AS DISPATCHINTERVAL,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(PRE_AP_ENERGY_PRICE AS DOUBLE) AS PRE_AP_ENERGY_PRICE,
  CAST(PRE_AP_RAISE6_PRICE AS DOUBLE) AS PRE_AP_RAISE6_PRICE,
  CAST(PRE_AP_RAISE60_PRICE AS DOUBLE) AS PRE_AP_RAISE60_PRICE,
  CAST(PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS PRE_AP_RAISE5MIN_PRICE,
  CAST(PRE_AP_RAISEREG_PRICE AS DOUBLE) AS PRE_AP_RAISEREG_PRICE,
  CAST(PRE_AP_LOWER6_PRICE AS DOUBLE) AS PRE_AP_LOWER6_PRICE,
  CAST(PRE_AP_LOWER60_PRICE AS DOUBLE) AS PRE_AP_LOWER60_PRICE,
  CAST(PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS PRE_AP_LOWER5MIN_PRICE,
  CAST(PRE_AP_LOWERREG_PRICE AS DOUBLE) AS PRE_AP_LOWERREG_PRICE,
  CAST(RAISE1SECRRP AS DOUBLE) AS RAISE1SECRRP,
  CAST(RAISE1SECROP AS DOUBLE) AS RAISE1SECROP,
  CAST(RAISE1SECAPCFLAG AS DOUBLE) AS RAISE1SECAPCFLAG,
  CAST(LOWER1SECRRP AS DOUBLE) AS LOWER1SECRRP,
  CAST(LOWER1SECROP AS DOUBLE) AS LOWER1SECROP,
  CAST(LOWER1SECAPCFLAG AS DOUBLE) AS LOWER1SECAPCFLAG,
  CAST(PRE_AP_RAISE1_PRICE AS DOUBLE) AS PRE_AP_RAISE1_PRICE,
  CAST(PRE_AP_LOWER1_PRICE AS DOUBLE) AS PRE_AP_LOWER1_PRICE,
  CAST(CUMUL_PRE_AP_ENERGY_PRICE AS DOUBLE) AS CUMUL_PRE_AP_ENERGY_PRICE,
  CAST(CUMUL_PRE_AP_RAISE6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE6_PRICE,
  CAST(CUMUL_PRE_AP_RAISE60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE60_PRICE,
  CAST(CUMUL_PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE5MIN_PRICE,
  CAST(CUMUL_PRE_AP_RAISEREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISEREG_PRICE,
  CAST(CUMUL_PRE_AP_LOWER6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER6_PRICE,
  CAST(CUMUL_PRE_AP_LOWER60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER60_PRICE,
  CAST(CUMUL_PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER5MIN_PRICE,
  CAST(CUMUL_PRE_AP_LOWERREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWERREG_PRICE,
  CAST(CUMUL_PRE_AP_RAISE1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE1_PRICE,
  CAST(CUMUL_PRE_AP_LOWER1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER1_PRICE,
  SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m11:05:47.492612 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m11:05:47.493612 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: ROLLBACK
[0m11:05:47.498247 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_price_today'
[0m11:05:47.498247 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: Close
[0m11:05:47.502875 [debug] [Thread-1 (]: Runtime Error in model fct_price_today (models\marts\fct_price_today.sql)
  Binder Error: Table function cannot contain subqueries
[0m11:05:47.503881 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df2ac2ff-342b-4222-94ae-bc14525ea3f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AF13AA090>]}
[0m11:05:47.503881 [error] [Thread-1 (]: 4 of 7 ERROR creating sql incremental model aemo.fct_price_today ............... [[31mERROR[0m in 0.05s]
[0m11:05:47.503881 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_price_today
[0m11:05:47.503881 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_scada
[0m11:05:47.503881 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_price_today' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_price_today (models\marts\fct_price_today.sql)
  Binder Error: Table function cannot contain subqueries.
[0m11:05:47.503881 [info ] [Thread-1 (]: 5 of 7 START sql incremental model aemo.fct_scada .............................. [RUN]
[0m11:05:47.503881 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.fct_price_today, now model.aemo_electricity.fct_scada)
[0m11:05:47.503881 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_scada
[0m11:05:47.503881 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_scada"
[0m11:05:47.503881 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_scada
[0m11:05:47.503881 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_scada"
[0m11:05:47.519963 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada"
[0m11:05:47.520913 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: BEGIN
[0m11:05:47.521931 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:05:47.522925 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:05:47.522925 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada"
[0m11:05:47.524259 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."csv_archive_log"
  WHERE source_type = 'daily'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/daily/year=' || substring(source_filename, 14, 4) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

scada_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'DUID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'DISPATCHMODE': 'VARCHAR',
      'AGCSTATUS': 'VARCHAR',
      'INITIALMW': 'VARCHAR',
      'TOTALCLEARED': 'VARCHAR',
      'RAMPDOWNRATE': 'VARCHAR',
      'RAMPUPRATE': 'VARCHAR',
      'LOWER5MIN': 'VARCHAR',
      'LOWER60SEC': 'VARCHAR',
      'LOWER6SEC': 'VARCHAR',
      'RAISE5MIN': 'VARCHAR',
      'RAISE60SEC': 'VARCHAR',
      'RAISE6SEC': 'VARCHAR',
      'MARGINAL5MINVALUE': 'VARCHAR',
      'MARGINAL60SECVALUE': 'VARCHAR',
      'MARGINAL6SECVALUE': 'VARCHAR',
      'MARGINALVALUE': 'VARCHAR',
      'VIOLATION5MINDEGREE': 'VARCHAR',
      'VIOLATION60SECDEGREE': 'VARCHAR',
      'VIOLATION6SECDEGREE': 'VARCHAR',
      'VIOLATIONDEGREE': 'VARCHAR',
      'LOWERREG': 'VARCHAR',
      'RAISEREG': 'VARCHAR',
      'AVAILABILITY': 'VARCHAR',
      'RAISE6SECFLAGS': 'VARCHAR',
      'RAISE60SECFLAGS': 'VARCHAR',
      'RAISE5MINFLAGS': 'VARCHAR',
      'RAISEREGFLAGS': 'VARCHAR',
      'LOWER6SECFLAGS': 'VARCHAR',
      'LOWER60SECFLAGS': 'VARCHAR',
      'LOWER5MINFLAGS': 'VARCHAR',
      'LOWERREGFLAGS': 'VARCHAR',
      'RAISEREGAVAILABILITY': 'VARCHAR',
      'RAISEREGENABLEMENTMAX': 'VARCHAR',
      'RAISEREGENABLEMENTMIN': 'VARCHAR',
      'LOWERREGAVAILABILITY': 'VARCHAR',
      'LOWERREGENABLEMENTMAX': 'VARCHAR',
      'LOWERREGENABLEMENTMIN': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DUNIT' AND VERSION = '3'
)

SELECT
  UNIT,
  DUID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(DISPATCHMODE AS DOUBLE) AS DISPATCHMODE,
  CAST(AGCSTATUS AS DOUBLE) AS AGCSTATUS,
  CAST(INITIALMW AS DOUBLE) AS INITIALMW,
  CAST(TOTALCLEARED AS DOUBLE) AS TOTALCLEARED,
  CAST(RAMPDOWNRATE AS DOUBLE) AS RAMPDOWNRATE,
  CAST(RAMPUPRATE AS DOUBLE) AS RAMPUPRATE,
  CAST(LOWER5MIN AS DOUBLE) AS LOWER5MIN,
  CAST(LOWER60SEC AS DOUBLE) AS LOWER60SEC,
  CAST(LOWER6SEC AS DOUBLE) AS LOWER6SEC,
  CAST(RAISE5MIN AS DOUBLE) AS RAISE5MIN,
  CAST(RAISE60SEC AS DOUBLE) AS RAISE60SEC,
  CAST(RAISE6SEC AS DOUBLE) AS RAISE6SEC,
  CAST(MARGINAL5MINVALUE AS DOUBLE) AS MARGINAL5MINVALUE,
  CAST(MARGINAL60SECVALUE AS DOUBLE) AS MARGINAL60SECVALUE,
  CAST(MARGINAL6SECVALUE AS DOUBLE) AS MARGINAL6SECVALUE,
  CAST(MARGINALVALUE AS DOUBLE) AS MARGINALVALUE,
  CAST(VIOLATION5MINDEGREE AS DOUBLE) AS VIOLATION5MINDEGREE,
  CAST(VIOLATION60SECDEGREE AS DOUBLE) AS VIOLATION60SECDEGREE,
  CAST(VIOLATION6SECDEGREE AS DOUBLE) AS VIOLATION6SECDEGREE,
  CAST(VIOLATIONDEGREE AS DOUBLE) AS VIOLATIONDEGREE,
  CAST(LOWERREG AS DOUBLE) AS LOWERREG,
  CAST(RAISEREG AS DOUBLE) AS RAISEREG,
  CAST(AVAILABILITY AS DOUBLE) AS AVAILABILITY,
  CAST(RAISE6SECFLAGS AS DOUBLE) AS RAISE6SECFLAGS,
  CAST(RAISE60SECFLAGS AS DOUBLE) AS RAISE60SECFLAGS,
  CAST(RAISE5MINFLAGS AS DOUBLE) AS RAISE5MINFLAGS,
  CAST(RAISEREGFLAGS AS DOUBLE) AS RAISEREGFLAGS,
  CAST(LOWER6SECFLAGS AS DOUBLE) AS LOWER6SECFLAGS,
  CAST(LOWER60SECFLAGS AS DOUBLE) AS LOWER60SECFLAGS,
  CAST(LOWER5MINFLAGS AS DOUBLE) AS LOWER5MINFLAGS,
  CAST(LOWERREGFLAGS AS DOUBLE) AS LOWERREGFLAGS,
  CAST(RAISEREGAVAILABILITY AS DOUBLE) AS RAISEREGAVAILABILITY,
  CAST(RAISEREGENABLEMENTMAX AS DOUBLE) AS RAISEREGENABLEMENTMAX,
  CAST(RAISEREGENABLEMENTMIN AS DOUBLE) AS RAISEREGENABLEMENTMIN,
  CAST(LOWERREGAVAILABILITY AS DOUBLE) AS LOWERREGAVAILABILITY,
  CAST(LOWERREGENABLEMENTMAX AS DOUBLE) AS LOWERREGENABLEMENTMAX,
  CAST(LOWERREGENABLEMENTMIN AS DOUBLE) AS LOWERREGENABLEMENTMIN,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m11:05:47.534768 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."csv_archive_log"
  WHERE source_type = 'daily'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/daily/year=' || substring(source_filename, 14, 4) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

scada_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'DUID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'DISPATCHMODE': 'VARCHAR',
      'AGCSTATUS': 'VARCHAR',
      'INITIALMW': 'VARCHAR',
      'TOTALCLEARED': 'VARCHAR',
      'RAMPDOWNRATE': 'VARCHAR',
      'RAMPUPRATE': 'VARCHAR',
      'LOWER5MIN': 'VARCHAR',
      'LOWER60SEC': 'VARCHAR',
      'LOWER6SEC': 'VARCHAR',
      'RAISE5MIN': 'VARCHAR',
      'RAISE60SEC': 'VARCHAR',
      'RAISE6SEC': 'VARCHAR',
      'MARGINAL5MINVALUE': 'VARCHAR',
      'MARGINAL60SECVALUE': 'VARCHAR',
      'MARGINAL6SECVALUE': 'VARCHAR',
      'MARGINALVALUE': 'VARCHAR',
      'VIOLATION5MINDEGREE': 'VARCHAR',
      'VIOLATION60SECDEGREE': 'VARCHAR',
      'VIOLATION6SECDEGREE': 'VARCHAR',
      'VIOLATIONDEGREE': 'VARCHAR',
      'LOWERREG': 'VARCHAR',
      'RAISEREG': 'VARCHAR',
      'AVAILABILITY': 'VARCHAR',
      'RAISE6SECFLAGS': 'VARCHAR',
      'RAISE60SECFLAGS': 'VARCHAR',
      'RAISE5MINFLAGS': 'VARCHAR',
      'RAISEREGFLAGS': 'VARCHAR',
      'LOWER6SECFLAGS': 'VARCHAR',
      'LOWER60SECFLAGS': 'VARCHAR',
      'LOWER5MINFLAGS': 'VARCHAR',
      'LOWERREGFLAGS': 'VARCHAR',
      'RAISEREGAVAILABILITY': 'VARCHAR',
      'RAISEREGENABLEMENTMAX': 'VARCHAR',
      'RAISEREGENABLEMENTMIN': 'VARCHAR',
      'LOWERREGAVAILABILITY': 'VARCHAR',
      'LOWERREGENABLEMENTMAX': 'VARCHAR',
      'LOWERREGENABLEMENTMIN': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DUNIT' AND VERSION = '3'
)

SELECT
  UNIT,
  DUID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(DISPATCHMODE AS DOUBLE) AS DISPATCHMODE,
  CAST(AGCSTATUS AS DOUBLE) AS AGCSTATUS,
  CAST(INITIALMW AS DOUBLE) AS INITIALMW,
  CAST(TOTALCLEARED AS DOUBLE) AS TOTALCLEARED,
  CAST(RAMPDOWNRATE AS DOUBLE) AS RAMPDOWNRATE,
  CAST(RAMPUPRATE AS DOUBLE) AS RAMPUPRATE,
  CAST(LOWER5MIN AS DOUBLE) AS LOWER5MIN,
  CAST(LOWER60SEC AS DOUBLE) AS LOWER60SEC,
  CAST(LOWER6SEC AS DOUBLE) AS LOWER6SEC,
  CAST(RAISE5MIN AS DOUBLE) AS RAISE5MIN,
  CAST(RAISE60SEC AS DOUBLE) AS RAISE60SEC,
  CAST(RAISE6SEC AS DOUBLE) AS RAISE6SEC,
  CAST(MARGINAL5MINVALUE AS DOUBLE) AS MARGINAL5MINVALUE,
  CAST(MARGINAL60SECVALUE AS DOUBLE) AS MARGINAL60SECVALUE,
  CAST(MARGINAL6SECVALUE AS DOUBLE) AS MARGINAL6SECVALUE,
  CAST(MARGINALVALUE AS DOUBLE) AS MARGINALVALUE,
  CAST(VIOLATION5MINDEGREE AS DOUBLE) AS VIOLATION5MINDEGREE,
  CAST(VIOLATION60SECDEGREE AS DOUBLE) AS VIOLATION60SECDEGREE,
  CAST(VIOLATION6SECDEGREE AS DOUBLE) AS VIOLATION6SECDEGREE,
  CAST(VIOLATIONDEGREE AS DOUBLE) AS VIOLATIONDEGREE,
  CAST(LOWERREG AS DOUBLE) AS LOWERREG,
  CAST(RAISEREG AS DOUBLE) AS RAISEREG,
  CAST(AVAILABILITY AS DOUBLE) AS AVAILABILITY,
  CAST(RAISE6SECFLAGS AS DOUBLE) AS RAISE6SECFLAGS,
  CAST(RAISE60SECFLAGS AS DOUBLE) AS RAISE60SECFLAGS,
  CAST(RAISE5MINFLAGS AS DOUBLE) AS RAISE5MINFLAGS,
  CAST(RAISEREGFLAGS AS DOUBLE) AS RAISEREGFLAGS,
  CAST(LOWER6SECFLAGS AS DOUBLE) AS LOWER6SECFLAGS,
  CAST(LOWER60SECFLAGS AS DOUBLE) AS LOWER60SECFLAGS,
  CAST(LOWER5MINFLAGS AS DOUBLE) AS LOWER5MINFLAGS,
  CAST(LOWERREGFLAGS AS DOUBLE) AS LOWERREGFLAGS,
  CAST(RAISEREGAVAILABILITY AS DOUBLE) AS RAISEREGAVAILABILITY,
  CAST(RAISEREGENABLEMENTMAX AS DOUBLE) AS RAISEREGENABLEMENTMAX,
  CAST(RAISEREGENABLEMENTMIN AS DOUBLE) AS RAISEREGENABLEMENTMIN,
  CAST(LOWERREGAVAILABILITY AS DOUBLE) AS LOWERREGAVAILABILITY,
  CAST(LOWERREGENABLEMENTMAX AS DOUBLE) AS LOWERREGENABLEMENTMAX,
  CAST(LOWERREGENABLEMENTMIN AS DOUBLE) AS LOWERREGENABLEMENTMIN,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m11:05:47.535777 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m11:05:47.535777 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: ROLLBACK
[0m11:05:47.540794 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_scada'
[0m11:05:47.541354 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: Close
[0m11:05:47.546085 [debug] [Thread-1 (]: Runtime Error in model fct_scada (models\marts\fct_scada.sql)
  Binder Error: Table function cannot contain subqueries
[0m11:05:47.546085 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df2ac2ff-342b-4222-94ae-bc14525ea3f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AEF8CF990>]}
[0m11:05:47.546085 [error] [Thread-1 (]: 5 of 7 ERROR creating sql incremental model aemo.fct_scada ..................... [[31mERROR[0m in 0.04s]
[0m11:05:47.546085 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_scada
[0m11:05:47.546085 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_scada_today
[0m11:05:47.546085 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_scada' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_scada (models\marts\fct_scada.sql)
  Binder Error: Table function cannot contain subqueries.
[0m11:05:47.546085 [info ] [Thread-1 (]: 6 of 7 START sql incremental model aemo.fct_scada_today ........................ [RUN]
[0m11:05:47.546085 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.fct_scada, now model.aemo_electricity.fct_scada_today)
[0m11:05:47.546085 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_scada_today
[0m11:05:47.557079 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_scada_today"
[0m11:05:47.558992 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_scada_today
[0m11:05:47.563907 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_scada_today"
[0m11:05:47.565897 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada_today"
[0m11:05:47.566905 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: BEGIN
[0m11:05:47.566905 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:05:47.567901 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:05:47.568900 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada_today"
[0m11:05:47.569733 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada_today"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."csv_archive_log"
  WHERE source_type = 'scada_today'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/scada_today/day=' || substring(source_filename, 22, 8) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

scada_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'UNIT_SCADA': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'DUID': 'VARCHAR',
      'SCADAVALUE': 'double',
      'LASTCHANGED': 'timestamp'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND SCADAVALUE != 0
)

SELECT
  DUID,
  SCADAVALUE AS INITIALMW,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  SETTLEMENTDATE,
  LASTCHANGED,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m11:05:47.578284 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada_today"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."csv_archive_log"
  WHERE source_type = 'scada_today'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/scada_today/day=' || substring(source_filename, 22, 8) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

scada_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'UNIT_SCADA': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'DUID': 'VARCHAR',
      'SCADAVALUE': 'double',
      'LASTCHANGED': 'timestamp'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND SCADAVALUE != 0
)

SELECT
  DUID,
  SCADAVALUE AS INITIALMW,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  SETTLEMENTDATE,
  LASTCHANGED,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m11:05:47.579287 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m11:05:47.580285 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: ROLLBACK
[0m11:05:47.582678 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_scada_today'
[0m11:05:47.582678 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: Close
[0m11:05:47.587628 [debug] [Thread-1 (]: Runtime Error in model fct_scada_today (models\marts\fct_scada_today.sql)
  Binder Error: Table function cannot contain subqueries
[0m11:05:47.587628 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df2ac2ff-342b-4222-94ae-bc14525ea3f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AF15BE950>]}
[0m11:05:47.587628 [error] [Thread-1 (]: 6 of 7 ERROR creating sql incremental model aemo.fct_scada_today ............... [[31mERROR[0m in 0.04s]
[0m11:05:47.591261 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_scada_today
[0m11:05:47.591261 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_summary
[0m11:05:47.591261 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_scada_today' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_scada_today (models\marts\fct_scada_today.sql)
  Binder Error: Table function cannot contain subqueries.
[0m11:05:47.593274 [info ] [Thread-1 (]: 7 of 7 SKIP relation aemo.fct_summary .......................................... [[33mSKIP[0m]
[0m11:05:47.593274 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_summary
[0m11:05:47.596038 [debug] [MainThread]: Using duckdb connection "master"
[0m11:05:47.596970 [debug] [MainThread]: On master: BEGIN
[0m11:05:47.596970 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:05:47.598072 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m11:05:47.598978 [debug] [MainThread]: On master: COMMIT
[0m11:05:47.598978 [debug] [MainThread]: Using duckdb connection "master"
[0m11:05:47.598978 [debug] [MainThread]: On master: COMMIT
[0m11:05:47.600496 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:05:47.601516 [debug] [MainThread]: On master: Close
[0m11:05:47.601516 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:05:47.602516 [debug] [MainThread]: Connection 'create_ducklake_aemo' was properly closed.
[0m11:05:47.603349 [debug] [MainThread]: Connection 'list_ducklake_aemo' was properly closed.
[0m11:05:47.603349 [debug] [MainThread]: Connection 'model.aemo_electricity.fct_scada_today' was properly closed.
[0m11:05:47.604634 [info ] [MainThread]: 
[0m11:05:47.604634 [info ] [MainThread]: Finished running 6 incremental models, 1 table model in 0 hours 0 minutes and 22.06 seconds (22.06s).
[0m11:05:47.606690 [debug] [MainThread]: Command end result
[0m11:05:47.628719 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m11:05:47.636666 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m11:05:47.637679 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\lakehouse\default\Files\dbt\target\run_results.json
[0m11:05:47.637679 [info ] [MainThread]: 
[0m11:05:47.645949 [info ] [MainThread]: [31mCompleted with 4 errors, 0 partial successes, and 0 warnings:[0m
[0m11:05:47.648021 [info ] [MainThread]: 
[0m11:05:47.649026 [error] [MainThread]: [31mFailure in model fct_price (models\marts\fct_price.sql)[0m
[0m11:05:47.651033 [error] [MainThread]:   Runtime Error in model fct_price (models\marts\fct_price.sql)
  Binder Error: Table function cannot contain subqueries
[0m11:05:47.653026 [info ] [MainThread]: 
[0m11:05:47.653612 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_price.sql
[0m11:05:47.654712 [info ] [MainThread]: 
[0m11:05:47.655750 [error] [MainThread]: [31mFailure in model fct_price_today (models\marts\fct_price_today.sql)[0m
[0m11:05:47.656757 [error] [MainThread]:   Runtime Error in model fct_price_today (models\marts\fct_price_today.sql)
  Binder Error: Table function cannot contain subqueries
[0m11:05:47.657756 [info ] [MainThread]: 
[0m11:05:47.658757 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_price_today.sql
[0m11:05:47.658757 [info ] [MainThread]: 
[0m11:05:47.703159 [error] [MainThread]: [31mFailure in model fct_scada (models\marts\fct_scada.sql)[0m
[0m11:05:47.707961 [error] [MainThread]:   Runtime Error in model fct_scada (models\marts\fct_scada.sql)
  Binder Error: Table function cannot contain subqueries
[0m11:05:47.707961 [info ] [MainThread]: 
[0m11:05:47.711534 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_scada.sql
[0m11:05:47.712093 [info ] [MainThread]: 
[0m11:05:47.712093 [error] [MainThread]: [31mFailure in model fct_scada_today (models\marts\fct_scada_today.sql)[0m
[0m11:05:47.712093 [error] [MainThread]:   Runtime Error in model fct_scada_today (models\marts\fct_scada_today.sql)
  Binder Error: Table function cannot contain subqueries
[0m11:05:47.712093 [info ] [MainThread]: 
[0m11:05:47.712093 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_scada_today.sql
[0m11:05:47.712093 [info ] [MainThread]: 
[0m11:05:47.712093 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=4 SKIP=1 NO-OP=0 TOTAL=7
[0m11:05:47.720930 [debug] [MainThread]: Command `dbt run` failed at 11:05:47.719922 after 23.74 seconds
[0m11:05:47.721930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AE96D8610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AE9502650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026AE9502710>]}
[0m11:05:47.722930 [debug] [MainThread]: Flushing usage events
[0m11:05:48.928122 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:07:53.431754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001978F6104D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001978F610590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001978F611D50>]}


============================== 11:07:53.440759 | 80def5f1-4a94-419d-953b-a9936eb18daf ==============================
[0m11:07:53.440759 [info ] [MainThread]: Running with dbt=1.11.2
[0m11:07:53.443216 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'C:\\lakehouse\\default\\Files\\dbt', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\lakehouse\\default\\Files\\dbt\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'no_print': 'None', 'invocation_command': 'dbt run --select stg_csv_archive_log', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'use_experimental_parser': 'False'}
[0m11:07:53.767124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '80def5f1-4a94-419d-953b-a9936eb18daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001978F8977D0>]}
[0m11:07:53.832012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '80def5f1-4a94-419d-953b-a9936eb18daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001978B0F9850>]}
[0m11:07:53.835870 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m11:07:54.216801 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m11:07:54.618174 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 4 files changed.
[0m11:07:54.618174 [debug] [MainThread]: Partial parsing: added file: aemo_electricity://models\staging\stg_csv_archive_log.sql
[0m11:07:54.618174 [debug] [MainThread]: Partial parsing: updated file: aemo_electricity://models\marts\fct_price.sql
[0m11:07:54.618174 [debug] [MainThread]: Partial parsing: updated file: aemo_electricity://models\marts\fct_price_today.sql
[0m11:07:54.618174 [debug] [MainThread]: Partial parsing: updated file: aemo_electricity://models\marts\fct_scada.sql
[0m11:07:54.618174 [debug] [MainThread]: Partial parsing: updated file: aemo_electricity://models\marts\fct_scada_today.sql
[0m11:07:54.967828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '80def5f1-4a94-419d-953b-a9936eb18daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001978F711050>]}
[0m11:07:55.038884 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m11:07:55.043264 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m11:07:55.096813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '80def5f1-4a94-419d-953b-a9936eb18daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001978F8DCED0>]}
[0m11:07:55.096813 [info ] [MainThread]: Found 8 models, 1 seed, 1 source, 474 macros
[0m11:07:55.101626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '80def5f1-4a94-419d-953b-a9936eb18daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001978FEC4190>]}
[0m11:07:55.101626 [info ] [MainThread]: 
[0m11:07:55.104454 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:07:55.106461 [info ] [MainThread]: 
[0m11:07:55.107067 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m11:07:55.109163 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake'
[0m11:07:55.374874 [debug] [ThreadPool]: Using duckdb connection "list_ducklake"
[0m11:07:55.374874 [debug] [ThreadPool]: On list_ducklake: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"ducklake"'
    
  
  
[0m11:07:55.374874 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:07:55.792727 [debug] [ThreadPool]: SQL status: OK in 0.414 seconds
[0m11:07:55.793120 [debug] [ThreadPool]: On list_ducklake: Close
[0m11:07:55.793120 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ducklake, now create_ducklake_aemo)
[0m11:07:55.793120 [debug] [ThreadPool]: Creating schema "database: "ducklake"
schema: "aemo"
"
[0m11:07:55.801483 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:07:55.801483 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
        select type from duckdb_databases()
        where lower(database_name)='ducklake'
        and type='sqlite'
    
  
[0m11:07:55.801483 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:07:55.801483 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:07:55.801483 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:07:55.801483 [debug] [ThreadPool]: On create_ducklake_aemo: BEGIN
[0m11:07:55.809377 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m11:07:55.809847 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:07:55.810978 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
    
        create schema if not exists "ducklake"."aemo"
    
[0m11:07:55.815679 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m11:07:55.816748 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m11:07:55.817284 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:07:55.818175 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m11:07:55.819223 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:07:55.819741 [debug] [ThreadPool]: On create_ducklake_aemo: Close
[0m11:07:55.825034 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake_aemo'
[0m11:07:55.831270 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m11:07:55.831797 [debug] [ThreadPool]: On list_ducklake_aemo: BEGIN
[0m11:07:55.832353 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:07:55.833453 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:07:55.834392 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m11:07:55.834392 [debug] [ThreadPool]: On list_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake_aemo"} */
select
      'ducklake' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'aemo'
    and lower(table_catalog) = 'ducklake'
  
[0m11:07:55.848295 [debug] [ThreadPool]: SQL status: OK in 0.013 seconds
[0m11:07:55.849361 [debug] [ThreadPool]: On list_ducklake_aemo: ROLLBACK
[0m11:07:55.851463 [debug] [ThreadPool]: Failed to rollback 'list_ducklake_aemo'
[0m11:07:55.851463 [debug] [ThreadPool]: On list_ducklake_aemo: Close
[0m11:07:55.851463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '80def5f1-4a94-419d-953b-a9936eb18daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001978F81AE10>]}
[0m11:07:55.851463 [debug] [MainThread]: Using duckdb connection "master"
[0m11:07:55.851463 [debug] [MainThread]: On master: BEGIN
[0m11:07:55.851463 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:07:55.851463 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m11:07:55.851463 [debug] [MainThread]: On master: COMMIT
[0m11:07:55.851463 [debug] [MainThread]: Using duckdb connection "master"
[0m11:07:55.851463 [debug] [MainThread]: On master: COMMIT
[0m11:07:55.859395 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:07:55.859910 [debug] [MainThread]: On master: Close
[0m11:07:55.859910 [debug] [Thread-1 (]: Began running node model.aemo_electricity.stg_csv_archive_log
[0m11:07:55.859910 [info ] [Thread-1 (]: 1 of 1 START sql table model aemo.stg_csv_archive_log .......................... [RUN]
[0m11:07:55.868416 [debug] [Thread-1 (]: Acquiring new duckdb connection 'model.aemo_electricity.stg_csv_archive_log'
[0m11:07:55.868416 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.stg_csv_archive_log
[0m11:07:55.876456 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.stg_csv_archive_log"
[0m11:07:55.877316 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.stg_csv_archive_log
[0m11:07:55.902037 [info ] [Thread-1 (]: [DOWNLOAD] Starting download with PATH_ROOT=/lakehouse/default, download_limit=2
[0m11:07:55.902587 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:07:55.902587 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: BEGIN
[0m11:07:55.902587 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m11:07:55.902587 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:07:55.902587 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:07:55.902587 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE PATH_ROOT = '/lakehouse/default'

[0m11:07:55.902587 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:07:55.902587 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:07:55.902587 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE download_limit = 2

[0m11:07:55.909528 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:07:55.910582 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:07:55.911628 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE csv_archive_path = getvariable('PATH_ROOT') || '/Files/csv'

[0m11:07:55.912802 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:07:55.914920 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:07:55.914920 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE SCHEMA IF NOT EXISTS ducklake.aemo

[0m11:07:55.921437 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m11:07:55.923032 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:07:55.923032 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

USE ducklake.aemo

[0m11:07:55.923032 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:07:55.926251 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:07:55.927259 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE _csv_archive_staging (
  source_type VARCHAR,
  source_filename VARCHAR,
  archive_path VARCHAR,
  archived_at TIMESTAMP,
  row_count BIGINT,
  source_url VARCHAR,
  etag VARCHAR
)

[0m11:07:55.928210 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:07:55.928210 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:07:55.928210 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE _existing_archive_log (
  source_type VARCHAR,
  source_filename VARCHAR
)

[0m11:07:55.928210 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:07:55.928210 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:07:55.928210 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO _existing_archive_log 
SELECT source_type, source_filename 
FROM ducklake.aemo.csv_archive_log

[0m11:07:55.938758 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m11:07:55.939765 [info ] [Thread-1 (]: [DOWNLOAD] Daily source: aemo
[0m11:07:55.941805 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:07:55.941805 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE daily_files_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('https://nemweb.com.au/Reports/Current/Daily_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'https://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DAILY%.zip%'
ORDER BY full_url DESC

[0m11:07:56.101255 [debug] [Thread-1 (]: SQL status: OK in 0.171 seconds
[0m11:07:56.101255 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:07:56.101255 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE daily_to_archive AS
SELECT full_url, filename
FROM daily_files_web
WHERE filename NOT IN (SELECT source_filename FROM _existing_archive_log WHERE source_type = 'daily')
LIMIT getvariable('download_limit')

[0m11:07:56.116302 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:07:56.116302 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:07:56.116302 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE has_daily_to_archive = (SELECT count(*) > 0 FROM daily_to_archive)

[0m11:07:56.116302 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:07:56.116302 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:07:56.116302 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE daily_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM daily_to_archive)

[0m11:07:56.116302 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:07:56.116302 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:07:56.116302 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE daily_expected = (SELECT count(*) FROM daily_to_archive)

[0m11:07:56.116302 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:07:56.116302 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:07:56.116302 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE daily_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM daily_to_archive)

[0m11:07:56.136117 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m11:07:56.137216 [info ] [Thread-1 (]: [DOWNLOAD] Processing daily files...
[0m11:07:56.138115 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:07:56.138115 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    CAST(substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 4) AS INT) AS year
  FROM read_blob(getvariable('daily_urls'))
  WHERE getvariable('has_daily_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/daily')
(FORMAT BLOB, PARTITION_BY (year, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m11:07:56.752080 [debug] [Thread-1 (]: SQL status: OK in 0.613 seconds
[0m11:07:56.755006 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:07:56.755006 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'daily' AS source_type,
  filename AS source_filename,
  '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM daily_to_archive
WHERE getvariable('daily_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('daily_paths'))) = getvariable('daily_expected')

[0m11:08:07.193962 [debug] [Thread-1 (]: SQL status: OK in 10.441 seconds
[0m11:08:07.193962 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:07.193962 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE intraday_scada_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('http://nemweb.com.au/Reports/Current/Dispatch_SCADA/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'http://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DISPATCHSCADA%'
ORDER BY full_url DESC
LIMIT 500

[0m11:08:07.369600 [debug] [Thread-1 (]: SQL status: OK in 0.164 seconds
[0m11:08:07.369600 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:07.369600 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE scada_today_to_archive AS
SELECT full_url, filename
FROM intraday_scada_web
WHERE filename NOT IN (SELECT source_filename FROM _existing_archive_log WHERE source_type = 'scada_today')
LIMIT getvariable('download_limit')

[0m11:08:07.369600 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:08:07.369600 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:07.369600 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE has_scada_today_to_archive = (SELECT count(*) > 0 FROM scada_today_to_archive)

[0m11:08:07.369600 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:08:07.369600 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:07.369600 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE scada_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM scada_today_to_archive)

[0m11:08:07.369600 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:08:07.369600 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:07.369600 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE scada_expected = (SELECT count(*) FROM scada_today_to_archive)

[0m11:08:07.369600 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:08:07.385426 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:07.385426 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE scada_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/scada_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM scada_today_to_archive)

[0m11:08:07.385426 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m11:08:07.385426 [info ] [Thread-1 (]: [DOWNLOAD] Processing intraday SCADA files...
[0m11:08:07.385426 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:07.385426 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 8) AS day
  FROM read_blob(getvariable('scada_urls'))
  WHERE getvariable('has_scada_today_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/scada_today')
(FORMAT BLOB, PARTITION_BY (day, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m11:08:07.516263 [debug] [Thread-1 (]: SQL status: OK in 0.125 seconds
[0m11:08:07.516263 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:07.516263 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'scada_today' AS source_type,
  filename AS source_filename,
  '/scada_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM scada_today_to_archive
WHERE getvariable('scada_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('scada_paths'))) = getvariable('scada_expected')

[0m11:08:12.981625 [debug] [Thread-1 (]: SQL status: OK in 5.459 seconds
[0m11:08:12.985506 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:12.987469 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE intraday_price_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('http://nemweb.com.au/Reports/Current/DispatchIS_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'http://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DISPATCHIS_%.zip%'
ORDER BY full_url DESC
LIMIT 500

[0m11:08:13.183766 [debug] [Thread-1 (]: SQL status: OK in 0.201 seconds
[0m11:08:13.183766 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:13.183766 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE price_today_to_archive AS
SELECT full_url, filename
FROM intraday_price_web
WHERE filename NOT IN (SELECT source_filename FROM _existing_archive_log WHERE source_type = 'price_today')
LIMIT getvariable('download_limit')

[0m11:08:13.183766 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:08:13.201899 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:13.203915 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE has_price_today_to_archive = (SELECT count(*) > 0 FROM price_today_to_archive)

[0m11:08:13.207942 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:08:13.209956 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:13.211968 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE price_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM price_today_to_archive)

[0m11:08:13.215735 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m11:08:13.215735 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:13.215735 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE price_expected = (SELECT count(*) FROM price_today_to_archive)

[0m11:08:13.215735 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:08:13.215735 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:13.215735 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE price_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/price_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM price_today_to_archive)

[0m11:08:13.231812 [debug] [Thread-1 (]: SQL status: OK in 0.006 seconds
[0m11:08:13.231812 [info ] [Thread-1 (]: [DOWNLOAD] Processing intraday PRICE files...
[0m11:08:13.231812 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:13.231812 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 8) AS day
  FROM read_blob(getvariable('price_urls'))
  WHERE getvariable('has_price_today_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/price_today')
(FORMAT BLOB, PARTITION_BY (day, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m11:08:13.399651 [debug] [Thread-1 (]: SQL status: OK in 0.159 seconds
[0m11:08:13.401660 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:13.401660 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'price_today' AS source_type,
  filename AS source_filename,
  '/price_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM price_today_to_archive
WHERE getvariable('price_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('price_paths'))) = getvariable('price_expected')

[0m11:08:18.926554 [debug] [Thread-1 (]: SQL status: OK in 5.523 seconds
[0m11:08:18.926554 [info ] [Thread-1 (]: [DOWNLOAD] Refreshing 4 DUID reference files...
[0m11:08:18.926554 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:18.926554 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (SELECT 1 AS id, 'init' AS dummy) TO (getvariable('csv_archive_path') || '/duid')
(FORMAT csv, PARTITION_BY (dummy), FILE_EXTENSION 'csv', OVERWRITE_OR_IGNORE)

[0m11:08:18.942505 [debug] [Thread-1 (]: SQL status: OK in 0.006 seconds
[0m11:08:18.945464 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:18.947460 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/djouallah-patch-1/duid_data.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/duid_data.csv') (FORMAT CSV, HEADER)

[0m11:08:19.049150 [debug] [Thread-1 (]: SQL status: OK in 0.100 seconds
[0m11:08:19.051157 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:19.051157 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://data.wa.aemo.com.au/datafiles/post-facilities/facilities.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/facilities.csv') (FORMAT CSV, HEADER)

[0m11:08:19.298301 [debug] [Thread-1 (]: SQL status: OK in 0.241 seconds
[0m11:08:19.299354 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:19.299354 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/main/WA_ENERGY.csv', header=true, null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/WA_ENERGY.csv') (FORMAT CSV, HEADER)

[0m11:08:19.354327 [debug] [Thread-1 (]: SQL status: OK in 0.056 seconds
[0m11:08:19.363537 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:19.363537 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/main/geo_data.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/geo_data.csv') (FORMAT CSV, HEADER)

[0m11:08:19.425385 [debug] [Thread-1 (]: SQL status: OK in 0.063 seconds
[0m11:08:19.425385 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:19.425385 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

DELETE FROM ducklake.aemo.csv_archive_log WHERE source_type LIKE 'duid_%'

[0m11:08:25.158801 [debug] [Thread-1 (]: SQL status: OK in 5.728 seconds
[0m11:08:25.158801 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:25.158801 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT * FROM (VALUES
  ('duid_data', 'duid_data', '/duid/duid_data.csv', now()),
  ('duid_facilities', 'facilities', '/duid/facilities.csv', now()),
  ('duid_wa_energy', 'WA_ENERGY', '/duid/WA_ENERGY.csv', now()),
  ('duid_geo_data', 'geo_data', '/duid/geo_data.csv', now())
) AS t(source_type, source_filename, archive_path, archived_at)

[0m11:08:31.108947 [debug] [Thread-1 (]: SQL status: OK in 5.954 seconds
[0m11:08:31.108947 [info ] [Thread-1 (]: [DOWNLOAD] DUID files written: 4
[0m11:08:31.108947 [info ] [Thread-1 (]: [DOWNLOAD COMPLETE]
[0m11:08:31.124683 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:31.141846 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:31.142857 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

  
    
    

    create  table
      "ducklake"."aemo"."stg_csv_archive_log__dbt_tmp"
  
    as (
      



SELECT 
  source_type,
  source_filename,
  archive_path,
  archived_at,
  row_count,
  source_url,
  etag
FROM "ducklake"."aemo"."csv_archive_log"
    );
  
  
[0m11:08:43.501755 [debug] [Thread-1 (]: SQL status: OK in 12.358 seconds
[0m11:08:43.503758 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:43.503758 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */
alter table "ducklake"."aemo"."stg_csv_archive_log__dbt_tmp" rename to "stg_csv_archive_log"
[0m11:08:43.519689 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:08:43.535723 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: COMMIT
[0m11:08:43.535723 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:43.535723 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: COMMIT
[0m11:08:43.551786 [debug] [Thread-1 (]: SQL status: OK in 0.019 seconds
[0m11:08:43.561939 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:08:43.561939 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

      drop table if exists "ducklake"."aemo"."stg_csv_archive_log__dbt_backup"
    
[0m11:08:43.593224 [debug] [Thread-1 (]: SQL status: OK in 0.031 seconds
[0m11:08:43.593224 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: Close
[0m11:08:43.598789 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '80def5f1-4a94-419d-953b-a9936eb18daf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000197912A2550>]}
[0m11:08:43.598789 [info ] [Thread-1 (]: 1 of 1 OK created sql table model aemo.stg_csv_archive_log ..................... [[32mOK[0m in 47.73s]
[0m11:08:43.598789 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.stg_csv_archive_log
[0m11:08:43.598789 [debug] [MainThread]: Using duckdb connection "master"
[0m11:08:43.598789 [debug] [MainThread]: On master: BEGIN
[0m11:08:43.598789 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:08:43.598789 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m11:08:43.598789 [debug] [MainThread]: On master: COMMIT
[0m11:08:43.598789 [debug] [MainThread]: Using duckdb connection "master"
[0m11:08:43.598789 [debug] [MainThread]: On master: COMMIT
[0m11:08:43.598789 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:08:43.598789 [debug] [MainThread]: On master: Close
[0m11:08:43.598789 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:08:43.598789 [debug] [MainThread]: Connection 'create_ducklake_aemo' was properly closed.
[0m11:08:43.598789 [debug] [MainThread]: Connection 'list_ducklake_aemo' was properly closed.
[0m11:08:43.598789 [debug] [MainThread]: Connection 'model.aemo_electricity.stg_csv_archive_log' was properly closed.
[0m11:08:43.598789 [info ] [MainThread]: 
[0m11:08:43.598789 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 48.49 seconds (48.49s).
[0m11:08:43.614492 [debug] [MainThread]: Command end result
[0m11:08:43.634818 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m11:08:43.643511 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m11:08:43.651316 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\lakehouse\default\Files\dbt\target\run_results.json
[0m11:08:43.651316 [info ] [MainThread]: 
[0m11:08:43.651316 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:08:43.651316 [info ] [MainThread]: 
[0m11:08:43.651316 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m11:08:43.651316 [debug] [MainThread]: Command `dbt run` succeeded at 11:08:43.651316 after 50.33 seconds
[0m11:08:43.651316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001978F644550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001978F607C90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001978F607C10>]}
[0m11:08:43.659155 [debug] [MainThread]: Flushing usage events
[0m11:08:44.731275 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:09:02.267288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F5B3210FD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F5B3244F90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F5B3211D10>]}


============================== 11:09:02.282095 | 94412568-08ab-4d54-a15f-f12182a02a04 ==============================
[0m11:09:02.282095 [info ] [MainThread]: Running with dbt=1.11.2
[0m11:09:02.283096 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\lakehouse\\default\\Files\\dbt', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\lakehouse\\default\\Files\\dbt\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'invocation_command': 'dbt run', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m11:09:02.568388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '94412568-08ab-4d54-a15f-f12182a02a04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F5B32CCE10>]}
[0m11:09:02.615957 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '94412568-08ab-4d54-a15f-f12182a02a04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F5ADD05FD0>]}
[0m11:09:02.626634 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m11:09:03.015871 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m11:09:03.242586 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:09:03.242586 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m11:09:03.242586 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:09:03.281932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '94412568-08ab-4d54-a15f-f12182a02a04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F5B1F7B2D0>]}
[0m11:09:03.353301 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m11:09:03.363938 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m11:09:03.421285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '94412568-08ab-4d54-a15f-f12182a02a04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F5B32D1490>]}
[0m11:09:03.421285 [info ] [MainThread]: Found 8 models, 1 seed, 1 source, 474 macros
[0m11:09:03.421285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '94412568-08ab-4d54-a15f-f12182a02a04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F5B32CD010>]}
[0m11:09:03.428300 [info ] [MainThread]: 
[0m11:09:03.430307 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:09:03.432335 [info ] [MainThread]: 
[0m11:09:03.433334 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m11:09:03.441799 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake'
[0m11:09:03.762363 [debug] [ThreadPool]: Using duckdb connection "list_ducklake"
[0m11:09:03.762363 [debug] [ThreadPool]: On list_ducklake: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"ducklake"'
    
  
  
[0m11:09:03.762363 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:09:04.174243 [debug] [ThreadPool]: SQL status: OK in 0.406 seconds
[0m11:09:04.174243 [debug] [ThreadPool]: On list_ducklake: Close
[0m11:09:04.174243 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ducklake, now create_ducklake_aemo)
[0m11:09:04.174243 [debug] [ThreadPool]: Creating schema "database: "ducklake"
schema: "aemo"
"
[0m11:09:04.183661 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:09:04.183661 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
        select type from duckdb_databases()
        where lower(database_name)='ducklake'
        and type='sqlite'
    
  
[0m11:09:04.183661 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:09:04.183661 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:09:04.183661 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:09:04.183661 [debug] [ThreadPool]: On create_ducklake_aemo: BEGIN
[0m11:09:04.183661 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m11:09:04.189972 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:09:04.189972 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
    
        create schema if not exists "ducklake"."aemo"
    
[0m11:09:04.189972 [debug] [ThreadPool]: SQL status: OK in 0.005 seconds
[0m11:09:04.189972 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m11:09:04.189972 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:09:04.189972 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m11:09:04.199218 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:09:04.200271 [debug] [ThreadPool]: On create_ducklake_aemo: Close
[0m11:09:04.201865 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake_aemo'
[0m11:09:04.207316 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m11:09:04.207889 [debug] [ThreadPool]: On list_ducklake_aemo: BEGIN
[0m11:09:04.208512 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:09:04.209699 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:09:04.209699 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m11:09:04.210243 [debug] [ThreadPool]: On list_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake_aemo"} */
select
      'ducklake' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'aemo'
    and lower(table_catalog) = 'ducklake'
  
[0m11:09:04.224381 [debug] [ThreadPool]: SQL status: OK in 0.013 seconds
[0m11:09:04.226102 [debug] [ThreadPool]: On list_ducklake_aemo: ROLLBACK
[0m11:09:04.226689 [debug] [ThreadPool]: Failed to rollback 'list_ducklake_aemo'
[0m11:09:04.228873 [debug] [ThreadPool]: On list_ducklake_aemo: Close
[0m11:09:04.231407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '94412568-08ab-4d54-a15f-f12182a02a04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F5B3D08E10>]}
[0m11:09:04.232677 [debug] [MainThread]: Using duckdb connection "master"
[0m11:09:04.233873 [debug] [MainThread]: On master: BEGIN
[0m11:09:04.234409 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:09:04.236077 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m11:09:04.236637 [debug] [MainThread]: On master: COMMIT
[0m11:09:04.237771 [debug] [MainThread]: Using duckdb connection "master"
[0m11:09:04.238862 [debug] [MainThread]: On master: COMMIT
[0m11:09:04.240070 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:09:04.240070 [debug] [MainThread]: On master: Close
[0m11:09:04.251961 [debug] [Thread-1 (]: Began running node model.aemo_electricity.dim_calendar
[0m11:09:04.251961 [info ] [Thread-1 (]: 1 of 8 START sql incremental model aemo.dim_calendar ........................... [RUN]
[0m11:09:04.251961 [debug] [Thread-1 (]: Acquiring new duckdb connection 'model.aemo_electricity.dim_calendar'
[0m11:09:04.251961 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.dim_calendar
[0m11:09:04.271021 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.dim_calendar"
[0m11:09:04.272118 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.dim_calendar
[0m11:09:04.311966 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:09:04.327719 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

    
  
    
    

    create temporary table
      "dim_calendar__dbt_tmp20260202110904308001"
  
    as (
      

SELECT
  CAST(date AS DATE) as date,
  CAST(EXTRACT(year FROM date) AS INT) as year,
  CAST(EXTRACT(month FROM date) AS INT) as month
FROM (
  SELECT unnest(generate_series(
    CAST('2018-04-01' AS DATE),
    CAST('2026-12-31' AS DATE),
    INTERVAL 1 DAY
  )) as date
)
    );
  
  
  
[0m11:09:04.327719 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m11:09:04.327719 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:09:04.336937 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:09:04.336937 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: BEGIN
[0m11:09:04.336937 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:09:04.336937 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:09:04.336937 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar__dbt_tmp20260202110904308001'
      
      
      order by ordinal_position

  
[0m11:09:04.352332 [debug] [Thread-1 (]: SQL status: OK in 0.010 seconds
[0m11:09:04.353661 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:09:04.353661 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar'
      
      and lower(table_schema) = 'aemo'
      
      
      and lower(table_catalog) = 'ducklake'
      
      order by ordinal_position

  
[0m11:09:04.353661 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:09:04.368916 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:09:04.368916 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar__dbt_tmp20260202110904308001'
      
      
      order by ordinal_position

  
[0m11:09:04.368916 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:09:04.368916 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:09:04.368916 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar'
      
      and lower(table_schema) = 'aemo'
      
      
      and lower(table_catalog) = 'ducklake'
      
      order by ordinal_position

  
[0m11:09:04.384837 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:09:04.384837 [debug] [Thread-1 (]: 
    In "ducklake"."aemo"."dim_calendar":
        Schema changed: False
        Source columns not in target: []
        Target columns not in source: []
        New column types: []
  
[0m11:09:04.384837 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:09:04.384837 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */
SELECT version()
[0m11:09:04.384837 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:09:04.400712 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.dim_calendar"
[0m11:09:04.409763 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:09:04.409763 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

        
            delete from "ducklake"."aemo"."dim_calendar"
            where (
                date) in (
                select (date)
                from "dim_calendar__dbt_tmp20260202110904308001"
            );

        
    

    insert into "ducklake"."aemo"."dim_calendar" ("date", "year", "month")
    (
        select "date", "year", "month"
        from "dim_calendar__dbt_tmp20260202110904308001"
    )
  
[0m11:09:20.012625 [debug] [Thread-1 (]: SQL status: OK in 15.615 seconds
[0m11:09:20.045934 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: COMMIT
[0m11:09:20.045934 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:09:20.045934 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: COMMIT
[0m11:09:20.076383 [debug] [Thread-1 (]: SQL status: OK in 0.023 seconds
[0m11:09:20.084843 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: Close
[0m11:09:20.088865 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94412568-08ab-4d54-a15f-f12182a02a04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F5B3D02710>]}
[0m11:09:20.092049 [info ] [Thread-1 (]: 1 of 8 OK created sql incremental model aemo.dim_calendar ...................... [[32mOK[0m in 15.83s]
[0m11:09:20.092049 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.dim_calendar
[0m11:09:20.092049 [debug] [Thread-1 (]: Began running node model.aemo_electricity.dim_duid
[0m11:09:20.092049 [info ] [Thread-1 (]: 2 of 8 START sql table model aemo.dim_duid ..................................... [RUN]
[0m11:09:20.092049 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.dim_calendar, now model.aemo_electricity.dim_duid)
[0m11:09:20.102237 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.dim_duid
[0m11:09:20.112934 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.dim_duid"
[0m11:09:20.114881 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.dim_duid
[0m11:09:20.130339 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.dim_duid"
[0m11:09:20.132554 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:09:20.133554 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: BEGIN
[0m11:09:20.133554 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:09:20.134557 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:09:20.134557 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:09:20.134557 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

  
    
    

    create  table
      "ducklake"."aemo"."dim_duid__dbt_tmp"
  
    as (
      

WITH
  states AS (
    SELECT 'WA1' AS RegionID, 'Western Australia' AS State
    UNION ALL SELECT 'QLD1', 'Queensland'
    UNION ALL SELECT 'NSW1', 'New South Wales'
    UNION ALL SELECT 'TAS1', 'Tasmania'
    UNION ALL SELECT 'SA1', 'South Australia'
    UNION ALL SELECT 'VIC1', 'Victoria'
  ),

  duid_aemo AS (
    SELECT
      DUID AS DUID,
      first(Region) AS Region,
      first("Fuel Source - Descriptor") AS FuelSourceDescriptor,
      first(Participant) AS Participant
    FROM
      read_csv('/lakehouse/default/Files/csv/duid/duid_data.csv')
    WHERE
      length(DUID) > 2
    GROUP BY
      DUID
  ),

  wa_facilities AS (
    SELECT
      'WA1' AS Region,
      "Facility Code" AS DUID,
      "Participant Name" AS Participant
    FROM
      read_csv_auto('/lakehouse/default/Files/csv/duid/facilities.csv')
  ),

  wa_energy AS (
    SELECT *
    FROM read_csv_auto('/lakehouse/default/Files/csv/duid/WA_ENERGY.csv', header = 1)
  ),

  duid_wa AS (
    SELECT
      wa_facilities.DUID,
      wa_facilities.Region,
      wa_energy.Technology AS FuelSourceDescriptor,
      wa_facilities.Participant
    FROM wa_facilities
    LEFT JOIN wa_energy ON wa_facilities.DUID = wa_energy.DUID
  ),

  duid_all AS (
    SELECT * FROM duid_aemo
    UNION ALL
    SELECT * FROM duid_wa
  ),

  geo AS (
    SELECT
      duid,
      max(latitude) as latitude,
      max(longitude) as longitude
    FROM read_csv('/lakehouse/default/Files/csv/duid/geo_data.csv')
    WHERE latitude IS NOT NULL
    GROUP BY duid
  )

SELECT
  a.DUID,
  a.Region,
  UPPER(LEFT(TRIM(FuelSourceDescriptor), 1)) || LOWER(SUBSTR(TRIM(FuelSourceDescriptor), 2)) AS FuelSourceDescriptor,
  a.Participant,
  states.State,
  geo.latitude,
  geo.longitude
FROM duid_all a
JOIN states ON a.Region = states.RegionID
LEFT JOIN geo ON a.duid = geo.duid
    );
  
  
[0m11:09:24.678984 [debug] [Thread-1 (]: SQL status: OK in 4.549 seconds
[0m11:09:24.678984 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:09:24.678984 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'aemo'
      AND table_name = 'dim_duid'
  
[0m11:09:24.694644 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:09:24.695150 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:09:24.695150 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'aemo'
      AND table_name = 'dim_duid'
  
[0m11:09:24.697156 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:09:24.704069 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:09:24.704069 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */
alter table "ducklake"."aemo"."dim_duid" rename to "dim_duid__dbt_backup"
[0m11:09:24.706074 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:09:24.710091 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:09:24.711599 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */
alter table "ducklake"."aemo"."dim_duid__dbt_tmp" rename to "dim_duid"
[0m11:09:24.711599 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:09:24.717616 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: COMMIT
[0m11:09:24.717616 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:09:24.719621 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: COMMIT
[0m11:09:24.741007 [debug] [Thread-1 (]: SQL status: OK in 0.021 seconds
[0m11:09:24.741007 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:09:24.741007 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

      drop table if exists "ducklake"."aemo"."dim_duid__dbt_backup"
    
[0m11:09:24.788446 [debug] [Thread-1 (]: SQL status: OK in 0.050 seconds
[0m11:09:24.788446 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: Close
[0m11:09:24.788446 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94412568-08ab-4d54-a15f-f12182a02a04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F5AFB9F590>]}
[0m11:09:24.788446 [info ] [Thread-1 (]: 2 of 8 OK created sql table model aemo.dim_duid ................................ [[32mOK[0m in 4.70s]
[0m11:09:24.788446 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.dim_duid
[0m11:09:24.788446 [debug] [Thread-1 (]: Began running node model.aemo_electricity.stg_csv_archive_log
[0m11:09:24.804171 [info ] [Thread-1 (]: 3 of 8 START sql table model aemo.stg_csv_archive_log .......................... [RUN]
[0m11:09:24.804171 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.dim_duid, now model.aemo_electricity.stg_csv_archive_log)
[0m11:09:24.804171 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.stg_csv_archive_log
[0m11:09:24.804171 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:24.804171 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.stg_csv_archive_log
[0m11:09:24.836391 [info ] [Thread-1 (]: [DOWNLOAD] Starting download with PATH_ROOT=/lakehouse/default, download_limit=2
[0m11:09:24.837238 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:24.837238 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: BEGIN
[0m11:09:24.837238 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:09:24.837238 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:09:24.841520 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:24.841520 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE PATH_ROOT = '/lakehouse/default'

[0m11:09:24.843743 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:09:24.844750 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:24.845845 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE download_limit = 2

[0m11:09:24.845845 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:09:24.847146 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:24.848239 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE csv_archive_path = getvariable('PATH_ROOT') || '/Files/csv'

[0m11:09:24.849239 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:09:24.849881 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:24.850973 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE SCHEMA IF NOT EXISTS ducklake.aemo

[0m11:09:24.883760 [debug] [Thread-1 (]: SQL status: OK in 0.036 seconds
[0m11:09:24.883760 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:24.883760 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

USE ducklake.aemo

[0m11:09:24.883760 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:09:24.883760 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:24.883760 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE _csv_archive_staging (
  source_type VARCHAR,
  source_filename VARCHAR,
  archive_path VARCHAR,
  archived_at TIMESTAMP,
  row_count BIGINT,
  source_url VARCHAR,
  etag VARCHAR
)

[0m11:09:24.883760 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:09:24.883760 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:24.883760 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE _existing_archive_log (
  source_type VARCHAR,
  source_filename VARCHAR
)

[0m11:09:24.883760 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:09:24.883760 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:24.883760 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO _existing_archive_log 
SELECT source_type, source_filename 
FROM ducklake.aemo.csv_archive_log

[0m11:09:31.037526 [debug] [Thread-1 (]: SQL status: OK in 6.150 seconds
[0m11:09:31.037526 [info ] [Thread-1 (]: [DOWNLOAD] Daily source: aemo
[0m11:09:31.037526 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:31.037526 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE daily_files_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('https://nemweb.com.au/Reports/Current/Daily_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'https://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DAILY%.zip%'
ORDER BY full_url DESC

[0m11:09:31.199938 [debug] [Thread-1 (]: SQL status: OK in 0.150 seconds
[0m11:09:31.203971 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:31.205985 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE daily_to_archive AS
SELECT full_url, filename
FROM daily_files_web
WHERE filename NOT IN (SELECT source_filename FROM _existing_archive_log WHERE source_type = 'daily')
LIMIT getvariable('download_limit')

[0m11:09:31.209037 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m11:09:31.209037 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:31.209037 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE has_daily_to_archive = (SELECT count(*) > 0 FROM daily_to_archive)

[0m11:09:31.221185 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:09:31.221185 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:31.221185 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE daily_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM daily_to_archive)

[0m11:09:31.221185 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m11:09:31.221185 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:31.221185 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE daily_expected = (SELECT count(*) FROM daily_to_archive)

[0m11:09:31.236102 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:09:31.236102 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:31.236102 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE daily_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM daily_to_archive)

[0m11:09:31.236102 [debug] [Thread-1 (]: SQL status: OK in 0.006 seconds
[0m11:09:31.252272 [info ] [Thread-1 (]: [DOWNLOAD] Processing daily files...
[0m11:09:31.252272 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:31.252272 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    CAST(substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 4) AS INT) AS year
  FROM read_blob(getvariable('daily_urls'))
  WHERE getvariable('has_daily_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/daily')
(FORMAT BLOB, PARTITION_BY (year, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m11:09:31.898032 [debug] [Thread-1 (]: SQL status: OK in 0.643 seconds
[0m11:09:31.900048 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:31.900048 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'daily' AS source_type,
  filename AS source_filename,
  '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM daily_to_archive
WHERE getvariable('daily_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('daily_paths'))) = getvariable('daily_expected')

[0m11:09:37.041964 [debug] [Thread-1 (]: SQL status: OK in 5.153 seconds
[0m11:09:37.058060 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:37.058060 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE intraday_scada_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('http://nemweb.com.au/Reports/Current/Dispatch_SCADA/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'http://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DISPATCHSCADA%'
ORDER BY full_url DESC
LIMIT 500

[0m11:09:37.268125 [debug] [Thread-1 (]: SQL status: OK in 0.206 seconds
[0m11:09:37.268125 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:37.268125 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE scada_today_to_archive AS
SELECT full_url, filename
FROM intraday_scada_web
WHERE filename NOT IN (SELECT source_filename FROM _existing_archive_log WHERE source_type = 'scada_today')
LIMIT getvariable('download_limit')

[0m11:09:37.268125 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:09:37.283385 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:37.285398 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE has_scada_today_to_archive = (SELECT count(*) > 0 FROM scada_today_to_archive)

[0m11:09:37.287407 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:09:37.287407 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:37.287407 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE scada_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM scada_today_to_archive)

[0m11:09:37.287407 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:09:37.287407 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:37.287407 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE scada_expected = (SELECT count(*) FROM scada_today_to_archive)

[0m11:09:37.287407 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:09:37.287407 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:37.299050 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE scada_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/scada_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM scada_today_to_archive)

[0m11:09:37.299050 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:09:37.299050 [info ] [Thread-1 (]: [DOWNLOAD] Processing intraday SCADA files...
[0m11:09:37.299050 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:37.299050 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 8) AS day
  FROM read_blob(getvariable('scada_urls'))
  WHERE getvariable('has_scada_today_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/scada_today')
(FORMAT BLOB, PARTITION_BY (day, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m11:09:37.426615 [debug] [Thread-1 (]: SQL status: OK in 0.121 seconds
[0m11:09:37.431623 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:37.431623 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'scada_today' AS source_type,
  filename AS source_filename,
  '/scada_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM scada_today_to_archive
WHERE getvariable('scada_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('scada_paths'))) = getvariable('scada_expected')

[0m11:09:43.462330 [debug] [Thread-1 (]: SQL status: OK in 6.035 seconds
[0m11:09:43.462330 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:43.462330 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE intraday_price_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('http://nemweb.com.au/Reports/Current/DispatchIS_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'http://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DISPATCHIS_%.zip%'
ORDER BY full_url DESC
LIMIT 500

[0m11:09:43.673312 [debug] [Thread-1 (]: SQL status: OK in 0.211 seconds
[0m11:09:43.689440 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:43.691446 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE price_today_to_archive AS
SELECT full_url, filename
FROM intraday_price_web
WHERE filename NOT IN (SELECT source_filename FROM _existing_archive_log WHERE source_type = 'price_today')
LIMIT getvariable('download_limit')

[0m11:09:43.693451 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:09:43.693451 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:43.693451 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE has_price_today_to_archive = (SELECT count(*) > 0 FROM price_today_to_archive)

[0m11:09:43.695457 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:09:43.695457 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:43.698416 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE price_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM price_today_to_archive)

[0m11:09:43.701078 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:09:43.703083 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:43.703083 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE price_expected = (SELECT count(*) FROM price_today_to_archive)

[0m11:09:43.705087 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:09:43.705087 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:43.705087 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE price_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/price_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM price_today_to_archive)

[0m11:09:43.709466 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:09:43.709466 [info ] [Thread-1 (]: [DOWNLOAD] Processing intraday PRICE files...
[0m11:09:43.709466 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:43.709466 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 8) AS day
  FROM read_blob(getvariable('price_urls'))
  WHERE getvariable('has_price_today_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/price_today')
(FORMAT BLOB, PARTITION_BY (day, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m11:09:43.869973 [debug] [Thread-1 (]: SQL status: OK in 0.168 seconds
[0m11:09:43.885938 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:43.889100 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'price_today' AS source_type,
  filename AS source_filename,
  '/price_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM price_today_to_archive
WHERE getvariable('price_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('price_paths'))) = getvariable('price_expected')

[0m11:09:48.852773 [debug] [Thread-1 (]: SQL status: OK in 4.964 seconds
[0m11:09:48.852773 [info ] [Thread-1 (]: [DOWNLOAD] Refreshing 4 DUID reference files...
[0m11:09:48.852773 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:48.861893 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (SELECT 1 AS id, 'init' AS dummy) TO (getvariable('csv_archive_path') || '/duid')
(FORMAT csv, PARTITION_BY (dummy), FILE_EXTENSION 'csv', OVERWRITE_OR_IGNORE)

[0m11:09:48.861893 [debug] [Thread-1 (]: SQL status: OK in 0.006 seconds
[0m11:09:48.871422 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:48.871422 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/djouallah-patch-1/duid_data.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/duid_data.csv') (FORMAT CSV, HEADER)

[0m11:09:49.201360 [debug] [Thread-1 (]: SQL status: OK in 0.326 seconds
[0m11:09:49.204884 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:49.206902 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://data.wa.aemo.com.au/datafiles/post-facilities/facilities.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/facilities.csv') (FORMAT CSV, HEADER)

[0m11:09:49.462509 [debug] [Thread-1 (]: SQL status: OK in 0.254 seconds
[0m11:09:49.465325 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:49.465325 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/main/WA_ENERGY.csv', header=true, null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/WA_ENERGY.csv') (FORMAT CSV, HEADER)

[0m11:09:49.757959 [debug] [Thread-1 (]: SQL status: OK in 0.289 seconds
[0m11:09:49.757959 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:49.757959 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/main/geo_data.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/geo_data.csv') (FORMAT CSV, HEADER)

[0m11:09:50.058187 [debug] [Thread-1 (]: SQL status: OK in 0.303 seconds
[0m11:09:50.058187 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:50.058187 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

DELETE FROM ducklake.aemo.csv_archive_log WHERE source_type LIKE 'duid_%'

[0m11:09:52.429144 [debug] [Thread-1 (]: SQL status: OK in 2.358 seconds
[0m11:09:52.433424 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:52.433424 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT * FROM (VALUES
  ('duid_data', 'duid_data', '/duid/duid_data.csv', now()),
  ('duid_facilities', 'facilities', '/duid/facilities.csv', now()),
  ('duid_wa_energy', 'WA_ENERGY', '/duid/WA_ENERGY.csv', now()),
  ('duid_geo_data', 'geo_data', '/duid/geo_data.csv', now())
) AS t(source_type, source_filename, archive_path, archived_at)

[0m11:09:58.697415 [debug] [Thread-1 (]: SQL status: OK in 6.269 seconds
[0m11:09:58.710527 [info ] [Thread-1 (]: [DOWNLOAD] DUID files written: 4
[0m11:09:58.712557 [info ] [Thread-1 (]: [DOWNLOAD COMPLETE]
[0m11:09:58.716922 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:58.718933 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:09:58.721671 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

  
    
    

    create  table
      "ducklake"."aemo"."stg_csv_archive_log__dbt_tmp"
  
    as (
      



SELECT 
  source_type,
  source_filename,
  archive_path,
  archived_at,
  row_count,
  source_url,
  etag
FROM "ducklake"."aemo"."csv_archive_log"
    );
  
  
[0m11:10:08.818000 [debug] [Thread-1 (]: SQL status: OK in 10.102 seconds
[0m11:10:08.818000 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:10:08.818000 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'aemo'
      AND table_name = 'stg_csv_archive_log'
  
[0m11:10:08.837024 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m11:10:08.841055 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:10:08.841055 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'aemo'
      AND table_name = 'stg_csv_archive_log'
  
[0m11:10:08.845086 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:10:08.855171 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:10:08.855171 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */
alter table "ducklake"."aemo"."stg_csv_archive_log" rename to "stg_csv_archive_log__dbt_backup"
[0m11:10:08.859196 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:10:08.864972 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:10:08.864972 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */
alter table "ducklake"."aemo"."stg_csv_archive_log__dbt_tmp" rename to "stg_csv_archive_log"
[0m11:10:08.866981 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:10:08.868989 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: COMMIT
[0m11:10:08.870994 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:10:08.870994 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: COMMIT
[0m11:10:08.896541 [debug] [Thread-1 (]: SQL status: OK in 0.029 seconds
[0m11:10:08.896541 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:10:08.896541 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

      drop table if exists "ducklake"."aemo"."stg_csv_archive_log__dbt_backup"
    
[0m11:10:08.944552 [debug] [Thread-1 (]: SQL status: OK in 0.042 seconds
[0m11:10:08.949026 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: Close
[0m11:10:08.949026 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94412568-08ab-4d54-a15f-f12182a02a04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F5B32509D0>]}
[0m11:10:08.951032 [info ] [Thread-1 (]: 3 of 8 OK created sql table model aemo.stg_csv_archive_log ..................... [[32mOK[0m in 44.14s]
[0m11:10:08.951032 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.stg_csv_archive_log
[0m11:10:08.951032 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_price
[0m11:10:08.951032 [info ] [Thread-1 (]: 4 of 8 START sql incremental model aemo.fct_price .............................. [RUN]
[0m11:10:08.951032 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.stg_csv_archive_log, now model.aemo_electricity.fct_price)
[0m11:10:08.951032 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_price
[0m11:10:08.965157 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_price"
[0m11:10:08.965569 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_price
[0m11:10:08.965569 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_price"
[0m11:10:08.973683 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price"
[0m11:10:08.973683 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: BEGIN
[0m11:10:08.974685 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:10:08.975684 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:10:08.975684 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price"
[0m11:10:08.976682 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."stg_csv_archive_log"
  WHERE source_type = 'daily'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/daily/year=' || substring(source_filename, 14, 4) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

price_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'TOTALDEMAND': 'VARCHAR',
      'DEMANDFORECAST': 'VARCHAR',
      'DISPATCHABLEGENERATION': 'VARCHAR',
      'DISPATCHABLELOAD': 'VARCHAR',
      'NETINTERCHANGE': 'VARCHAR',
      'EXCESSGENERATION': 'VARCHAR',
      'LOWER5MINDISPATCH': 'VARCHAR',
      'LOWER5MINIMPORT': 'VARCHAR',
      'LOWER5MINLOCALDISPATCH': 'VARCHAR',
      'LOWER5MINLOCALPRICE': 'VARCHAR',
      'LOWER5MINLOCALREQ': 'VARCHAR',
      'LOWER5MINPRICE': 'VARCHAR',
      'LOWER5MINREQ': 'VARCHAR',
      'LOWER5MINSUPPLYPRICE': 'VARCHAR',
      'LOWER60SECDISPATCH': 'VARCHAR',
      'LOWER60SECIMPORT': 'VARCHAR',
      'LOWER60SECLOCALDISPATCH': 'VARCHAR',
      'LOWER60SECLOCALPRICE': 'VARCHAR',
      'LOWER60SECLOCALREQ': 'VARCHAR',
      'LOWER60SECPRICE': 'VARCHAR',
      'LOWER60SECREQ': 'VARCHAR',
      'LOWER60SECSUPPLYPRICE': 'VARCHAR',
      'LOWER6SECDISPATCH': 'VARCHAR',
      'LOWER6SECIMPORT': 'VARCHAR',
      'LOWER6SECLOCALDISPATCH': 'VARCHAR',
      'LOWER6SECLOCALPRICE': 'VARCHAR',
      'LOWER6SECLOCALREQ': 'VARCHAR',
      'LOWER6SECPRICE': 'VARCHAR',
      'LOWER6SECREQ': 'VARCHAR',
      'LOWER6SECSUPPLYPRICE': 'VARCHAR',
      'RAISE5MINDISPATCH': 'VARCHAR',
      'RAISE5MINIMPORT': 'VARCHAR',
      'RAISE5MINLOCALDISPATCH': 'VARCHAR',
      'RAISE5MINLOCALPRICE': 'VARCHAR',
      'RAISE5MINLOCALREQ': 'VARCHAR',
      'RAISE5MINPRICE': 'VARCHAR',
      'RAISE5MINREQ': 'VARCHAR',
      'RAISE5MINSUPPLYPRICE': 'VARCHAR',
      'RAISE60SECDISPATCH': 'VARCHAR',
      'RAISE60SECIMPORT': 'VARCHAR',
      'RAISE60SECLOCALDISPATCH': 'VARCHAR',
      'RAISE60SECLOCALPRICE': 'VARCHAR',
      'RAISE60SECLOCALREQ': 'VARCHAR',
      'RAISE60SECPRICE': 'VARCHAR',
      'RAISE60SECREQ': 'VARCHAR',
      'RAISE60SECSUPPLYPRICE': 'VARCHAR',
      'RAISE6SECDISPATCH': 'VARCHAR',
      'RAISE6SECIMPORT': 'VARCHAR',
      'RAISE6SECLOCALDISPATCH': 'VARCHAR',
      'RAISE6SECLOCALPRICE': 'VARCHAR',
      'RAISE6SECLOCALREQ': 'VARCHAR',
      'RAISE6SECPRICE': 'VARCHAR',
      'RAISE6SECREQ': 'VARCHAR',
      'RAISE6SECSUPPLYPRICE': 'VARCHAR',
      'AGGREGATEDISPATCHERROR': 'VARCHAR',
      'AVAILABLEGENERATION': 'VARCHAR',
      'AVAILABLELOAD': 'VARCHAR',
      'INITIALSUPPLY': 'VARCHAR',
      'CLEAREDSUPPLY': 'VARCHAR',
      'LOWERREGIMPORT': 'VARCHAR',
      'LOWERREGLOCALDISPATCH': 'VARCHAR',
      'LOWERREGLOCALREQ': 'VARCHAR',
      'LOWERREGREQ': 'VARCHAR',
      'RAISEREGIMPORT': 'VARCHAR',
      'RAISEREGLOCALDISPATCH': 'VARCHAR',
      'RAISEREGLOCALREQ': 'VARCHAR',
      'RAISEREGREQ': 'VARCHAR',
      'RAISE5MINLOCALVIOLATION': 'VARCHAR',
      'RAISEREGLOCALVIOLATION': 'VARCHAR',
      'RAISE60SECLOCALVIOLATION': 'VARCHAR',
      'RAISE6SECLOCALVIOLATION': 'VARCHAR',
      'LOWER5MINLOCALVIOLATION': 'VARCHAR',
      'LOWERREGLOCALVIOLATION': 'VARCHAR',
      'LOWER60SECLOCALVIOLATION': 'VARCHAR',
      'LOWER6SECLOCALVIOLATION': 'VARCHAR',
      'RAISE5MINVIOLATION': 'VARCHAR',
      'RAISEREGVIOLATION': 'VARCHAR',
      'RAISE60SECVIOLATION': 'VARCHAR',
      'RAISE6SECVIOLATION': 'VARCHAR',
      'LOWER5MINVIOLATION': 'VARCHAR',
      'LOWERREGVIOLATION': 'VARCHAR',
      'LOWER60SECVIOLATION': 'VARCHAR',
      'LOWER6SECVIOLATION': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR',
      'LORSURPLUS': 'VARCHAR',
      'LRCSURPLUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DREGION' AND VERSION = '3'
)

SELECT
  UNIT,
  REGIONID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(TOTALDEMAND AS DOUBLE) AS TOTALDEMAND,
  CAST(DEMANDFORECAST AS DOUBLE) AS DEMANDFORECAST,
  CAST(DISPATCHABLEGENERATION AS DOUBLE) AS DISPATCHABLEGENERATION,
  CAST(DISPATCHABLELOAD AS DOUBLE) AS DISPATCHABLELOAD,
  CAST(NETINTERCHANGE AS DOUBLE) AS NETINTERCHANGE,
  CAST(EXCESSGENERATION AS DOUBLE) AS EXCESSGENERATION,
  CAST(LOWER5MINDISPATCH AS DOUBLE) AS LOWER5MINDISPATCH,
  CAST(LOWER5MINIMPORT AS DOUBLE) AS LOWER5MINIMPORT,
  CAST(LOWER5MINLOCALDISPATCH AS DOUBLE) AS LOWER5MINLOCALDISPATCH,
  CAST(LOWER5MINLOCALPRICE AS DOUBLE) AS LOWER5MINLOCALPRICE,
  CAST(LOWER5MINLOCALREQ AS DOUBLE) AS LOWER5MINLOCALREQ,
  CAST(LOWER5MINPRICE AS DOUBLE) AS LOWER5MINPRICE,
  CAST(LOWER5MINREQ AS DOUBLE) AS LOWER5MINREQ,
  CAST(LOWER5MINSUPPLYPRICE AS DOUBLE) AS LOWER5MINSUPPLYPRICE,
  CAST(LOWER60SECDISPATCH AS DOUBLE) AS LOWER60SECDISPATCH,
  CAST(LOWER60SECIMPORT AS DOUBLE) AS LOWER60SECIMPORT,
  CAST(LOWER60SECLOCALDISPATCH AS DOUBLE) AS LOWER60SECLOCALDISPATCH,
  CAST(LOWER60SECLOCALPRICE AS DOUBLE) AS LOWER60SECLOCALPRICE,
  CAST(LOWER60SECLOCALREQ AS DOUBLE) AS LOWER60SECLOCALREQ,
  CAST(LOWER60SECPRICE AS DOUBLE) AS LOWER60SECPRICE,
  CAST(LOWER60SECREQ AS DOUBLE) AS LOWER60SECREQ,
  CAST(LOWER60SECSUPPLYPRICE AS DOUBLE) AS LOWER60SECSUPPLYPRICE,
  CAST(LOWER6SECDISPATCH AS DOUBLE) AS LOWER6SECDISPATCH,
  CAST(LOWER6SECIMPORT AS DOUBLE) AS LOWER6SECIMPORT,
  CAST(LOWER6SECLOCALDISPATCH AS DOUBLE) AS LOWER6SECLOCALDISPATCH,
  CAST(LOWER6SECLOCALPRICE AS DOUBLE) AS LOWER6SECLOCALPRICE,
  CAST(LOWER6SECLOCALREQ AS DOUBLE) AS LOWER6SECLOCALREQ,
  CAST(LOWER6SECPRICE AS DOUBLE) AS LOWER6SECPRICE,
  CAST(LOWER6SECREQ AS DOUBLE) AS LOWER6SECREQ,
  CAST(LOWER6SECSUPPLYPRICE AS DOUBLE) AS LOWER6SECSUPPLYPRICE,
  CAST(RAISE5MINDISPATCH AS DOUBLE) AS RAISE5MINDISPATCH,
  CAST(RAISE5MINIMPORT AS DOUBLE) AS RAISE5MINIMPORT,
  CAST(RAISE5MINLOCALDISPATCH AS DOUBLE) AS RAISE5MINLOCALDISPATCH,
  CAST(RAISE5MINLOCALPRICE AS DOUBLE) AS RAISE5MINLOCALPRICE,
  CAST(RAISE5MINLOCALREQ AS DOUBLE) AS RAISE5MINLOCALREQ,
  CAST(RAISE5MINPRICE AS DOUBLE) AS RAISE5MINPRICE,
  CAST(RAISE5MINREQ AS DOUBLE) AS RAISE5MINREQ,
  CAST(RAISE5MINSUPPLYPRICE AS DOUBLE) AS RAISE5MINSUPPLYPRICE,
  CAST(RAISE60SECDISPATCH AS DOUBLE) AS RAISE60SECDISPATCH,
  CAST(RAISE60SECIMPORT AS DOUBLE) AS RAISE60SECIMPORT,
  CAST(RAISE60SECLOCALDISPATCH AS DOUBLE) AS RAISE60SECLOCALDISPATCH,
  CAST(RAISE60SECLOCALPRICE AS DOUBLE) AS RAISE60SECLOCALPRICE,
  CAST(RAISE60SECLOCALREQ AS DOUBLE) AS RAISE60SECLOCALREQ,
  CAST(RAISE60SECPRICE AS DOUBLE) AS RAISE60SECPRICE,
  CAST(RAISE60SECREQ AS DOUBLE) AS RAISE60SECREQ,
  CAST(RAISE60SECSUPPLYPRICE AS DOUBLE) AS RAISE60SECSUPPLYPRICE,
  CAST(RAISE6SECDISPATCH AS DOUBLE) AS RAISE6SECDISPATCH,
  CAST(RAISE6SECIMPORT AS DOUBLE) AS RAISE6SECIMPORT,
  CAST(RAISE6SECLOCALDISPATCH AS DOUBLE) AS RAISE6SECLOCALDISPATCH,
  CAST(RAISE6SECLOCALPRICE AS DOUBLE) AS RAISE6SECLOCALPRICE,
  CAST(RAISE6SECLOCALREQ AS DOUBLE) AS RAISE6SECLOCALREQ,
  CAST(RAISE6SECPRICE AS DOUBLE) AS RAISE6SECPRICE,
  CAST(RAISE6SECREQ AS DOUBLE) AS RAISE6SECREQ,
  CAST(RAISE6SECSUPPLYPRICE AS DOUBLE) AS RAISE6SECSUPPLYPRICE,
  CAST(AGGREGATEDISPATCHERROR AS DOUBLE) AS AGGREGATEDISPATCHERROR,
  CAST(AVAILABLEGENERATION AS DOUBLE) AS AVAILABLEGENERATION,
  CAST(AVAILABLELOAD AS DOUBLE) AS AVAILABLELOAD,
  CAST(INITIALSUPPLY AS DOUBLE) AS INITIALSUPPLY,
  CAST(CLEAREDSUPPLY AS DOUBLE) AS CLEAREDSUPPLY,
  CAST(LOWERREGIMPORT AS DOUBLE) AS LOWERREGIMPORT,
  CAST(LOWERREGLOCALDISPATCH AS DOUBLE) AS LOWERREGLOCALDISPATCH,
  CAST(LOWERREGLOCALREQ AS DOUBLE) AS LOWERREGLOCALREQ,
  CAST(LOWERREGREQ AS DOUBLE) AS LOWERREGREQ,
  CAST(RAISEREGIMPORT AS DOUBLE) AS RAISEREGIMPORT,
  CAST(RAISEREGLOCALDISPATCH AS DOUBLE) AS RAISEREGLOCALDISPATCH,
  CAST(RAISEREGLOCALREQ AS DOUBLE) AS RAISEREGLOCALREQ,
  CAST(RAISEREGREQ AS DOUBLE) AS RAISEREGREQ,
  CAST(RAISE5MINLOCALVIOLATION AS DOUBLE) AS RAISE5MINLOCALVIOLATION,
  CAST(RAISEREGLOCALVIOLATION AS DOUBLE) AS RAISEREGLOCALVIOLATION,
  CAST(RAISE60SECLOCALVIOLATION AS DOUBLE) AS RAISE60SECLOCALVIOLATION,
  CAST(RAISE6SECLOCALVIOLATION AS DOUBLE) AS RAISE6SECLOCALVIOLATION,
  CAST(LOWER5MINLOCALVIOLATION AS DOUBLE) AS LOWER5MINLOCALVIOLATION,
  CAST(LOWERREGLOCALVIOLATION AS DOUBLE) AS LOWERREGLOCALVIOLATION,
  CAST(LOWER60SECLOCALVIOLATION AS DOUBLE) AS LOWER60SECLOCALVIOLATION,
  CAST(LOWER6SECLOCALVIOLATION AS DOUBLE) AS LOWER6SECLOCALVIOLATION,
  CAST(RAISE5MINVIOLATION AS DOUBLE) AS RAISE5MINVIOLATION,
  CAST(RAISEREGVIOLATION AS DOUBLE) AS RAISEREGVIOLATION,
  CAST(RAISE60SECVIOLATION AS DOUBLE) AS RAISE60SECVIOLATION,
  CAST(RAISE6SECVIOLATION AS DOUBLE) AS RAISE6SECVIOLATION,
  CAST(LOWER5MINVIOLATION AS DOUBLE) AS LOWER5MINVIOLATION,
  CAST(LOWERREGVIOLATION AS DOUBLE) AS LOWERREGVIOLATION,
  CAST(LOWER60SECVIOLATION AS DOUBLE) AS LOWER60SECVIOLATION,
  CAST(LOWER6SECVIOLATION AS DOUBLE) AS LOWER6SECVIOLATION,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  CAST(LORSURPLUS AS DOUBLE) AS LORSURPLUS,
  CAST(LRCSURPLUS AS DOUBLE) AS LRCSURPLUS,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m11:10:09.011820 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."stg_csv_archive_log"
  WHERE source_type = 'daily'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/daily/year=' || substring(source_filename, 14, 4) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

price_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'TOTALDEMAND': 'VARCHAR',
      'DEMANDFORECAST': 'VARCHAR',
      'DISPATCHABLEGENERATION': 'VARCHAR',
      'DISPATCHABLELOAD': 'VARCHAR',
      'NETINTERCHANGE': 'VARCHAR',
      'EXCESSGENERATION': 'VARCHAR',
      'LOWER5MINDISPATCH': 'VARCHAR',
      'LOWER5MINIMPORT': 'VARCHAR',
      'LOWER5MINLOCALDISPATCH': 'VARCHAR',
      'LOWER5MINLOCALPRICE': 'VARCHAR',
      'LOWER5MINLOCALREQ': 'VARCHAR',
      'LOWER5MINPRICE': 'VARCHAR',
      'LOWER5MINREQ': 'VARCHAR',
      'LOWER5MINSUPPLYPRICE': 'VARCHAR',
      'LOWER60SECDISPATCH': 'VARCHAR',
      'LOWER60SECIMPORT': 'VARCHAR',
      'LOWER60SECLOCALDISPATCH': 'VARCHAR',
      'LOWER60SECLOCALPRICE': 'VARCHAR',
      'LOWER60SECLOCALREQ': 'VARCHAR',
      'LOWER60SECPRICE': 'VARCHAR',
      'LOWER60SECREQ': 'VARCHAR',
      'LOWER60SECSUPPLYPRICE': 'VARCHAR',
      'LOWER6SECDISPATCH': 'VARCHAR',
      'LOWER6SECIMPORT': 'VARCHAR',
      'LOWER6SECLOCALDISPATCH': 'VARCHAR',
      'LOWER6SECLOCALPRICE': 'VARCHAR',
      'LOWER6SECLOCALREQ': 'VARCHAR',
      'LOWER6SECPRICE': 'VARCHAR',
      'LOWER6SECREQ': 'VARCHAR',
      'LOWER6SECSUPPLYPRICE': 'VARCHAR',
      'RAISE5MINDISPATCH': 'VARCHAR',
      'RAISE5MINIMPORT': 'VARCHAR',
      'RAISE5MINLOCALDISPATCH': 'VARCHAR',
      'RAISE5MINLOCALPRICE': 'VARCHAR',
      'RAISE5MINLOCALREQ': 'VARCHAR',
      'RAISE5MINPRICE': 'VARCHAR',
      'RAISE5MINREQ': 'VARCHAR',
      'RAISE5MINSUPPLYPRICE': 'VARCHAR',
      'RAISE60SECDISPATCH': 'VARCHAR',
      'RAISE60SECIMPORT': 'VARCHAR',
      'RAISE60SECLOCALDISPATCH': 'VARCHAR',
      'RAISE60SECLOCALPRICE': 'VARCHAR',
      'RAISE60SECLOCALREQ': 'VARCHAR',
      'RAISE60SECPRICE': 'VARCHAR',
      'RAISE60SECREQ': 'VARCHAR',
      'RAISE60SECSUPPLYPRICE': 'VARCHAR',
      'RAISE6SECDISPATCH': 'VARCHAR',
      'RAISE6SECIMPORT': 'VARCHAR',
      'RAISE6SECLOCALDISPATCH': 'VARCHAR',
      'RAISE6SECLOCALPRICE': 'VARCHAR',
      'RAISE6SECLOCALREQ': 'VARCHAR',
      'RAISE6SECPRICE': 'VARCHAR',
      'RAISE6SECREQ': 'VARCHAR',
      'RAISE6SECSUPPLYPRICE': 'VARCHAR',
      'AGGREGATEDISPATCHERROR': 'VARCHAR',
      'AVAILABLEGENERATION': 'VARCHAR',
      'AVAILABLELOAD': 'VARCHAR',
      'INITIALSUPPLY': 'VARCHAR',
      'CLEAREDSUPPLY': 'VARCHAR',
      'LOWERREGIMPORT': 'VARCHAR',
      'LOWERREGLOCALDISPATCH': 'VARCHAR',
      'LOWERREGLOCALREQ': 'VARCHAR',
      'LOWERREGREQ': 'VARCHAR',
      'RAISEREGIMPORT': 'VARCHAR',
      'RAISEREGLOCALDISPATCH': 'VARCHAR',
      'RAISEREGLOCALREQ': 'VARCHAR',
      'RAISEREGREQ': 'VARCHAR',
      'RAISE5MINLOCALVIOLATION': 'VARCHAR',
      'RAISEREGLOCALVIOLATION': 'VARCHAR',
      'RAISE60SECLOCALVIOLATION': 'VARCHAR',
      'RAISE6SECLOCALVIOLATION': 'VARCHAR',
      'LOWER5MINLOCALVIOLATION': 'VARCHAR',
      'LOWERREGLOCALVIOLATION': 'VARCHAR',
      'LOWER60SECLOCALVIOLATION': 'VARCHAR',
      'LOWER6SECLOCALVIOLATION': 'VARCHAR',
      'RAISE5MINVIOLATION': 'VARCHAR',
      'RAISEREGVIOLATION': 'VARCHAR',
      'RAISE60SECVIOLATION': 'VARCHAR',
      'RAISE6SECVIOLATION': 'VARCHAR',
      'LOWER5MINVIOLATION': 'VARCHAR',
      'LOWERREGVIOLATION': 'VARCHAR',
      'LOWER60SECVIOLATION': 'VARCHAR',
      'LOWER6SECVIOLATION': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR',
      'LORSURPLUS': 'VARCHAR',
      'LRCSURPLUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DREGION' AND VERSION = '3'
)

SELECT
  UNIT,
  REGIONID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(TOTALDEMAND AS DOUBLE) AS TOTALDEMAND,
  CAST(DEMANDFORECAST AS DOUBLE) AS DEMANDFORECAST,
  CAST(DISPATCHABLEGENERATION AS DOUBLE) AS DISPATCHABLEGENERATION,
  CAST(DISPATCHABLELOAD AS DOUBLE) AS DISPATCHABLELOAD,
  CAST(NETINTERCHANGE AS DOUBLE) AS NETINTERCHANGE,
  CAST(EXCESSGENERATION AS DOUBLE) AS EXCESSGENERATION,
  CAST(LOWER5MINDISPATCH AS DOUBLE) AS LOWER5MINDISPATCH,
  CAST(LOWER5MINIMPORT AS DOUBLE) AS LOWER5MINIMPORT,
  CAST(LOWER5MINLOCALDISPATCH AS DOUBLE) AS LOWER5MINLOCALDISPATCH,
  CAST(LOWER5MINLOCALPRICE AS DOUBLE) AS LOWER5MINLOCALPRICE,
  CAST(LOWER5MINLOCALREQ AS DOUBLE) AS LOWER5MINLOCALREQ,
  CAST(LOWER5MINPRICE AS DOUBLE) AS LOWER5MINPRICE,
  CAST(LOWER5MINREQ AS DOUBLE) AS LOWER5MINREQ,
  CAST(LOWER5MINSUPPLYPRICE AS DOUBLE) AS LOWER5MINSUPPLYPRICE,
  CAST(LOWER60SECDISPATCH AS DOUBLE) AS LOWER60SECDISPATCH,
  CAST(LOWER60SECIMPORT AS DOUBLE) AS LOWER60SECIMPORT,
  CAST(LOWER60SECLOCALDISPATCH AS DOUBLE) AS LOWER60SECLOCALDISPATCH,
  CAST(LOWER60SECLOCALPRICE AS DOUBLE) AS LOWER60SECLOCALPRICE,
  CAST(LOWER60SECLOCALREQ AS DOUBLE) AS LOWER60SECLOCALREQ,
  CAST(LOWER60SECPRICE AS DOUBLE) AS LOWER60SECPRICE,
  CAST(LOWER60SECREQ AS DOUBLE) AS LOWER60SECREQ,
  CAST(LOWER60SECSUPPLYPRICE AS DOUBLE) AS LOWER60SECSUPPLYPRICE,
  CAST(LOWER6SECDISPATCH AS DOUBLE) AS LOWER6SECDISPATCH,
  CAST(LOWER6SECIMPORT AS DOUBLE) AS LOWER6SECIMPORT,
  CAST(LOWER6SECLOCALDISPATCH AS DOUBLE) AS LOWER6SECLOCALDISPATCH,
  CAST(LOWER6SECLOCALPRICE AS DOUBLE) AS LOWER6SECLOCALPRICE,
  CAST(LOWER6SECLOCALREQ AS DOUBLE) AS LOWER6SECLOCALREQ,
  CAST(LOWER6SECPRICE AS DOUBLE) AS LOWER6SECPRICE,
  CAST(LOWER6SECREQ AS DOUBLE) AS LOWER6SECREQ,
  CAST(LOWER6SECSUPPLYPRICE AS DOUBLE) AS LOWER6SECSUPPLYPRICE,
  CAST(RAISE5MINDISPATCH AS DOUBLE) AS RAISE5MINDISPATCH,
  CAST(RAISE5MINIMPORT AS DOUBLE) AS RAISE5MINIMPORT,
  CAST(RAISE5MINLOCALDISPATCH AS DOUBLE) AS RAISE5MINLOCALDISPATCH,
  CAST(RAISE5MINLOCALPRICE AS DOUBLE) AS RAISE5MINLOCALPRICE,
  CAST(RAISE5MINLOCALREQ AS DOUBLE) AS RAISE5MINLOCALREQ,
  CAST(RAISE5MINPRICE AS DOUBLE) AS RAISE5MINPRICE,
  CAST(RAISE5MINREQ AS DOUBLE) AS RAISE5MINREQ,
  CAST(RAISE5MINSUPPLYPRICE AS DOUBLE) AS RAISE5MINSUPPLYPRICE,
  CAST(RAISE60SECDISPATCH AS DOUBLE) AS RAISE60SECDISPATCH,
  CAST(RAISE60SECIMPORT AS DOUBLE) AS RAISE60SECIMPORT,
  CAST(RAISE60SECLOCALDISPATCH AS DOUBLE) AS RAISE60SECLOCALDISPATCH,
  CAST(RAISE60SECLOCALPRICE AS DOUBLE) AS RAISE60SECLOCALPRICE,
  CAST(RAISE60SECLOCALREQ AS DOUBLE) AS RAISE60SECLOCALREQ,
  CAST(RAISE60SECPRICE AS DOUBLE) AS RAISE60SECPRICE,
  CAST(RAISE60SECREQ AS DOUBLE) AS RAISE60SECREQ,
  CAST(RAISE60SECSUPPLYPRICE AS DOUBLE) AS RAISE60SECSUPPLYPRICE,
  CAST(RAISE6SECDISPATCH AS DOUBLE) AS RAISE6SECDISPATCH,
  CAST(RAISE6SECIMPORT AS DOUBLE) AS RAISE6SECIMPORT,
  CAST(RAISE6SECLOCALDISPATCH AS DOUBLE) AS RAISE6SECLOCALDISPATCH,
  CAST(RAISE6SECLOCALPRICE AS DOUBLE) AS RAISE6SECLOCALPRICE,
  CAST(RAISE6SECLOCALREQ AS DOUBLE) AS RAISE6SECLOCALREQ,
  CAST(RAISE6SECPRICE AS DOUBLE) AS RAISE6SECPRICE,
  CAST(RAISE6SECREQ AS DOUBLE) AS RAISE6SECREQ,
  CAST(RAISE6SECSUPPLYPRICE AS DOUBLE) AS RAISE6SECSUPPLYPRICE,
  CAST(AGGREGATEDISPATCHERROR AS DOUBLE) AS AGGREGATEDISPATCHERROR,
  CAST(AVAILABLEGENERATION AS DOUBLE) AS AVAILABLEGENERATION,
  CAST(AVAILABLELOAD AS DOUBLE) AS AVAILABLELOAD,
  CAST(INITIALSUPPLY AS DOUBLE) AS INITIALSUPPLY,
  CAST(CLEAREDSUPPLY AS DOUBLE) AS CLEAREDSUPPLY,
  CAST(LOWERREGIMPORT AS DOUBLE) AS LOWERREGIMPORT,
  CAST(LOWERREGLOCALDISPATCH AS DOUBLE) AS LOWERREGLOCALDISPATCH,
  CAST(LOWERREGLOCALREQ AS DOUBLE) AS LOWERREGLOCALREQ,
  CAST(LOWERREGREQ AS DOUBLE) AS LOWERREGREQ,
  CAST(RAISEREGIMPORT AS DOUBLE) AS RAISEREGIMPORT,
  CAST(RAISEREGLOCALDISPATCH AS DOUBLE) AS RAISEREGLOCALDISPATCH,
  CAST(RAISEREGLOCALREQ AS DOUBLE) AS RAISEREGLOCALREQ,
  CAST(RAISEREGREQ AS DOUBLE) AS RAISEREGREQ,
  CAST(RAISE5MINLOCALVIOLATION AS DOUBLE) AS RAISE5MINLOCALVIOLATION,
  CAST(RAISEREGLOCALVIOLATION AS DOUBLE) AS RAISEREGLOCALVIOLATION,
  CAST(RAISE60SECLOCALVIOLATION AS DOUBLE) AS RAISE60SECLOCALVIOLATION,
  CAST(RAISE6SECLOCALVIOLATION AS DOUBLE) AS RAISE6SECLOCALVIOLATION,
  CAST(LOWER5MINLOCALVIOLATION AS DOUBLE) AS LOWER5MINLOCALVIOLATION,
  CAST(LOWERREGLOCALVIOLATION AS DOUBLE) AS LOWERREGLOCALVIOLATION,
  CAST(LOWER60SECLOCALVIOLATION AS DOUBLE) AS LOWER60SECLOCALVIOLATION,
  CAST(LOWER6SECLOCALVIOLATION AS DOUBLE) AS LOWER6SECLOCALVIOLATION,
  CAST(RAISE5MINVIOLATION AS DOUBLE) AS RAISE5MINVIOLATION,
  CAST(RAISEREGVIOLATION AS DOUBLE) AS RAISEREGVIOLATION,
  CAST(RAISE60SECVIOLATION AS DOUBLE) AS RAISE60SECVIOLATION,
  CAST(RAISE6SECVIOLATION AS DOUBLE) AS RAISE6SECVIOLATION,
  CAST(LOWER5MINVIOLATION AS DOUBLE) AS LOWER5MINVIOLATION,
  CAST(LOWERREGVIOLATION AS DOUBLE) AS LOWERREGVIOLATION,
  CAST(LOWER60SECVIOLATION AS DOUBLE) AS LOWER60SECVIOLATION,
  CAST(LOWER6SECVIOLATION AS DOUBLE) AS LOWER6SECVIOLATION,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  CAST(LORSURPLUS AS DOUBLE) AS LORSURPLUS,
  CAST(LRCSURPLUS AS DOUBLE) AS LRCSURPLUS,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m11:10:09.011820 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m11:10:09.013825 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: ROLLBACK
[0m11:10:09.024217 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_price'
[0m11:10:09.027587 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: Close
[0m11:10:09.031100 [debug] [Thread-1 (]: Runtime Error in model fct_price (models\marts\fct_price.sql)
  Binder Error: Table function cannot contain subqueries
[0m11:10:09.031100 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94412568-08ab-4d54-a15f-f12182a02a04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F5B3D09690>]}
[0m11:10:09.032196 [error] [Thread-1 (]: 4 of 8 ERROR creating sql incremental model aemo.fct_price ..................... [[31mERROR[0m in 0.08s]
[0m11:10:09.034216 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_price
[0m11:10:09.034216 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_price_today
[0m11:10:09.035117 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_price' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_price (models\marts\fct_price.sql)
  Binder Error: Table function cannot contain subqueries.
[0m11:10:09.036106 [info ] [Thread-1 (]: 5 of 8 START sql incremental model aemo.fct_price_today ........................ [RUN]
[0m11:10:09.038110 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.fct_price, now model.aemo_electricity.fct_price_today)
[0m11:10:09.038110 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_price_today
[0m11:10:09.043391 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_price_today"
[0m11:10:09.044393 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_price_today
[0m11:10:09.047810 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_price_today"
[0m11:10:09.049839 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price_today"
[0m11:10:09.050820 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: BEGIN
[0m11:10:09.051715 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:10:09.051715 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:10:09.051715 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price_today"
[0m11:10:09.056931 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price_today"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."stg_csv_archive_log"
  WHERE source_type = 'price_today'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/price_today/day=' || substring(source_filename, 19, 8) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

price_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'PRICE': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'DISPATCHINTERVAL': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'LASTCHANGED': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'PRICE_STATUS': 'VARCHAR',
      'PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'RAISE1SECRRP': 'VARCHAR',
      'RAISE1SECROP': 'VARCHAR',
      'RAISE1SECAPCFLAG': 'VARCHAR',
      'LOWER1SECRRP': 'VARCHAR',
      'LOWER1SECROP': 'VARCHAR',
      'LOWER1SECAPCFLAG': 'VARCHAR',
      'PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'OCD_STATUS': 'VARCHAR',
      'MII_STATUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND PRICE = 'PRICE'
)

SELECT
  REGIONID,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(DISPATCHINTERVAL AS DOUBLE) AS DISPATCHINTERVAL,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(PRE_AP_ENERGY_PRICE AS DOUBLE) AS PRE_AP_ENERGY_PRICE,
  CAST(PRE_AP_RAISE6_PRICE AS DOUBLE) AS PRE_AP_RAISE6_PRICE,
  CAST(PRE_AP_RAISE60_PRICE AS DOUBLE) AS PRE_AP_RAISE60_PRICE,
  CAST(PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS PRE_AP_RAISE5MIN_PRICE,
  CAST(PRE_AP_RAISEREG_PRICE AS DOUBLE) AS PRE_AP_RAISEREG_PRICE,
  CAST(PRE_AP_LOWER6_PRICE AS DOUBLE) AS PRE_AP_LOWER6_PRICE,
  CAST(PRE_AP_LOWER60_PRICE AS DOUBLE) AS PRE_AP_LOWER60_PRICE,
  CAST(PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS PRE_AP_LOWER5MIN_PRICE,
  CAST(PRE_AP_LOWERREG_PRICE AS DOUBLE) AS PRE_AP_LOWERREG_PRICE,
  CAST(RAISE1SECRRP AS DOUBLE) AS RAISE1SECRRP,
  CAST(RAISE1SECROP AS DOUBLE) AS RAISE1SECROP,
  CAST(RAISE1SECAPCFLAG AS DOUBLE) AS RAISE1SECAPCFLAG,
  CAST(LOWER1SECRRP AS DOUBLE) AS LOWER1SECRRP,
  CAST(LOWER1SECROP AS DOUBLE) AS LOWER1SECROP,
  CAST(LOWER1SECAPCFLAG AS DOUBLE) AS LOWER1SECAPCFLAG,
  CAST(PRE_AP_RAISE1_PRICE AS DOUBLE) AS PRE_AP_RAISE1_PRICE,
  CAST(PRE_AP_LOWER1_PRICE AS DOUBLE) AS PRE_AP_LOWER1_PRICE,
  CAST(CUMUL_PRE_AP_ENERGY_PRICE AS DOUBLE) AS CUMUL_PRE_AP_ENERGY_PRICE,
  CAST(CUMUL_PRE_AP_RAISE6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE6_PRICE,
  CAST(CUMUL_PRE_AP_RAISE60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE60_PRICE,
  CAST(CUMUL_PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE5MIN_PRICE,
  CAST(CUMUL_PRE_AP_RAISEREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISEREG_PRICE,
  CAST(CUMUL_PRE_AP_LOWER6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER6_PRICE,
  CAST(CUMUL_PRE_AP_LOWER60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER60_PRICE,
  CAST(CUMUL_PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER5MIN_PRICE,
  CAST(CUMUL_PRE_AP_LOWERREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWERREG_PRICE,
  CAST(CUMUL_PRE_AP_RAISE1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE1_PRICE,
  CAST(CUMUL_PRE_AP_LOWER1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER1_PRICE,
  SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m11:10:09.065354 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price_today"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."stg_csv_archive_log"
  WHERE source_type = 'price_today'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/price_today/day=' || substring(source_filename, 19, 8) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

price_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'PRICE': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'DISPATCHINTERVAL': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'LASTCHANGED': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'PRICE_STATUS': 'VARCHAR',
      'PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'RAISE1SECRRP': 'VARCHAR',
      'RAISE1SECROP': 'VARCHAR',
      'RAISE1SECAPCFLAG': 'VARCHAR',
      'LOWER1SECRRP': 'VARCHAR',
      'LOWER1SECROP': 'VARCHAR',
      'LOWER1SECAPCFLAG': 'VARCHAR',
      'PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'OCD_STATUS': 'VARCHAR',
      'MII_STATUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND PRICE = 'PRICE'
)

SELECT
  REGIONID,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(DISPATCHINTERVAL AS DOUBLE) AS DISPATCHINTERVAL,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(PRE_AP_ENERGY_PRICE AS DOUBLE) AS PRE_AP_ENERGY_PRICE,
  CAST(PRE_AP_RAISE6_PRICE AS DOUBLE) AS PRE_AP_RAISE6_PRICE,
  CAST(PRE_AP_RAISE60_PRICE AS DOUBLE) AS PRE_AP_RAISE60_PRICE,
  CAST(PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS PRE_AP_RAISE5MIN_PRICE,
  CAST(PRE_AP_RAISEREG_PRICE AS DOUBLE) AS PRE_AP_RAISEREG_PRICE,
  CAST(PRE_AP_LOWER6_PRICE AS DOUBLE) AS PRE_AP_LOWER6_PRICE,
  CAST(PRE_AP_LOWER60_PRICE AS DOUBLE) AS PRE_AP_LOWER60_PRICE,
  CAST(PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS PRE_AP_LOWER5MIN_PRICE,
  CAST(PRE_AP_LOWERREG_PRICE AS DOUBLE) AS PRE_AP_LOWERREG_PRICE,
  CAST(RAISE1SECRRP AS DOUBLE) AS RAISE1SECRRP,
  CAST(RAISE1SECROP AS DOUBLE) AS RAISE1SECROP,
  CAST(RAISE1SECAPCFLAG AS DOUBLE) AS RAISE1SECAPCFLAG,
  CAST(LOWER1SECRRP AS DOUBLE) AS LOWER1SECRRP,
  CAST(LOWER1SECROP AS DOUBLE) AS LOWER1SECROP,
  CAST(LOWER1SECAPCFLAG AS DOUBLE) AS LOWER1SECAPCFLAG,
  CAST(PRE_AP_RAISE1_PRICE AS DOUBLE) AS PRE_AP_RAISE1_PRICE,
  CAST(PRE_AP_LOWER1_PRICE AS DOUBLE) AS PRE_AP_LOWER1_PRICE,
  CAST(CUMUL_PRE_AP_ENERGY_PRICE AS DOUBLE) AS CUMUL_PRE_AP_ENERGY_PRICE,
  CAST(CUMUL_PRE_AP_RAISE6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE6_PRICE,
  CAST(CUMUL_PRE_AP_RAISE60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE60_PRICE,
  CAST(CUMUL_PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE5MIN_PRICE,
  CAST(CUMUL_PRE_AP_RAISEREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISEREG_PRICE,
  CAST(CUMUL_PRE_AP_LOWER6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER6_PRICE,
  CAST(CUMUL_PRE_AP_LOWER60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER60_PRICE,
  CAST(CUMUL_PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER5MIN_PRICE,
  CAST(CUMUL_PRE_AP_LOWERREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWERREG_PRICE,
  CAST(CUMUL_PRE_AP_RAISE1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE1_PRICE,
  CAST(CUMUL_PRE_AP_LOWER1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER1_PRICE,
  SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m11:10:09.066366 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m11:10:09.067365 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: ROLLBACK
[0m11:10:09.068894 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_price_today'
[0m11:10:09.068894 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: Close
[0m11:10:09.077266 [debug] [Thread-1 (]: Runtime Error in model fct_price_today (models\marts\fct_price_today.sql)
  Binder Error: Table function cannot contain subqueries
[0m11:10:09.077266 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94412568-08ab-4d54-a15f-f12182a02a04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F5B3DFE110>]}
[0m11:10:09.077266 [error] [Thread-1 (]: 5 of 8 ERROR creating sql incremental model aemo.fct_price_today ............... [[31mERROR[0m in 0.04s]
[0m11:10:09.077266 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_price_today
[0m11:10:09.081012 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_scada
[0m11:10:09.081012 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_price_today' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_price_today (models\marts\fct_price_today.sql)
  Binder Error: Table function cannot contain subqueries.
[0m11:10:09.082023 [info ] [Thread-1 (]: 6 of 8 START sql incremental model aemo.fct_scada .............................. [RUN]
[0m11:10:09.083747 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.fct_price_today, now model.aemo_electricity.fct_scada)
[0m11:10:09.083747 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_scada
[0m11:10:09.088538 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_scada"
[0m11:10:09.089745 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_scada
[0m11:10:09.092752 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_scada"
[0m11:10:09.094749 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada"
[0m11:10:09.095750 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: BEGIN
[0m11:10:09.095750 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:10:09.097468 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:10:09.097468 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada"
[0m11:10:09.098706 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."stg_csv_archive_log"
  WHERE source_type = 'daily'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/daily/year=' || substring(source_filename, 14, 4) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

scada_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'DUID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'DISPATCHMODE': 'VARCHAR',
      'AGCSTATUS': 'VARCHAR',
      'INITIALMW': 'VARCHAR',
      'TOTALCLEARED': 'VARCHAR',
      'RAMPDOWNRATE': 'VARCHAR',
      'RAMPUPRATE': 'VARCHAR',
      'LOWER5MIN': 'VARCHAR',
      'LOWER60SEC': 'VARCHAR',
      'LOWER6SEC': 'VARCHAR',
      'RAISE5MIN': 'VARCHAR',
      'RAISE60SEC': 'VARCHAR',
      'RAISE6SEC': 'VARCHAR',
      'MARGINAL5MINVALUE': 'VARCHAR',
      'MARGINAL60SECVALUE': 'VARCHAR',
      'MARGINAL6SECVALUE': 'VARCHAR',
      'MARGINALVALUE': 'VARCHAR',
      'VIOLATION5MINDEGREE': 'VARCHAR',
      'VIOLATION60SECDEGREE': 'VARCHAR',
      'VIOLATION6SECDEGREE': 'VARCHAR',
      'VIOLATIONDEGREE': 'VARCHAR',
      'LOWERREG': 'VARCHAR',
      'RAISEREG': 'VARCHAR',
      'AVAILABILITY': 'VARCHAR',
      'RAISE6SECFLAGS': 'VARCHAR',
      'RAISE60SECFLAGS': 'VARCHAR',
      'RAISE5MINFLAGS': 'VARCHAR',
      'RAISEREGFLAGS': 'VARCHAR',
      'LOWER6SECFLAGS': 'VARCHAR',
      'LOWER60SECFLAGS': 'VARCHAR',
      'LOWER5MINFLAGS': 'VARCHAR',
      'LOWERREGFLAGS': 'VARCHAR',
      'RAISEREGAVAILABILITY': 'VARCHAR',
      'RAISEREGENABLEMENTMAX': 'VARCHAR',
      'RAISEREGENABLEMENTMIN': 'VARCHAR',
      'LOWERREGAVAILABILITY': 'VARCHAR',
      'LOWERREGENABLEMENTMAX': 'VARCHAR',
      'LOWERREGENABLEMENTMIN': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DUNIT' AND VERSION = '3'
)

SELECT
  UNIT,
  DUID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(DISPATCHMODE AS DOUBLE) AS DISPATCHMODE,
  CAST(AGCSTATUS AS DOUBLE) AS AGCSTATUS,
  CAST(INITIALMW AS DOUBLE) AS INITIALMW,
  CAST(TOTALCLEARED AS DOUBLE) AS TOTALCLEARED,
  CAST(RAMPDOWNRATE AS DOUBLE) AS RAMPDOWNRATE,
  CAST(RAMPUPRATE AS DOUBLE) AS RAMPUPRATE,
  CAST(LOWER5MIN AS DOUBLE) AS LOWER5MIN,
  CAST(LOWER60SEC AS DOUBLE) AS LOWER60SEC,
  CAST(LOWER6SEC AS DOUBLE) AS LOWER6SEC,
  CAST(RAISE5MIN AS DOUBLE) AS RAISE5MIN,
  CAST(RAISE60SEC AS DOUBLE) AS RAISE60SEC,
  CAST(RAISE6SEC AS DOUBLE) AS RAISE6SEC,
  CAST(MARGINAL5MINVALUE AS DOUBLE) AS MARGINAL5MINVALUE,
  CAST(MARGINAL60SECVALUE AS DOUBLE) AS MARGINAL60SECVALUE,
  CAST(MARGINAL6SECVALUE AS DOUBLE) AS MARGINAL6SECVALUE,
  CAST(MARGINALVALUE AS DOUBLE) AS MARGINALVALUE,
  CAST(VIOLATION5MINDEGREE AS DOUBLE) AS VIOLATION5MINDEGREE,
  CAST(VIOLATION60SECDEGREE AS DOUBLE) AS VIOLATION60SECDEGREE,
  CAST(VIOLATION6SECDEGREE AS DOUBLE) AS VIOLATION6SECDEGREE,
  CAST(VIOLATIONDEGREE AS DOUBLE) AS VIOLATIONDEGREE,
  CAST(LOWERREG AS DOUBLE) AS LOWERREG,
  CAST(RAISEREG AS DOUBLE) AS RAISEREG,
  CAST(AVAILABILITY AS DOUBLE) AS AVAILABILITY,
  CAST(RAISE6SECFLAGS AS DOUBLE) AS RAISE6SECFLAGS,
  CAST(RAISE60SECFLAGS AS DOUBLE) AS RAISE60SECFLAGS,
  CAST(RAISE5MINFLAGS AS DOUBLE) AS RAISE5MINFLAGS,
  CAST(RAISEREGFLAGS AS DOUBLE) AS RAISEREGFLAGS,
  CAST(LOWER6SECFLAGS AS DOUBLE) AS LOWER6SECFLAGS,
  CAST(LOWER60SECFLAGS AS DOUBLE) AS LOWER60SECFLAGS,
  CAST(LOWER5MINFLAGS AS DOUBLE) AS LOWER5MINFLAGS,
  CAST(LOWERREGFLAGS AS DOUBLE) AS LOWERREGFLAGS,
  CAST(RAISEREGAVAILABILITY AS DOUBLE) AS RAISEREGAVAILABILITY,
  CAST(RAISEREGENABLEMENTMAX AS DOUBLE) AS RAISEREGENABLEMENTMAX,
  CAST(RAISEREGENABLEMENTMIN AS DOUBLE) AS RAISEREGENABLEMENTMIN,
  CAST(LOWERREGAVAILABILITY AS DOUBLE) AS LOWERREGAVAILABILITY,
  CAST(LOWERREGENABLEMENTMAX AS DOUBLE) AS LOWERREGENABLEMENTMAX,
  CAST(LOWERREGENABLEMENTMIN AS DOUBLE) AS LOWERREGENABLEMENTMIN,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m11:10:09.106115 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."stg_csv_archive_log"
  WHERE source_type = 'daily'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/daily/year=' || substring(source_filename, 14, 4) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

scada_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'DUID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'DISPATCHMODE': 'VARCHAR',
      'AGCSTATUS': 'VARCHAR',
      'INITIALMW': 'VARCHAR',
      'TOTALCLEARED': 'VARCHAR',
      'RAMPDOWNRATE': 'VARCHAR',
      'RAMPUPRATE': 'VARCHAR',
      'LOWER5MIN': 'VARCHAR',
      'LOWER60SEC': 'VARCHAR',
      'LOWER6SEC': 'VARCHAR',
      'RAISE5MIN': 'VARCHAR',
      'RAISE60SEC': 'VARCHAR',
      'RAISE6SEC': 'VARCHAR',
      'MARGINAL5MINVALUE': 'VARCHAR',
      'MARGINAL60SECVALUE': 'VARCHAR',
      'MARGINAL6SECVALUE': 'VARCHAR',
      'MARGINALVALUE': 'VARCHAR',
      'VIOLATION5MINDEGREE': 'VARCHAR',
      'VIOLATION60SECDEGREE': 'VARCHAR',
      'VIOLATION6SECDEGREE': 'VARCHAR',
      'VIOLATIONDEGREE': 'VARCHAR',
      'LOWERREG': 'VARCHAR',
      'RAISEREG': 'VARCHAR',
      'AVAILABILITY': 'VARCHAR',
      'RAISE6SECFLAGS': 'VARCHAR',
      'RAISE60SECFLAGS': 'VARCHAR',
      'RAISE5MINFLAGS': 'VARCHAR',
      'RAISEREGFLAGS': 'VARCHAR',
      'LOWER6SECFLAGS': 'VARCHAR',
      'LOWER60SECFLAGS': 'VARCHAR',
      'LOWER5MINFLAGS': 'VARCHAR',
      'LOWERREGFLAGS': 'VARCHAR',
      'RAISEREGAVAILABILITY': 'VARCHAR',
      'RAISEREGENABLEMENTMAX': 'VARCHAR',
      'RAISEREGENABLEMENTMIN': 'VARCHAR',
      'LOWERREGAVAILABILITY': 'VARCHAR',
      'LOWERREGENABLEMENTMAX': 'VARCHAR',
      'LOWERREGENABLEMENTMIN': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DUNIT' AND VERSION = '3'
)

SELECT
  UNIT,
  DUID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(DISPATCHMODE AS DOUBLE) AS DISPATCHMODE,
  CAST(AGCSTATUS AS DOUBLE) AS AGCSTATUS,
  CAST(INITIALMW AS DOUBLE) AS INITIALMW,
  CAST(TOTALCLEARED AS DOUBLE) AS TOTALCLEARED,
  CAST(RAMPDOWNRATE AS DOUBLE) AS RAMPDOWNRATE,
  CAST(RAMPUPRATE AS DOUBLE) AS RAMPUPRATE,
  CAST(LOWER5MIN AS DOUBLE) AS LOWER5MIN,
  CAST(LOWER60SEC AS DOUBLE) AS LOWER60SEC,
  CAST(LOWER6SEC AS DOUBLE) AS LOWER6SEC,
  CAST(RAISE5MIN AS DOUBLE) AS RAISE5MIN,
  CAST(RAISE60SEC AS DOUBLE) AS RAISE60SEC,
  CAST(RAISE6SEC AS DOUBLE) AS RAISE6SEC,
  CAST(MARGINAL5MINVALUE AS DOUBLE) AS MARGINAL5MINVALUE,
  CAST(MARGINAL60SECVALUE AS DOUBLE) AS MARGINAL60SECVALUE,
  CAST(MARGINAL6SECVALUE AS DOUBLE) AS MARGINAL6SECVALUE,
  CAST(MARGINALVALUE AS DOUBLE) AS MARGINALVALUE,
  CAST(VIOLATION5MINDEGREE AS DOUBLE) AS VIOLATION5MINDEGREE,
  CAST(VIOLATION60SECDEGREE AS DOUBLE) AS VIOLATION60SECDEGREE,
  CAST(VIOLATION6SECDEGREE AS DOUBLE) AS VIOLATION6SECDEGREE,
  CAST(VIOLATIONDEGREE AS DOUBLE) AS VIOLATIONDEGREE,
  CAST(LOWERREG AS DOUBLE) AS LOWERREG,
  CAST(RAISEREG AS DOUBLE) AS RAISEREG,
  CAST(AVAILABILITY AS DOUBLE) AS AVAILABILITY,
  CAST(RAISE6SECFLAGS AS DOUBLE) AS RAISE6SECFLAGS,
  CAST(RAISE60SECFLAGS AS DOUBLE) AS RAISE60SECFLAGS,
  CAST(RAISE5MINFLAGS AS DOUBLE) AS RAISE5MINFLAGS,
  CAST(RAISEREGFLAGS AS DOUBLE) AS RAISEREGFLAGS,
  CAST(LOWER6SECFLAGS AS DOUBLE) AS LOWER6SECFLAGS,
  CAST(LOWER60SECFLAGS AS DOUBLE) AS LOWER60SECFLAGS,
  CAST(LOWER5MINFLAGS AS DOUBLE) AS LOWER5MINFLAGS,
  CAST(LOWERREGFLAGS AS DOUBLE) AS LOWERREGFLAGS,
  CAST(RAISEREGAVAILABILITY AS DOUBLE) AS RAISEREGAVAILABILITY,
  CAST(RAISEREGENABLEMENTMAX AS DOUBLE) AS RAISEREGENABLEMENTMAX,
  CAST(RAISEREGENABLEMENTMIN AS DOUBLE) AS RAISEREGENABLEMENTMIN,
  CAST(LOWERREGAVAILABILITY AS DOUBLE) AS LOWERREGAVAILABILITY,
  CAST(LOWERREGENABLEMENTMAX AS DOUBLE) AS LOWERREGENABLEMENTMAX,
  CAST(LOWERREGENABLEMENTMIN AS DOUBLE) AS LOWERREGENABLEMENTMIN,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m11:10:09.107114 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m11:10:09.108114 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: ROLLBACK
[0m11:10:09.111113 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_scada'
[0m11:10:09.114365 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: Close
[0m11:10:09.115373 [debug] [Thread-1 (]: Runtime Error in model fct_scada (models\marts\fct_scada.sql)
  Binder Error: Table function cannot contain subqueries
[0m11:10:09.115373 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94412568-08ab-4d54-a15f-f12182a02a04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F5B3CECBD0>]}
[0m11:10:09.115373 [error] [Thread-1 (]: 6 of 8 ERROR creating sql incremental model aemo.fct_scada ..................... [[31mERROR[0m in 0.03s]
[0m11:10:09.122640 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_scada
[0m11:10:09.123648 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_scada_today
[0m11:10:09.123648 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_scada' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_scada (models\marts\fct_scada.sql)
  Binder Error: Table function cannot contain subqueries.
[0m11:10:09.124671 [info ] [Thread-1 (]: 7 of 8 START sql incremental model aemo.fct_scada_today ........................ [RUN]
[0m11:10:09.126277 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.fct_scada, now model.aemo_electricity.fct_scada_today)
[0m11:10:09.126277 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_scada_today
[0m11:10:09.130319 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_scada_today"
[0m11:10:09.132523 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_scada_today
[0m11:10:09.135527 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_scada_today"
[0m11:10:09.137523 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada_today"
[0m11:10:09.137523 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: BEGIN
[0m11:10:09.139146 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:10:09.140202 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:10:09.141295 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada_today"
[0m11:10:09.142202 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada_today"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."stg_csv_archive_log"
  WHERE source_type = 'scada_today'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/scada_today/day=' || substring(source_filename, 22, 8) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

scada_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'UNIT_SCADA': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'DUID': 'VARCHAR',
      'SCADAVALUE': 'double',
      'LASTCHANGED': 'timestamp'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND SCADAVALUE != 0
)

SELECT
  DUID,
  SCADAVALUE AS INITIALMW,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  SETTLEMENTDATE,
  LASTCHANGED,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m11:10:09.151807 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada_today"
  
    as (
      



WITH source_files AS (
  SELECT source_filename
  FROM "ducklake"."aemo"."stg_csv_archive_log"
  WHERE source_type = 'scada_today'
  
),

file_paths AS (
  SELECT list('zip://' || '/lakehouse/default/Files/csv' || '/scada_today/day=' || substring(source_filename, 22, 8) || '/source_file=' || source_filename || '/data_0.zip/*.CSV') as paths
  FROM source_files
),

scada_staging AS (
  SELECT *
  FROM read_csv(
    (SELECT COALESCE(paths, ['']) FROM file_paths),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'UNIT_SCADA': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'DUID': 'VARCHAR',
      'SCADAVALUE': 'double',
      'LASTCHANGED': 'timestamp'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND SCADAVALUE != 0
)

SELECT
  DUID,
  SCADAVALUE AS INITIALMW,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  SETTLEMENTDATE,
  LASTCHANGED,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m11:10:09.153885 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m11:10:09.156302 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: ROLLBACK
[0m11:10:09.157404 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_scada_today'
[0m11:10:09.164853 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: Close
[0m11:10:09.166382 [debug] [Thread-1 (]: Runtime Error in model fct_scada_today (models\marts\fct_scada_today.sql)
  Binder Error: Table function cannot contain subqueries
[0m11:10:09.166382 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94412568-08ab-4d54-a15f-f12182a02a04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F5B3DB0DD0>]}
[0m11:10:09.166382 [error] [Thread-1 (]: 7 of 8 ERROR creating sql incremental model aemo.fct_scada_today ............... [[31mERROR[0m in 0.04s]
[0m11:10:09.166382 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_scada_today
[0m11:10:09.172666 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_summary
[0m11:10:09.173672 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_scada_today' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_scada_today (models\marts\fct_scada_today.sql)
  Binder Error: Table function cannot contain subqueries.
[0m11:10:09.173672 [info ] [Thread-1 (]: 8 of 8 SKIP relation aemo.fct_summary .......................................... [[33mSKIP[0m]
[0m11:10:09.174672 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_summary
[0m11:10:09.176672 [debug] [MainThread]: Using duckdb connection "master"
[0m11:10:09.176672 [debug] [MainThread]: On master: BEGIN
[0m11:10:09.177674 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:10:09.178672 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m11:10:09.178672 [debug] [MainThread]: On master: COMMIT
[0m11:10:09.178672 [debug] [MainThread]: Using duckdb connection "master"
[0m11:10:09.179675 [debug] [MainThread]: On master: COMMIT
[0m11:10:09.179675 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:10:09.180671 [debug] [MainThread]: On master: Close
[0m11:10:09.181672 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:10:09.181672 [debug] [MainThread]: Connection 'create_ducklake_aemo' was properly closed.
[0m11:10:09.182672 [debug] [MainThread]: Connection 'list_ducklake_aemo' was properly closed.
[0m11:10:09.182672 [debug] [MainThread]: Connection 'model.aemo_electricity.fct_scada_today' was properly closed.
[0m11:10:09.183671 [info ] [MainThread]: 
[0m11:10:09.183671 [info ] [MainThread]: Finished running 6 incremental models, 2 table models in 0 hours 1 minutes and 5.75 seconds (65.75s).
[0m11:10:09.186912 [debug] [MainThread]: Command end result
[0m11:10:09.214647 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m11:10:09.223199 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m11:10:09.239945 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\lakehouse\default\Files\dbt\target\run_results.json
[0m11:10:09.241040 [info ] [MainThread]: 
[0m11:10:09.242997 [info ] [MainThread]: [31mCompleted with 4 errors, 0 partial successes, and 0 warnings:[0m
[0m11:10:09.244951 [info ] [MainThread]: 
[0m11:10:09.246954 [error] [MainThread]: [31mFailure in model fct_price (models\marts\fct_price.sql)[0m
[0m11:10:09.247955 [error] [MainThread]:   Runtime Error in model fct_price (models\marts\fct_price.sql)
  Binder Error: Table function cannot contain subqueries
[0m11:10:09.250176 [info ] [MainThread]: 
[0m11:10:09.251303 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_price.sql
[0m11:10:09.253301 [info ] [MainThread]: 
[0m11:10:09.254303 [error] [MainThread]: [31mFailure in model fct_price_today (models\marts\fct_price_today.sql)[0m
[0m11:10:09.255301 [error] [MainThread]:   Runtime Error in model fct_price_today (models\marts\fct_price_today.sql)
  Binder Error: Table function cannot contain subqueries
[0m11:10:09.256049 [info ] [MainThread]: 
[0m11:10:09.257607 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_price_today.sql
[0m11:10:09.259621 [info ] [MainThread]: 
[0m11:10:09.261612 [error] [MainThread]: [31mFailure in model fct_scada (models\marts\fct_scada.sql)[0m
[0m11:10:09.263226 [error] [MainThread]:   Runtime Error in model fct_scada (models\marts\fct_scada.sql)
  Binder Error: Table function cannot contain subqueries
[0m11:10:09.263226 [info ] [MainThread]: 
[0m11:10:09.264585 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_scada.sql
[0m11:10:09.264585 [info ] [MainThread]: 
[0m11:10:09.264585 [error] [MainThread]: [31mFailure in model fct_scada_today (models\marts\fct_scada_today.sql)[0m
[0m11:10:09.268573 [error] [MainThread]:   Runtime Error in model fct_scada_today (models\marts\fct_scada_today.sql)
  Binder Error: Table function cannot contain subqueries
[0m11:10:09.269079 [info ] [MainThread]: 
[0m11:10:09.269951 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_scada_today.sql
[0m11:10:09.270959 [info ] [MainThread]: 
[0m11:10:09.271963 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=4 SKIP=1 NO-OP=0 TOTAL=8
[0m11:10:09.272963 [debug] [MainThread]: Command `dbt run` failed at 11:10:09.272963 after 67.09 seconds
[0m11:10:09.272963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F5ACFC09D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F5ACDF28D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F5ACDF2710>]}
[0m11:10:09.272963 [debug] [MainThread]: Flushing usage events
[0m11:10:10.538221 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:14:20.696265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FD1D710E90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FD1D711D10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FD1D712610>]}


============================== 11:14:20.712154 | 5c8bbc3d-d9fe-43f9-8da7-60cc2f7f138c ==============================
[0m11:14:20.712154 [info ] [MainThread]: Running with dbt=1.11.2
[0m11:14:20.712154 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\lakehouse\\default\\Files\\dbt', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\lakehouse\\default\\Files\\dbt\\logs', 'introspect': 'True', 'invocation_command': 'dbt run', 'fail_fast': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True'}
[0m11:14:21.021134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5c8bbc3d-d9fe-43f9-8da7-60cc2f7f138c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FD1D7D2F10>]}
[0m11:14:21.083019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5c8bbc3d-d9fe-43f9-8da7-60cc2f7f138c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FD191F8450>]}
[0m11:14:21.087742 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m11:14:21.461031 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m11:14:21.819743 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 4 files changed.
[0m11:14:21.821843 [debug] [MainThread]: Partial parsing: added file: aemo_electricity://macros\get_archive_paths.sql
[0m11:14:21.821843 [debug] [MainThread]: Partial parsing: updated file: aemo_electricity://models\marts\fct_scada_today.sql
[0m11:14:21.821843 [debug] [MainThread]: Partial parsing: updated file: aemo_electricity://models\marts\fct_scada.sql
[0m11:14:21.821843 [debug] [MainThread]: Partial parsing: updated file: aemo_electricity://models\marts\fct_price.sql
[0m11:14:21.821843 [debug] [MainThread]: Partial parsing: updated file: aemo_electricity://models\marts\fct_price_today.sql
[0m11:14:22.137755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5c8bbc3d-d9fe-43f9-8da7-60cc2f7f138c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FD1DFD7090>]}
[0m11:14:22.196158 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m11:14:22.210978 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m11:14:22.261129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5c8bbc3d-d9fe-43f9-8da7-60cc2f7f138c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FD1DF5B310>]}
[0m11:14:22.268010 [info ] [MainThread]: Found 8 models, 1 seed, 1 source, 475 macros
[0m11:14:22.268010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c8bbc3d-d9fe-43f9-8da7-60cc2f7f138c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FD1D957990>]}
[0m11:14:22.270019 [info ] [MainThread]: 
[0m11:14:22.270019 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:14:22.270019 [info ] [MainThread]: 
[0m11:14:22.275656 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m11:14:22.283664 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake'
[0m11:14:22.519119 [debug] [ThreadPool]: Using duckdb connection "list_ducklake"
[0m11:14:22.519119 [debug] [ThreadPool]: On list_ducklake: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"ducklake"'
    
  
  
[0m11:14:22.519119 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:14:23.007437 [debug] [ThreadPool]: SQL status: OK in 0.480 seconds
[0m11:14:23.013542 [debug] [ThreadPool]: On list_ducklake: Close
[0m11:14:23.014597 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ducklake, now create_ducklake_aemo)
[0m11:14:23.014597 [debug] [ThreadPool]: Creating schema "database: "ducklake"
schema: "aemo"
"
[0m11:14:23.022374 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:14:23.023373 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
        select type from duckdb_databases()
        where lower(database_name)='ducklake'
        and type='sqlite'
    
  
[0m11:14:23.023373 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:14:23.025371 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:14:23.026390 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:14:23.026390 [debug] [ThreadPool]: On create_ducklake_aemo: BEGIN
[0m11:14:23.027387 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m11:14:23.027387 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:14:23.028391 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
    
        create schema if not exists "ducklake"."aemo"
    
[0m11:14:23.029359 [debug] [ThreadPool]: SQL status: OK in 0.005 seconds
[0m11:14:23.029359 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m11:14:23.035050 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:14:23.035050 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m11:14:23.035050 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:14:23.037056 [debug] [ThreadPool]: On create_ducklake_aemo: Close
[0m11:14:23.038947 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake_aemo'
[0m11:14:23.043963 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m11:14:23.044962 [debug] [ThreadPool]: On list_ducklake_aemo: BEGIN
[0m11:14:23.044962 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:14:23.046317 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:14:23.046317 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m11:14:23.047340 [debug] [ThreadPool]: On list_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake_aemo"} */
select
      'ducklake' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'aemo'
    and lower(table_catalog) = 'ducklake'
  
[0m11:14:23.054304 [debug] [ThreadPool]: SQL status: OK in 0.013 seconds
[0m11:14:23.054304 [debug] [ThreadPool]: On list_ducklake_aemo: ROLLBACK
[0m11:14:23.063302 [debug] [ThreadPool]: Failed to rollback 'list_ducklake_aemo'
[0m11:14:23.063302 [debug] [ThreadPool]: On list_ducklake_aemo: Close
[0m11:14:23.063302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c8bbc3d-d9fe-43f9-8da7-60cc2f7f138c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FD190D7E50>]}
[0m11:14:23.063302 [debug] [MainThread]: Using duckdb connection "master"
[0m11:14:23.063302 [debug] [MainThread]: On master: BEGIN
[0m11:14:23.069351 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:14:23.069351 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m11:14:23.070734 [debug] [MainThread]: On master: COMMIT
[0m11:14:23.070734 [debug] [MainThread]: Using duckdb connection "master"
[0m11:14:23.070734 [debug] [MainThread]: On master: COMMIT
[0m11:14:23.070734 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:14:23.070734 [debug] [MainThread]: On master: Close
[0m11:14:23.070734 [debug] [Thread-1 (]: Began running node model.aemo_electricity.dim_calendar
[0m11:14:23.070734 [info ] [Thread-1 (]: 1 of 8 START sql incremental model aemo.dim_calendar ........................... [RUN]
[0m11:14:23.070734 [debug] [Thread-1 (]: Acquiring new duckdb connection 'model.aemo_electricity.dim_calendar'
[0m11:14:23.070734 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.dim_calendar
[0m11:14:23.089262 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.dim_calendar"
[0m11:14:23.091165 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.dim_calendar
[0m11:14:23.143488 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:14:23.144454 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

    
  
    
    

    create temporary table
      "dim_calendar__dbt_tmp20260202111423121412"
  
    as (
      

SELECT
  CAST(date AS DATE) as date,
  CAST(EXTRACT(year FROM date) AS INT) as year,
  CAST(EXTRACT(month FROM date) AS INT) as month
FROM (
  SELECT unnest(generate_series(
    CAST('2018-04-01' AS DATE),
    CAST('2026-12-31' AS DATE),
    INTERVAL 1 DAY
  )) as date
)
    );
  
  
  
[0m11:14:23.145400 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m11:14:23.148650 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:14:23.154400 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:14:23.154400 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: BEGIN
[0m11:14:23.154400 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:14:23.154400 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:14:23.154400 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar__dbt_tmp20260202111423121412'
      
      
      order by ordinal_position

  
[0m11:14:23.154400 [debug] [Thread-1 (]: SQL status: OK in 0.009 seconds
[0m11:14:23.169676 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:14:23.169676 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar'
      
      and lower(table_schema) = 'aemo'
      
      
      and lower(table_catalog) = 'ducklake'
      
      order by ordinal_position

  
[0m11:14:23.169676 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:14:23.189089 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:14:23.190118 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar__dbt_tmp20260202111423121412'
      
      
      order by ordinal_position

  
[0m11:14:23.193089 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:14:23.195994 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:14:23.195994 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar'
      
      and lower(table_schema) = 'aemo'
      
      
      and lower(table_catalog) = 'ducklake'
      
      order by ordinal_position

  
[0m11:14:23.195994 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:14:23.210991 [debug] [Thread-1 (]: 
    In "ducklake"."aemo"."dim_calendar":
        Schema changed: False
        Source columns not in target: []
        Target columns not in source: []
        New column types: []
  
[0m11:14:23.210991 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:14:23.210991 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */
SELECT version()
[0m11:14:23.210991 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:14:23.226742 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.dim_calendar"
[0m11:14:23.226742 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:14:23.226742 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

        
            delete from "ducklake"."aemo"."dim_calendar"
            where (
                date) in (
                select (date)
                from "dim_calendar__dbt_tmp20260202111423121412"
            );

        
    

    insert into "ducklake"."aemo"."dim_calendar" ("date", "year", "month")
    (
        select "date", "year", "month"
        from "dim_calendar__dbt_tmp20260202111423121412"
    )
  
[0m11:14:38.132154 [debug] [Thread-1 (]: SQL status: OK in 14.910 seconds
[0m11:14:38.164409 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: COMMIT
[0m11:14:38.164409 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:14:38.164409 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: COMMIT
[0m11:14:38.195999 [debug] [Thread-1 (]: SQL status: OK in 0.033 seconds
[0m11:14:38.195999 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: Close
[0m11:14:38.212008 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c8bbc3d-d9fe-43f9-8da7-60cc2f7f138c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FD1DECC510>]}
[0m11:14:38.212008 [info ] [Thread-1 (]: 1 of 8 OK created sql incremental model aemo.dim_calendar ...................... [[32mOK[0m in 15.13s]
[0m11:14:38.221284 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.dim_calendar
[0m11:14:38.221284 [debug] [Thread-1 (]: Began running node model.aemo_electricity.dim_duid
[0m11:14:38.221284 [info ] [Thread-1 (]: 2 of 8 START sql table model aemo.dim_duid ..................................... [RUN]
[0m11:14:38.221284 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.dim_calendar, now model.aemo_electricity.dim_duid)
[0m11:14:38.229198 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.dim_duid
[0m11:14:38.231197 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.dim_duid"
[0m11:14:38.231197 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.dim_duid
[0m11:14:38.261486 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.dim_duid"
[0m11:14:38.264798 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:14:38.265872 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: BEGIN
[0m11:14:38.266863 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:14:38.268865 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:14:38.269950 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:14:38.270870 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

  
    
    

    create  table
      "ducklake"."aemo"."dim_duid__dbt_tmp"
  
    as (
      

WITH
  states AS (
    SELECT 'WA1' AS RegionID, 'Western Australia' AS State
    UNION ALL SELECT 'QLD1', 'Queensland'
    UNION ALL SELECT 'NSW1', 'New South Wales'
    UNION ALL SELECT 'TAS1', 'Tasmania'
    UNION ALL SELECT 'SA1', 'South Australia'
    UNION ALL SELECT 'VIC1', 'Victoria'
  ),

  duid_aemo AS (
    SELECT
      DUID AS DUID,
      first(Region) AS Region,
      first("Fuel Source - Descriptor") AS FuelSourceDescriptor,
      first(Participant) AS Participant
    FROM
      read_csv('/lakehouse/default/Files/csv/duid/duid_data.csv')
    WHERE
      length(DUID) > 2
    GROUP BY
      DUID
  ),

  wa_facilities AS (
    SELECT
      'WA1' AS Region,
      "Facility Code" AS DUID,
      "Participant Name" AS Participant
    FROM
      read_csv_auto('/lakehouse/default/Files/csv/duid/facilities.csv')
  ),

  wa_energy AS (
    SELECT *
    FROM read_csv_auto('/lakehouse/default/Files/csv/duid/WA_ENERGY.csv', header = 1)
  ),

  duid_wa AS (
    SELECT
      wa_facilities.DUID,
      wa_facilities.Region,
      wa_energy.Technology AS FuelSourceDescriptor,
      wa_facilities.Participant
    FROM wa_facilities
    LEFT JOIN wa_energy ON wa_facilities.DUID = wa_energy.DUID
  ),

  duid_all AS (
    SELECT * FROM duid_aemo
    UNION ALL
    SELECT * FROM duid_wa
  ),

  geo AS (
    SELECT
      duid,
      max(latitude) as latitude,
      max(longitude) as longitude
    FROM read_csv('/lakehouse/default/Files/csv/duid/geo_data.csv')
    WHERE latitude IS NOT NULL
    GROUP BY duid
  )

SELECT
  a.DUID,
  a.Region,
  UPPER(LEFT(TRIM(FuelSourceDescriptor), 1)) || LOWER(SUBSTR(TRIM(FuelSourceDescriptor), 2)) AS FuelSourceDescriptor,
  a.Participant,
  states.State,
  geo.latitude,
  geo.longitude
FROM duid_all a
JOIN states ON a.Region = states.RegionID
LEFT JOIN geo ON a.duid = geo.duid
    );
  
  
[0m11:14:42.292859 [debug] [Thread-1 (]: SQL status: OK in 4.021 seconds
[0m11:14:42.296870 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:14:42.298875 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'aemo'
      AND table_name = 'dim_duid'
  
[0m11:14:42.298875 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:14:42.302142 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:14:42.302142 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'aemo'
      AND table_name = 'dim_duid'
  
[0m11:14:42.304151 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:14:42.308163 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:14:42.310169 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */
alter table "ducklake"."aemo"."dim_duid" rename to "dim_duid__dbt_backup"
[0m11:14:42.310169 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:14:42.314181 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:14:42.314181 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */
alter table "ducklake"."aemo"."dim_duid__dbt_tmp" rename to "dim_duid"
[0m11:14:42.314181 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:14:42.314181 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: COMMIT
[0m11:14:42.314181 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:14:42.314181 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: COMMIT
[0m11:14:42.339970 [debug] [Thread-1 (]: SQL status: OK in 0.020 seconds
[0m11:14:42.347591 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:14:42.347591 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

      drop table if exists "ducklake"."aemo"."dim_duid__dbt_backup"
    
[0m11:14:42.397585 [debug] [Thread-1 (]: SQL status: OK in 0.052 seconds
[0m11:14:42.404218 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: Close
[0m11:14:42.405221 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c8bbc3d-d9fe-43f9-8da7-60cc2f7f138c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FD1F38E2D0>]}
[0m11:14:42.406312 [info ] [Thread-1 (]: 2 of 8 OK created sql table model aemo.dim_duid ................................ [[32mOK[0m in 4.18s]
[0m11:14:42.407220 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.dim_duid
[0m11:14:42.407917 [debug] [Thread-1 (]: Began running node model.aemo_electricity.stg_csv_archive_log
[0m11:14:42.408236 [info ] [Thread-1 (]: 3 of 8 START sql table model aemo.stg_csv_archive_log .......................... [RUN]
[0m11:14:42.408236 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.dim_duid, now model.aemo_electricity.stg_csv_archive_log)
[0m11:14:42.408236 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.stg_csv_archive_log
[0m11:14:42.408236 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:42.415466 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.stg_csv_archive_log
[0m11:14:42.442680 [info ] [Thread-1 (]: [DOWNLOAD] Starting download with PATH_ROOT=/lakehouse/default, download_limit=2
[0m11:14:42.444589 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:42.444589 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: BEGIN
[0m11:14:42.445597 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:14:42.446112 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:14:42.446112 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:42.448884 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE PATH_ROOT = '/lakehouse/default'

[0m11:14:42.449904 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:14:42.452125 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:42.452125 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE download_limit = 2

[0m11:14:42.453125 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:14:42.454249 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:42.455203 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE csv_archive_path = getvariable('PATH_ROOT') || '/Files/csv'

[0m11:14:42.456201 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:14:42.457049 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:42.458057 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE SCHEMA IF NOT EXISTS ducklake.aemo

[0m11:14:42.490538 [debug] [Thread-1 (]: SQL status: OK in 0.032 seconds
[0m11:14:42.491668 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:42.492647 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

USE ducklake.aemo

[0m11:14:42.492647 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:14:42.493622 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:42.494667 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE _csv_archive_staging (
  source_type VARCHAR,
  source_filename VARCHAR,
  archive_path VARCHAR,
  archived_at TIMESTAMP,
  row_count BIGINT,
  source_url VARCHAR,
  etag VARCHAR
)

[0m11:14:42.495585 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:14:42.496671 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:42.496671 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE _existing_archive_log (
  source_type VARCHAR,
  source_filename VARCHAR
)

[0m11:14:42.497587 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:14:42.498679 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:42.498679 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO _existing_archive_log 
SELECT source_type, source_filename 
FROM ducklake.aemo.csv_archive_log

[0m11:14:49.133267 [debug] [Thread-1 (]: SQL status: OK in 6.638 seconds
[0m11:14:49.133267 [info ] [Thread-1 (]: [DOWNLOAD] Daily source: aemo
[0m11:14:49.133267 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:49.133267 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE daily_files_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('https://nemweb.com.au/Reports/Current/Daily_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'https://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DAILY%.zip%'
ORDER BY full_url DESC

[0m11:14:49.278704 [debug] [Thread-1 (]: SQL status: OK in 0.139 seconds
[0m11:14:49.278704 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:49.278704 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE daily_to_archive AS
SELECT full_url, filename
FROM daily_files_web
WHERE filename NOT IN (SELECT source_filename FROM _existing_archive_log WHERE source_type = 'daily')
LIMIT getvariable('download_limit')

[0m11:14:49.278704 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:14:49.286940 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:49.288946 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE has_daily_to_archive = (SELECT count(*) > 0 FROM daily_to_archive)

[0m11:14:49.290458 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:14:49.290458 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:49.292284 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE daily_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM daily_to_archive)

[0m11:14:49.294290 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:14:49.297301 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:49.297301 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE daily_expected = (SELECT count(*) FROM daily_to_archive)

[0m11:14:49.299306 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:14:49.299306 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:49.299306 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE daily_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM daily_to_archive)

[0m11:14:49.299306 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:14:49.306218 [info ] [Thread-1 (]: [DOWNLOAD] Processing daily files...
[0m11:14:49.306218 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:49.306218 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    CAST(substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 4) AS INT) AS year
  FROM read_blob(getvariable('daily_urls'))
  WHERE getvariable('has_daily_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/daily')
(FORMAT BLOB, PARTITION_BY (year, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m11:14:49.951927 [debug] [Thread-1 (]: SQL status: OK in 0.645 seconds
[0m11:14:49.955945 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:49.955945 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'daily' AS source_type,
  filename AS source_filename,
  '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM daily_to_archive
WHERE getvariable('daily_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('daily_paths'))) = getvariable('daily_expected')

[0m11:14:55.372013 [debug] [Thread-1 (]: SQL status: OK in 5.411 seconds
[0m11:14:55.374021 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:55.374021 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE intraday_scada_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('http://nemweb.com.au/Reports/Current/Dispatch_SCADA/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'http://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DISPATCHSCADA%'
ORDER BY full_url DESC
LIMIT 500

[0m11:14:55.626158 [debug] [Thread-1 (]: SQL status: OK in 0.255 seconds
[0m11:14:55.626158 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:55.626158 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE scada_today_to_archive AS
SELECT full_url, filename
FROM intraday_scada_web
WHERE filename NOT IN (SELECT source_filename FROM _existing_archive_log WHERE source_type = 'scada_today')
LIMIT getvariable('download_limit')

[0m11:14:55.626158 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:14:55.626158 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:55.626158 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE has_scada_today_to_archive = (SELECT count(*) > 0 FROM scada_today_to_archive)

[0m11:14:55.626158 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:14:55.626158 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:55.626158 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE scada_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM scada_today_to_archive)

[0m11:14:55.644027 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:14:55.646039 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:55.648051 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE scada_expected = (SELECT count(*) FROM scada_today_to_archive)

[0m11:14:55.650062 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:14:55.654099 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:55.654099 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE scada_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/scada_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM scada_today_to_archive)

[0m11:14:55.660623 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m11:14:55.662736 [info ] [Thread-1 (]: [DOWNLOAD] Processing intraday SCADA files...
[0m11:14:55.662736 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:55.662736 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 8) AS day
  FROM read_blob(getvariable('scada_urls'))
  WHERE getvariable('has_scada_today_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/scada_today')
(FORMAT BLOB, PARTITION_BY (day, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m11:14:55.812140 [debug] [Thread-1 (]: SQL status: OK in 0.152 seconds
[0m11:14:55.821819 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:14:55.823834 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'scada_today' AS source_type,
  filename AS source_filename,
  '/scada_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM scada_today_to_archive
WHERE getvariable('scada_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('scada_paths'))) = getvariable('scada_expected')

[0m11:15:00.719909 [debug] [Thread-1 (]: SQL status: OK in 4.896 seconds
[0m11:15:00.719909 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:00.719909 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE intraday_price_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('http://nemweb.com.au/Reports/Current/DispatchIS_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'http://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DISPATCHIS_%.zip%'
ORDER BY full_url DESC
LIMIT 500

[0m11:15:00.954763 [debug] [Thread-1 (]: SQL status: OK in 0.231 seconds
[0m11:15:00.954763 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:00.954763 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE price_today_to_archive AS
SELECT full_url, filename
FROM intraday_price_web
WHERE filename NOT IN (SELECT source_filename FROM _existing_archive_log WHERE source_type = 'price_today')
LIMIT getvariable('download_limit')

[0m11:15:00.954763 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:15:00.961120 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:00.961120 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE has_price_today_to_archive = (SELECT count(*) > 0 FROM price_today_to_archive)

[0m11:15:00.961120 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:15:00.961120 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:00.961120 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE price_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM price_today_to_archive)

[0m11:15:00.961120 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:15:00.961120 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:00.970399 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE price_expected = (SELECT count(*) FROM price_today_to_archive)

[0m11:15:00.970399 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:15:00.970399 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:00.970399 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE price_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/price_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM price_today_to_archive)

[0m11:15:00.970399 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:15:00.970399 [info ] [Thread-1 (]: [DOWNLOAD] Processing intraday PRICE files...
[0m11:15:00.970399 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:00.970399 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 8) AS day
  FROM read_blob(getvariable('price_urls'))
  WHERE getvariable('has_price_today_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/price_today')
(FORMAT BLOB, PARTITION_BY (day, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m11:15:01.366814 [debug] [Thread-1 (]: SQL status: OK in 0.385 seconds
[0m11:15:01.368820 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:01.368820 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'price_today' AS source_type,
  filename AS source_filename,
  '/price_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM price_today_to_archive
WHERE getvariable('price_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('price_paths'))) = getvariable('price_expected')

[0m11:15:06.640668 [debug] [Thread-1 (]: SQL status: OK in 5.276 seconds
[0m11:15:06.640668 [info ] [Thread-1 (]: [DOWNLOAD] Refreshing 4 DUID reference files...
[0m11:15:06.640668 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:06.640668 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (SELECT 1 AS id, 'init' AS dummy) TO (getvariable('csv_archive_path') || '/duid')
(FORMAT csv, PARTITION_BY (dummy), FILE_EXTENSION 'csv', OVERWRITE_OR_IGNORE)

[0m11:15:06.664301 [debug] [Thread-1 (]: SQL status: OK in 0.008 seconds
[0m11:15:06.664301 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:06.664301 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/djouallah-patch-1/duid_data.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/duid_data.csv') (FORMAT CSV, HEADER)

[0m11:15:06.993036 [debug] [Thread-1 (]: SQL status: OK in 0.328 seconds
[0m11:15:06.993036 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:06.993036 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://data.wa.aemo.com.au/datafiles/post-facilities/facilities.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/facilities.csv') (FORMAT CSV, HEADER)

[0m11:15:07.233152 [debug] [Thread-1 (]: SQL status: OK in 0.232 seconds
[0m11:15:07.237176 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:07.239187 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/main/WA_ENERGY.csv', header=true, null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/WA_ENERGY.csv') (FORMAT CSV, HEADER)

[0m11:15:07.523617 [debug] [Thread-1 (]: SQL status: OK in 0.288 seconds
[0m11:15:07.523617 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:07.523617 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/main/geo_data.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/geo_data.csv') (FORMAT CSV, HEADER)

[0m11:15:07.838078 [debug] [Thread-1 (]: SQL status: OK in 0.304 seconds
[0m11:15:07.842111 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:07.844123 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

DELETE FROM ducklake.aemo.csv_archive_log WHERE source_type LIKE 'duid_%'

[0m11:15:10.385435 [debug] [Thread-1 (]: SQL status: OK in 2.540 seconds
[0m11:15:10.389477 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:10.391491 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT * FROM (VALUES
  ('duid_data', 'duid_data', '/duid/duid_data.csv', now()),
  ('duid_facilities', 'facilities', '/duid/facilities.csv', now()),
  ('duid_wa_energy', 'WA_ENERGY', '/duid/WA_ENERGY.csv', now()),
  ('duid_geo_data', 'geo_data', '/duid/geo_data.csv', now())
) AS t(source_type, source_filename, archive_path, archived_at)

[0m11:15:16.226312 [debug] [Thread-1 (]: SQL status: OK in 5.834 seconds
[0m11:15:16.228064 [info ] [Thread-1 (]: [DOWNLOAD] DUID files written: 4
[0m11:15:16.230838 [info ] [Thread-1 (]: [DOWNLOAD COMPLETE]
[0m11:15:16.230838 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:16.230838 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:16.230838 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

  
    
    

    create  table
      "ducklake"."aemo"."stg_csv_archive_log__dbt_tmp"
  
    as (
      



SELECT 
  source_type,
  source_filename,
  archive_path,
  archived_at,
  row_count,
  source_url,
  etag
FROM "ducklake"."aemo"."csv_archive_log"
    );
  
  
[0m11:15:27.834069 [debug] [Thread-1 (]: SQL status: OK in 11.593 seconds
[0m11:15:27.836075 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:27.837374 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'aemo'
      AND table_name = 'stg_csv_archive_log'
  
[0m11:15:27.837374 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:15:27.837374 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:27.837374 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'aemo'
      AND table_name = 'stg_csv_archive_log'
  
[0m11:15:27.837374 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:15:27.846864 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:27.846864 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */
alter table "ducklake"."aemo"."stg_csv_archive_log" rename to "stg_csv_archive_log__dbt_backup"
[0m11:15:27.846864 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:15:27.846864 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:27.846864 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */
alter table "ducklake"."aemo"."stg_csv_archive_log__dbt_tmp" rename to "stg_csv_archive_log"
[0m11:15:27.846864 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:15:27.846864 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: COMMIT
[0m11:15:27.846864 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:27.846864 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: COMMIT
[0m11:15:27.883901 [debug] [Thread-1 (]: SQL status: OK in 0.029 seconds
[0m11:15:27.883901 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:15:27.883901 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

      drop table if exists "ducklake"."aemo"."stg_csv_archive_log__dbt_backup"
    
[0m11:15:27.944022 [debug] [Thread-1 (]: SQL status: OK in 0.053 seconds
[0m11:15:27.946158 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: Close
[0m11:15:27.947199 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c8bbc3d-d9fe-43f9-8da7-60cc2f7f138c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FD1F3DC2D0>]}
[0m11:15:27.948409 [info ] [Thread-1 (]: 3 of 8 OK created sql table model aemo.stg_csv_archive_log ..................... [[32mOK[0m in 45.54s]
[0m11:15:27.949761 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.stg_csv_archive_log
[0m11:15:27.950799 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_price
[0m11:15:27.951869 [info ] [Thread-1 (]: 4 of 8 START sql incremental model aemo.fct_price .............................. [RUN]
[0m11:15:27.952386 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.stg_csv_archive_log, now model.aemo_electricity.fct_price)
[0m11:15:27.952902 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_price
[0m11:15:27.957898 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_price"
[0m11:15:27.959614 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_price
[0m11:15:27.964737 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price"
[0m11:15:27.965486 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: BEGIN
[0m11:15:27.966861 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:15:27.968174 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:15:27.969182 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price"
[0m11:15:27.969840 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price"} */

        SET VARIABLE price_daily_paths = (SELECT COALESCE(NULLIF(list('zip://' || '/lakehouse/default/Files/csv' || '/daily/year=' || substring(source_filename, 14, 4) || '/source_file=' || source_filename || '/data_0.zip/*.CSV'), []), ['']) FROM "ducklake"."aemo"."stg_csv_archive_log" WHERE source_type = 'daily')
      
[0m11:15:31.460494 [debug] [Thread-1 (]: SQL status: OK in 3.494 seconds
[0m11:15:31.460494 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_price"
[0m11:15:31.466668 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price"
[0m11:15:31.466668 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price"
  
    as (
      



WITH price_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('price_daily_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'TOTALDEMAND': 'VARCHAR',
      'DEMANDFORECAST': 'VARCHAR',
      'DISPATCHABLEGENERATION': 'VARCHAR',
      'DISPATCHABLELOAD': 'VARCHAR',
      'NETINTERCHANGE': 'VARCHAR',
      'EXCESSGENERATION': 'VARCHAR',
      'LOWER5MINDISPATCH': 'VARCHAR',
      'LOWER5MINIMPORT': 'VARCHAR',
      'LOWER5MINLOCALDISPATCH': 'VARCHAR',
      'LOWER5MINLOCALPRICE': 'VARCHAR',
      'LOWER5MINLOCALREQ': 'VARCHAR',
      'LOWER5MINPRICE': 'VARCHAR',
      'LOWER5MINREQ': 'VARCHAR',
      'LOWER5MINSUPPLYPRICE': 'VARCHAR',
      'LOWER60SECDISPATCH': 'VARCHAR',
      'LOWER60SECIMPORT': 'VARCHAR',
      'LOWER60SECLOCALDISPATCH': 'VARCHAR',
      'LOWER60SECLOCALPRICE': 'VARCHAR',
      'LOWER60SECLOCALREQ': 'VARCHAR',
      'LOWER60SECPRICE': 'VARCHAR',
      'LOWER60SECREQ': 'VARCHAR',
      'LOWER60SECSUPPLYPRICE': 'VARCHAR',
      'LOWER6SECDISPATCH': 'VARCHAR',
      'LOWER6SECIMPORT': 'VARCHAR',
      'LOWER6SECLOCALDISPATCH': 'VARCHAR',
      'LOWER6SECLOCALPRICE': 'VARCHAR',
      'LOWER6SECLOCALREQ': 'VARCHAR',
      'LOWER6SECPRICE': 'VARCHAR',
      'LOWER6SECREQ': 'VARCHAR',
      'LOWER6SECSUPPLYPRICE': 'VARCHAR',
      'RAISE5MINDISPATCH': 'VARCHAR',
      'RAISE5MINIMPORT': 'VARCHAR',
      'RAISE5MINLOCALDISPATCH': 'VARCHAR',
      'RAISE5MINLOCALPRICE': 'VARCHAR',
      'RAISE5MINLOCALREQ': 'VARCHAR',
      'RAISE5MINPRICE': 'VARCHAR',
      'RAISE5MINREQ': 'VARCHAR',
      'RAISE5MINSUPPLYPRICE': 'VARCHAR',
      'RAISE60SECDISPATCH': 'VARCHAR',
      'RAISE60SECIMPORT': 'VARCHAR',
      'RAISE60SECLOCALDISPATCH': 'VARCHAR',
      'RAISE60SECLOCALPRICE': 'VARCHAR',
      'RAISE60SECLOCALREQ': 'VARCHAR',
      'RAISE60SECPRICE': 'VARCHAR',
      'RAISE60SECREQ': 'VARCHAR',
      'RAISE60SECSUPPLYPRICE': 'VARCHAR',
      'RAISE6SECDISPATCH': 'VARCHAR',
      'RAISE6SECIMPORT': 'VARCHAR',
      'RAISE6SECLOCALDISPATCH': 'VARCHAR',
      'RAISE6SECLOCALPRICE': 'VARCHAR',
      'RAISE6SECLOCALREQ': 'VARCHAR',
      'RAISE6SECPRICE': 'VARCHAR',
      'RAISE6SECREQ': 'VARCHAR',
      'RAISE6SECSUPPLYPRICE': 'VARCHAR',
      'AGGREGATEDISPATCHERROR': 'VARCHAR',
      'AVAILABLEGENERATION': 'VARCHAR',
      'AVAILABLELOAD': 'VARCHAR',
      'INITIALSUPPLY': 'VARCHAR',
      'CLEAREDSUPPLY': 'VARCHAR',
      'LOWERREGIMPORT': 'VARCHAR',
      'LOWERREGLOCALDISPATCH': 'VARCHAR',
      'LOWERREGLOCALREQ': 'VARCHAR',
      'LOWERREGREQ': 'VARCHAR',
      'RAISEREGIMPORT': 'VARCHAR',
      'RAISEREGLOCALDISPATCH': 'VARCHAR',
      'RAISEREGLOCALREQ': 'VARCHAR',
      'RAISEREGREQ': 'VARCHAR',
      'RAISE5MINLOCALVIOLATION': 'VARCHAR',
      'RAISEREGLOCALVIOLATION': 'VARCHAR',
      'RAISE60SECLOCALVIOLATION': 'VARCHAR',
      'RAISE6SECLOCALVIOLATION': 'VARCHAR',
      'LOWER5MINLOCALVIOLATION': 'VARCHAR',
      'LOWERREGLOCALVIOLATION': 'VARCHAR',
      'LOWER60SECLOCALVIOLATION': 'VARCHAR',
      'LOWER6SECLOCALVIOLATION': 'VARCHAR',
      'RAISE5MINVIOLATION': 'VARCHAR',
      'RAISEREGVIOLATION': 'VARCHAR',
      'RAISE60SECVIOLATION': 'VARCHAR',
      'RAISE6SECVIOLATION': 'VARCHAR',
      'LOWER5MINVIOLATION': 'VARCHAR',
      'LOWERREGVIOLATION': 'VARCHAR',
      'LOWER60SECVIOLATION': 'VARCHAR',
      'LOWER6SECVIOLATION': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR',
      'LORSURPLUS': 'VARCHAR',
      'LRCSURPLUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DREGION' AND VERSION = '3'
)

SELECT
  UNIT,
  REGIONID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(TOTALDEMAND AS DOUBLE) AS TOTALDEMAND,
  CAST(DEMANDFORECAST AS DOUBLE) AS DEMANDFORECAST,
  CAST(DISPATCHABLEGENERATION AS DOUBLE) AS DISPATCHABLEGENERATION,
  CAST(DISPATCHABLELOAD AS DOUBLE) AS DISPATCHABLELOAD,
  CAST(NETINTERCHANGE AS DOUBLE) AS NETINTERCHANGE,
  CAST(EXCESSGENERATION AS DOUBLE) AS EXCESSGENERATION,
  CAST(LOWER5MINDISPATCH AS DOUBLE) AS LOWER5MINDISPATCH,
  CAST(LOWER5MINIMPORT AS DOUBLE) AS LOWER5MINIMPORT,
  CAST(LOWER5MINLOCALDISPATCH AS DOUBLE) AS LOWER5MINLOCALDISPATCH,
  CAST(LOWER5MINLOCALPRICE AS DOUBLE) AS LOWER5MINLOCALPRICE,
  CAST(LOWER5MINLOCALREQ AS DOUBLE) AS LOWER5MINLOCALREQ,
  CAST(LOWER5MINPRICE AS DOUBLE) AS LOWER5MINPRICE,
  CAST(LOWER5MINREQ AS DOUBLE) AS LOWER5MINREQ,
  CAST(LOWER5MINSUPPLYPRICE AS DOUBLE) AS LOWER5MINSUPPLYPRICE,
  CAST(LOWER60SECDISPATCH AS DOUBLE) AS LOWER60SECDISPATCH,
  CAST(LOWER60SECIMPORT AS DOUBLE) AS LOWER60SECIMPORT,
  CAST(LOWER60SECLOCALDISPATCH AS DOUBLE) AS LOWER60SECLOCALDISPATCH,
  CAST(LOWER60SECLOCALPRICE AS DOUBLE) AS LOWER60SECLOCALPRICE,
  CAST(LOWER60SECLOCALREQ AS DOUBLE) AS LOWER60SECLOCALREQ,
  CAST(LOWER60SECPRICE AS DOUBLE) AS LOWER60SECPRICE,
  CAST(LOWER60SECREQ AS DOUBLE) AS LOWER60SECREQ,
  CAST(LOWER60SECSUPPLYPRICE AS DOUBLE) AS LOWER60SECSUPPLYPRICE,
  CAST(LOWER6SECDISPATCH AS DOUBLE) AS LOWER6SECDISPATCH,
  CAST(LOWER6SECIMPORT AS DOUBLE) AS LOWER6SECIMPORT,
  CAST(LOWER6SECLOCALDISPATCH AS DOUBLE) AS LOWER6SECLOCALDISPATCH,
  CAST(LOWER6SECLOCALPRICE AS DOUBLE) AS LOWER6SECLOCALPRICE,
  CAST(LOWER6SECLOCALREQ AS DOUBLE) AS LOWER6SECLOCALREQ,
  CAST(LOWER6SECPRICE AS DOUBLE) AS LOWER6SECPRICE,
  CAST(LOWER6SECREQ AS DOUBLE) AS LOWER6SECREQ,
  CAST(LOWER6SECSUPPLYPRICE AS DOUBLE) AS LOWER6SECSUPPLYPRICE,
  CAST(RAISE5MINDISPATCH AS DOUBLE) AS RAISE5MINDISPATCH,
  CAST(RAISE5MINIMPORT AS DOUBLE) AS RAISE5MINIMPORT,
  CAST(RAISE5MINLOCALDISPATCH AS DOUBLE) AS RAISE5MINLOCALDISPATCH,
  CAST(RAISE5MINLOCALPRICE AS DOUBLE) AS RAISE5MINLOCALPRICE,
  CAST(RAISE5MINLOCALREQ AS DOUBLE) AS RAISE5MINLOCALREQ,
  CAST(RAISE5MINPRICE AS DOUBLE) AS RAISE5MINPRICE,
  CAST(RAISE5MINREQ AS DOUBLE) AS RAISE5MINREQ,
  CAST(RAISE5MINSUPPLYPRICE AS DOUBLE) AS RAISE5MINSUPPLYPRICE,
  CAST(RAISE60SECDISPATCH AS DOUBLE) AS RAISE60SECDISPATCH,
  CAST(RAISE60SECIMPORT AS DOUBLE) AS RAISE60SECIMPORT,
  CAST(RAISE60SECLOCALDISPATCH AS DOUBLE) AS RAISE60SECLOCALDISPATCH,
  CAST(RAISE60SECLOCALPRICE AS DOUBLE) AS RAISE60SECLOCALPRICE,
  CAST(RAISE60SECLOCALREQ AS DOUBLE) AS RAISE60SECLOCALREQ,
  CAST(RAISE60SECPRICE AS DOUBLE) AS RAISE60SECPRICE,
  CAST(RAISE60SECREQ AS DOUBLE) AS RAISE60SECREQ,
  CAST(RAISE60SECSUPPLYPRICE AS DOUBLE) AS RAISE60SECSUPPLYPRICE,
  CAST(RAISE6SECDISPATCH AS DOUBLE) AS RAISE6SECDISPATCH,
  CAST(RAISE6SECIMPORT AS DOUBLE) AS RAISE6SECIMPORT,
  CAST(RAISE6SECLOCALDISPATCH AS DOUBLE) AS RAISE6SECLOCALDISPATCH,
  CAST(RAISE6SECLOCALPRICE AS DOUBLE) AS RAISE6SECLOCALPRICE,
  CAST(RAISE6SECLOCALREQ AS DOUBLE) AS RAISE6SECLOCALREQ,
  CAST(RAISE6SECPRICE AS DOUBLE) AS RAISE6SECPRICE,
  CAST(RAISE6SECREQ AS DOUBLE) AS RAISE6SECREQ,
  CAST(RAISE6SECSUPPLYPRICE AS DOUBLE) AS RAISE6SECSUPPLYPRICE,
  CAST(AGGREGATEDISPATCHERROR AS DOUBLE) AS AGGREGATEDISPATCHERROR,
  CAST(AVAILABLEGENERATION AS DOUBLE) AS AVAILABLEGENERATION,
  CAST(AVAILABLELOAD AS DOUBLE) AS AVAILABLELOAD,
  CAST(INITIALSUPPLY AS DOUBLE) AS INITIALSUPPLY,
  CAST(CLEAREDSUPPLY AS DOUBLE) AS CLEAREDSUPPLY,
  CAST(LOWERREGIMPORT AS DOUBLE) AS LOWERREGIMPORT,
  CAST(LOWERREGLOCALDISPATCH AS DOUBLE) AS LOWERREGLOCALDISPATCH,
  CAST(LOWERREGLOCALREQ AS DOUBLE) AS LOWERREGLOCALREQ,
  CAST(LOWERREGREQ AS DOUBLE) AS LOWERREGREQ,
  CAST(RAISEREGIMPORT AS DOUBLE) AS RAISEREGIMPORT,
  CAST(RAISEREGLOCALDISPATCH AS DOUBLE) AS RAISEREGLOCALDISPATCH,
  CAST(RAISEREGLOCALREQ AS DOUBLE) AS RAISEREGLOCALREQ,
  CAST(RAISEREGREQ AS DOUBLE) AS RAISEREGREQ,
  CAST(RAISE5MINLOCALVIOLATION AS DOUBLE) AS RAISE5MINLOCALVIOLATION,
  CAST(RAISEREGLOCALVIOLATION AS DOUBLE) AS RAISEREGLOCALVIOLATION,
  CAST(RAISE60SECLOCALVIOLATION AS DOUBLE) AS RAISE60SECLOCALVIOLATION,
  CAST(RAISE6SECLOCALVIOLATION AS DOUBLE) AS RAISE6SECLOCALVIOLATION,
  CAST(LOWER5MINLOCALVIOLATION AS DOUBLE) AS LOWER5MINLOCALVIOLATION,
  CAST(LOWERREGLOCALVIOLATION AS DOUBLE) AS LOWERREGLOCALVIOLATION,
  CAST(LOWER60SECLOCALVIOLATION AS DOUBLE) AS LOWER60SECLOCALVIOLATION,
  CAST(LOWER6SECLOCALVIOLATION AS DOUBLE) AS LOWER6SECLOCALVIOLATION,
  CAST(RAISE5MINVIOLATION AS DOUBLE) AS RAISE5MINVIOLATION,
  CAST(RAISEREGVIOLATION AS DOUBLE) AS RAISEREGVIOLATION,
  CAST(RAISE60SECVIOLATION AS DOUBLE) AS RAISE60SECVIOLATION,
  CAST(RAISE6SECVIOLATION AS DOUBLE) AS RAISE6SECVIOLATION,
  CAST(LOWER5MINVIOLATION AS DOUBLE) AS LOWER5MINVIOLATION,
  CAST(LOWERREGVIOLATION AS DOUBLE) AS LOWERREGVIOLATION,
  CAST(LOWER60SECVIOLATION AS DOUBLE) AS LOWER60SECVIOLATION,
  CAST(LOWER6SECVIOLATION AS DOUBLE) AS LOWER6SECVIOLATION,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  CAST(LORSURPLUS AS DOUBLE) AS LORSURPLUS,
  CAST(LRCSURPLUS AS DOUBLE) AS LRCSURPLUS,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m11:15:31.466668 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price"
  
    as (
      



WITH price_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('price_daily_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'TOTALDEMAND': 'VARCHAR',
      'DEMANDFORECAST': 'VARCHAR',
      'DISPATCHABLEGENERATION': 'VARCHAR',
      'DISPATCHABLELOAD': 'VARCHAR',
      'NETINTERCHANGE': 'VARCHAR',
      'EXCESSGENERATION': 'VARCHAR',
      'LOWER5MINDISPATCH': 'VARCHAR',
      'LOWER5MINIMPORT': 'VARCHAR',
      'LOWER5MINLOCALDISPATCH': 'VARCHAR',
      'LOWER5MINLOCALPRICE': 'VARCHAR',
      'LOWER5MINLOCALREQ': 'VARCHAR',
      'LOWER5MINPRICE': 'VARCHAR',
      'LOWER5MINREQ': 'VARCHAR',
      'LOWER5MINSUPPLYPRICE': 'VARCHAR',
      'LOWER60SECDISPATCH': 'VARCHAR',
      'LOWER60SECIMPORT': 'VARCHAR',
      'LOWER60SECLOCALDISPATCH': 'VARCHAR',
      'LOWER60SECLOCALPRICE': 'VARCHAR',
      'LOWER60SECLOCALREQ': 'VARCHAR',
      'LOWER60SECPRICE': 'VARCHAR',
      'LOWER60SECREQ': 'VARCHAR',
      'LOWER60SECSUPPLYPRICE': 'VARCHAR',
      'LOWER6SECDISPATCH': 'VARCHAR',
      'LOWER6SECIMPORT': 'VARCHAR',
      'LOWER6SECLOCALDISPATCH': 'VARCHAR',
      'LOWER6SECLOCALPRICE': 'VARCHAR',
      'LOWER6SECLOCALREQ': 'VARCHAR',
      'LOWER6SECPRICE': 'VARCHAR',
      'LOWER6SECREQ': 'VARCHAR',
      'LOWER6SECSUPPLYPRICE': 'VARCHAR',
      'RAISE5MINDISPATCH': 'VARCHAR',
      'RAISE5MINIMPORT': 'VARCHAR',
      'RAISE5MINLOCALDISPATCH': 'VARCHAR',
      'RAISE5MINLOCALPRICE': 'VARCHAR',
      'RAISE5MINLOCALREQ': 'VARCHAR',
      'RAISE5MINPRICE': 'VARCHAR',
      'RAISE5MINREQ': 'VARCHAR',
      'RAISE5MINSUPPLYPRICE': 'VARCHAR',
      'RAISE60SECDISPATCH': 'VARCHAR',
      'RAISE60SECIMPORT': 'VARCHAR',
      'RAISE60SECLOCALDISPATCH': 'VARCHAR',
      'RAISE60SECLOCALPRICE': 'VARCHAR',
      'RAISE60SECLOCALREQ': 'VARCHAR',
      'RAISE60SECPRICE': 'VARCHAR',
      'RAISE60SECREQ': 'VARCHAR',
      'RAISE60SECSUPPLYPRICE': 'VARCHAR',
      'RAISE6SECDISPATCH': 'VARCHAR',
      'RAISE6SECIMPORT': 'VARCHAR',
      'RAISE6SECLOCALDISPATCH': 'VARCHAR',
      'RAISE6SECLOCALPRICE': 'VARCHAR',
      'RAISE6SECLOCALREQ': 'VARCHAR',
      'RAISE6SECPRICE': 'VARCHAR',
      'RAISE6SECREQ': 'VARCHAR',
      'RAISE6SECSUPPLYPRICE': 'VARCHAR',
      'AGGREGATEDISPATCHERROR': 'VARCHAR',
      'AVAILABLEGENERATION': 'VARCHAR',
      'AVAILABLELOAD': 'VARCHAR',
      'INITIALSUPPLY': 'VARCHAR',
      'CLEAREDSUPPLY': 'VARCHAR',
      'LOWERREGIMPORT': 'VARCHAR',
      'LOWERREGLOCALDISPATCH': 'VARCHAR',
      'LOWERREGLOCALREQ': 'VARCHAR',
      'LOWERREGREQ': 'VARCHAR',
      'RAISEREGIMPORT': 'VARCHAR',
      'RAISEREGLOCALDISPATCH': 'VARCHAR',
      'RAISEREGLOCALREQ': 'VARCHAR',
      'RAISEREGREQ': 'VARCHAR',
      'RAISE5MINLOCALVIOLATION': 'VARCHAR',
      'RAISEREGLOCALVIOLATION': 'VARCHAR',
      'RAISE60SECLOCALVIOLATION': 'VARCHAR',
      'RAISE6SECLOCALVIOLATION': 'VARCHAR',
      'LOWER5MINLOCALVIOLATION': 'VARCHAR',
      'LOWERREGLOCALVIOLATION': 'VARCHAR',
      'LOWER60SECLOCALVIOLATION': 'VARCHAR',
      'LOWER6SECLOCALVIOLATION': 'VARCHAR',
      'RAISE5MINVIOLATION': 'VARCHAR',
      'RAISEREGVIOLATION': 'VARCHAR',
      'RAISE60SECVIOLATION': 'VARCHAR',
      'RAISE6SECVIOLATION': 'VARCHAR',
      'LOWER5MINVIOLATION': 'VARCHAR',
      'LOWERREGVIOLATION': 'VARCHAR',
      'LOWER60SECVIOLATION': 'VARCHAR',
      'LOWER6SECVIOLATION': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR',
      'LORSURPLUS': 'VARCHAR',
      'LRCSURPLUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DREGION' AND VERSION = '3'
)

SELECT
  UNIT,
  REGIONID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(TOTALDEMAND AS DOUBLE) AS TOTALDEMAND,
  CAST(DEMANDFORECAST AS DOUBLE) AS DEMANDFORECAST,
  CAST(DISPATCHABLEGENERATION AS DOUBLE) AS DISPATCHABLEGENERATION,
  CAST(DISPATCHABLELOAD AS DOUBLE) AS DISPATCHABLELOAD,
  CAST(NETINTERCHANGE AS DOUBLE) AS NETINTERCHANGE,
  CAST(EXCESSGENERATION AS DOUBLE) AS EXCESSGENERATION,
  CAST(LOWER5MINDISPATCH AS DOUBLE) AS LOWER5MINDISPATCH,
  CAST(LOWER5MINIMPORT AS DOUBLE) AS LOWER5MINIMPORT,
  CAST(LOWER5MINLOCALDISPATCH AS DOUBLE) AS LOWER5MINLOCALDISPATCH,
  CAST(LOWER5MINLOCALPRICE AS DOUBLE) AS LOWER5MINLOCALPRICE,
  CAST(LOWER5MINLOCALREQ AS DOUBLE) AS LOWER5MINLOCALREQ,
  CAST(LOWER5MINPRICE AS DOUBLE) AS LOWER5MINPRICE,
  CAST(LOWER5MINREQ AS DOUBLE) AS LOWER5MINREQ,
  CAST(LOWER5MINSUPPLYPRICE AS DOUBLE) AS LOWER5MINSUPPLYPRICE,
  CAST(LOWER60SECDISPATCH AS DOUBLE) AS LOWER60SECDISPATCH,
  CAST(LOWER60SECIMPORT AS DOUBLE) AS LOWER60SECIMPORT,
  CAST(LOWER60SECLOCALDISPATCH AS DOUBLE) AS LOWER60SECLOCALDISPATCH,
  CAST(LOWER60SECLOCALPRICE AS DOUBLE) AS LOWER60SECLOCALPRICE,
  CAST(LOWER60SECLOCALREQ AS DOUBLE) AS LOWER60SECLOCALREQ,
  CAST(LOWER60SECPRICE AS DOUBLE) AS LOWER60SECPRICE,
  CAST(LOWER60SECREQ AS DOUBLE) AS LOWER60SECREQ,
  CAST(LOWER60SECSUPPLYPRICE AS DOUBLE) AS LOWER60SECSUPPLYPRICE,
  CAST(LOWER6SECDISPATCH AS DOUBLE) AS LOWER6SECDISPATCH,
  CAST(LOWER6SECIMPORT AS DOUBLE) AS LOWER6SECIMPORT,
  CAST(LOWER6SECLOCALDISPATCH AS DOUBLE) AS LOWER6SECLOCALDISPATCH,
  CAST(LOWER6SECLOCALPRICE AS DOUBLE) AS LOWER6SECLOCALPRICE,
  CAST(LOWER6SECLOCALREQ AS DOUBLE) AS LOWER6SECLOCALREQ,
  CAST(LOWER6SECPRICE AS DOUBLE) AS LOWER6SECPRICE,
  CAST(LOWER6SECREQ AS DOUBLE) AS LOWER6SECREQ,
  CAST(LOWER6SECSUPPLYPRICE AS DOUBLE) AS LOWER6SECSUPPLYPRICE,
  CAST(RAISE5MINDISPATCH AS DOUBLE) AS RAISE5MINDISPATCH,
  CAST(RAISE5MINIMPORT AS DOUBLE) AS RAISE5MINIMPORT,
  CAST(RAISE5MINLOCALDISPATCH AS DOUBLE) AS RAISE5MINLOCALDISPATCH,
  CAST(RAISE5MINLOCALPRICE AS DOUBLE) AS RAISE5MINLOCALPRICE,
  CAST(RAISE5MINLOCALREQ AS DOUBLE) AS RAISE5MINLOCALREQ,
  CAST(RAISE5MINPRICE AS DOUBLE) AS RAISE5MINPRICE,
  CAST(RAISE5MINREQ AS DOUBLE) AS RAISE5MINREQ,
  CAST(RAISE5MINSUPPLYPRICE AS DOUBLE) AS RAISE5MINSUPPLYPRICE,
  CAST(RAISE60SECDISPATCH AS DOUBLE) AS RAISE60SECDISPATCH,
  CAST(RAISE60SECIMPORT AS DOUBLE) AS RAISE60SECIMPORT,
  CAST(RAISE60SECLOCALDISPATCH AS DOUBLE) AS RAISE60SECLOCALDISPATCH,
  CAST(RAISE60SECLOCALPRICE AS DOUBLE) AS RAISE60SECLOCALPRICE,
  CAST(RAISE60SECLOCALREQ AS DOUBLE) AS RAISE60SECLOCALREQ,
  CAST(RAISE60SECPRICE AS DOUBLE) AS RAISE60SECPRICE,
  CAST(RAISE60SECREQ AS DOUBLE) AS RAISE60SECREQ,
  CAST(RAISE60SECSUPPLYPRICE AS DOUBLE) AS RAISE60SECSUPPLYPRICE,
  CAST(RAISE6SECDISPATCH AS DOUBLE) AS RAISE6SECDISPATCH,
  CAST(RAISE6SECIMPORT AS DOUBLE) AS RAISE6SECIMPORT,
  CAST(RAISE6SECLOCALDISPATCH AS DOUBLE) AS RAISE6SECLOCALDISPATCH,
  CAST(RAISE6SECLOCALPRICE AS DOUBLE) AS RAISE6SECLOCALPRICE,
  CAST(RAISE6SECLOCALREQ AS DOUBLE) AS RAISE6SECLOCALREQ,
  CAST(RAISE6SECPRICE AS DOUBLE) AS RAISE6SECPRICE,
  CAST(RAISE6SECREQ AS DOUBLE) AS RAISE6SECREQ,
  CAST(RAISE6SECSUPPLYPRICE AS DOUBLE) AS RAISE6SECSUPPLYPRICE,
  CAST(AGGREGATEDISPATCHERROR AS DOUBLE) AS AGGREGATEDISPATCHERROR,
  CAST(AVAILABLEGENERATION AS DOUBLE) AS AVAILABLEGENERATION,
  CAST(AVAILABLELOAD AS DOUBLE) AS AVAILABLELOAD,
  CAST(INITIALSUPPLY AS DOUBLE) AS INITIALSUPPLY,
  CAST(CLEAREDSUPPLY AS DOUBLE) AS CLEAREDSUPPLY,
  CAST(LOWERREGIMPORT AS DOUBLE) AS LOWERREGIMPORT,
  CAST(LOWERREGLOCALDISPATCH AS DOUBLE) AS LOWERREGLOCALDISPATCH,
  CAST(LOWERREGLOCALREQ AS DOUBLE) AS LOWERREGLOCALREQ,
  CAST(LOWERREGREQ AS DOUBLE) AS LOWERREGREQ,
  CAST(RAISEREGIMPORT AS DOUBLE) AS RAISEREGIMPORT,
  CAST(RAISEREGLOCALDISPATCH AS DOUBLE) AS RAISEREGLOCALDISPATCH,
  CAST(RAISEREGLOCALREQ AS DOUBLE) AS RAISEREGLOCALREQ,
  CAST(RAISEREGREQ AS DOUBLE) AS RAISEREGREQ,
  CAST(RAISE5MINLOCALVIOLATION AS DOUBLE) AS RAISE5MINLOCALVIOLATION,
  CAST(RAISEREGLOCALVIOLATION AS DOUBLE) AS RAISEREGLOCALVIOLATION,
  CAST(RAISE60SECLOCALVIOLATION AS DOUBLE) AS RAISE60SECLOCALVIOLATION,
  CAST(RAISE6SECLOCALVIOLATION AS DOUBLE) AS RAISE6SECLOCALVIOLATION,
  CAST(LOWER5MINLOCALVIOLATION AS DOUBLE) AS LOWER5MINLOCALVIOLATION,
  CAST(LOWERREGLOCALVIOLATION AS DOUBLE) AS LOWERREGLOCALVIOLATION,
  CAST(LOWER60SECLOCALVIOLATION AS DOUBLE) AS LOWER60SECLOCALVIOLATION,
  CAST(LOWER6SECLOCALVIOLATION AS DOUBLE) AS LOWER6SECLOCALVIOLATION,
  CAST(RAISE5MINVIOLATION AS DOUBLE) AS RAISE5MINVIOLATION,
  CAST(RAISEREGVIOLATION AS DOUBLE) AS RAISEREGVIOLATION,
  CAST(RAISE60SECVIOLATION AS DOUBLE) AS RAISE60SECVIOLATION,
  CAST(RAISE6SECVIOLATION AS DOUBLE) AS RAISE6SECVIOLATION,
  CAST(LOWER5MINVIOLATION AS DOUBLE) AS LOWER5MINVIOLATION,
  CAST(LOWERREGVIOLATION AS DOUBLE) AS LOWERREGVIOLATION,
  CAST(LOWER60SECVIOLATION AS DOUBLE) AS LOWER60SECVIOLATION,
  CAST(LOWER6SECVIOLATION AS DOUBLE) AS LOWER6SECVIOLATION,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  CAST(LORSURPLUS AS DOUBLE) AS LORSURPLUS,
  CAST(LRCSURPLUS AS DOUBLE) AS LRCSURPLUS,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m11:15:31.466668 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m11:15:31.466668 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: ROLLBACK
[0m11:15:31.770081 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_price'
[0m11:15:31.770081 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: Close
[0m11:15:31.785891 [debug] [Thread-1 (]: Runtime Error in model fct_price (models\marts\fct_price.sql)
  IO Error: No files found that match the pattern "zip:///lakehouse/default/Files/csv/daily/year=2026/source_file=PUBLIC_DAILY_202602010000_20260202040506/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^
[0m11:15:31.787805 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c8bbc3d-d9fe-43f9-8da7-60cc2f7f138c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FD1F443890>]}
[0m11:15:31.788864 [error] [Thread-1 (]: 4 of 8 ERROR creating sql incremental model aemo.fct_price ..................... [[31mERROR[0m in 3.84s]
[0m11:15:31.790112 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_price
[0m11:15:31.790112 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_price_today
[0m11:15:31.791111 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_price' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_price (models\marts\fct_price.sql)
  IO Error: No files found that match the pattern "zip:///lakehouse/default/Files/csv/daily/year=2026/source_file=PUBLIC_DAILY_202602010000_20260202040506/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^.
[0m11:15:31.791111 [info ] [Thread-1 (]: 5 of 8 START sql incremental model aemo.fct_price_today ........................ [RUN]
[0m11:15:31.793118 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.fct_price, now model.aemo_electricity.fct_price_today)
[0m11:15:31.793118 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_price_today
[0m11:15:31.798207 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_price_today"
[0m11:15:31.798207 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_price_today
[0m11:15:31.798207 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price_today"
[0m11:15:31.798207 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: BEGIN
[0m11:15:31.798207 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:15:31.798207 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:15:31.798207 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price_today"
[0m11:15:31.798207 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price_today"} */

        SET VARIABLE price_today_paths = (SELECT COALESCE(NULLIF(list('zip://' || '/lakehouse/default/Files/csv' || '/price_today/day=' || substring(source_filename, 19, 8) || '/source_file=' || source_filename || '/data_0.zip/*.CSV'), []), ['']) FROM "ducklake"."aemo"."stg_csv_archive_log" WHERE source_type = 'price_today')
      
[0m11:15:31.824793 [debug] [Thread-1 (]: SQL status: OK in 0.018 seconds
[0m11:15:31.826791 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_price_today"
[0m11:15:31.827403 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price_today"
[0m11:15:31.827403 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price_today"
  
    as (
      



WITH price_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('price_today_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'PRICE': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'DISPATCHINTERVAL': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'LASTCHANGED': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'PRICE_STATUS': 'VARCHAR',
      'PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'RAISE1SECRRP': 'VARCHAR',
      'RAISE1SECROP': 'VARCHAR',
      'RAISE1SECAPCFLAG': 'VARCHAR',
      'LOWER1SECRRP': 'VARCHAR',
      'LOWER1SECROP': 'VARCHAR',
      'LOWER1SECAPCFLAG': 'VARCHAR',
      'PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'OCD_STATUS': 'VARCHAR',
      'MII_STATUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND PRICE = 'PRICE'
)

SELECT
  REGIONID,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(DISPATCHINTERVAL AS DOUBLE) AS DISPATCHINTERVAL,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(PRE_AP_ENERGY_PRICE AS DOUBLE) AS PRE_AP_ENERGY_PRICE,
  CAST(PRE_AP_RAISE6_PRICE AS DOUBLE) AS PRE_AP_RAISE6_PRICE,
  CAST(PRE_AP_RAISE60_PRICE AS DOUBLE) AS PRE_AP_RAISE60_PRICE,
  CAST(PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS PRE_AP_RAISE5MIN_PRICE,
  CAST(PRE_AP_RAISEREG_PRICE AS DOUBLE) AS PRE_AP_RAISEREG_PRICE,
  CAST(PRE_AP_LOWER6_PRICE AS DOUBLE) AS PRE_AP_LOWER6_PRICE,
  CAST(PRE_AP_LOWER60_PRICE AS DOUBLE) AS PRE_AP_LOWER60_PRICE,
  CAST(PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS PRE_AP_LOWER5MIN_PRICE,
  CAST(PRE_AP_LOWERREG_PRICE AS DOUBLE) AS PRE_AP_LOWERREG_PRICE,
  CAST(RAISE1SECRRP AS DOUBLE) AS RAISE1SECRRP,
  CAST(RAISE1SECROP AS DOUBLE) AS RAISE1SECROP,
  CAST(RAISE1SECAPCFLAG AS DOUBLE) AS RAISE1SECAPCFLAG,
  CAST(LOWER1SECRRP AS DOUBLE) AS LOWER1SECRRP,
  CAST(LOWER1SECROP AS DOUBLE) AS LOWER1SECROP,
  CAST(LOWER1SECAPCFLAG AS DOUBLE) AS LOWER1SECAPCFLAG,
  CAST(PRE_AP_RAISE1_PRICE AS DOUBLE) AS PRE_AP_RAISE1_PRICE,
  CAST(PRE_AP_LOWER1_PRICE AS DOUBLE) AS PRE_AP_LOWER1_PRICE,
  CAST(CUMUL_PRE_AP_ENERGY_PRICE AS DOUBLE) AS CUMUL_PRE_AP_ENERGY_PRICE,
  CAST(CUMUL_PRE_AP_RAISE6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE6_PRICE,
  CAST(CUMUL_PRE_AP_RAISE60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE60_PRICE,
  CAST(CUMUL_PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE5MIN_PRICE,
  CAST(CUMUL_PRE_AP_RAISEREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISEREG_PRICE,
  CAST(CUMUL_PRE_AP_LOWER6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER6_PRICE,
  CAST(CUMUL_PRE_AP_LOWER60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER60_PRICE,
  CAST(CUMUL_PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER5MIN_PRICE,
  CAST(CUMUL_PRE_AP_LOWERREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWERREG_PRICE,
  CAST(CUMUL_PRE_AP_RAISE1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE1_PRICE,
  CAST(CUMUL_PRE_AP_LOWER1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER1_PRICE,
  SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m11:15:31.833088 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price_today"
  
    as (
      



WITH price_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('price_today_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'PRICE': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'DISPATCHINTERVAL': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'LASTCHANGED': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'PRICE_STATUS': 'VARCHAR',
      'PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'RAISE1SECRRP': 'VARCHAR',
      'RAISE1SECROP': 'VARCHAR',
      'RAISE1SECAPCFLAG': 'VARCHAR',
      'LOWER1SECRRP': 'VARCHAR',
      'LOWER1SECROP': 'VARCHAR',
      'LOWER1SECAPCFLAG': 'VARCHAR',
      'PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'OCD_STATUS': 'VARCHAR',
      'MII_STATUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND PRICE = 'PRICE'
)

SELECT
  REGIONID,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(DISPATCHINTERVAL AS DOUBLE) AS DISPATCHINTERVAL,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(PRE_AP_ENERGY_PRICE AS DOUBLE) AS PRE_AP_ENERGY_PRICE,
  CAST(PRE_AP_RAISE6_PRICE AS DOUBLE) AS PRE_AP_RAISE6_PRICE,
  CAST(PRE_AP_RAISE60_PRICE AS DOUBLE) AS PRE_AP_RAISE60_PRICE,
  CAST(PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS PRE_AP_RAISE5MIN_PRICE,
  CAST(PRE_AP_RAISEREG_PRICE AS DOUBLE) AS PRE_AP_RAISEREG_PRICE,
  CAST(PRE_AP_LOWER6_PRICE AS DOUBLE) AS PRE_AP_LOWER6_PRICE,
  CAST(PRE_AP_LOWER60_PRICE AS DOUBLE) AS PRE_AP_LOWER60_PRICE,
  CAST(PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS PRE_AP_LOWER5MIN_PRICE,
  CAST(PRE_AP_LOWERREG_PRICE AS DOUBLE) AS PRE_AP_LOWERREG_PRICE,
  CAST(RAISE1SECRRP AS DOUBLE) AS RAISE1SECRRP,
  CAST(RAISE1SECROP AS DOUBLE) AS RAISE1SECROP,
  CAST(RAISE1SECAPCFLAG AS DOUBLE) AS RAISE1SECAPCFLAG,
  CAST(LOWER1SECRRP AS DOUBLE) AS LOWER1SECRRP,
  CAST(LOWER1SECROP AS DOUBLE) AS LOWER1SECROP,
  CAST(LOWER1SECAPCFLAG AS DOUBLE) AS LOWER1SECAPCFLAG,
  CAST(PRE_AP_RAISE1_PRICE AS DOUBLE) AS PRE_AP_RAISE1_PRICE,
  CAST(PRE_AP_LOWER1_PRICE AS DOUBLE) AS PRE_AP_LOWER1_PRICE,
  CAST(CUMUL_PRE_AP_ENERGY_PRICE AS DOUBLE) AS CUMUL_PRE_AP_ENERGY_PRICE,
  CAST(CUMUL_PRE_AP_RAISE6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE6_PRICE,
  CAST(CUMUL_PRE_AP_RAISE60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE60_PRICE,
  CAST(CUMUL_PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE5MIN_PRICE,
  CAST(CUMUL_PRE_AP_RAISEREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISEREG_PRICE,
  CAST(CUMUL_PRE_AP_LOWER6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER6_PRICE,
  CAST(CUMUL_PRE_AP_LOWER60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER60_PRICE,
  CAST(CUMUL_PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER5MIN_PRICE,
  CAST(CUMUL_PRE_AP_LOWERREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWERREG_PRICE,
  CAST(CUMUL_PRE_AP_RAISE1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE1_PRICE,
  CAST(CUMUL_PRE_AP_LOWER1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER1_PRICE,
  SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m11:15:31.833088 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m11:15:31.835096 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: ROLLBACK
[0m11:15:31.837101 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_price_today'
[0m11:15:31.839107 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: Close
[0m11:15:31.842856 [debug] [Thread-1 (]: Runtime Error in model fct_price_today (models\marts\fct_price_today.sql)
  IO Error: No files found that match the pattern "zip:///lakehouse/default/Files/csv/price_today/day=20260202/source_file=PUBLIC_DISPATCHIS_202602021110_0000000501570650/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^
[0m11:15:31.843850 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c8bbc3d-d9fe-43f9-8da7-60cc2f7f138c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FD1F44D710>]}
[0m11:15:31.844766 [error] [Thread-1 (]: 5 of 8 ERROR creating sql incremental model aemo.fct_price_today ............... [[31mERROR[0m in 0.05s]
[0m11:15:31.845766 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_price_today
[0m11:15:31.845766 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_scada
[0m11:15:31.846807 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_price_today' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_price_today (models\marts\fct_price_today.sql)
  IO Error: No files found that match the pattern "zip:///lakehouse/default/Files/csv/price_today/day=20260202/source_file=PUBLIC_DISPATCHIS_202602021110_0000000501570650/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^.
[0m11:15:31.847572 [info ] [Thread-1 (]: 6 of 8 START sql incremental model aemo.fct_scada .............................. [RUN]
[0m11:15:31.848634 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.fct_price_today, now model.aemo_electricity.fct_scada)
[0m11:15:31.848634 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_scada
[0m11:15:31.852633 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_scada"
[0m11:15:31.854636 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_scada
[0m11:15:31.862324 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada"
[0m11:15:31.862324 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: BEGIN
[0m11:15:31.863887 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:15:31.865087 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:15:31.866087 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada"
[0m11:15:31.867090 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada"} */

        SET VARIABLE scada_daily_paths = (SELECT COALESCE(NULLIF(list('zip://' || '/lakehouse/default/Files/csv' || '/daily/year=' || substring(source_filename, 14, 4) || '/source_file=' || source_filename || '/data_0.zip/*.CSV'), []), ['']) FROM "ducklake"."aemo"."stg_csv_archive_log" WHERE source_type = 'daily')
      
[0m11:15:31.881649 [debug] [Thread-1 (]: SQL status: OK in 0.018 seconds
[0m11:15:31.881649 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_scada"
[0m11:15:31.881649 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada"
[0m11:15:31.890245 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada"
  
    as (
      



WITH scada_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('scada_daily_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'DUID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'DISPATCHMODE': 'VARCHAR',
      'AGCSTATUS': 'VARCHAR',
      'INITIALMW': 'VARCHAR',
      'TOTALCLEARED': 'VARCHAR',
      'RAMPDOWNRATE': 'VARCHAR',
      'RAMPUPRATE': 'VARCHAR',
      'LOWER5MIN': 'VARCHAR',
      'LOWER60SEC': 'VARCHAR',
      'LOWER6SEC': 'VARCHAR',
      'RAISE5MIN': 'VARCHAR',
      'RAISE60SEC': 'VARCHAR',
      'RAISE6SEC': 'VARCHAR',
      'MARGINAL5MINVALUE': 'VARCHAR',
      'MARGINAL60SECVALUE': 'VARCHAR',
      'MARGINAL6SECVALUE': 'VARCHAR',
      'MARGINALVALUE': 'VARCHAR',
      'VIOLATION5MINDEGREE': 'VARCHAR',
      'VIOLATION60SECDEGREE': 'VARCHAR',
      'VIOLATION6SECDEGREE': 'VARCHAR',
      'VIOLATIONDEGREE': 'VARCHAR',
      'LOWERREG': 'VARCHAR',
      'RAISEREG': 'VARCHAR',
      'AVAILABILITY': 'VARCHAR',
      'RAISE6SECFLAGS': 'VARCHAR',
      'RAISE60SECFLAGS': 'VARCHAR',
      'RAISE5MINFLAGS': 'VARCHAR',
      'RAISEREGFLAGS': 'VARCHAR',
      'LOWER6SECFLAGS': 'VARCHAR',
      'LOWER60SECFLAGS': 'VARCHAR',
      'LOWER5MINFLAGS': 'VARCHAR',
      'LOWERREGFLAGS': 'VARCHAR',
      'RAISEREGAVAILABILITY': 'VARCHAR',
      'RAISEREGENABLEMENTMAX': 'VARCHAR',
      'RAISEREGENABLEMENTMIN': 'VARCHAR',
      'LOWERREGAVAILABILITY': 'VARCHAR',
      'LOWERREGENABLEMENTMAX': 'VARCHAR',
      'LOWERREGENABLEMENTMIN': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DUNIT' AND VERSION = '3'
)

SELECT
  UNIT,
  DUID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(DISPATCHMODE AS DOUBLE) AS DISPATCHMODE,
  CAST(AGCSTATUS AS DOUBLE) AS AGCSTATUS,
  CAST(INITIALMW AS DOUBLE) AS INITIALMW,
  CAST(TOTALCLEARED AS DOUBLE) AS TOTALCLEARED,
  CAST(RAMPDOWNRATE AS DOUBLE) AS RAMPDOWNRATE,
  CAST(RAMPUPRATE AS DOUBLE) AS RAMPUPRATE,
  CAST(LOWER5MIN AS DOUBLE) AS LOWER5MIN,
  CAST(LOWER60SEC AS DOUBLE) AS LOWER60SEC,
  CAST(LOWER6SEC AS DOUBLE) AS LOWER6SEC,
  CAST(RAISE5MIN AS DOUBLE) AS RAISE5MIN,
  CAST(RAISE60SEC AS DOUBLE) AS RAISE60SEC,
  CAST(RAISE6SEC AS DOUBLE) AS RAISE6SEC,
  CAST(MARGINAL5MINVALUE AS DOUBLE) AS MARGINAL5MINVALUE,
  CAST(MARGINAL60SECVALUE AS DOUBLE) AS MARGINAL60SECVALUE,
  CAST(MARGINAL6SECVALUE AS DOUBLE) AS MARGINAL6SECVALUE,
  CAST(MARGINALVALUE AS DOUBLE) AS MARGINALVALUE,
  CAST(VIOLATION5MINDEGREE AS DOUBLE) AS VIOLATION5MINDEGREE,
  CAST(VIOLATION60SECDEGREE AS DOUBLE) AS VIOLATION60SECDEGREE,
  CAST(VIOLATION6SECDEGREE AS DOUBLE) AS VIOLATION6SECDEGREE,
  CAST(VIOLATIONDEGREE AS DOUBLE) AS VIOLATIONDEGREE,
  CAST(LOWERREG AS DOUBLE) AS LOWERREG,
  CAST(RAISEREG AS DOUBLE) AS RAISEREG,
  CAST(AVAILABILITY AS DOUBLE) AS AVAILABILITY,
  CAST(RAISE6SECFLAGS AS DOUBLE) AS RAISE6SECFLAGS,
  CAST(RAISE60SECFLAGS AS DOUBLE) AS RAISE60SECFLAGS,
  CAST(RAISE5MINFLAGS AS DOUBLE) AS RAISE5MINFLAGS,
  CAST(RAISEREGFLAGS AS DOUBLE) AS RAISEREGFLAGS,
  CAST(LOWER6SECFLAGS AS DOUBLE) AS LOWER6SECFLAGS,
  CAST(LOWER60SECFLAGS AS DOUBLE) AS LOWER60SECFLAGS,
  CAST(LOWER5MINFLAGS AS DOUBLE) AS LOWER5MINFLAGS,
  CAST(LOWERREGFLAGS AS DOUBLE) AS LOWERREGFLAGS,
  CAST(RAISEREGAVAILABILITY AS DOUBLE) AS RAISEREGAVAILABILITY,
  CAST(RAISEREGENABLEMENTMAX AS DOUBLE) AS RAISEREGENABLEMENTMAX,
  CAST(RAISEREGENABLEMENTMIN AS DOUBLE) AS RAISEREGENABLEMENTMIN,
  CAST(LOWERREGAVAILABILITY AS DOUBLE) AS LOWERREGAVAILABILITY,
  CAST(LOWERREGENABLEMENTMAX AS DOUBLE) AS LOWERREGENABLEMENTMAX,
  CAST(LOWERREGENABLEMENTMIN AS DOUBLE) AS LOWERREGENABLEMENTMIN,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m11:15:31.893350 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada"
  
    as (
      



WITH scada_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('scada_daily_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'DUID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'DISPATCHMODE': 'VARCHAR',
      'AGCSTATUS': 'VARCHAR',
      'INITIALMW': 'VARCHAR',
      'TOTALCLEARED': 'VARCHAR',
      'RAMPDOWNRATE': 'VARCHAR',
      'RAMPUPRATE': 'VARCHAR',
      'LOWER5MIN': 'VARCHAR',
      'LOWER60SEC': 'VARCHAR',
      'LOWER6SEC': 'VARCHAR',
      'RAISE5MIN': 'VARCHAR',
      'RAISE60SEC': 'VARCHAR',
      'RAISE6SEC': 'VARCHAR',
      'MARGINAL5MINVALUE': 'VARCHAR',
      'MARGINAL60SECVALUE': 'VARCHAR',
      'MARGINAL6SECVALUE': 'VARCHAR',
      'MARGINALVALUE': 'VARCHAR',
      'VIOLATION5MINDEGREE': 'VARCHAR',
      'VIOLATION60SECDEGREE': 'VARCHAR',
      'VIOLATION6SECDEGREE': 'VARCHAR',
      'VIOLATIONDEGREE': 'VARCHAR',
      'LOWERREG': 'VARCHAR',
      'RAISEREG': 'VARCHAR',
      'AVAILABILITY': 'VARCHAR',
      'RAISE6SECFLAGS': 'VARCHAR',
      'RAISE60SECFLAGS': 'VARCHAR',
      'RAISE5MINFLAGS': 'VARCHAR',
      'RAISEREGFLAGS': 'VARCHAR',
      'LOWER6SECFLAGS': 'VARCHAR',
      'LOWER60SECFLAGS': 'VARCHAR',
      'LOWER5MINFLAGS': 'VARCHAR',
      'LOWERREGFLAGS': 'VARCHAR',
      'RAISEREGAVAILABILITY': 'VARCHAR',
      'RAISEREGENABLEMENTMAX': 'VARCHAR',
      'RAISEREGENABLEMENTMIN': 'VARCHAR',
      'LOWERREGAVAILABILITY': 'VARCHAR',
      'LOWERREGENABLEMENTMAX': 'VARCHAR',
      'LOWERREGENABLEMENTMIN': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DUNIT' AND VERSION = '3'
)

SELECT
  UNIT,
  DUID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(DISPATCHMODE AS DOUBLE) AS DISPATCHMODE,
  CAST(AGCSTATUS AS DOUBLE) AS AGCSTATUS,
  CAST(INITIALMW AS DOUBLE) AS INITIALMW,
  CAST(TOTALCLEARED AS DOUBLE) AS TOTALCLEARED,
  CAST(RAMPDOWNRATE AS DOUBLE) AS RAMPDOWNRATE,
  CAST(RAMPUPRATE AS DOUBLE) AS RAMPUPRATE,
  CAST(LOWER5MIN AS DOUBLE) AS LOWER5MIN,
  CAST(LOWER60SEC AS DOUBLE) AS LOWER60SEC,
  CAST(LOWER6SEC AS DOUBLE) AS LOWER6SEC,
  CAST(RAISE5MIN AS DOUBLE) AS RAISE5MIN,
  CAST(RAISE60SEC AS DOUBLE) AS RAISE60SEC,
  CAST(RAISE6SEC AS DOUBLE) AS RAISE6SEC,
  CAST(MARGINAL5MINVALUE AS DOUBLE) AS MARGINAL5MINVALUE,
  CAST(MARGINAL60SECVALUE AS DOUBLE) AS MARGINAL60SECVALUE,
  CAST(MARGINAL6SECVALUE AS DOUBLE) AS MARGINAL6SECVALUE,
  CAST(MARGINALVALUE AS DOUBLE) AS MARGINALVALUE,
  CAST(VIOLATION5MINDEGREE AS DOUBLE) AS VIOLATION5MINDEGREE,
  CAST(VIOLATION60SECDEGREE AS DOUBLE) AS VIOLATION60SECDEGREE,
  CAST(VIOLATION6SECDEGREE AS DOUBLE) AS VIOLATION6SECDEGREE,
  CAST(VIOLATIONDEGREE AS DOUBLE) AS VIOLATIONDEGREE,
  CAST(LOWERREG AS DOUBLE) AS LOWERREG,
  CAST(RAISEREG AS DOUBLE) AS RAISEREG,
  CAST(AVAILABILITY AS DOUBLE) AS AVAILABILITY,
  CAST(RAISE6SECFLAGS AS DOUBLE) AS RAISE6SECFLAGS,
  CAST(RAISE60SECFLAGS AS DOUBLE) AS RAISE60SECFLAGS,
  CAST(RAISE5MINFLAGS AS DOUBLE) AS RAISE5MINFLAGS,
  CAST(RAISEREGFLAGS AS DOUBLE) AS RAISEREGFLAGS,
  CAST(LOWER6SECFLAGS AS DOUBLE) AS LOWER6SECFLAGS,
  CAST(LOWER60SECFLAGS AS DOUBLE) AS LOWER60SECFLAGS,
  CAST(LOWER5MINFLAGS AS DOUBLE) AS LOWER5MINFLAGS,
  CAST(LOWERREGFLAGS AS DOUBLE) AS LOWERREGFLAGS,
  CAST(RAISEREGAVAILABILITY AS DOUBLE) AS RAISEREGAVAILABILITY,
  CAST(RAISEREGENABLEMENTMAX AS DOUBLE) AS RAISEREGENABLEMENTMAX,
  CAST(RAISEREGENABLEMENTMIN AS DOUBLE) AS RAISEREGENABLEMENTMIN,
  CAST(LOWERREGAVAILABILITY AS DOUBLE) AS LOWERREGAVAILABILITY,
  CAST(LOWERREGENABLEMENTMAX AS DOUBLE) AS LOWERREGENABLEMENTMAX,
  CAST(LOWERREGENABLEMENTMIN AS DOUBLE) AS LOWERREGENABLEMENTMIN,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m11:15:31.894351 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m11:15:31.895354 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: ROLLBACK
[0m11:15:31.899603 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_scada'
[0m11:15:31.900605 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: Close
[0m11:15:31.904603 [debug] [Thread-1 (]: Runtime Error in model fct_scada (models\marts\fct_scada.sql)
  IO Error: No files found that match the pattern "zip:///lakehouse/default/Files/csv/daily/year=2026/source_file=PUBLIC_DAILY_202602010000_20260202040506/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^
[0m11:15:31.905950 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c8bbc3d-d9fe-43f9-8da7-60cc2f7f138c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FD1F2CFC90>]}
[0m11:15:31.905950 [error] [Thread-1 (]: 6 of 8 ERROR creating sql incremental model aemo.fct_scada ..................... [[31mERROR[0m in 0.06s]
[0m11:15:31.906954 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_scada
[0m11:15:31.908455 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_scada_today
[0m11:15:31.908455 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_scada' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_scada (models\marts\fct_scada.sql)
  IO Error: No files found that match the pattern "zip:///lakehouse/default/Files/csv/daily/year=2026/source_file=PUBLIC_DAILY_202602010000_20260202040506/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^.
[0m11:15:31.909465 [info ] [Thread-1 (]: 7 of 8 START sql incremental model aemo.fct_scada_today ........................ [RUN]
[0m11:15:31.910234 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.fct_scada, now model.aemo_electricity.fct_scada_today)
[0m11:15:31.910234 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_scada_today
[0m11:15:31.915028 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_scada_today"
[0m11:15:31.917058 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_scada_today
[0m11:15:31.921077 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada_today"
[0m11:15:31.922092 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: BEGIN
[0m11:15:31.928090 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:15:31.929098 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:15:31.929098 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada_today"
[0m11:15:31.930540 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada_today"} */

        SET VARIABLE scada_today_paths = (SELECT COALESCE(NULLIF(list('zip://' || '/lakehouse/default/Files/csv' || '/scada_today/day=' || substring(source_filename, 22, 8) || '/source_file=' || source_filename || '/data_0.zip/*.CSV'), []), ['']) FROM "ducklake"."aemo"."stg_csv_archive_log" WHERE source_type = 'scada_today')
      
[0m11:15:31.948354 [debug] [Thread-1 (]: SQL status: OK in 0.018 seconds
[0m11:15:31.948354 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_scada_today"
[0m11:15:31.948354 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada_today"
[0m11:15:31.948354 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada_today"
  
    as (
      



WITH scada_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('scada_today_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'UNIT_SCADA': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'DUID': 'VARCHAR',
      'SCADAVALUE': 'double',
      'LASTCHANGED': 'timestamp'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND SCADAVALUE != 0
)

SELECT
  DUID,
  SCADAVALUE AS INITIALMW,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  SETTLEMENTDATE,
  LASTCHANGED,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m11:15:31.948354 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada_today"
  
    as (
      



WITH scada_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('scada_today_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'UNIT_SCADA': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'DUID': 'VARCHAR',
      'SCADAVALUE': 'double',
      'LASTCHANGED': 'timestamp'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND SCADAVALUE != 0
)

SELECT
  DUID,
  SCADAVALUE AS INITIALMW,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  SETTLEMENTDATE,
  LASTCHANGED,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m11:15:31.955703 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m11:15:31.955703 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: ROLLBACK
[0m11:15:31.958989 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_scada_today'
[0m11:15:31.959990 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: Close
[0m11:15:31.962989 [debug] [Thread-1 (]: Runtime Error in model fct_scada_today (models\marts\fct_scada_today.sql)
  IO Error: No files found that match the pattern "zip:///lakehouse/default/Files/csv/scada_today/day=20260202/source_file=PUBLIC_DISPATCHSCADA_202602021110_0000000501570655/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^
[0m11:15:31.963989 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c8bbc3d-d9fe-43f9-8da7-60cc2f7f138c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FD1F440950>]}
[0m11:15:31.963989 [error] [Thread-1 (]: 7 of 8 ERROR creating sql incremental model aemo.fct_scada_today ............... [[31mERROR[0m in 0.05s]
[0m11:15:31.965171 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_scada_today
[0m11:15:31.966263 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_summary
[0m11:15:31.966263 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_scada_today' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_scada_today (models\marts\fct_scada_today.sql)
  IO Error: No files found that match the pattern "zip:///lakehouse/default/Files/csv/scada_today/day=20260202/source_file=PUBLIC_DISPATCHSCADA_202602021110_0000000501570655/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^.
[0m11:15:31.967170 [info ] [Thread-1 (]: 8 of 8 SKIP relation aemo.fct_summary .......................................... [[33mSKIP[0m]
[0m11:15:31.968168 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_summary
[0m11:15:31.970178 [debug] [MainThread]: Using duckdb connection "master"
[0m11:15:31.970178 [debug] [MainThread]: On master: BEGIN
[0m11:15:31.971169 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:15:31.972169 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m11:15:31.973172 [debug] [MainThread]: On master: COMMIT
[0m11:15:31.973172 [debug] [MainThread]: Using duckdb connection "master"
[0m11:15:31.973172 [debug] [MainThread]: On master: COMMIT
[0m11:15:31.973172 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:15:31.973172 [debug] [MainThread]: On master: Close
[0m11:15:31.973172 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:15:31.973172 [debug] [MainThread]: Connection 'create_ducklake_aemo' was properly closed.
[0m11:15:31.973172 [debug] [MainThread]: Connection 'list_ducklake_aemo' was properly closed.
[0m11:15:31.973172 [debug] [MainThread]: Connection 'model.aemo_electricity.fct_scada_today' was properly closed.
[0m11:15:31.973172 [info ] [MainThread]: 
[0m11:15:31.973172 [info ] [MainThread]: Finished running 6 incremental models, 2 table models in 0 hours 1 minutes and 9.70 seconds (69.70s).
[0m11:15:31.980511 [debug] [MainThread]: Command end result
[0m11:15:32.008451 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m11:15:32.042307 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m11:15:32.050455 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\lakehouse\default\Files\dbt\target\run_results.json
[0m11:15:32.052461 [info ] [MainThread]: 
[0m11:15:32.052461 [info ] [MainThread]: [31mCompleted with 4 errors, 0 partial successes, and 0 warnings:[0m
[0m11:15:32.054467 [info ] [MainThread]: 
[0m11:15:32.054467 [error] [MainThread]: [31mFailure in model fct_price (models\marts\fct_price.sql)[0m
[0m11:15:32.056471 [error] [MainThread]:   Runtime Error in model fct_price (models\marts\fct_price.sql)
  IO Error: No files found that match the pattern "zip:///lakehouse/default/Files/csv/daily/year=2026/source_file=PUBLIC_DAILY_202602010000_20260202040506/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^
[0m11:15:32.056471 [info ] [MainThread]: 
[0m11:15:32.056471 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_price.sql
[0m11:15:32.059942 [info ] [MainThread]: 
[0m11:15:32.060952 [error] [MainThread]: [31mFailure in model fct_price_today (models\marts\fct_price_today.sql)[0m
[0m11:15:32.061955 [error] [MainThread]:   Runtime Error in model fct_price_today (models\marts\fct_price_today.sql)
  IO Error: No files found that match the pattern "zip:///lakehouse/default/Files/csv/price_today/day=20260202/source_file=PUBLIC_DISPATCHIS_202602021110_0000000501570650/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^
[0m11:15:32.061955 [info ] [MainThread]: 
[0m11:15:32.062953 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_price_today.sql
[0m11:15:32.063951 [info ] [MainThread]: 
[0m11:15:32.065703 [error] [MainThread]: [31mFailure in model fct_scada (models\marts\fct_scada.sql)[0m
[0m11:15:32.066742 [error] [MainThread]:   Runtime Error in model fct_scada (models\marts\fct_scada.sql)
  IO Error: No files found that match the pattern "zip:///lakehouse/default/Files/csv/daily/year=2026/source_file=PUBLIC_DAILY_202602010000_20260202040506/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^
[0m11:15:32.066742 [info ] [MainThread]: 
[0m11:15:32.068224 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_scada.sql
[0m11:15:32.069380 [info ] [MainThread]: 
[0m11:15:32.070629 [error] [MainThread]: [31mFailure in model fct_scada_today (models\marts\fct_scada_today.sql)[0m
[0m11:15:32.072033 [error] [MainThread]:   Runtime Error in model fct_scada_today (models\marts\fct_scada_today.sql)
  IO Error: No files found that match the pattern "zip:///lakehouse/default/Files/csv/scada_today/day=20260202/source_file=PUBLIC_DISPATCHSCADA_202602021110_0000000501570655/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^
[0m11:15:32.072580 [info ] [MainThread]: 
[0m11:15:32.072580 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_scada_today.sql
[0m11:15:32.072580 [info ] [MainThread]: 
[0m11:15:32.072580 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=4 SKIP=1 NO-OP=0 TOTAL=8
[0m11:15:32.077559 [debug] [MainThread]: Command `dbt run` failed at 11:15:32.077559 after 71.46 seconds
[0m11:15:32.079572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FD174C0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FD1D486610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FD1DE4FF50>]}
[0m11:15:32.079572 [debug] [MainThread]: Flushing usage events
[0m11:15:33.443089 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:19:34.112777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AEB7102D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AEB76A450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AEB76A6D0>]}


============================== 11:19:34.144574 | 6fcdb120-4072-4b7f-b418-3c0279c1751e ==============================
[0m11:19:34.144574 [info ] [MainThread]: Running with dbt=1.11.2
[0m11:19:34.146530 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\lakehouse\\default\\Files\\dbt', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\lakehouse\\default\\Files\\dbt\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'invocation_command': 'dbt run', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'use_experimental_parser': 'False'}
[0m11:19:35.066439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6fcdb120-4072-4b7f-b418-3c0279c1751e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AEB9D5FD0>]}
[0m11:19:35.116676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6fcdb120-4072-4b7f-b418-3c0279c1751e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AE72082D0>]}
[0m11:19:35.183580 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m11:19:36.000492 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m11:19:36.133697 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:19:36.141044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '6fcdb120-4072-4b7f-b418-3c0279c1751e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AE98A23D0>]}
[0m11:19:40.653730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6fcdb120-4072-4b7f-b418-3c0279c1751e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AED1ABA90>]}
[0m11:19:40.717330 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m11:19:40.733314 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m11:19:41.614596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6fcdb120-4072-4b7f-b418-3c0279c1751e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AED2B3C10>]}
[0m11:19:41.614596 [info ] [MainThread]: Found 8 models, 1 seed, 1 source, 475 macros
[0m11:19:41.614596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6fcdb120-4072-4b7f-b418-3c0279c1751e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AEB9D3790>]}
[0m11:19:41.614596 [info ] [MainThread]: 
[0m11:19:41.614596 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:19:41.614596 [info ] [MainThread]: 
[0m11:19:41.630716 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m11:19:41.630716 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake'
[0m11:19:50.609107 [debug] [ThreadPool]: Using duckdb connection "list_ducklake"
[0m11:19:50.609107 [debug] [ThreadPool]: On list_ducklake: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"ducklake"'
    
  
  
[0m11:19:50.609107 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:19:51.653500 [debug] [ThreadPool]: SQL status: OK in 1.043 seconds
[0m11:19:51.653500 [debug] [ThreadPool]: On list_ducklake: Close
[0m11:19:51.662172 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ducklake, now create_ducklake_aemo)
[0m11:19:51.664188 [debug] [ThreadPool]: Creating schema "database: "ducklake"
schema: "aemo"
"
[0m11:19:51.680225 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:19:51.682846 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
        select type from duckdb_databases()
        where lower(database_name)='ducklake'
        and type='sqlite'
    
  
[0m11:19:51.684858 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:19:51.687202 [debug] [ThreadPool]: SQL status: OK in 0.003 seconds
[0m11:19:51.687202 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:19:51.687202 [debug] [ThreadPool]: On create_ducklake_aemo: BEGIN
[0m11:19:51.695155 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:19:51.695155 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:19:51.695155 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
    
        create schema if not exists "ducklake"."aemo"
    
[0m11:19:51.703743 [debug] [ThreadPool]: SQL status: OK in 0.009 seconds
[0m11:19:51.711772 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m11:19:51.711772 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:19:51.711772 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m11:19:51.711772 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:19:51.711772 [debug] [ThreadPool]: On create_ducklake_aemo: Close
[0m11:19:51.722797 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake_aemo'
[0m11:19:51.736908 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m11:19:51.736908 [debug] [ThreadPool]: On list_ducklake_aemo: BEGIN
[0m11:19:51.736908 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:19:51.736908 [debug] [ThreadPool]: SQL status: OK in 0.002 seconds
[0m11:19:51.736908 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m11:19:51.736908 [debug] [ThreadPool]: On list_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake_aemo"} */
select
      'ducklake' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'aemo'
    and lower(table_catalog) = 'ducklake'
  
[0m11:19:51.787689 [debug] [ThreadPool]: SQL status: OK in 0.041 seconds
[0m11:19:51.787689 [debug] [ThreadPool]: On list_ducklake_aemo: ROLLBACK
[0m11:19:51.835454 [debug] [ThreadPool]: Failed to rollback 'list_ducklake_aemo'
[0m11:19:51.835454 [debug] [ThreadPool]: On list_ducklake_aemo: Close
[0m11:19:51.835454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6fcdb120-4072-4b7f-b418-3c0279c1751e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AED4DAE50>]}
[0m11:19:51.835454 [debug] [MainThread]: Using duckdb connection "master"
[0m11:19:51.835454 [debug] [MainThread]: On master: BEGIN
[0m11:19:51.835454 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:19:51.835454 [debug] [MainThread]: SQL status: OK in 0.002 seconds
[0m11:19:51.835454 [debug] [MainThread]: On master: COMMIT
[0m11:19:51.835454 [debug] [MainThread]: Using duckdb connection "master"
[0m11:19:51.835454 [debug] [MainThread]: On master: COMMIT
[0m11:19:51.835454 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m11:19:51.851369 [debug] [MainThread]: On master: Close
[0m11:19:51.932996 [debug] [Thread-1 (]: Began running node model.aemo_electricity.dim_calendar
[0m11:19:51.937546 [info ] [Thread-1 (]: 1 of 8 START sql incremental model aemo.dim_calendar ........................... [RUN]
[0m11:19:51.937546 [debug] [Thread-1 (]: Acquiring new duckdb connection 'model.aemo_electricity.dim_calendar'
[0m11:19:51.937546 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.dim_calendar
[0m11:19:51.947892 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.dim_calendar"
[0m11:19:51.949900 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.dim_calendar
[0m11:19:52.007960 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:19:52.008488 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

    
  
    
    

    create temporary table
      "dim_calendar__dbt_tmp20260202111951985288"
  
    as (
      

SELECT
  CAST(date AS DATE) as date,
  CAST(EXTRACT(year FROM date) AS INT) as year,
  CAST(EXTRACT(month FROM date) AS INT) as month
FROM (
  SELECT unnest(generate_series(
    CAST('2018-04-01' AS DATE),
    CAST('2026-12-31' AS DATE),
    INTERVAL 1 DAY
  )) as date
)
    );
  
  
  
[0m11:19:52.009538 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m11:19:52.013263 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m11:19:52.020752 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:19:52.022049 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: BEGIN
[0m11:19:52.022656 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:19:52.023230 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:19:52.023834 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar__dbt_tmp20260202111951985288'
      
      
      order by ordinal_position

  
[0m11:19:52.033049 [debug] [Thread-1 (]: SQL status: OK in 0.011 seconds
[0m11:19:52.037527 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:19:52.037527 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar'
      
      and lower(table_schema) = 'aemo'
      
      
      and lower(table_catalog) = 'ducklake'
      
      order by ordinal_position

  
[0m11:19:52.045191 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m11:19:52.074589 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:19:52.077185 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar__dbt_tmp20260202111951985288'
      
      
      order by ordinal_position

  
[0m11:19:52.083646 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m11:19:52.088519 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:19:52.089510 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar'
      
      and lower(table_schema) = 'aemo'
      
      
      and lower(table_catalog) = 'ducklake'
      
      order by ordinal_position

  
[0m11:19:52.098717 [debug] [Thread-1 (]: SQL status: OK in 0.007 seconds
[0m11:19:52.120925 [debug] [Thread-1 (]: 
    In "ducklake"."aemo"."dim_calendar":
        Schema changed: False
        Source columns not in target: []
        Target columns not in source: []
        New column types: []
  
[0m11:19:52.122201 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:19:52.123204 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */
SELECT version()
[0m11:19:52.125210 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:19:52.173399 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.dim_calendar"
[0m11:19:52.175407 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:19:52.177416 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

        
            delete from "ducklake"."aemo"."dim_calendar"
            where (
                date) in (
                select (date)
                from "dim_calendar__dbt_tmp20260202111951985288"
            );

        
    

    insert into "ducklake"."aemo"."dim_calendar" ("date", "year", "month")
    (
        select "date", "year", "month"
        from "dim_calendar__dbt_tmp20260202111951985288"
    )
  
[0m11:20:10.046362 [debug] [Thread-1 (]: SQL status: OK in 17.865 seconds
[0m11:20:10.078699 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: COMMIT
[0m11:20:10.082760 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:20:10.082760 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: COMMIT
[0m11:20:10.114681 [debug] [Thread-1 (]: SQL status: OK in 0.034 seconds
[0m11:20:10.125224 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: Close
[0m11:20:10.162540 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fcdb120-4072-4b7f-b418-3c0279c1751e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AEBF56E10>]}
[0m11:20:10.166565 [info ] [Thread-1 (]: 1 of 8 OK created sql incremental model aemo.dim_calendar ...................... [[32mOK[0m in 18.19s]
[0m11:20:10.166565 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.dim_calendar
[0m11:20:10.166565 [debug] [Thread-1 (]: Began running node model.aemo_electricity.dim_duid
[0m11:20:10.166565 [info ] [Thread-1 (]: 2 of 8 START sql table model aemo.dim_duid ..................................... [RUN]
[0m11:20:10.166565 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.dim_calendar, now model.aemo_electricity.dim_duid)
[0m11:20:10.166565 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.dim_duid
[0m11:20:10.184418 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.dim_duid"
[0m11:20:10.191659 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.dim_duid
[0m11:20:10.217451 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.dim_duid"
[0m11:20:10.222540 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:20:10.222540 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: BEGIN
[0m11:20:10.227788 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:20:10.227788 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:20:10.231625 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:20:10.235057 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

  
    
    

    create  table
      "ducklake"."aemo"."dim_duid__dbt_tmp"
  
    as (
      

WITH
  states AS (
    SELECT 'WA1' AS RegionID, 'Western Australia' AS State
    UNION ALL SELECT 'QLD1', 'Queensland'
    UNION ALL SELECT 'NSW1', 'New South Wales'
    UNION ALL SELECT 'TAS1', 'Tasmania'
    UNION ALL SELECT 'SA1', 'South Australia'
    UNION ALL SELECT 'VIC1', 'Victoria'
  ),

  duid_aemo AS (
    SELECT
      DUID AS DUID,
      first(Region) AS Region,
      first("Fuel Source - Descriptor") AS FuelSourceDescriptor,
      first(Participant) AS Participant
    FROM
      read_csv('c:/lakehouse/default/Files/csv/duid/duid_data.csv')
    WHERE
      length(DUID) > 2
    GROUP BY
      DUID
  ),

  wa_facilities AS (
    SELECT
      'WA1' AS Region,
      "Facility Code" AS DUID,
      "Participant Name" AS Participant
    FROM
      read_csv_auto('c:/lakehouse/default/Files/csv/duid/facilities.csv')
  ),

  wa_energy AS (
    SELECT *
    FROM read_csv_auto('c:/lakehouse/default/Files/csv/duid/WA_ENERGY.csv', header = 1)
  ),

  duid_wa AS (
    SELECT
      wa_facilities.DUID,
      wa_facilities.Region,
      wa_energy.Technology AS FuelSourceDescriptor,
      wa_facilities.Participant
    FROM wa_facilities
    LEFT JOIN wa_energy ON wa_facilities.DUID = wa_energy.DUID
  ),

  duid_all AS (
    SELECT * FROM duid_aemo
    UNION ALL
    SELECT * FROM duid_wa
  ),

  geo AS (
    SELECT
      duid,
      max(latitude) as latitude,
      max(longitude) as longitude
    FROM read_csv('c:/lakehouse/default/Files/csv/duid/geo_data.csv')
    WHERE latitude IS NOT NULL
    GROUP BY duid
  )

SELECT
  a.DUID,
  a.Region,
  UPPER(LEFT(TRIM(FuelSourceDescriptor), 1)) || LOWER(SUBSTR(TRIM(FuelSourceDescriptor), 2)) AS FuelSourceDescriptor,
  a.Participant,
  states.State,
  geo.latitude,
  geo.longitude
FROM duid_all a
JOIN states ON a.Region = states.RegionID
LEFT JOIN geo ON a.duid = geo.duid
    );
  
  
[0m11:20:14.929760 [debug] [Thread-1 (]: SQL status: OK in 4.694 seconds
[0m11:20:14.953182 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:20:14.955222 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'aemo'
      AND table_name = 'dim_duid'
  
[0m11:20:14.962272 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m11:20:14.962272 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:20:14.962272 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'aemo'
      AND table_name = 'dim_duid'
  
[0m11:20:14.975512 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:20:15.006680 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:20:15.010131 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */
alter table "ducklake"."aemo"."dim_duid" rename to "dim_duid__dbt_backup"
[0m11:20:15.014250 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:20:15.023619 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:20:15.026517 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */
alter table "ducklake"."aemo"."dim_duid__dbt_tmp" rename to "dim_duid"
[0m11:20:15.029517 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:20:15.047836 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: COMMIT
[0m11:20:15.049858 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:20:15.050832 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: COMMIT
[0m11:20:15.108815 [debug] [Thread-1 (]: SQL status: OK in 0.059 seconds
[0m11:20:15.127113 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:20:15.129248 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

      drop table if exists "ducklake"."aemo"."dim_duid__dbt_backup"
    
[0m11:20:15.297866 [debug] [Thread-1 (]: SQL status: OK in 0.166 seconds
[0m11:20:15.303112 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: Close
[0m11:20:15.304111 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fcdb120-4072-4b7f-b418-3c0279c1751e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AED2B3310>]}
[0m11:20:15.306586 [info ] [Thread-1 (]: 2 of 8 OK created sql table model aemo.dim_duid ................................ [[32mOK[0m in 5.14s]
[0m11:20:15.308581 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.dim_duid
[0m11:20:15.309831 [debug] [Thread-1 (]: Began running node model.aemo_electricity.stg_csv_archive_log
[0m11:20:15.312022 [info ] [Thread-1 (]: 3 of 8 START sql table model aemo.stg_csv_archive_log .......................... [RUN]
[0m11:20:15.315032 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.dim_duid, now model.aemo_electricity.stg_csv_archive_log)
[0m11:20:15.321837 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.stg_csv_archive_log
[0m11:20:15.332883 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:15.337044 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.stg_csv_archive_log
[0m11:20:15.348225 [info ] [Thread-1 (]: [DOWNLOAD] Starting download with PATH_ROOT=c:/lakehouse/default, download_limit=2
[0m11:20:15.350224 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:15.352347 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: BEGIN
[0m11:20:15.353356 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:20:15.355835 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:20:15.356848 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:15.357850 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE PATH_ROOT = 'c:/lakehouse/default'

[0m11:20:15.359234 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:20:15.362885 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:15.363895 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE download_limit = 2

[0m11:20:15.365899 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:20:15.367916 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:15.368892 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE csv_archive_path = getvariable('PATH_ROOT') || '/Files/csv'

[0m11:20:15.369894 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:20:15.371909 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:15.372894 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE SCHEMA IF NOT EXISTS ducklake.aemo

[0m11:20:15.413191 [debug] [Thread-1 (]: SQL status: OK in 0.039 seconds
[0m11:20:15.415196 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:15.416194 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

USE ducklake.aemo

[0m11:20:15.417627 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:20:15.419662 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:15.420633 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE _csv_archive_staging (
  source_type VARCHAR,
  source_filename VARCHAR,
  archive_path VARCHAR,
  archived_at TIMESTAMP,
  row_count BIGINT,
  source_url VARCHAR,
  etag VARCHAR
)

[0m11:20:15.421635 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:20:15.423635 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:15.424635 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE _existing_archive_log (
  source_type VARCHAR,
  source_filename VARCHAR
)

[0m11:20:15.425636 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:20:15.427660 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:15.428639 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO _existing_archive_log 
SELECT source_type, source_filename 
FROM ducklake.aemo.csv_archive_log

[0m11:20:23.543124 [debug] [Thread-1 (]: SQL status: OK in 8.113 seconds
[0m11:20:23.545131 [info ] [Thread-1 (]: [DOWNLOAD] Daily source: aemo
[0m11:20:23.547137 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:23.547137 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE daily_files_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('https://nemweb.com.au/Reports/Current/Daily_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'https://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DAILY%.zip%'
ORDER BY full_url DESC

[0m11:20:23.698587 [debug] [Thread-1 (]: SQL status: OK in 0.152 seconds
[0m11:20:23.705165 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:23.708172 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE daily_to_archive AS
SELECT full_url, filename
FROM daily_files_web
WHERE filename NOT IN (SELECT source_filename FROM _existing_archive_log WHERE source_type = 'daily')
LIMIT getvariable('download_limit')

[0m11:20:23.714267 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m11:20:23.716679 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:23.718680 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE has_daily_to_archive = (SELECT count(*) > 0 FROM daily_to_archive)

[0m11:20:23.721698 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:20:23.723707 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:23.725707 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE daily_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM daily_to_archive)

[0m11:20:23.735764 [debug] [Thread-1 (]: SQL status: OK in 0.008 seconds
[0m11:20:23.739124 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:23.741130 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE daily_expected = (SELECT count(*) FROM daily_to_archive)

[0m11:20:23.741130 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:20:23.749578 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:23.749578 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE daily_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM daily_to_archive)

[0m11:20:23.749578 [debug] [Thread-1 (]: SQL status: OK in 0.011 seconds
[0m11:20:23.766571 [info ] [Thread-1 (]: [DOWNLOAD] Processing daily files...
[0m11:20:23.768775 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:23.770776 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    CAST(substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 4) AS INT) AS year
  FROM read_blob(getvariable('daily_urls'))
  WHERE getvariable('has_daily_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/daily')
(FORMAT BLOB, PARTITION_BY (year, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m11:20:24.427040 [debug] [Thread-1 (]: SQL status: OK in 0.656 seconds
[0m11:20:24.433317 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:24.435329 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'daily' AS source_type,
  filename AS source_filename,
  '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM daily_to_archive
WHERE getvariable('daily_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('daily_paths'))) = getvariable('daily_expected')

[0m11:20:30.137582 [debug] [Thread-1 (]: SQL status: OK in 5.704 seconds
[0m11:20:30.137582 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:30.137582 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE intraday_scada_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('http://nemweb.com.au/Reports/Current/Dispatch_SCADA/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'http://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DISPATCHSCADA%'
ORDER BY full_url DESC
LIMIT 500

[0m11:20:30.373637 [debug] [Thread-1 (]: SQL status: OK in 0.229 seconds
[0m11:20:30.373637 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:30.373637 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE scada_today_to_archive AS
SELECT full_url, filename
FROM intraday_scada_web
WHERE filename NOT IN (SELECT source_filename FROM _existing_archive_log WHERE source_type = 'scada_today')
LIMIT getvariable('download_limit')

[0m11:20:30.389534 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m11:20:30.389534 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:30.389534 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE has_scada_today_to_archive = (SELECT count(*) > 0 FROM scada_today_to_archive)

[0m11:20:30.389534 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:20:30.389534 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:30.405586 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE scada_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM scada_today_to_archive)

[0m11:20:30.414914 [debug] [Thread-1 (]: SQL status: OK in 0.007 seconds
[0m11:20:30.414914 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:30.414914 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE scada_expected = (SELECT count(*) FROM scada_today_to_archive)

[0m11:20:30.421710 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:20:30.421710 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:30.421710 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE scada_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/scada_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM scada_today_to_archive)

[0m11:20:30.421710 [debug] [Thread-1 (]: SQL status: OK in 0.007 seconds
[0m11:20:30.439465 [info ] [Thread-1 (]: [DOWNLOAD] Processing intraday SCADA files...
[0m11:20:30.441481 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:30.443420 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 8) AS day
  FROM read_blob(getvariable('scada_urls'))
  WHERE getvariable('has_scada_today_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/scada_today')
(FORMAT BLOB, PARTITION_BY (day, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m11:20:30.604972 [debug] [Thread-1 (]: SQL status: OK in 0.161 seconds
[0m11:20:30.604972 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:30.604972 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'scada_today' AS source_type,
  filename AS source_filename,
  '/scada_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM scada_today_to_archive
WHERE getvariable('scada_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('scada_paths'))) = getvariable('scada_expected')

[0m11:20:36.785904 [debug] [Thread-1 (]: SQL status: OK in 6.182 seconds
[0m11:20:36.800372 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:36.800372 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE intraday_price_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('http://nemweb.com.au/Reports/Current/DispatchIS_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'http://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DISPATCHIS_%.zip%'
ORDER BY full_url DESC
LIMIT 500

[0m11:20:37.027034 [debug] [Thread-1 (]: SQL status: OK in 0.228 seconds
[0m11:20:37.039064 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:37.042323 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE price_today_to_archive AS
SELECT full_url, filename
FROM intraday_price_web
WHERE filename NOT IN (SELECT source_filename FROM _existing_archive_log WHERE source_type = 'price_today')
LIMIT getvariable('download_limit')

[0m11:20:37.043920 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m11:20:37.053035 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:37.054952 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE has_price_today_to_archive = (SELECT count(*) > 0 FROM price_today_to_archive)

[0m11:20:37.059035 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:20:37.062260 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:37.064216 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE price_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM price_today_to_archive)

[0m11:20:37.072597 [debug] [Thread-1 (]: SQL status: OK in 0.006 seconds
[0m11:20:37.075592 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:37.077590 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE price_expected = (SELECT count(*) FROM price_today_to_archive)

[0m11:20:37.080577 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:20:37.083590 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:37.085543 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE price_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/price_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM price_today_to_archive)

[0m11:20:37.093224 [debug] [Thread-1 (]: SQL status: OK in 0.007 seconds
[0m11:20:37.096394 [info ] [Thread-1 (]: [DOWNLOAD] Processing intraday PRICE files...
[0m11:20:37.099459 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:37.101365 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 8) AS day
  FROM read_blob(getvariable('price_urls'))
  WHERE getvariable('has_price_today_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/price_today')
(FORMAT BLOB, PARTITION_BY (day, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m11:20:37.310603 [debug] [Thread-1 (]: SQL status: OK in 0.208 seconds
[0m11:20:37.314287 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:37.319533 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'price_today' AS source_type,
  filename AS source_filename,
  '/price_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM price_today_to_archive
WHERE getvariable('price_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('price_paths'))) = getvariable('price_expected')

[0m11:20:43.247585 [debug] [Thread-1 (]: SQL status: OK in 5.935 seconds
[0m11:20:43.247585 [info ] [Thread-1 (]: [DOWNLOAD] Refreshing 4 DUID reference files...
[0m11:20:43.247585 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:43.263471 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (SELECT 1 AS id, 'init' AS dummy) TO (getvariable('csv_archive_path') || '/duid')
(FORMAT csv, PARTITION_BY (dummy), FILE_EXTENSION 'csv', OVERWRITE_OR_IGNORE)

[0m11:20:43.263471 [debug] [Thread-1 (]: SQL status: OK in 0.006 seconds
[0m11:20:43.276492 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:43.278509 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/djouallah-patch-1/duid_data.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/duid_data.csv') (FORMAT CSV, HEADER)

[0m11:20:43.631461 [debug] [Thread-1 (]: SQL status: OK in 0.352 seconds
[0m11:20:43.633476 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:43.634494 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://data.wa.aemo.com.au/datafiles/post-facilities/facilities.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/facilities.csv') (FORMAT CSV, HEADER)

[0m11:20:43.885477 [debug] [Thread-1 (]: SQL status: OK in 0.250 seconds
[0m11:20:43.891866 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:43.893149 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/main/WA_ENERGY.csv', header=true, null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/WA_ENERGY.csv') (FORMAT CSV, HEADER)

[0m11:20:44.185314 [debug] [Thread-1 (]: SQL status: OK in 0.290 seconds
[0m11:20:44.191471 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:44.191471 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/main/geo_data.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/geo_data.csv') (FORMAT CSV, HEADER)

[0m11:20:44.515008 [debug] [Thread-1 (]: SQL status: OK in 0.321 seconds
[0m11:20:44.522730 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:44.524324 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

DELETE FROM ducklake.aemo.csv_archive_log WHERE source_type LIKE 'duid_%'

[0m11:20:47.219947 [debug] [Thread-1 (]: SQL status: OK in 2.698 seconds
[0m11:20:47.226316 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:47.228330 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT * FROM (VALUES
  ('duid_data', 'duid_data', '/duid/duid_data.csv', now()),
  ('duid_facilities', 'facilities', '/duid/facilities.csv', now()),
  ('duid_wa_energy', 'WA_ENERGY', '/duid/WA_ENERGY.csv', now()),
  ('duid_geo_data', 'geo_data', '/duid/geo_data.csv', now())
) AS t(source_type, source_filename, archive_path, archived_at)

[0m11:20:52.876288 [debug] [Thread-1 (]: SQL status: OK in 5.646 seconds
[0m11:20:52.878359 [info ] [Thread-1 (]: [DOWNLOAD] DUID files written: 4
[0m11:20:52.880680 [info ] [Thread-1 (]: [DOWNLOAD COMPLETE]
[0m11:20:52.883771 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:52.887685 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:20:52.890171 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

  
    
    

    create  table
      "ducklake"."aemo"."stg_csv_archive_log__dbt_tmp"
  
    as (
      



SELECT 
  source_type,
  source_filename,
  archive_path,
  archived_at,
  row_count,
  source_url,
  etag
FROM "ducklake"."aemo"."csv_archive_log"
    );
  
  
[0m11:21:07.412148 [debug] [Thread-1 (]: SQL status: OK in 14.525 seconds
[0m11:21:07.412148 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:21:07.412148 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'aemo'
      AND table_name = 'stg_csv_archive_log'
  
[0m11:21:07.412148 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:21:07.412148 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:21:07.412148 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'aemo'
      AND table_name = 'stg_csv_archive_log'
  
[0m11:21:07.412148 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:21:07.428142 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:21:07.428142 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */
alter table "ducklake"."aemo"."stg_csv_archive_log" rename to "stg_csv_archive_log__dbt_backup"
[0m11:21:07.428142 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:21:07.428142 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:21:07.428142 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */
alter table "ducklake"."aemo"."stg_csv_archive_log__dbt_tmp" rename to "stg_csv_archive_log"
[0m11:21:07.428142 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:21:07.428142 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: COMMIT
[0m11:21:07.428142 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:21:07.428142 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: COMMIT
[0m11:21:07.444297 [debug] [Thread-1 (]: SQL status: OK in 0.021 seconds
[0m11:21:07.460311 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:21:07.460311 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

      drop table if exists "ducklake"."aemo"."stg_csv_archive_log__dbt_backup"
    
[0m11:21:07.492020 [debug] [Thread-1 (]: SQL status: OK in 0.040 seconds
[0m11:21:07.492020 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: Close
[0m11:21:07.492020 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fcdb120-4072-4b7f-b418-3c0279c1751e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AEBF51AD0>]}
[0m11:21:07.507767 [info ] [Thread-1 (]: 3 of 8 OK created sql table model aemo.stg_csv_archive_log ..................... [[32mOK[0m in 52.18s]
[0m11:21:07.507767 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.stg_csv_archive_log
[0m11:21:07.507767 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_price
[0m11:21:07.507767 [info ] [Thread-1 (]: 4 of 8 START sql incremental model aemo.fct_price .............................. [RUN]
[0m11:21:07.507767 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.stg_csv_archive_log, now model.aemo_electricity.fct_price)
[0m11:21:07.507767 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_price
[0m11:21:07.507767 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_price"
[0m11:21:07.507767 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_price
[0m11:21:07.523509 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price"
[0m11:21:07.524664 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: BEGIN
[0m11:21:07.525688 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:21:07.526688 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:21:07.527676 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price"
[0m11:21:07.528676 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price"} */

        SET VARIABLE price_daily_paths = (SELECT COALESCE(NULLIF(list('zip://' || 'c:/lakehouse/default/Files/csv' || '/daily/year=' || substring(source_filename, 14, 4) || '/source_file=' || source_filename || '/data_0.zip/*.CSV'), []), ['']) FROM "ducklake"."aemo"."stg_csv_archive_log" WHERE source_type = 'daily')
      
[0m11:21:10.778032 [debug] [Thread-1 (]: SQL status: OK in 3.249 seconds
[0m11:21:10.778032 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_price"
[0m11:21:10.778032 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price"
[0m11:21:10.785687 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price"
  
    as (
      



WITH price_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('price_daily_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'TOTALDEMAND': 'VARCHAR',
      'DEMANDFORECAST': 'VARCHAR',
      'DISPATCHABLEGENERATION': 'VARCHAR',
      'DISPATCHABLELOAD': 'VARCHAR',
      'NETINTERCHANGE': 'VARCHAR',
      'EXCESSGENERATION': 'VARCHAR',
      'LOWER5MINDISPATCH': 'VARCHAR',
      'LOWER5MINIMPORT': 'VARCHAR',
      'LOWER5MINLOCALDISPATCH': 'VARCHAR',
      'LOWER5MINLOCALPRICE': 'VARCHAR',
      'LOWER5MINLOCALREQ': 'VARCHAR',
      'LOWER5MINPRICE': 'VARCHAR',
      'LOWER5MINREQ': 'VARCHAR',
      'LOWER5MINSUPPLYPRICE': 'VARCHAR',
      'LOWER60SECDISPATCH': 'VARCHAR',
      'LOWER60SECIMPORT': 'VARCHAR',
      'LOWER60SECLOCALDISPATCH': 'VARCHAR',
      'LOWER60SECLOCALPRICE': 'VARCHAR',
      'LOWER60SECLOCALREQ': 'VARCHAR',
      'LOWER60SECPRICE': 'VARCHAR',
      'LOWER60SECREQ': 'VARCHAR',
      'LOWER60SECSUPPLYPRICE': 'VARCHAR',
      'LOWER6SECDISPATCH': 'VARCHAR',
      'LOWER6SECIMPORT': 'VARCHAR',
      'LOWER6SECLOCALDISPATCH': 'VARCHAR',
      'LOWER6SECLOCALPRICE': 'VARCHAR',
      'LOWER6SECLOCALREQ': 'VARCHAR',
      'LOWER6SECPRICE': 'VARCHAR',
      'LOWER6SECREQ': 'VARCHAR',
      'LOWER6SECSUPPLYPRICE': 'VARCHAR',
      'RAISE5MINDISPATCH': 'VARCHAR',
      'RAISE5MINIMPORT': 'VARCHAR',
      'RAISE5MINLOCALDISPATCH': 'VARCHAR',
      'RAISE5MINLOCALPRICE': 'VARCHAR',
      'RAISE5MINLOCALREQ': 'VARCHAR',
      'RAISE5MINPRICE': 'VARCHAR',
      'RAISE5MINREQ': 'VARCHAR',
      'RAISE5MINSUPPLYPRICE': 'VARCHAR',
      'RAISE60SECDISPATCH': 'VARCHAR',
      'RAISE60SECIMPORT': 'VARCHAR',
      'RAISE60SECLOCALDISPATCH': 'VARCHAR',
      'RAISE60SECLOCALPRICE': 'VARCHAR',
      'RAISE60SECLOCALREQ': 'VARCHAR',
      'RAISE60SECPRICE': 'VARCHAR',
      'RAISE60SECREQ': 'VARCHAR',
      'RAISE60SECSUPPLYPRICE': 'VARCHAR',
      'RAISE6SECDISPATCH': 'VARCHAR',
      'RAISE6SECIMPORT': 'VARCHAR',
      'RAISE6SECLOCALDISPATCH': 'VARCHAR',
      'RAISE6SECLOCALPRICE': 'VARCHAR',
      'RAISE6SECLOCALREQ': 'VARCHAR',
      'RAISE6SECPRICE': 'VARCHAR',
      'RAISE6SECREQ': 'VARCHAR',
      'RAISE6SECSUPPLYPRICE': 'VARCHAR',
      'AGGREGATEDISPATCHERROR': 'VARCHAR',
      'AVAILABLEGENERATION': 'VARCHAR',
      'AVAILABLELOAD': 'VARCHAR',
      'INITIALSUPPLY': 'VARCHAR',
      'CLEAREDSUPPLY': 'VARCHAR',
      'LOWERREGIMPORT': 'VARCHAR',
      'LOWERREGLOCALDISPATCH': 'VARCHAR',
      'LOWERREGLOCALREQ': 'VARCHAR',
      'LOWERREGREQ': 'VARCHAR',
      'RAISEREGIMPORT': 'VARCHAR',
      'RAISEREGLOCALDISPATCH': 'VARCHAR',
      'RAISEREGLOCALREQ': 'VARCHAR',
      'RAISEREGREQ': 'VARCHAR',
      'RAISE5MINLOCALVIOLATION': 'VARCHAR',
      'RAISEREGLOCALVIOLATION': 'VARCHAR',
      'RAISE60SECLOCALVIOLATION': 'VARCHAR',
      'RAISE6SECLOCALVIOLATION': 'VARCHAR',
      'LOWER5MINLOCALVIOLATION': 'VARCHAR',
      'LOWERREGLOCALVIOLATION': 'VARCHAR',
      'LOWER60SECLOCALVIOLATION': 'VARCHAR',
      'LOWER6SECLOCALVIOLATION': 'VARCHAR',
      'RAISE5MINVIOLATION': 'VARCHAR',
      'RAISEREGVIOLATION': 'VARCHAR',
      'RAISE60SECVIOLATION': 'VARCHAR',
      'RAISE6SECVIOLATION': 'VARCHAR',
      'LOWER5MINVIOLATION': 'VARCHAR',
      'LOWERREGVIOLATION': 'VARCHAR',
      'LOWER60SECVIOLATION': 'VARCHAR',
      'LOWER6SECVIOLATION': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR',
      'LORSURPLUS': 'VARCHAR',
      'LRCSURPLUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DREGION' AND VERSION = '3'
)

SELECT
  UNIT,
  REGIONID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(TOTALDEMAND AS DOUBLE) AS TOTALDEMAND,
  CAST(DEMANDFORECAST AS DOUBLE) AS DEMANDFORECAST,
  CAST(DISPATCHABLEGENERATION AS DOUBLE) AS DISPATCHABLEGENERATION,
  CAST(DISPATCHABLELOAD AS DOUBLE) AS DISPATCHABLELOAD,
  CAST(NETINTERCHANGE AS DOUBLE) AS NETINTERCHANGE,
  CAST(EXCESSGENERATION AS DOUBLE) AS EXCESSGENERATION,
  CAST(LOWER5MINDISPATCH AS DOUBLE) AS LOWER5MINDISPATCH,
  CAST(LOWER5MINIMPORT AS DOUBLE) AS LOWER5MINIMPORT,
  CAST(LOWER5MINLOCALDISPATCH AS DOUBLE) AS LOWER5MINLOCALDISPATCH,
  CAST(LOWER5MINLOCALPRICE AS DOUBLE) AS LOWER5MINLOCALPRICE,
  CAST(LOWER5MINLOCALREQ AS DOUBLE) AS LOWER5MINLOCALREQ,
  CAST(LOWER5MINPRICE AS DOUBLE) AS LOWER5MINPRICE,
  CAST(LOWER5MINREQ AS DOUBLE) AS LOWER5MINREQ,
  CAST(LOWER5MINSUPPLYPRICE AS DOUBLE) AS LOWER5MINSUPPLYPRICE,
  CAST(LOWER60SECDISPATCH AS DOUBLE) AS LOWER60SECDISPATCH,
  CAST(LOWER60SECIMPORT AS DOUBLE) AS LOWER60SECIMPORT,
  CAST(LOWER60SECLOCALDISPATCH AS DOUBLE) AS LOWER60SECLOCALDISPATCH,
  CAST(LOWER60SECLOCALPRICE AS DOUBLE) AS LOWER60SECLOCALPRICE,
  CAST(LOWER60SECLOCALREQ AS DOUBLE) AS LOWER60SECLOCALREQ,
  CAST(LOWER60SECPRICE AS DOUBLE) AS LOWER60SECPRICE,
  CAST(LOWER60SECREQ AS DOUBLE) AS LOWER60SECREQ,
  CAST(LOWER60SECSUPPLYPRICE AS DOUBLE) AS LOWER60SECSUPPLYPRICE,
  CAST(LOWER6SECDISPATCH AS DOUBLE) AS LOWER6SECDISPATCH,
  CAST(LOWER6SECIMPORT AS DOUBLE) AS LOWER6SECIMPORT,
  CAST(LOWER6SECLOCALDISPATCH AS DOUBLE) AS LOWER6SECLOCALDISPATCH,
  CAST(LOWER6SECLOCALPRICE AS DOUBLE) AS LOWER6SECLOCALPRICE,
  CAST(LOWER6SECLOCALREQ AS DOUBLE) AS LOWER6SECLOCALREQ,
  CAST(LOWER6SECPRICE AS DOUBLE) AS LOWER6SECPRICE,
  CAST(LOWER6SECREQ AS DOUBLE) AS LOWER6SECREQ,
  CAST(LOWER6SECSUPPLYPRICE AS DOUBLE) AS LOWER6SECSUPPLYPRICE,
  CAST(RAISE5MINDISPATCH AS DOUBLE) AS RAISE5MINDISPATCH,
  CAST(RAISE5MINIMPORT AS DOUBLE) AS RAISE5MINIMPORT,
  CAST(RAISE5MINLOCALDISPATCH AS DOUBLE) AS RAISE5MINLOCALDISPATCH,
  CAST(RAISE5MINLOCALPRICE AS DOUBLE) AS RAISE5MINLOCALPRICE,
  CAST(RAISE5MINLOCALREQ AS DOUBLE) AS RAISE5MINLOCALREQ,
  CAST(RAISE5MINPRICE AS DOUBLE) AS RAISE5MINPRICE,
  CAST(RAISE5MINREQ AS DOUBLE) AS RAISE5MINREQ,
  CAST(RAISE5MINSUPPLYPRICE AS DOUBLE) AS RAISE5MINSUPPLYPRICE,
  CAST(RAISE60SECDISPATCH AS DOUBLE) AS RAISE60SECDISPATCH,
  CAST(RAISE60SECIMPORT AS DOUBLE) AS RAISE60SECIMPORT,
  CAST(RAISE60SECLOCALDISPATCH AS DOUBLE) AS RAISE60SECLOCALDISPATCH,
  CAST(RAISE60SECLOCALPRICE AS DOUBLE) AS RAISE60SECLOCALPRICE,
  CAST(RAISE60SECLOCALREQ AS DOUBLE) AS RAISE60SECLOCALREQ,
  CAST(RAISE60SECPRICE AS DOUBLE) AS RAISE60SECPRICE,
  CAST(RAISE60SECREQ AS DOUBLE) AS RAISE60SECREQ,
  CAST(RAISE60SECSUPPLYPRICE AS DOUBLE) AS RAISE60SECSUPPLYPRICE,
  CAST(RAISE6SECDISPATCH AS DOUBLE) AS RAISE6SECDISPATCH,
  CAST(RAISE6SECIMPORT AS DOUBLE) AS RAISE6SECIMPORT,
  CAST(RAISE6SECLOCALDISPATCH AS DOUBLE) AS RAISE6SECLOCALDISPATCH,
  CAST(RAISE6SECLOCALPRICE AS DOUBLE) AS RAISE6SECLOCALPRICE,
  CAST(RAISE6SECLOCALREQ AS DOUBLE) AS RAISE6SECLOCALREQ,
  CAST(RAISE6SECPRICE AS DOUBLE) AS RAISE6SECPRICE,
  CAST(RAISE6SECREQ AS DOUBLE) AS RAISE6SECREQ,
  CAST(RAISE6SECSUPPLYPRICE AS DOUBLE) AS RAISE6SECSUPPLYPRICE,
  CAST(AGGREGATEDISPATCHERROR AS DOUBLE) AS AGGREGATEDISPATCHERROR,
  CAST(AVAILABLEGENERATION AS DOUBLE) AS AVAILABLEGENERATION,
  CAST(AVAILABLELOAD AS DOUBLE) AS AVAILABLELOAD,
  CAST(INITIALSUPPLY AS DOUBLE) AS INITIALSUPPLY,
  CAST(CLEAREDSUPPLY AS DOUBLE) AS CLEAREDSUPPLY,
  CAST(LOWERREGIMPORT AS DOUBLE) AS LOWERREGIMPORT,
  CAST(LOWERREGLOCALDISPATCH AS DOUBLE) AS LOWERREGLOCALDISPATCH,
  CAST(LOWERREGLOCALREQ AS DOUBLE) AS LOWERREGLOCALREQ,
  CAST(LOWERREGREQ AS DOUBLE) AS LOWERREGREQ,
  CAST(RAISEREGIMPORT AS DOUBLE) AS RAISEREGIMPORT,
  CAST(RAISEREGLOCALDISPATCH AS DOUBLE) AS RAISEREGLOCALDISPATCH,
  CAST(RAISEREGLOCALREQ AS DOUBLE) AS RAISEREGLOCALREQ,
  CAST(RAISEREGREQ AS DOUBLE) AS RAISEREGREQ,
  CAST(RAISE5MINLOCALVIOLATION AS DOUBLE) AS RAISE5MINLOCALVIOLATION,
  CAST(RAISEREGLOCALVIOLATION AS DOUBLE) AS RAISEREGLOCALVIOLATION,
  CAST(RAISE60SECLOCALVIOLATION AS DOUBLE) AS RAISE60SECLOCALVIOLATION,
  CAST(RAISE6SECLOCALVIOLATION AS DOUBLE) AS RAISE6SECLOCALVIOLATION,
  CAST(LOWER5MINLOCALVIOLATION AS DOUBLE) AS LOWER5MINLOCALVIOLATION,
  CAST(LOWERREGLOCALVIOLATION AS DOUBLE) AS LOWERREGLOCALVIOLATION,
  CAST(LOWER60SECLOCALVIOLATION AS DOUBLE) AS LOWER60SECLOCALVIOLATION,
  CAST(LOWER6SECLOCALVIOLATION AS DOUBLE) AS LOWER6SECLOCALVIOLATION,
  CAST(RAISE5MINVIOLATION AS DOUBLE) AS RAISE5MINVIOLATION,
  CAST(RAISEREGVIOLATION AS DOUBLE) AS RAISEREGVIOLATION,
  CAST(RAISE60SECVIOLATION AS DOUBLE) AS RAISE60SECVIOLATION,
  CAST(RAISE6SECVIOLATION AS DOUBLE) AS RAISE6SECVIOLATION,
  CAST(LOWER5MINVIOLATION AS DOUBLE) AS LOWER5MINVIOLATION,
  CAST(LOWERREGVIOLATION AS DOUBLE) AS LOWERREGVIOLATION,
  CAST(LOWER60SECVIOLATION AS DOUBLE) AS LOWER60SECVIOLATION,
  CAST(LOWER6SECVIOLATION AS DOUBLE) AS LOWER6SECVIOLATION,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  CAST(LORSURPLUS AS DOUBLE) AS LORSURPLUS,
  CAST(LRCSURPLUS AS DOUBLE) AS LRCSURPLUS,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m11:21:10.786737 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price"
  
    as (
      



WITH price_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('price_daily_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'TOTALDEMAND': 'VARCHAR',
      'DEMANDFORECAST': 'VARCHAR',
      'DISPATCHABLEGENERATION': 'VARCHAR',
      'DISPATCHABLELOAD': 'VARCHAR',
      'NETINTERCHANGE': 'VARCHAR',
      'EXCESSGENERATION': 'VARCHAR',
      'LOWER5MINDISPATCH': 'VARCHAR',
      'LOWER5MINIMPORT': 'VARCHAR',
      'LOWER5MINLOCALDISPATCH': 'VARCHAR',
      'LOWER5MINLOCALPRICE': 'VARCHAR',
      'LOWER5MINLOCALREQ': 'VARCHAR',
      'LOWER5MINPRICE': 'VARCHAR',
      'LOWER5MINREQ': 'VARCHAR',
      'LOWER5MINSUPPLYPRICE': 'VARCHAR',
      'LOWER60SECDISPATCH': 'VARCHAR',
      'LOWER60SECIMPORT': 'VARCHAR',
      'LOWER60SECLOCALDISPATCH': 'VARCHAR',
      'LOWER60SECLOCALPRICE': 'VARCHAR',
      'LOWER60SECLOCALREQ': 'VARCHAR',
      'LOWER60SECPRICE': 'VARCHAR',
      'LOWER60SECREQ': 'VARCHAR',
      'LOWER60SECSUPPLYPRICE': 'VARCHAR',
      'LOWER6SECDISPATCH': 'VARCHAR',
      'LOWER6SECIMPORT': 'VARCHAR',
      'LOWER6SECLOCALDISPATCH': 'VARCHAR',
      'LOWER6SECLOCALPRICE': 'VARCHAR',
      'LOWER6SECLOCALREQ': 'VARCHAR',
      'LOWER6SECPRICE': 'VARCHAR',
      'LOWER6SECREQ': 'VARCHAR',
      'LOWER6SECSUPPLYPRICE': 'VARCHAR',
      'RAISE5MINDISPATCH': 'VARCHAR',
      'RAISE5MINIMPORT': 'VARCHAR',
      'RAISE5MINLOCALDISPATCH': 'VARCHAR',
      'RAISE5MINLOCALPRICE': 'VARCHAR',
      'RAISE5MINLOCALREQ': 'VARCHAR',
      'RAISE5MINPRICE': 'VARCHAR',
      'RAISE5MINREQ': 'VARCHAR',
      'RAISE5MINSUPPLYPRICE': 'VARCHAR',
      'RAISE60SECDISPATCH': 'VARCHAR',
      'RAISE60SECIMPORT': 'VARCHAR',
      'RAISE60SECLOCALDISPATCH': 'VARCHAR',
      'RAISE60SECLOCALPRICE': 'VARCHAR',
      'RAISE60SECLOCALREQ': 'VARCHAR',
      'RAISE60SECPRICE': 'VARCHAR',
      'RAISE60SECREQ': 'VARCHAR',
      'RAISE60SECSUPPLYPRICE': 'VARCHAR',
      'RAISE6SECDISPATCH': 'VARCHAR',
      'RAISE6SECIMPORT': 'VARCHAR',
      'RAISE6SECLOCALDISPATCH': 'VARCHAR',
      'RAISE6SECLOCALPRICE': 'VARCHAR',
      'RAISE6SECLOCALREQ': 'VARCHAR',
      'RAISE6SECPRICE': 'VARCHAR',
      'RAISE6SECREQ': 'VARCHAR',
      'RAISE6SECSUPPLYPRICE': 'VARCHAR',
      'AGGREGATEDISPATCHERROR': 'VARCHAR',
      'AVAILABLEGENERATION': 'VARCHAR',
      'AVAILABLELOAD': 'VARCHAR',
      'INITIALSUPPLY': 'VARCHAR',
      'CLEAREDSUPPLY': 'VARCHAR',
      'LOWERREGIMPORT': 'VARCHAR',
      'LOWERREGLOCALDISPATCH': 'VARCHAR',
      'LOWERREGLOCALREQ': 'VARCHAR',
      'LOWERREGREQ': 'VARCHAR',
      'RAISEREGIMPORT': 'VARCHAR',
      'RAISEREGLOCALDISPATCH': 'VARCHAR',
      'RAISEREGLOCALREQ': 'VARCHAR',
      'RAISEREGREQ': 'VARCHAR',
      'RAISE5MINLOCALVIOLATION': 'VARCHAR',
      'RAISEREGLOCALVIOLATION': 'VARCHAR',
      'RAISE60SECLOCALVIOLATION': 'VARCHAR',
      'RAISE6SECLOCALVIOLATION': 'VARCHAR',
      'LOWER5MINLOCALVIOLATION': 'VARCHAR',
      'LOWERREGLOCALVIOLATION': 'VARCHAR',
      'LOWER60SECLOCALVIOLATION': 'VARCHAR',
      'LOWER6SECLOCALVIOLATION': 'VARCHAR',
      'RAISE5MINVIOLATION': 'VARCHAR',
      'RAISEREGVIOLATION': 'VARCHAR',
      'RAISE60SECVIOLATION': 'VARCHAR',
      'RAISE6SECVIOLATION': 'VARCHAR',
      'LOWER5MINVIOLATION': 'VARCHAR',
      'LOWERREGVIOLATION': 'VARCHAR',
      'LOWER60SECVIOLATION': 'VARCHAR',
      'LOWER6SECVIOLATION': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR',
      'LORSURPLUS': 'VARCHAR',
      'LRCSURPLUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DREGION' AND VERSION = '3'
)

SELECT
  UNIT,
  REGIONID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(TOTALDEMAND AS DOUBLE) AS TOTALDEMAND,
  CAST(DEMANDFORECAST AS DOUBLE) AS DEMANDFORECAST,
  CAST(DISPATCHABLEGENERATION AS DOUBLE) AS DISPATCHABLEGENERATION,
  CAST(DISPATCHABLELOAD AS DOUBLE) AS DISPATCHABLELOAD,
  CAST(NETINTERCHANGE AS DOUBLE) AS NETINTERCHANGE,
  CAST(EXCESSGENERATION AS DOUBLE) AS EXCESSGENERATION,
  CAST(LOWER5MINDISPATCH AS DOUBLE) AS LOWER5MINDISPATCH,
  CAST(LOWER5MINIMPORT AS DOUBLE) AS LOWER5MINIMPORT,
  CAST(LOWER5MINLOCALDISPATCH AS DOUBLE) AS LOWER5MINLOCALDISPATCH,
  CAST(LOWER5MINLOCALPRICE AS DOUBLE) AS LOWER5MINLOCALPRICE,
  CAST(LOWER5MINLOCALREQ AS DOUBLE) AS LOWER5MINLOCALREQ,
  CAST(LOWER5MINPRICE AS DOUBLE) AS LOWER5MINPRICE,
  CAST(LOWER5MINREQ AS DOUBLE) AS LOWER5MINREQ,
  CAST(LOWER5MINSUPPLYPRICE AS DOUBLE) AS LOWER5MINSUPPLYPRICE,
  CAST(LOWER60SECDISPATCH AS DOUBLE) AS LOWER60SECDISPATCH,
  CAST(LOWER60SECIMPORT AS DOUBLE) AS LOWER60SECIMPORT,
  CAST(LOWER60SECLOCALDISPATCH AS DOUBLE) AS LOWER60SECLOCALDISPATCH,
  CAST(LOWER60SECLOCALPRICE AS DOUBLE) AS LOWER60SECLOCALPRICE,
  CAST(LOWER60SECLOCALREQ AS DOUBLE) AS LOWER60SECLOCALREQ,
  CAST(LOWER60SECPRICE AS DOUBLE) AS LOWER60SECPRICE,
  CAST(LOWER60SECREQ AS DOUBLE) AS LOWER60SECREQ,
  CAST(LOWER60SECSUPPLYPRICE AS DOUBLE) AS LOWER60SECSUPPLYPRICE,
  CAST(LOWER6SECDISPATCH AS DOUBLE) AS LOWER6SECDISPATCH,
  CAST(LOWER6SECIMPORT AS DOUBLE) AS LOWER6SECIMPORT,
  CAST(LOWER6SECLOCALDISPATCH AS DOUBLE) AS LOWER6SECLOCALDISPATCH,
  CAST(LOWER6SECLOCALPRICE AS DOUBLE) AS LOWER6SECLOCALPRICE,
  CAST(LOWER6SECLOCALREQ AS DOUBLE) AS LOWER6SECLOCALREQ,
  CAST(LOWER6SECPRICE AS DOUBLE) AS LOWER6SECPRICE,
  CAST(LOWER6SECREQ AS DOUBLE) AS LOWER6SECREQ,
  CAST(LOWER6SECSUPPLYPRICE AS DOUBLE) AS LOWER6SECSUPPLYPRICE,
  CAST(RAISE5MINDISPATCH AS DOUBLE) AS RAISE5MINDISPATCH,
  CAST(RAISE5MINIMPORT AS DOUBLE) AS RAISE5MINIMPORT,
  CAST(RAISE5MINLOCALDISPATCH AS DOUBLE) AS RAISE5MINLOCALDISPATCH,
  CAST(RAISE5MINLOCALPRICE AS DOUBLE) AS RAISE5MINLOCALPRICE,
  CAST(RAISE5MINLOCALREQ AS DOUBLE) AS RAISE5MINLOCALREQ,
  CAST(RAISE5MINPRICE AS DOUBLE) AS RAISE5MINPRICE,
  CAST(RAISE5MINREQ AS DOUBLE) AS RAISE5MINREQ,
  CAST(RAISE5MINSUPPLYPRICE AS DOUBLE) AS RAISE5MINSUPPLYPRICE,
  CAST(RAISE60SECDISPATCH AS DOUBLE) AS RAISE60SECDISPATCH,
  CAST(RAISE60SECIMPORT AS DOUBLE) AS RAISE60SECIMPORT,
  CAST(RAISE60SECLOCALDISPATCH AS DOUBLE) AS RAISE60SECLOCALDISPATCH,
  CAST(RAISE60SECLOCALPRICE AS DOUBLE) AS RAISE60SECLOCALPRICE,
  CAST(RAISE60SECLOCALREQ AS DOUBLE) AS RAISE60SECLOCALREQ,
  CAST(RAISE60SECPRICE AS DOUBLE) AS RAISE60SECPRICE,
  CAST(RAISE60SECREQ AS DOUBLE) AS RAISE60SECREQ,
  CAST(RAISE60SECSUPPLYPRICE AS DOUBLE) AS RAISE60SECSUPPLYPRICE,
  CAST(RAISE6SECDISPATCH AS DOUBLE) AS RAISE6SECDISPATCH,
  CAST(RAISE6SECIMPORT AS DOUBLE) AS RAISE6SECIMPORT,
  CAST(RAISE6SECLOCALDISPATCH AS DOUBLE) AS RAISE6SECLOCALDISPATCH,
  CAST(RAISE6SECLOCALPRICE AS DOUBLE) AS RAISE6SECLOCALPRICE,
  CAST(RAISE6SECLOCALREQ AS DOUBLE) AS RAISE6SECLOCALREQ,
  CAST(RAISE6SECPRICE AS DOUBLE) AS RAISE6SECPRICE,
  CAST(RAISE6SECREQ AS DOUBLE) AS RAISE6SECREQ,
  CAST(RAISE6SECSUPPLYPRICE AS DOUBLE) AS RAISE6SECSUPPLYPRICE,
  CAST(AGGREGATEDISPATCHERROR AS DOUBLE) AS AGGREGATEDISPATCHERROR,
  CAST(AVAILABLEGENERATION AS DOUBLE) AS AVAILABLEGENERATION,
  CAST(AVAILABLELOAD AS DOUBLE) AS AVAILABLELOAD,
  CAST(INITIALSUPPLY AS DOUBLE) AS INITIALSUPPLY,
  CAST(CLEAREDSUPPLY AS DOUBLE) AS CLEAREDSUPPLY,
  CAST(LOWERREGIMPORT AS DOUBLE) AS LOWERREGIMPORT,
  CAST(LOWERREGLOCALDISPATCH AS DOUBLE) AS LOWERREGLOCALDISPATCH,
  CAST(LOWERREGLOCALREQ AS DOUBLE) AS LOWERREGLOCALREQ,
  CAST(LOWERREGREQ AS DOUBLE) AS LOWERREGREQ,
  CAST(RAISEREGIMPORT AS DOUBLE) AS RAISEREGIMPORT,
  CAST(RAISEREGLOCALDISPATCH AS DOUBLE) AS RAISEREGLOCALDISPATCH,
  CAST(RAISEREGLOCALREQ AS DOUBLE) AS RAISEREGLOCALREQ,
  CAST(RAISEREGREQ AS DOUBLE) AS RAISEREGREQ,
  CAST(RAISE5MINLOCALVIOLATION AS DOUBLE) AS RAISE5MINLOCALVIOLATION,
  CAST(RAISEREGLOCALVIOLATION AS DOUBLE) AS RAISEREGLOCALVIOLATION,
  CAST(RAISE60SECLOCALVIOLATION AS DOUBLE) AS RAISE60SECLOCALVIOLATION,
  CAST(RAISE6SECLOCALVIOLATION AS DOUBLE) AS RAISE6SECLOCALVIOLATION,
  CAST(LOWER5MINLOCALVIOLATION AS DOUBLE) AS LOWER5MINLOCALVIOLATION,
  CAST(LOWERREGLOCALVIOLATION AS DOUBLE) AS LOWERREGLOCALVIOLATION,
  CAST(LOWER60SECLOCALVIOLATION AS DOUBLE) AS LOWER60SECLOCALVIOLATION,
  CAST(LOWER6SECLOCALVIOLATION AS DOUBLE) AS LOWER6SECLOCALVIOLATION,
  CAST(RAISE5MINVIOLATION AS DOUBLE) AS RAISE5MINVIOLATION,
  CAST(RAISEREGVIOLATION AS DOUBLE) AS RAISEREGVIOLATION,
  CAST(RAISE60SECVIOLATION AS DOUBLE) AS RAISE60SECVIOLATION,
  CAST(RAISE6SECVIOLATION AS DOUBLE) AS RAISE6SECVIOLATION,
  CAST(LOWER5MINVIOLATION AS DOUBLE) AS LOWER5MINVIOLATION,
  CAST(LOWERREGVIOLATION AS DOUBLE) AS LOWERREGVIOLATION,
  CAST(LOWER60SECVIOLATION AS DOUBLE) AS LOWER60SECVIOLATION,
  CAST(LOWER6SECVIOLATION AS DOUBLE) AS LOWER6SECVIOLATION,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  CAST(LORSURPLUS AS DOUBLE) AS LORSURPLUS,
  CAST(LRCSURPLUS AS DOUBLE) AS LRCSURPLUS,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m11:21:10.786737 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m11:21:10.786737 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: ROLLBACK
[0m11:21:10.802530 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_price'
[0m11:21:10.802530 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: Close
[0m11:21:10.820447 [debug] [Thread-1 (]: Runtime Error in model fct_price (models\marts\fct_price.sql)
  IO Error: No files found that match the pattern "zip://c:/lakehouse/default/Files/csv/daily/year=2026/source_file=PUBLIC_DAILY_202602010000_20260202040506/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^
[0m11:21:10.820447 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fcdb120-4072-4b7f-b418-3c0279c1751e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AED5BC0D0>]}
[0m11:21:10.820447 [error] [Thread-1 (]: 4 of 8 ERROR creating sql incremental model aemo.fct_price ..................... [[31mERROR[0m in 3.31s]
[0m11:21:10.820447 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_price
[0m11:21:10.820447 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_price_today
[0m11:21:10.820447 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_price' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_price (models\marts\fct_price.sql)
  IO Error: No files found that match the pattern "zip://c:/lakehouse/default/Files/csv/daily/year=2026/source_file=PUBLIC_DAILY_202602010000_20260202040506/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^.
[0m11:21:10.820447 [info ] [Thread-1 (]: 5 of 8 START sql incremental model aemo.fct_price_today ........................ [RUN]
[0m11:21:10.820447 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.fct_price, now model.aemo_electricity.fct_price_today)
[0m11:21:10.820447 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_price_today
[0m11:21:10.835321 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_price_today"
[0m11:21:10.837326 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_price_today
[0m11:21:10.838416 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price_today"
[0m11:21:10.838416 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: BEGIN
[0m11:21:10.838416 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:21:10.838416 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:21:10.838416 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price_today"
[0m11:21:10.838416 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price_today"} */

        SET VARIABLE price_today_paths = (SELECT COALESCE(NULLIF(list('zip://' || 'c:/lakehouse/default/Files/csv' || '/price_today/day=' || substring(source_filename, 19, 8) || '/source_file=' || source_filename || '/data_0.zip/*.CSV'), []), ['']) FROM "ducklake"."aemo"."stg_csv_archive_log" WHERE source_type = 'price_today')
      
[0m11:21:10.864278 [debug] [Thread-1 (]: SQL status: OK in 0.015 seconds
[0m11:21:10.866358 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_price_today"
[0m11:21:10.867763 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price_today"
[0m11:21:10.867763 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price_today"
  
    as (
      



WITH price_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('price_today_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'PRICE': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'DISPATCHINTERVAL': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'LASTCHANGED': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'PRICE_STATUS': 'VARCHAR',
      'PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'RAISE1SECRRP': 'VARCHAR',
      'RAISE1SECROP': 'VARCHAR',
      'RAISE1SECAPCFLAG': 'VARCHAR',
      'LOWER1SECRRP': 'VARCHAR',
      'LOWER1SECROP': 'VARCHAR',
      'LOWER1SECAPCFLAG': 'VARCHAR',
      'PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'OCD_STATUS': 'VARCHAR',
      'MII_STATUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND PRICE = 'PRICE'
)

SELECT
  REGIONID,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(DISPATCHINTERVAL AS DOUBLE) AS DISPATCHINTERVAL,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(PRE_AP_ENERGY_PRICE AS DOUBLE) AS PRE_AP_ENERGY_PRICE,
  CAST(PRE_AP_RAISE6_PRICE AS DOUBLE) AS PRE_AP_RAISE6_PRICE,
  CAST(PRE_AP_RAISE60_PRICE AS DOUBLE) AS PRE_AP_RAISE60_PRICE,
  CAST(PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS PRE_AP_RAISE5MIN_PRICE,
  CAST(PRE_AP_RAISEREG_PRICE AS DOUBLE) AS PRE_AP_RAISEREG_PRICE,
  CAST(PRE_AP_LOWER6_PRICE AS DOUBLE) AS PRE_AP_LOWER6_PRICE,
  CAST(PRE_AP_LOWER60_PRICE AS DOUBLE) AS PRE_AP_LOWER60_PRICE,
  CAST(PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS PRE_AP_LOWER5MIN_PRICE,
  CAST(PRE_AP_LOWERREG_PRICE AS DOUBLE) AS PRE_AP_LOWERREG_PRICE,
  CAST(RAISE1SECRRP AS DOUBLE) AS RAISE1SECRRP,
  CAST(RAISE1SECROP AS DOUBLE) AS RAISE1SECROP,
  CAST(RAISE1SECAPCFLAG AS DOUBLE) AS RAISE1SECAPCFLAG,
  CAST(LOWER1SECRRP AS DOUBLE) AS LOWER1SECRRP,
  CAST(LOWER1SECROP AS DOUBLE) AS LOWER1SECROP,
  CAST(LOWER1SECAPCFLAG AS DOUBLE) AS LOWER1SECAPCFLAG,
  CAST(PRE_AP_RAISE1_PRICE AS DOUBLE) AS PRE_AP_RAISE1_PRICE,
  CAST(PRE_AP_LOWER1_PRICE AS DOUBLE) AS PRE_AP_LOWER1_PRICE,
  CAST(CUMUL_PRE_AP_ENERGY_PRICE AS DOUBLE) AS CUMUL_PRE_AP_ENERGY_PRICE,
  CAST(CUMUL_PRE_AP_RAISE6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE6_PRICE,
  CAST(CUMUL_PRE_AP_RAISE60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE60_PRICE,
  CAST(CUMUL_PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE5MIN_PRICE,
  CAST(CUMUL_PRE_AP_RAISEREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISEREG_PRICE,
  CAST(CUMUL_PRE_AP_LOWER6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER6_PRICE,
  CAST(CUMUL_PRE_AP_LOWER60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER60_PRICE,
  CAST(CUMUL_PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER5MIN_PRICE,
  CAST(CUMUL_PRE_AP_LOWERREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWERREG_PRICE,
  CAST(CUMUL_PRE_AP_RAISE1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE1_PRICE,
  CAST(CUMUL_PRE_AP_LOWER1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER1_PRICE,
  SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m11:21:10.872868 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price_today"
  
    as (
      



WITH price_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('price_today_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'PRICE': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'DISPATCHINTERVAL': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'LASTCHANGED': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'PRICE_STATUS': 'VARCHAR',
      'PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'RAISE1SECRRP': 'VARCHAR',
      'RAISE1SECROP': 'VARCHAR',
      'RAISE1SECAPCFLAG': 'VARCHAR',
      'LOWER1SECRRP': 'VARCHAR',
      'LOWER1SECROP': 'VARCHAR',
      'LOWER1SECAPCFLAG': 'VARCHAR',
      'PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'OCD_STATUS': 'VARCHAR',
      'MII_STATUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND PRICE = 'PRICE'
)

SELECT
  REGIONID,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(DISPATCHINTERVAL AS DOUBLE) AS DISPATCHINTERVAL,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(PRE_AP_ENERGY_PRICE AS DOUBLE) AS PRE_AP_ENERGY_PRICE,
  CAST(PRE_AP_RAISE6_PRICE AS DOUBLE) AS PRE_AP_RAISE6_PRICE,
  CAST(PRE_AP_RAISE60_PRICE AS DOUBLE) AS PRE_AP_RAISE60_PRICE,
  CAST(PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS PRE_AP_RAISE5MIN_PRICE,
  CAST(PRE_AP_RAISEREG_PRICE AS DOUBLE) AS PRE_AP_RAISEREG_PRICE,
  CAST(PRE_AP_LOWER6_PRICE AS DOUBLE) AS PRE_AP_LOWER6_PRICE,
  CAST(PRE_AP_LOWER60_PRICE AS DOUBLE) AS PRE_AP_LOWER60_PRICE,
  CAST(PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS PRE_AP_LOWER5MIN_PRICE,
  CAST(PRE_AP_LOWERREG_PRICE AS DOUBLE) AS PRE_AP_LOWERREG_PRICE,
  CAST(RAISE1SECRRP AS DOUBLE) AS RAISE1SECRRP,
  CAST(RAISE1SECROP AS DOUBLE) AS RAISE1SECROP,
  CAST(RAISE1SECAPCFLAG AS DOUBLE) AS RAISE1SECAPCFLAG,
  CAST(LOWER1SECRRP AS DOUBLE) AS LOWER1SECRRP,
  CAST(LOWER1SECROP AS DOUBLE) AS LOWER1SECROP,
  CAST(LOWER1SECAPCFLAG AS DOUBLE) AS LOWER1SECAPCFLAG,
  CAST(PRE_AP_RAISE1_PRICE AS DOUBLE) AS PRE_AP_RAISE1_PRICE,
  CAST(PRE_AP_LOWER1_PRICE AS DOUBLE) AS PRE_AP_LOWER1_PRICE,
  CAST(CUMUL_PRE_AP_ENERGY_PRICE AS DOUBLE) AS CUMUL_PRE_AP_ENERGY_PRICE,
  CAST(CUMUL_PRE_AP_RAISE6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE6_PRICE,
  CAST(CUMUL_PRE_AP_RAISE60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE60_PRICE,
  CAST(CUMUL_PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE5MIN_PRICE,
  CAST(CUMUL_PRE_AP_RAISEREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISEREG_PRICE,
  CAST(CUMUL_PRE_AP_LOWER6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER6_PRICE,
  CAST(CUMUL_PRE_AP_LOWER60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER60_PRICE,
  CAST(CUMUL_PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER5MIN_PRICE,
  CAST(CUMUL_PRE_AP_LOWERREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWERREG_PRICE,
  CAST(CUMUL_PRE_AP_RAISE1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE1_PRICE,
  CAST(CUMUL_PRE_AP_LOWER1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER1_PRICE,
  SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m11:21:10.872868 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m11:21:10.872868 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: ROLLBACK
[0m11:21:10.880447 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_price_today'
[0m11:21:10.880447 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: Close
[0m11:21:10.880447 [debug] [Thread-1 (]: Runtime Error in model fct_price_today (models\marts\fct_price_today.sql)
  IO Error: No files found that match the pattern "zip://c:/lakehouse/default/Files/csv/price_today/day=20260202/source_file=PUBLIC_DISPATCHIS_202602021110_0000000501570650/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^
[0m11:21:10.880447 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fcdb120-4072-4b7f-b418-3c0279c1751e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AED5BE750>]}
[0m11:21:10.880447 [error] [Thread-1 (]: 5 of 8 ERROR creating sql incremental model aemo.fct_price_today ............... [[31mERROR[0m in 0.06s]
[0m11:21:10.880447 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_price_today
[0m11:21:10.888267 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_scada
[0m11:21:10.888716 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_price_today' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_price_today (models\marts\fct_price_today.sql)
  IO Error: No files found that match the pattern "zip://c:/lakehouse/default/Files/csv/price_today/day=20260202/source_file=PUBLIC_DISPATCHIS_202602021110_0000000501570650/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^.
[0m11:21:10.888716 [info ] [Thread-1 (]: 6 of 8 START sql incremental model aemo.fct_scada .............................. [RUN]
[0m11:21:10.888716 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.fct_price_today, now model.aemo_electricity.fct_scada)
[0m11:21:10.888716 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_scada
[0m11:21:10.894710 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_scada"
[0m11:21:10.896880 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_scada
[0m11:21:10.901844 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada"
[0m11:21:10.902826 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: BEGIN
[0m11:21:10.902826 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:21:10.902826 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:21:10.902826 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada"
[0m11:21:10.904985 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada"} */

        SET VARIABLE scada_daily_paths = (SELECT COALESCE(NULLIF(list('zip://' || 'c:/lakehouse/default/Files/csv' || '/daily/year=' || substring(source_filename, 14, 4) || '/source_file=' || source_filename || '/data_0.zip/*.CSV'), []), ['']) FROM "ducklake"."aemo"."stg_csv_archive_log" WHERE source_type = 'daily')
      
[0m11:21:10.921460 [debug] [Thread-1 (]: SQL status: OK in 0.016 seconds
[0m11:21:10.922473 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_scada"
[0m11:21:10.922473 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada"
[0m11:21:10.922473 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada"
  
    as (
      



WITH scada_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('scada_daily_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'DUID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'DISPATCHMODE': 'VARCHAR',
      'AGCSTATUS': 'VARCHAR',
      'INITIALMW': 'VARCHAR',
      'TOTALCLEARED': 'VARCHAR',
      'RAMPDOWNRATE': 'VARCHAR',
      'RAMPUPRATE': 'VARCHAR',
      'LOWER5MIN': 'VARCHAR',
      'LOWER60SEC': 'VARCHAR',
      'LOWER6SEC': 'VARCHAR',
      'RAISE5MIN': 'VARCHAR',
      'RAISE60SEC': 'VARCHAR',
      'RAISE6SEC': 'VARCHAR',
      'MARGINAL5MINVALUE': 'VARCHAR',
      'MARGINAL60SECVALUE': 'VARCHAR',
      'MARGINAL6SECVALUE': 'VARCHAR',
      'MARGINALVALUE': 'VARCHAR',
      'VIOLATION5MINDEGREE': 'VARCHAR',
      'VIOLATION60SECDEGREE': 'VARCHAR',
      'VIOLATION6SECDEGREE': 'VARCHAR',
      'VIOLATIONDEGREE': 'VARCHAR',
      'LOWERREG': 'VARCHAR',
      'RAISEREG': 'VARCHAR',
      'AVAILABILITY': 'VARCHAR',
      'RAISE6SECFLAGS': 'VARCHAR',
      'RAISE60SECFLAGS': 'VARCHAR',
      'RAISE5MINFLAGS': 'VARCHAR',
      'RAISEREGFLAGS': 'VARCHAR',
      'LOWER6SECFLAGS': 'VARCHAR',
      'LOWER60SECFLAGS': 'VARCHAR',
      'LOWER5MINFLAGS': 'VARCHAR',
      'LOWERREGFLAGS': 'VARCHAR',
      'RAISEREGAVAILABILITY': 'VARCHAR',
      'RAISEREGENABLEMENTMAX': 'VARCHAR',
      'RAISEREGENABLEMENTMIN': 'VARCHAR',
      'LOWERREGAVAILABILITY': 'VARCHAR',
      'LOWERREGENABLEMENTMAX': 'VARCHAR',
      'LOWERREGENABLEMENTMIN': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DUNIT' AND VERSION = '3'
)

SELECT
  UNIT,
  DUID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(DISPATCHMODE AS DOUBLE) AS DISPATCHMODE,
  CAST(AGCSTATUS AS DOUBLE) AS AGCSTATUS,
  CAST(INITIALMW AS DOUBLE) AS INITIALMW,
  CAST(TOTALCLEARED AS DOUBLE) AS TOTALCLEARED,
  CAST(RAMPDOWNRATE AS DOUBLE) AS RAMPDOWNRATE,
  CAST(RAMPUPRATE AS DOUBLE) AS RAMPUPRATE,
  CAST(LOWER5MIN AS DOUBLE) AS LOWER5MIN,
  CAST(LOWER60SEC AS DOUBLE) AS LOWER60SEC,
  CAST(LOWER6SEC AS DOUBLE) AS LOWER6SEC,
  CAST(RAISE5MIN AS DOUBLE) AS RAISE5MIN,
  CAST(RAISE60SEC AS DOUBLE) AS RAISE60SEC,
  CAST(RAISE6SEC AS DOUBLE) AS RAISE6SEC,
  CAST(MARGINAL5MINVALUE AS DOUBLE) AS MARGINAL5MINVALUE,
  CAST(MARGINAL60SECVALUE AS DOUBLE) AS MARGINAL60SECVALUE,
  CAST(MARGINAL6SECVALUE AS DOUBLE) AS MARGINAL6SECVALUE,
  CAST(MARGINALVALUE AS DOUBLE) AS MARGINALVALUE,
  CAST(VIOLATION5MINDEGREE AS DOUBLE) AS VIOLATION5MINDEGREE,
  CAST(VIOLATION60SECDEGREE AS DOUBLE) AS VIOLATION60SECDEGREE,
  CAST(VIOLATION6SECDEGREE AS DOUBLE) AS VIOLATION6SECDEGREE,
  CAST(VIOLATIONDEGREE AS DOUBLE) AS VIOLATIONDEGREE,
  CAST(LOWERREG AS DOUBLE) AS LOWERREG,
  CAST(RAISEREG AS DOUBLE) AS RAISEREG,
  CAST(AVAILABILITY AS DOUBLE) AS AVAILABILITY,
  CAST(RAISE6SECFLAGS AS DOUBLE) AS RAISE6SECFLAGS,
  CAST(RAISE60SECFLAGS AS DOUBLE) AS RAISE60SECFLAGS,
  CAST(RAISE5MINFLAGS AS DOUBLE) AS RAISE5MINFLAGS,
  CAST(RAISEREGFLAGS AS DOUBLE) AS RAISEREGFLAGS,
  CAST(LOWER6SECFLAGS AS DOUBLE) AS LOWER6SECFLAGS,
  CAST(LOWER60SECFLAGS AS DOUBLE) AS LOWER60SECFLAGS,
  CAST(LOWER5MINFLAGS AS DOUBLE) AS LOWER5MINFLAGS,
  CAST(LOWERREGFLAGS AS DOUBLE) AS LOWERREGFLAGS,
  CAST(RAISEREGAVAILABILITY AS DOUBLE) AS RAISEREGAVAILABILITY,
  CAST(RAISEREGENABLEMENTMAX AS DOUBLE) AS RAISEREGENABLEMENTMAX,
  CAST(RAISEREGENABLEMENTMIN AS DOUBLE) AS RAISEREGENABLEMENTMIN,
  CAST(LOWERREGAVAILABILITY AS DOUBLE) AS LOWERREGAVAILABILITY,
  CAST(LOWERREGENABLEMENTMAX AS DOUBLE) AS LOWERREGENABLEMENTMAX,
  CAST(LOWERREGENABLEMENTMIN AS DOUBLE) AS LOWERREGENABLEMENTMIN,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m11:21:10.922473 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada"
  
    as (
      



WITH scada_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('scada_daily_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'DUID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'DISPATCHMODE': 'VARCHAR',
      'AGCSTATUS': 'VARCHAR',
      'INITIALMW': 'VARCHAR',
      'TOTALCLEARED': 'VARCHAR',
      'RAMPDOWNRATE': 'VARCHAR',
      'RAMPUPRATE': 'VARCHAR',
      'LOWER5MIN': 'VARCHAR',
      'LOWER60SEC': 'VARCHAR',
      'LOWER6SEC': 'VARCHAR',
      'RAISE5MIN': 'VARCHAR',
      'RAISE60SEC': 'VARCHAR',
      'RAISE6SEC': 'VARCHAR',
      'MARGINAL5MINVALUE': 'VARCHAR',
      'MARGINAL60SECVALUE': 'VARCHAR',
      'MARGINAL6SECVALUE': 'VARCHAR',
      'MARGINALVALUE': 'VARCHAR',
      'VIOLATION5MINDEGREE': 'VARCHAR',
      'VIOLATION60SECDEGREE': 'VARCHAR',
      'VIOLATION6SECDEGREE': 'VARCHAR',
      'VIOLATIONDEGREE': 'VARCHAR',
      'LOWERREG': 'VARCHAR',
      'RAISEREG': 'VARCHAR',
      'AVAILABILITY': 'VARCHAR',
      'RAISE6SECFLAGS': 'VARCHAR',
      'RAISE60SECFLAGS': 'VARCHAR',
      'RAISE5MINFLAGS': 'VARCHAR',
      'RAISEREGFLAGS': 'VARCHAR',
      'LOWER6SECFLAGS': 'VARCHAR',
      'LOWER60SECFLAGS': 'VARCHAR',
      'LOWER5MINFLAGS': 'VARCHAR',
      'LOWERREGFLAGS': 'VARCHAR',
      'RAISEREGAVAILABILITY': 'VARCHAR',
      'RAISEREGENABLEMENTMAX': 'VARCHAR',
      'RAISEREGENABLEMENTMIN': 'VARCHAR',
      'LOWERREGAVAILABILITY': 'VARCHAR',
      'LOWERREGENABLEMENTMAX': 'VARCHAR',
      'LOWERREGENABLEMENTMIN': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DUNIT' AND VERSION = '3'
)

SELECT
  UNIT,
  DUID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(DISPATCHMODE AS DOUBLE) AS DISPATCHMODE,
  CAST(AGCSTATUS AS DOUBLE) AS AGCSTATUS,
  CAST(INITIALMW AS DOUBLE) AS INITIALMW,
  CAST(TOTALCLEARED AS DOUBLE) AS TOTALCLEARED,
  CAST(RAMPDOWNRATE AS DOUBLE) AS RAMPDOWNRATE,
  CAST(RAMPUPRATE AS DOUBLE) AS RAMPUPRATE,
  CAST(LOWER5MIN AS DOUBLE) AS LOWER5MIN,
  CAST(LOWER60SEC AS DOUBLE) AS LOWER60SEC,
  CAST(LOWER6SEC AS DOUBLE) AS LOWER6SEC,
  CAST(RAISE5MIN AS DOUBLE) AS RAISE5MIN,
  CAST(RAISE60SEC AS DOUBLE) AS RAISE60SEC,
  CAST(RAISE6SEC AS DOUBLE) AS RAISE6SEC,
  CAST(MARGINAL5MINVALUE AS DOUBLE) AS MARGINAL5MINVALUE,
  CAST(MARGINAL60SECVALUE AS DOUBLE) AS MARGINAL60SECVALUE,
  CAST(MARGINAL6SECVALUE AS DOUBLE) AS MARGINAL6SECVALUE,
  CAST(MARGINALVALUE AS DOUBLE) AS MARGINALVALUE,
  CAST(VIOLATION5MINDEGREE AS DOUBLE) AS VIOLATION5MINDEGREE,
  CAST(VIOLATION60SECDEGREE AS DOUBLE) AS VIOLATION60SECDEGREE,
  CAST(VIOLATION6SECDEGREE AS DOUBLE) AS VIOLATION6SECDEGREE,
  CAST(VIOLATIONDEGREE AS DOUBLE) AS VIOLATIONDEGREE,
  CAST(LOWERREG AS DOUBLE) AS LOWERREG,
  CAST(RAISEREG AS DOUBLE) AS RAISEREG,
  CAST(AVAILABILITY AS DOUBLE) AS AVAILABILITY,
  CAST(RAISE6SECFLAGS AS DOUBLE) AS RAISE6SECFLAGS,
  CAST(RAISE60SECFLAGS AS DOUBLE) AS RAISE60SECFLAGS,
  CAST(RAISE5MINFLAGS AS DOUBLE) AS RAISE5MINFLAGS,
  CAST(RAISEREGFLAGS AS DOUBLE) AS RAISEREGFLAGS,
  CAST(LOWER6SECFLAGS AS DOUBLE) AS LOWER6SECFLAGS,
  CAST(LOWER60SECFLAGS AS DOUBLE) AS LOWER60SECFLAGS,
  CAST(LOWER5MINFLAGS AS DOUBLE) AS LOWER5MINFLAGS,
  CAST(LOWERREGFLAGS AS DOUBLE) AS LOWERREGFLAGS,
  CAST(RAISEREGAVAILABILITY AS DOUBLE) AS RAISEREGAVAILABILITY,
  CAST(RAISEREGENABLEMENTMAX AS DOUBLE) AS RAISEREGENABLEMENTMAX,
  CAST(RAISEREGENABLEMENTMIN AS DOUBLE) AS RAISEREGENABLEMENTMIN,
  CAST(LOWERREGAVAILABILITY AS DOUBLE) AS LOWERREGAVAILABILITY,
  CAST(LOWERREGENABLEMENTMAX AS DOUBLE) AS LOWERREGENABLEMENTMAX,
  CAST(LOWERREGENABLEMENTMIN AS DOUBLE) AS LOWERREGENABLEMENTMIN,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m11:21:10.922473 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m11:21:10.930094 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: ROLLBACK
[0m11:21:10.930920 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_scada'
[0m11:21:10.930920 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: Close
[0m11:21:10.930920 [debug] [Thread-1 (]: Runtime Error in model fct_scada (models\marts\fct_scada.sql)
  IO Error: No files found that match the pattern "zip://c:/lakehouse/default/Files/csv/daily/year=2026/source_file=PUBLIC_DAILY_202602010000_20260202040506/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^
[0m11:21:10.938240 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fcdb120-4072-4b7f-b418-3c0279c1751e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AED5C8AD0>]}
[0m11:21:10.939063 [error] [Thread-1 (]: 6 of 8 ERROR creating sql incremental model aemo.fct_scada ..................... [[31mERROR[0m in 0.05s]
[0m11:21:10.939063 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_scada
[0m11:21:10.939063 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_scada_today
[0m11:21:10.939063 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_scada' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_scada (models\marts\fct_scada.sql)
  IO Error: No files found that match the pattern "zip://c:/lakehouse/default/Files/csv/daily/year=2026/source_file=PUBLIC_DAILY_202602010000_20260202040506/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^.
[0m11:21:10.939063 [info ] [Thread-1 (]: 7 of 8 START sql incremental model aemo.fct_scada_today ........................ [RUN]
[0m11:21:10.939063 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.fct_scada, now model.aemo_electricity.fct_scada_today)
[0m11:21:10.939063 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_scada_today
[0m11:21:10.948705 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_scada_today"
[0m11:21:10.950820 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_scada_today
[0m11:21:10.955827 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada_today"
[0m11:21:10.956826 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: BEGIN
[0m11:21:10.956826 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:21:10.958831 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:21:10.959506 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada_today"
[0m11:21:10.960572 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada_today"} */

        SET VARIABLE scada_today_paths = (SELECT COALESCE(NULLIF(list('zip://' || 'c:/lakehouse/default/Files/csv' || '/scada_today/day=' || substring(source_filename, 22, 8) || '/source_file=' || source_filename || '/data_0.zip/*.CSV'), []), ['']) FROM "ducklake"."aemo"."stg_csv_archive_log" WHERE source_type = 'scada_today')
      
[0m11:21:10.973151 [debug] [Thread-1 (]: SQL status: OK in 0.015 seconds
[0m11:21:10.978086 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_scada_today"
[0m11:21:10.979845 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada_today"
[0m11:21:10.980901 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada_today"
  
    as (
      



WITH scada_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('scada_today_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'UNIT_SCADA': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'DUID': 'VARCHAR',
      'SCADAVALUE': 'double',
      'LASTCHANGED': 'timestamp'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND SCADAVALUE != 0
)

SELECT
  DUID,
  SCADAVALUE AS INITIALMW,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  SETTLEMENTDATE,
  LASTCHANGED,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m11:21:10.981936 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada_today"
  
    as (
      



WITH scada_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('scada_today_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'UNIT_SCADA': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'DUID': 'VARCHAR',
      'SCADAVALUE': 'double',
      'LASTCHANGED': 'timestamp'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND SCADAVALUE != 0
)

SELECT
  DUID,
  SCADAVALUE AS INITIALMW,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  SETTLEMENTDATE,
  LASTCHANGED,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m11:21:10.982947 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m11:21:10.982947 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: ROLLBACK
[0m11:21:10.985934 [debug] [Thread-1 (]: Failed to rollback 'model.aemo_electricity.fct_scada_today'
[0m11:21:10.986939 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: Close
[0m11:21:10.990657 [debug] [Thread-1 (]: Runtime Error in model fct_scada_today (models\marts\fct_scada_today.sql)
  IO Error: No files found that match the pattern "zip://c:/lakehouse/default/Files/csv/scada_today/day=20260202/source_file=PUBLIC_DISPATCHSCADA_202602021110_0000000501570655/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^
[0m11:21:10.990657 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6fcdb120-4072-4b7f-b418-3c0279c1751e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AED6A9190>]}
[0m11:21:10.991660 [error] [Thread-1 (]: 7 of 8 ERROR creating sql incremental model aemo.fct_scada_today ............... [[31mERROR[0m in 0.05s]
[0m11:21:10.992580 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_scada_today
[0m11:21:10.993612 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_summary
[0m11:21:10.993612 [debug] [Thread-4 (]: Marking all children of 'model.aemo_electricity.fct_scada_today' to be skipped because of status 'error'.  Reason: Runtime Error in model fct_scada_today (models\marts\fct_scada_today.sql)
  IO Error: No files found that match the pattern "zip://c:/lakehouse/default/Files/csv/scada_today/day=20260202/source_file=PUBLIC_DISPATCHSCADA_202602021110_0000000501570655/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^.
[0m11:21:10.994612 [info ] [Thread-1 (]: 8 of 8 SKIP relation aemo.fct_summary .......................................... [[33mSKIP[0m]
[0m11:21:10.995209 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_summary
[0m11:21:10.997217 [debug] [MainThread]: Using duckdb connection "master"
[0m11:21:10.997217 [debug] [MainThread]: On master: BEGIN
[0m11:21:10.997217 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:21:10.997217 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m11:21:10.997217 [debug] [MainThread]: On master: COMMIT
[0m11:21:10.997217 [debug] [MainThread]: Using duckdb connection "master"
[0m11:21:10.997217 [debug] [MainThread]: On master: COMMIT
[0m11:21:10.997217 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:21:10.997217 [debug] [MainThread]: On master: Close
[0m11:21:10.997217 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:21:10.997217 [debug] [MainThread]: Connection 'create_ducklake_aemo' was properly closed.
[0m11:21:10.997217 [debug] [MainThread]: Connection 'list_ducklake_aemo' was properly closed.
[0m11:21:10.997217 [debug] [MainThread]: Connection 'model.aemo_electricity.fct_scada_today' was properly closed.
[0m11:21:10.997217 [info ] [MainThread]: 
[0m11:21:10.997217 [info ] [MainThread]: Finished running 6 incremental models, 2 table models in 0 hours 1 minutes and 29.37 seconds (89.37s).
[0m11:21:11.008872 [debug] [MainThread]: Command end result
[0m11:21:11.034151 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m11:21:11.038576 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m11:21:11.047772 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\lakehouse\default\Files\dbt\target\run_results.json
[0m11:21:11.048784 [info ] [MainThread]: 
[0m11:21:11.049791 [info ] [MainThread]: [31mCompleted with 4 errors, 0 partial successes, and 0 warnings:[0m
[0m11:21:11.050700 [info ] [MainThread]: 
[0m11:21:11.051690 [error] [MainThread]: [31mFailure in model fct_price (models\marts\fct_price.sql)[0m
[0m11:21:11.052689 [error] [MainThread]:   Runtime Error in model fct_price (models\marts\fct_price.sql)
  IO Error: No files found that match the pattern "zip://c:/lakehouse/default/Files/csv/daily/year=2026/source_file=PUBLIC_DAILY_202602010000_20260202040506/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^
[0m11:21:11.053691 [info ] [MainThread]: 
[0m11:21:11.053691 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_price.sql
[0m11:21:11.055001 [info ] [MainThread]: 
[0m11:21:11.056073 [error] [MainThread]: [31mFailure in model fct_price_today (models\marts\fct_price_today.sql)[0m
[0m11:21:11.057067 [error] [MainThread]:   Runtime Error in model fct_price_today (models\marts\fct_price_today.sql)
  IO Error: No files found that match the pattern "zip://c:/lakehouse/default/Files/csv/price_today/day=20260202/source_file=PUBLIC_DISPATCHIS_202602021110_0000000501570650/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^
[0m11:21:11.058067 [info ] [MainThread]: 
[0m11:21:11.058067 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_price_today.sql
[0m11:21:11.059073 [info ] [MainThread]: 
[0m11:21:11.061072 [error] [MainThread]: [31mFailure in model fct_scada (models\marts\fct_scada.sql)[0m
[0m11:21:11.061072 [error] [MainThread]:   Runtime Error in model fct_scada (models\marts\fct_scada.sql)
  IO Error: No files found that match the pattern "zip://c:/lakehouse/default/Files/csv/daily/year=2026/source_file=PUBLIC_DAILY_202602010000_20260202040506/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^
[0m11:21:11.062071 [info ] [MainThread]: 
[0m11:21:11.063071 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_scada.sql
[0m11:21:11.064287 [info ] [MainThread]: 
[0m11:21:11.065287 [error] [MainThread]: [31mFailure in model fct_scada_today (models\marts\fct_scada_today.sql)[0m
[0m11:21:11.065287 [error] [MainThread]:   Runtime Error in model fct_scada_today (models\marts\fct_scada_today.sql)
  IO Error: No files found that match the pattern "zip://c:/lakehouse/default/Files/csv/scada_today/day=20260202/source_file=PUBLIC_DISPATCHSCADA_202602021110_0000000501570655/data_0.zip/*.CSV"
  
  LINE 17:   FROM read_csv(
                  ^
[0m11:21:11.066287 [info ] [MainThread]: 
[0m11:21:11.067391 [info ] [MainThread]:   compiled code at target\compiled\aemo_electricity\models\marts\fct_scada_today.sql
[0m11:21:11.068285 [info ] [MainThread]: 
[0m11:21:11.069462 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=4 SKIP=1 NO-OP=0 TOTAL=8
[0m11:21:11.071500 [debug] [MainThread]: Command `dbt run` failed at 11:21:11.071500 after 97.12 seconds
[0m11:21:11.073195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AEB76AC50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AE54C0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027AEB486610>]}
[0m11:21:11.074227 [debug] [MainThread]: Flushing usage events
[0m11:21:12.389577 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:28:10.436919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A26611F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A26611DD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A26612590>]}


============================== 11:28:10.444884 | f5d8ee1a-f5c0-477c-99c2-f94a09c62bf4 ==============================
[0m11:28:10.444884 [info ] [MainThread]: Running with dbt=1.11.2
[0m11:28:10.444884 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': 'C:\\lakehouse\\default\\Files\\dbt', 'quiet': 'False', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'version_check': 'True', 'log_path': 'C:\\lakehouse\\default\\Files\\dbt\\logs', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'no_print': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'write_json': 'True'}
[0m11:28:10.852903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f5d8ee1a-f5c0-477c-99c2-f94a09c62bf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A2666A150>]}
[0m11:28:10.905325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f5d8ee1a-f5c0-477c-99c2-f94a09c62bf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A22108410>]}
[0m11:28:10.910316 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m11:28:11.320965 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m11:28:11.415986 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m11:28:11.416986 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m11:28:11.417548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'f5d8ee1a-f5c0-477c-99c2-f94a09c62bf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A2479E310>]}
[0m11:28:12.805074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f5d8ee1a-f5c0-477c-99c2-f94a09c62bf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A26E4CC50>]}
[0m11:28:12.899553 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m11:28:12.903814 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m11:28:12.952911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f5d8ee1a-f5c0-477c-99c2-f94a09c62bf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A281B3810>]}
[0m11:28:12.952911 [info ] [MainThread]: Found 8 models, 1 seed, 1 source, 475 macros
[0m11:28:12.952911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f5d8ee1a-f5c0-477c-99c2-f94a09c62bf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A280AA090>]}
[0m11:28:12.952911 [info ] [MainThread]: 
[0m11:28:12.952911 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:28:12.952911 [info ] [MainThread]: 
[0m11:28:12.952911 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m11:28:12.964561 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake'
[0m11:28:13.352733 [debug] [ThreadPool]: Using duckdb connection "list_ducklake"
[0m11:28:13.354738 [debug] [ThreadPool]: On list_ducklake: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"ducklake"'
    
  
  
[0m11:28:13.354738 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:28:13.818459 [debug] [ThreadPool]: SQL status: OK in 0.463 seconds
[0m11:28:13.819441 [debug] [ThreadPool]: On list_ducklake: Close
[0m11:28:13.819441 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ducklake, now create_ducklake_aemo)
[0m11:28:13.819441 [debug] [ThreadPool]: Creating schema "database: "ducklake"
schema: "aemo"
"
[0m11:28:13.819441 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:28:13.819441 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
        select type from duckdb_databases()
        where lower(database_name)='ducklake'
        and type='sqlite'
    
  
[0m11:28:13.819441 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:28:13.819441 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:28:13.819441 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:28:13.819441 [debug] [ThreadPool]: On create_ducklake_aemo: BEGIN
[0m11:28:13.819441 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m11:28:13.819441 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:28:13.819441 [debug] [ThreadPool]: On create_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "create_ducklake_aemo"} */

    
    
        create schema if not exists "ducklake"."aemo"
    
[0m11:28:13.838546 [debug] [ThreadPool]: SQL status: OK in 0.005 seconds
[0m11:28:13.839546 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m11:28:13.839546 [debug] [ThreadPool]: Using duckdb connection "create_ducklake_aemo"
[0m11:28:13.840546 [debug] [ThreadPool]: On create_ducklake_aemo: COMMIT
[0m11:28:13.841545 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:28:13.841545 [debug] [ThreadPool]: On create_ducklake_aemo: Close
[0m11:28:13.844051 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_ducklake_aemo'
[0m11:28:13.848770 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m11:28:13.849856 [debug] [ThreadPool]: On list_ducklake_aemo: BEGIN
[0m11:28:13.850868 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:28:13.850868 [debug] [ThreadPool]: SQL status: OK in 0.001 seconds
[0m11:28:13.851910 [debug] [ThreadPool]: Using duckdb connection "list_ducklake_aemo"
[0m11:28:13.851910 [debug] [ThreadPool]: On list_ducklake_aemo: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "connection_name": "list_ducklake_aemo"} */
select
      'ducklake' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'aemo'
    and lower(table_catalog) = 'ducklake'
  
[0m11:28:13.867787 [debug] [ThreadPool]: SQL status: OK in 0.017 seconds
[0m11:28:13.867787 [debug] [ThreadPool]: On list_ducklake_aemo: ROLLBACK
[0m11:28:13.867787 [debug] [ThreadPool]: Failed to rollback 'list_ducklake_aemo'
[0m11:28:13.867787 [debug] [ThreadPool]: On list_ducklake_aemo: Close
[0m11:28:13.867787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f5d8ee1a-f5c0-477c-99c2-f94a09c62bf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A26B9FA90>]}
[0m11:28:13.883771 [debug] [MainThread]: Using duckdb connection "master"
[0m11:28:13.883771 [debug] [MainThread]: On master: BEGIN
[0m11:28:13.883771 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:28:13.886707 [debug] [MainThread]: SQL status: OK in 0.002 seconds
[0m11:28:13.887834 [debug] [MainThread]: On master: COMMIT
[0m11:28:13.888873 [debug] [MainThread]: Using duckdb connection "master"
[0m11:28:13.889785 [debug] [MainThread]: On master: COMMIT
[0m11:28:13.891784 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m11:28:13.892873 [debug] [MainThread]: On master: Close
[0m11:28:13.902938 [debug] [Thread-1 (]: Began running node model.aemo_electricity.dim_calendar
[0m11:28:13.902938 [info ] [Thread-1 (]: 1 of 8 START sql incremental model aemo.dim_calendar ........................... [RUN]
[0m11:28:13.902938 [debug] [Thread-1 (]: Acquiring new duckdb connection 'model.aemo_electricity.dim_calendar'
[0m11:28:13.902938 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.dim_calendar
[0m11:28:13.936178 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.dim_calendar"
[0m11:28:13.939200 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.dim_calendar
[0m11:28:14.046310 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:28:14.047474 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

    
  
    
    

    create temporary table
      "dim_calendar__dbt_tmp20260202112814017910"
  
    as (
      

SELECT
  CAST(date AS DATE) as date,
  CAST(EXTRACT(year FROM date) AS INT) as year,
  CAST(EXTRACT(month FROM date) AS INT) as month
FROM (
  SELECT unnest(generate_series(
    CAST('2018-04-01' AS DATE),
    CAST('2026-12-31' AS DATE),
    INTERVAL 1 DAY
  )) as date
)
    );
  
  
  
[0m11:28:14.048101 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m11:28:14.051599 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m11:28:14.060475 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:28:14.061602 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: BEGIN
[0m11:28:14.062770 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:28:14.063394 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:28:14.063980 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar__dbt_tmp20260202112814017910'
      
      
      order by ordinal_position

  
[0m11:28:14.070147 [debug] [Thread-1 (]: SQL status: OK in 0.010 seconds
[0m11:28:14.076979 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:28:14.076979 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar'
      
      and lower(table_schema) = 'aemo'
      
      
      and lower(table_catalog) = 'ducklake'
      
      order by ordinal_position

  
[0m11:28:14.076979 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m11:28:14.107604 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:28:14.109512 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar__dbt_tmp20260202112814017910'
      
      
      order by ordinal_position

  
[0m11:28:14.111249 [debug] [Thread-1 (]: SQL status: OK in 0.005 seconds
[0m11:28:14.118081 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:28:14.118081 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from system.information_schema.columns
      where table_name = 'dim_calendar'
      
      and lower(table_schema) = 'aemo'
      
      
      and lower(table_catalog) = 'ducklake'
      
      order by ordinal_position

  
[0m11:28:14.126432 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m11:28:14.144480 [debug] [Thread-1 (]: 
    In "ducklake"."aemo"."dim_calendar":
        Schema changed: False
        Source columns not in target: []
        Target columns not in source: []
        New column types: []
  
[0m11:28:14.146064 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:28:14.147152 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */
SELECT version()
[0m11:28:14.149065 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:28:14.168723 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.dim_calendar"
[0m11:28:14.168723 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:28:14.168723 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_calendar"} */

        
            delete from "ducklake"."aemo"."dim_calendar"
            where (
                date) in (
                select (date)
                from "dim_calendar__dbt_tmp20260202112814017910"
            );

        
    

    insert into "ducklake"."aemo"."dim_calendar" ("date", "year", "month")
    (
        select "date", "year", "month"
        from "dim_calendar__dbt_tmp20260202112814017910"
    )
  
[0m11:28:28.875836 [debug] [Thread-1 (]: SQL status: OK in 14.700 seconds
[0m11:28:28.901132 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: COMMIT
[0m11:28:28.901132 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_calendar"
[0m11:28:28.904125 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: COMMIT
[0m11:28:28.926764 [debug] [Thread-1 (]: SQL status: OK in 0.024 seconds
[0m11:28:28.935967 [debug] [Thread-1 (]: On model.aemo_electricity.dim_calendar: Close
[0m11:28:28.935967 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5d8ee1a-f5c0-477c-99c2-f94a09c62bf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A26E19410>]}
[0m11:28:28.935967 [info ] [Thread-1 (]: 1 of 8 OK created sql incremental model aemo.dim_calendar ...................... [[32mOK[0m in 15.03s]
[0m11:28:28.935967 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.dim_calendar
[0m11:28:28.952195 [debug] [Thread-1 (]: Began running node model.aemo_electricity.dim_duid
[0m11:28:28.952195 [info ] [Thread-1 (]: 2 of 8 START sql table model aemo.dim_duid ..................................... [RUN]
[0m11:28:28.952195 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.dim_calendar, now model.aemo_electricity.dim_duid)
[0m11:28:28.952195 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.dim_duid
[0m11:28:28.969450 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.dim_duid"
[0m11:28:28.969450 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.dim_duid
[0m11:28:29.008719 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.dim_duid"
[0m11:28:29.013410 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:28:29.013807 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: BEGIN
[0m11:28:29.015814 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:28:29.017826 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:28:29.017826 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:28:29.019837 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

  
    
    

    create  table
      "ducklake"."aemo"."dim_duid__dbt_tmp"
  
    as (
      

WITH
  states AS (
    SELECT 'WA1' AS RegionID, 'Western Australia' AS State
    UNION ALL SELECT 'QLD1', 'Queensland'
    UNION ALL SELECT 'NSW1', 'New South Wales'
    UNION ALL SELECT 'TAS1', 'Tasmania'
    UNION ALL SELECT 'SA1', 'South Australia'
    UNION ALL SELECT 'VIC1', 'Victoria'
  ),

  duid_aemo AS (
    SELECT
      DUID AS DUID,
      first(Region) AS Region,
      first("Fuel Source - Descriptor") AS FuelSourceDescriptor,
      first(Participant) AS Participant
    FROM
      read_csv('/lakehouse/default/Files/csv/duid/duid_data.csv')
    WHERE
      length(DUID) > 2
    GROUP BY
      DUID
  ),

  wa_facilities AS (
    SELECT
      'WA1' AS Region,
      "Facility Code" AS DUID,
      "Participant Name" AS Participant
    FROM
      read_csv_auto('/lakehouse/default/Files/csv/duid/facilities.csv')
  ),

  wa_energy AS (
    SELECT *
    FROM read_csv_auto('/lakehouse/default/Files/csv/duid/WA_ENERGY.csv', header = 1)
  ),

  duid_wa AS (
    SELECT
      wa_facilities.DUID,
      wa_facilities.Region,
      wa_energy.Technology AS FuelSourceDescriptor,
      wa_facilities.Participant
    FROM wa_facilities
    LEFT JOIN wa_energy ON wa_facilities.DUID = wa_energy.DUID
  ),

  duid_all AS (
    SELECT * FROM duid_aemo
    UNION ALL
    SELECT * FROM duid_wa
  ),

  geo AS (
    SELECT
      duid,
      max(latitude) as latitude,
      max(longitude) as longitude
    FROM read_csv('/lakehouse/default/Files/csv/duid/geo_data.csv')
    WHERE latitude IS NOT NULL
    GROUP BY duid
  )

SELECT
  a.DUID,
  a.Region,
  UPPER(LEFT(TRIM(FuelSourceDescriptor), 1)) || LOWER(SUBSTR(TRIM(FuelSourceDescriptor), 2)) AS FuelSourceDescriptor,
  a.Participant,
  states.State,
  geo.latitude,
  geo.longitude
FROM duid_all a
JOIN states ON a.Region = states.RegionID
LEFT JOIN geo ON a.duid = geo.duid
    );
  
  
[0m11:28:33.774054 [debug] [Thread-1 (]: SQL status: OK in 4.752 seconds
[0m11:28:33.784065 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:28:33.784954 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'aemo'
      AND table_name = 'dim_duid'
  
[0m11:28:33.790299 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m11:28:33.793311 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:28:33.794312 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'aemo'
      AND table_name = 'dim_duid'
  
[0m11:28:33.794312 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:28:33.822324 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:28:33.826147 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */
alter table "ducklake"."aemo"."dim_duid" rename to "dim_duid__dbt_backup"
[0m11:28:33.833525 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:28:33.840391 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:28:33.841391 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */
alter table "ducklake"."aemo"."dim_duid__dbt_tmp" rename to "dim_duid"
[0m11:28:33.843114 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:28:33.853171 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: COMMIT
[0m11:28:33.854394 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:28:33.855393 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: COMMIT
[0m11:28:33.886407 [debug] [Thread-1 (]: SQL status: OK in 0.030 seconds
[0m11:28:33.894651 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.dim_duid"
[0m11:28:33.895753 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.dim_duid"} */

      drop table if exists "ducklake"."aemo"."dim_duid__dbt_backup"
    
[0m11:28:33.969116 [debug] [Thread-1 (]: SQL status: OK in 0.072 seconds
[0m11:28:33.973813 [debug] [Thread-1 (]: On model.aemo_electricity.dim_duid: Close
[0m11:28:33.976499 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5d8ee1a-f5c0-477c-99c2-f94a09c62bf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A26E77710>]}
[0m11:28:33.978530 [info ] [Thread-1 (]: 2 of 8 OK created sql table model aemo.dim_duid ................................ [[32mOK[0m in 5.02s]
[0m11:28:33.981369 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.dim_duid
[0m11:28:33.983722 [debug] [Thread-1 (]: Began running node model.aemo_electricity.stg_csv_archive_log
[0m11:28:33.985616 [info ] [Thread-1 (]: 3 of 8 START sql table model aemo.stg_csv_archive_log .......................... [RUN]
[0m11:28:33.987624 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.dim_duid, now model.aemo_electricity.stg_csv_archive_log)
[0m11:28:33.990618 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.stg_csv_archive_log
[0m11:28:34.000646 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:34.004709 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.stg_csv_archive_log
[0m11:28:34.016230 [info ] [Thread-1 (]: [DOWNLOAD] Starting download with PATH_ROOT=/lakehouse/default, download_limit=2
[0m11:28:34.019741 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:34.020741 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: BEGIN
[0m11:28:34.022739 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:28:34.023739 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:28:34.026464 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:34.028600 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE PATH_ROOT = '/lakehouse/default'

[0m11:28:34.030872 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:28:34.032937 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:34.035678 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE download_limit = 2

[0m11:28:34.038137 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:28:34.041148 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:34.041148 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE csv_archive_path = getvariable('PATH_ROOT') || '/Files/csv'

[0m11:28:34.046107 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:28:34.049250 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:34.049250 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE SCHEMA IF NOT EXISTS ducklake.aemo

[0m11:28:34.095488 [debug] [Thread-1 (]: SQL status: OK in 0.044 seconds
[0m11:28:34.097614 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:34.097614 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

USE ducklake.aemo

[0m11:28:34.097614 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:28:34.097614 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:34.101948 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE _csv_archive_staging (
  source_type VARCHAR,
  source_filename VARCHAR,
  archive_path VARCHAR,
  archived_at TIMESTAMP,
  row_count BIGINT,
  source_url VARCHAR,
  etag VARCHAR
)

[0m11:28:34.101948 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:28:34.105150 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:34.105150 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE _existing_archive_log (
  source_type VARCHAR,
  source_filename VARCHAR
)

[0m11:28:34.107410 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:28:34.109524 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:34.109524 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO _existing_archive_log 
SELECT source_type, source_filename 
FROM ducklake.aemo.csv_archive_log

[0m11:28:41.737355 [debug] [Thread-1 (]: SQL status: OK in 7.628 seconds
[0m11:28:41.737355 [info ] [Thread-1 (]: [DOWNLOAD] Daily source: aemo
[0m11:28:41.737355 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:41.737355 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE daily_files_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('https://nemweb.com.au/Reports/Current/Daily_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'https://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DAILY%.zip%'
ORDER BY full_url DESC

[0m11:28:41.950070 [debug] [Thread-1 (]: SQL status: OK in 0.204 seconds
[0m11:28:41.953059 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:41.953059 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE daily_to_archive AS
SELECT full_url, filename
FROM daily_files_web
WHERE filename NOT IN (SELECT source_filename FROM _existing_archive_log WHERE source_type = 'daily')
LIMIT getvariable('download_limit')

[0m11:28:41.953059 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m11:28:41.953059 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:41.953059 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE has_daily_to_archive = (SELECT count(*) > 0 FROM daily_to_archive)

[0m11:28:41.971658 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:28:41.971658 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:41.971658 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE daily_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM daily_to_archive)

[0m11:28:41.985035 [debug] [Thread-1 (]: SQL status: OK in 0.007 seconds
[0m11:28:41.986428 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:41.986428 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE daily_expected = (SELECT count(*) FROM daily_to_archive)

[0m11:28:41.986428 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:28:41.986428 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:41.997421 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE daily_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM daily_to_archive)

[0m11:28:42.005264 [debug] [Thread-1 (]: SQL status: OK in 0.007 seconds
[0m11:28:42.005264 [info ] [Thread-1 (]: [DOWNLOAD] Processing daily files...
[0m11:28:42.005264 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:42.005264 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    CAST(substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 4) AS INT) AS year
  FROM read_blob(getvariable('daily_urls'))
  WHERE getvariable('has_daily_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/daily')
(FORMAT BLOB, PARTITION_BY (year, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m11:28:42.616621 [debug] [Thread-1 (]: SQL status: OK in 0.611 seconds
[0m11:28:42.616621 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:42.616621 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'daily' AS source_type,
  filename AS source_filename,
  '/daily/year=' || CAST(substring(split_part(filename, '_', 3), 1, 4) AS INT) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM daily_to_archive
WHERE getvariable('daily_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('daily_paths'))) = getvariable('daily_expected')

[0m11:28:47.340612 [debug] [Thread-1 (]: SQL status: OK in 4.713 seconds
[0m11:28:47.343203 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:47.343203 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE intraday_scada_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('http://nemweb.com.au/Reports/Current/Dispatch_SCADA/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'http://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DISPATCHSCADA%'
ORDER BY full_url DESC
LIMIT 500

[0m11:28:47.517913 [debug] [Thread-1 (]: SQL status: OK in 0.171 seconds
[0m11:28:47.517913 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:47.517913 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE scada_today_to_archive AS
SELECT full_url, filename
FROM intraday_scada_web
WHERE filename NOT IN (SELECT source_filename FROM _existing_archive_log WHERE source_type = 'scada_today')
LIMIT getvariable('download_limit')

[0m11:28:47.517913 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:28:47.517913 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:47.517913 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE has_scada_today_to_archive = (SELECT count(*) > 0 FROM scada_today_to_archive)

[0m11:28:47.517913 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:28:47.517913 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:47.517913 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE scada_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM scada_today_to_archive)

[0m11:28:47.517913 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m11:28:47.533678 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:47.533678 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE scada_expected = (SELECT count(*) FROM scada_today_to_archive)

[0m11:28:47.533678 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:28:47.533678 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:47.533678 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE scada_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/scada_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM scada_today_to_archive)

[0m11:28:47.539533 [debug] [Thread-1 (]: SQL status: OK in 0.004 seconds
[0m11:28:47.539533 [info ] [Thread-1 (]: [DOWNLOAD] Processing intraday SCADA files...
[0m11:28:47.539533 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:47.539533 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 8) AS day
  FROM read_blob(getvariable('scada_urls'))
  WHERE getvariable('has_scada_today_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/scada_today')
(FORMAT BLOB, PARTITION_BY (day, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m11:28:47.700038 [debug] [Thread-1 (]: SQL status: OK in 0.155 seconds
[0m11:28:47.706604 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:47.708618 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'scada_today' AS source_type,
  filename AS source_filename,
  '/scada_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM scada_today_to_archive
WHERE getvariable('scada_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('scada_paths'))) = getvariable('scada_expected')

[0m11:28:53.627792 [debug] [Thread-1 (]: SQL status: OK in 5.925 seconds
[0m11:28:53.627792 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:53.627792 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE intraday_price_web AS
WITH
  html_data AS (
    SELECT content AS html FROM read_text('http://nemweb.com.au/Reports/Current/DispatchIS_Reports/')
  ),
  lines AS (
    SELECT unnest(string_split(html, '<br>')) AS line FROM html_data
  )
SELECT
  'http://nemweb.com.au' || regexp_extract(line, 'HREF="([^"]+)"', 1) AS full_url,
  split_part(regexp_extract(line, 'HREF="[^"]+/([^"]+\.zip)"', 1), '.', 1) AS filename
FROM lines
WHERE line LIKE '%PUBLIC_DISPATCHIS_%.zip%'
ORDER BY full_url DESC
LIMIT 500

[0m11:28:53.807831 [debug] [Thread-1 (]: SQL status: OK in 0.180 seconds
[0m11:28:53.807831 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:53.807831 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

CREATE OR REPLACE TEMP TABLE price_today_to_archive AS
SELECT full_url, filename
FROM intraday_price_web
WHERE filename NOT IN (SELECT source_filename FROM _existing_archive_log WHERE source_type = 'price_today')
LIMIT getvariable('download_limit')

[0m11:28:53.822623 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:28:53.823713 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:53.824293 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE has_price_today_to_archive = (SELECT count(*) > 0 FROM price_today_to_archive)

[0m11:28:53.826618 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:28:53.827760 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:53.828339 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE price_urls = (SELECT COALESCE(NULLIF(list(full_url), []), list_value('')) FROM price_today_to_archive)

[0m11:28:53.832790 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:28:53.834456 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:53.834977 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE price_expected = (SELECT count(*) FROM price_today_to_archive)

[0m11:28:53.836709 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:28:53.838270 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:53.839024 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

SET VARIABLE price_paths = (SELECT COALESCE(NULLIF(list(getvariable('csv_archive_path') || '/price_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip'), []), list_value('')) FROM price_today_to_archive)

[0m11:28:53.843385 [debug] [Thread-1 (]: SQL status: OK in 0.003 seconds
[0m11:28:53.844489 [info ] [Thread-1 (]: [DOWNLOAD] Processing intraday PRICE files...
[0m11:28:53.845689 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:53.846263 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT
    content,
    split_part(split_part(filename, '/', -1), '.', 1) AS source_file,
    substring(split_part(split_part(filename, '/', -1), '_', 3), 1, 8) AS day
  FROM read_blob(getvariable('price_urls'))
  WHERE getvariable('has_price_today_to_archive') AND filename != ''
) TO (getvariable('csv_archive_path') || '/price_today')
(FORMAT BLOB, PARTITION_BY (day, source_file), FILE_EXTENSION 'zip', OVERWRITE_OR_IGNORE)

[0m11:28:54.040854 [debug] [Thread-1 (]: SQL status: OK in 0.194 seconds
[0m11:28:54.044387 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:54.046407 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT
  'price_today' AS source_type,
  filename AS source_filename,
  '/price_today/day=' || substring(split_part(filename, '_', 3), 1, 8) || '/source_file=' || filename || '/data_0.zip' AS archive_path,
  now() AS archived_at
FROM price_today_to_archive
WHERE getvariable('price_expected') > 0
  AND (SELECT count(*) FROM glob(getvariable('price_paths'))) = getvariable('price_expected')

[0m11:28:59.855343 [debug] [Thread-1 (]: SQL status: OK in 5.807 seconds
[0m11:28:59.855343 [info ] [Thread-1 (]: [DOWNLOAD] Refreshing 4 DUID reference files...
[0m11:28:59.861392 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:59.861392 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (SELECT 1 AS id, 'init' AS dummy) TO (getvariable('csv_archive_path') || '/duid')
(FORMAT csv, PARTITION_BY (dummy), FILE_EXTENSION 'csv', OVERWRITE_OR_IGNORE)

[0m11:28:59.872499 [debug] [Thread-1 (]: SQL status: OK in 0.007 seconds
[0m11:28:59.875500 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:28:59.877438 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/djouallah-patch-1/duid_data.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/duid_data.csv') (FORMAT CSV, HEADER)

[0m11:29:00.315280 [debug] [Thread-1 (]: SQL status: OK in 0.436 seconds
[0m11:29:00.317289 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:29:00.319043 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://data.wa.aemo.com.au/datafiles/post-facilities/facilities.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/facilities.csv') (FORMAT CSV, HEADER)

[0m11:29:00.682182 [debug] [Thread-1 (]: SQL status: OK in 0.361 seconds
[0m11:29:00.686215 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:29:00.688230 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/main/WA_ENERGY.csv', header=true, null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/WA_ENERGY.csv') (FORMAT CSV, HEADER)

[0m11:29:01.023413 [debug] [Thread-1 (]: SQL status: OK in 0.343 seconds
[0m11:29:01.023413 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:29:01.023413 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

COPY (
  SELECT * FROM read_csv_auto('https://raw.githubusercontent.com/djouallah/aemo_fabric/refs/heads/main/geo_data.csv', null_padding=true, ignore_errors=true)
) TO (getvariable('csv_archive_path') || '/duid/geo_data.csv') (FORMAT CSV, HEADER)

[0m11:29:01.385318 [debug] [Thread-1 (]: SQL status: OK in 0.346 seconds
[0m11:29:01.387325 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:29:01.387325 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

DELETE FROM ducklake.aemo.csv_archive_log WHERE source_type LIKE 'duid_%'

[0m11:29:04.157292 [debug] [Thread-1 (]: SQL status: OK in 2.769 seconds
[0m11:29:04.159413 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:29:04.161421 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

INSERT INTO ducklake.aemo.csv_archive_log BY NAME
SELECT * FROM (VALUES
  ('duid_data', 'duid_data', '/duid/duid_data.csv', now()),
  ('duid_facilities', 'facilities', '/duid/facilities.csv', now()),
  ('duid_wa_energy', 'WA_ENERGY', '/duid/WA_ENERGY.csv', now()),
  ('duid_geo_data', 'geo_data', '/duid/geo_data.csv', now())
) AS t(source_type, source_filename, archive_path, archived_at)

[0m11:29:10.023761 [debug] [Thread-1 (]: SQL status: OK in 5.861 seconds
[0m11:29:10.027792 [info ] [Thread-1 (]: [DOWNLOAD] DUID files written: 4
[0m11:29:10.027792 [info ] [Thread-1 (]: [DOWNLOAD COMPLETE]
[0m11:29:10.027792 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.stg_csv_archive_log"
[0m11:29:10.037254 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:29:10.038830 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

  
    
    

    create  table
      "ducklake"."aemo"."stg_csv_archive_log__dbt_tmp"
  
    as (
      



SELECT 
  source_type,
  source_filename,
  archive_path,
  archived_at,
  row_count,
  source_url,
  etag
FROM "ducklake"."aemo"."csv_archive_log"
    );
  
  
[0m11:29:25.710199 [debug] [Thread-1 (]: SQL status: OK in 15.670 seconds
[0m11:29:25.712160 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:29:25.712160 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

    SELECT index_name
    FROM duckdb_indexes()
    WHERE schema_name = 'aemo'
      AND table_name = 'stg_csv_archive_log'
  
[0m11:29:25.712160 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:29:25.712160 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:29:25.712160 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

    SELECT COUNT(*) as remaining_indexes
    FROM duckdb_indexes()
    WHERE schema_name = 'aemo'
      AND table_name = 'stg_csv_archive_log'
  
[0m11:29:25.712160 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:29:25.712160 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:29:25.712160 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */
alter table "ducklake"."aemo"."stg_csv_archive_log" rename to "stg_csv_archive_log__dbt_backup"
[0m11:29:25.712160 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m11:29:25.725916 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:29:25.725916 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */
alter table "ducklake"."aemo"."stg_csv_archive_log__dbt_tmp" rename to "stg_csv_archive_log"
[0m11:29:25.725916 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:29:25.725916 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: COMMIT
[0m11:29:25.725916 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:29:25.725916 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: COMMIT
[0m11:29:25.757445 [debug] [Thread-1 (]: SQL status: OK in 0.024 seconds
[0m11:29:25.757445 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.stg_csv_archive_log"
[0m11:29:25.757445 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.stg_csv_archive_log"} */

      drop table if exists "ducklake"."aemo"."stg_csv_archive_log__dbt_backup"
    
[0m11:29:25.805096 [debug] [Thread-1 (]: SQL status: OK in 0.042 seconds
[0m11:29:25.805096 [debug] [Thread-1 (]: On model.aemo_electricity.stg_csv_archive_log: Close
[0m11:29:25.805096 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5d8ee1a-f5c0-477c-99c2-f94a09c62bf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A2686F590>]}
[0m11:29:25.805096 [info ] [Thread-1 (]: 3 of 8 OK created sql table model aemo.stg_csv_archive_log ..................... [[32mOK[0m in 51.82s]
[0m11:29:25.805096 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.stg_csv_archive_log
[0m11:29:25.805096 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_price
[0m11:29:25.805096 [info ] [Thread-1 (]: 4 of 8 START sql incremental model aemo.fct_price .............................. [RUN]
[0m11:29:25.805096 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.stg_csv_archive_log, now model.aemo_electricity.fct_price)
[0m11:29:25.805096 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_price
[0m11:29:25.805096 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_price"
[0m11:29:25.820825 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_price
[0m11:29:25.825679 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price"
[0m11:29:25.826852 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: BEGIN
[0m11:29:25.828789 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:29:25.831001 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:29:25.832001 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price"
[0m11:29:25.833004 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price"} */

        SET VARIABLE price_daily_paths = (SELECT COALESCE(NULLIF(list('zip://' || '/lakehouse/default/Files/csv' || '/daily/year=' || substring(source_filename, 14, 4) || '/source_file=' || source_filename || '/data_0.zip/*.CSV'), []), ['']) FROM "ducklake"."aemo"."stg_csv_archive_log" WHERE source_type = 'daily')
      
[0m11:29:29.234563 [debug] [Thread-1 (]: SQL status: OK in 3.409 seconds
[0m11:29:29.234563 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_price"
[0m11:29:29.250502 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price"
[0m11:29:29.253870 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price"
  
    as (
      



WITH price_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('price_daily_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'TOTALDEMAND': 'VARCHAR',
      'DEMANDFORECAST': 'VARCHAR',
      'DISPATCHABLEGENERATION': 'VARCHAR',
      'DISPATCHABLELOAD': 'VARCHAR',
      'NETINTERCHANGE': 'VARCHAR',
      'EXCESSGENERATION': 'VARCHAR',
      'LOWER5MINDISPATCH': 'VARCHAR',
      'LOWER5MINIMPORT': 'VARCHAR',
      'LOWER5MINLOCALDISPATCH': 'VARCHAR',
      'LOWER5MINLOCALPRICE': 'VARCHAR',
      'LOWER5MINLOCALREQ': 'VARCHAR',
      'LOWER5MINPRICE': 'VARCHAR',
      'LOWER5MINREQ': 'VARCHAR',
      'LOWER5MINSUPPLYPRICE': 'VARCHAR',
      'LOWER60SECDISPATCH': 'VARCHAR',
      'LOWER60SECIMPORT': 'VARCHAR',
      'LOWER60SECLOCALDISPATCH': 'VARCHAR',
      'LOWER60SECLOCALPRICE': 'VARCHAR',
      'LOWER60SECLOCALREQ': 'VARCHAR',
      'LOWER60SECPRICE': 'VARCHAR',
      'LOWER60SECREQ': 'VARCHAR',
      'LOWER60SECSUPPLYPRICE': 'VARCHAR',
      'LOWER6SECDISPATCH': 'VARCHAR',
      'LOWER6SECIMPORT': 'VARCHAR',
      'LOWER6SECLOCALDISPATCH': 'VARCHAR',
      'LOWER6SECLOCALPRICE': 'VARCHAR',
      'LOWER6SECLOCALREQ': 'VARCHAR',
      'LOWER6SECPRICE': 'VARCHAR',
      'LOWER6SECREQ': 'VARCHAR',
      'LOWER6SECSUPPLYPRICE': 'VARCHAR',
      'RAISE5MINDISPATCH': 'VARCHAR',
      'RAISE5MINIMPORT': 'VARCHAR',
      'RAISE5MINLOCALDISPATCH': 'VARCHAR',
      'RAISE5MINLOCALPRICE': 'VARCHAR',
      'RAISE5MINLOCALREQ': 'VARCHAR',
      'RAISE5MINPRICE': 'VARCHAR',
      'RAISE5MINREQ': 'VARCHAR',
      'RAISE5MINSUPPLYPRICE': 'VARCHAR',
      'RAISE60SECDISPATCH': 'VARCHAR',
      'RAISE60SECIMPORT': 'VARCHAR',
      'RAISE60SECLOCALDISPATCH': 'VARCHAR',
      'RAISE60SECLOCALPRICE': 'VARCHAR',
      'RAISE60SECLOCALREQ': 'VARCHAR',
      'RAISE60SECPRICE': 'VARCHAR',
      'RAISE60SECREQ': 'VARCHAR',
      'RAISE60SECSUPPLYPRICE': 'VARCHAR',
      'RAISE6SECDISPATCH': 'VARCHAR',
      'RAISE6SECIMPORT': 'VARCHAR',
      'RAISE6SECLOCALDISPATCH': 'VARCHAR',
      'RAISE6SECLOCALPRICE': 'VARCHAR',
      'RAISE6SECLOCALREQ': 'VARCHAR',
      'RAISE6SECPRICE': 'VARCHAR',
      'RAISE6SECREQ': 'VARCHAR',
      'RAISE6SECSUPPLYPRICE': 'VARCHAR',
      'AGGREGATEDISPATCHERROR': 'VARCHAR',
      'AVAILABLEGENERATION': 'VARCHAR',
      'AVAILABLELOAD': 'VARCHAR',
      'INITIALSUPPLY': 'VARCHAR',
      'CLEAREDSUPPLY': 'VARCHAR',
      'LOWERREGIMPORT': 'VARCHAR',
      'LOWERREGLOCALDISPATCH': 'VARCHAR',
      'LOWERREGLOCALREQ': 'VARCHAR',
      'LOWERREGREQ': 'VARCHAR',
      'RAISEREGIMPORT': 'VARCHAR',
      'RAISEREGLOCALDISPATCH': 'VARCHAR',
      'RAISEREGLOCALREQ': 'VARCHAR',
      'RAISEREGREQ': 'VARCHAR',
      'RAISE5MINLOCALVIOLATION': 'VARCHAR',
      'RAISEREGLOCALVIOLATION': 'VARCHAR',
      'RAISE60SECLOCALVIOLATION': 'VARCHAR',
      'RAISE6SECLOCALVIOLATION': 'VARCHAR',
      'LOWER5MINLOCALVIOLATION': 'VARCHAR',
      'LOWERREGLOCALVIOLATION': 'VARCHAR',
      'LOWER60SECLOCALVIOLATION': 'VARCHAR',
      'LOWER6SECLOCALVIOLATION': 'VARCHAR',
      'RAISE5MINVIOLATION': 'VARCHAR',
      'RAISEREGVIOLATION': 'VARCHAR',
      'RAISE60SECVIOLATION': 'VARCHAR',
      'RAISE6SECVIOLATION': 'VARCHAR',
      'LOWER5MINVIOLATION': 'VARCHAR',
      'LOWERREGVIOLATION': 'VARCHAR',
      'LOWER60SECVIOLATION': 'VARCHAR',
      'LOWER6SECVIOLATION': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR',
      'LORSURPLUS': 'VARCHAR',
      'LRCSURPLUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DREGION' AND VERSION = '3'
)

SELECT
  UNIT,
  REGIONID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(TOTALDEMAND AS DOUBLE) AS TOTALDEMAND,
  CAST(DEMANDFORECAST AS DOUBLE) AS DEMANDFORECAST,
  CAST(DISPATCHABLEGENERATION AS DOUBLE) AS DISPATCHABLEGENERATION,
  CAST(DISPATCHABLELOAD AS DOUBLE) AS DISPATCHABLELOAD,
  CAST(NETINTERCHANGE AS DOUBLE) AS NETINTERCHANGE,
  CAST(EXCESSGENERATION AS DOUBLE) AS EXCESSGENERATION,
  CAST(LOWER5MINDISPATCH AS DOUBLE) AS LOWER5MINDISPATCH,
  CAST(LOWER5MINIMPORT AS DOUBLE) AS LOWER5MINIMPORT,
  CAST(LOWER5MINLOCALDISPATCH AS DOUBLE) AS LOWER5MINLOCALDISPATCH,
  CAST(LOWER5MINLOCALPRICE AS DOUBLE) AS LOWER5MINLOCALPRICE,
  CAST(LOWER5MINLOCALREQ AS DOUBLE) AS LOWER5MINLOCALREQ,
  CAST(LOWER5MINPRICE AS DOUBLE) AS LOWER5MINPRICE,
  CAST(LOWER5MINREQ AS DOUBLE) AS LOWER5MINREQ,
  CAST(LOWER5MINSUPPLYPRICE AS DOUBLE) AS LOWER5MINSUPPLYPRICE,
  CAST(LOWER60SECDISPATCH AS DOUBLE) AS LOWER60SECDISPATCH,
  CAST(LOWER60SECIMPORT AS DOUBLE) AS LOWER60SECIMPORT,
  CAST(LOWER60SECLOCALDISPATCH AS DOUBLE) AS LOWER60SECLOCALDISPATCH,
  CAST(LOWER60SECLOCALPRICE AS DOUBLE) AS LOWER60SECLOCALPRICE,
  CAST(LOWER60SECLOCALREQ AS DOUBLE) AS LOWER60SECLOCALREQ,
  CAST(LOWER60SECPRICE AS DOUBLE) AS LOWER60SECPRICE,
  CAST(LOWER60SECREQ AS DOUBLE) AS LOWER60SECREQ,
  CAST(LOWER60SECSUPPLYPRICE AS DOUBLE) AS LOWER60SECSUPPLYPRICE,
  CAST(LOWER6SECDISPATCH AS DOUBLE) AS LOWER6SECDISPATCH,
  CAST(LOWER6SECIMPORT AS DOUBLE) AS LOWER6SECIMPORT,
  CAST(LOWER6SECLOCALDISPATCH AS DOUBLE) AS LOWER6SECLOCALDISPATCH,
  CAST(LOWER6SECLOCALPRICE AS DOUBLE) AS LOWER6SECLOCALPRICE,
  CAST(LOWER6SECLOCALREQ AS DOUBLE) AS LOWER6SECLOCALREQ,
  CAST(LOWER6SECPRICE AS DOUBLE) AS LOWER6SECPRICE,
  CAST(LOWER6SECREQ AS DOUBLE) AS LOWER6SECREQ,
  CAST(LOWER6SECSUPPLYPRICE AS DOUBLE) AS LOWER6SECSUPPLYPRICE,
  CAST(RAISE5MINDISPATCH AS DOUBLE) AS RAISE5MINDISPATCH,
  CAST(RAISE5MINIMPORT AS DOUBLE) AS RAISE5MINIMPORT,
  CAST(RAISE5MINLOCALDISPATCH AS DOUBLE) AS RAISE5MINLOCALDISPATCH,
  CAST(RAISE5MINLOCALPRICE AS DOUBLE) AS RAISE5MINLOCALPRICE,
  CAST(RAISE5MINLOCALREQ AS DOUBLE) AS RAISE5MINLOCALREQ,
  CAST(RAISE5MINPRICE AS DOUBLE) AS RAISE5MINPRICE,
  CAST(RAISE5MINREQ AS DOUBLE) AS RAISE5MINREQ,
  CAST(RAISE5MINSUPPLYPRICE AS DOUBLE) AS RAISE5MINSUPPLYPRICE,
  CAST(RAISE60SECDISPATCH AS DOUBLE) AS RAISE60SECDISPATCH,
  CAST(RAISE60SECIMPORT AS DOUBLE) AS RAISE60SECIMPORT,
  CAST(RAISE60SECLOCALDISPATCH AS DOUBLE) AS RAISE60SECLOCALDISPATCH,
  CAST(RAISE60SECLOCALPRICE AS DOUBLE) AS RAISE60SECLOCALPRICE,
  CAST(RAISE60SECLOCALREQ AS DOUBLE) AS RAISE60SECLOCALREQ,
  CAST(RAISE60SECPRICE AS DOUBLE) AS RAISE60SECPRICE,
  CAST(RAISE60SECREQ AS DOUBLE) AS RAISE60SECREQ,
  CAST(RAISE60SECSUPPLYPRICE AS DOUBLE) AS RAISE60SECSUPPLYPRICE,
  CAST(RAISE6SECDISPATCH AS DOUBLE) AS RAISE6SECDISPATCH,
  CAST(RAISE6SECIMPORT AS DOUBLE) AS RAISE6SECIMPORT,
  CAST(RAISE6SECLOCALDISPATCH AS DOUBLE) AS RAISE6SECLOCALDISPATCH,
  CAST(RAISE6SECLOCALPRICE AS DOUBLE) AS RAISE6SECLOCALPRICE,
  CAST(RAISE6SECLOCALREQ AS DOUBLE) AS RAISE6SECLOCALREQ,
  CAST(RAISE6SECPRICE AS DOUBLE) AS RAISE6SECPRICE,
  CAST(RAISE6SECREQ AS DOUBLE) AS RAISE6SECREQ,
  CAST(RAISE6SECSUPPLYPRICE AS DOUBLE) AS RAISE6SECSUPPLYPRICE,
  CAST(AGGREGATEDISPATCHERROR AS DOUBLE) AS AGGREGATEDISPATCHERROR,
  CAST(AVAILABLEGENERATION AS DOUBLE) AS AVAILABLEGENERATION,
  CAST(AVAILABLELOAD AS DOUBLE) AS AVAILABLELOAD,
  CAST(INITIALSUPPLY AS DOUBLE) AS INITIALSUPPLY,
  CAST(CLEAREDSUPPLY AS DOUBLE) AS CLEAREDSUPPLY,
  CAST(LOWERREGIMPORT AS DOUBLE) AS LOWERREGIMPORT,
  CAST(LOWERREGLOCALDISPATCH AS DOUBLE) AS LOWERREGLOCALDISPATCH,
  CAST(LOWERREGLOCALREQ AS DOUBLE) AS LOWERREGLOCALREQ,
  CAST(LOWERREGREQ AS DOUBLE) AS LOWERREGREQ,
  CAST(RAISEREGIMPORT AS DOUBLE) AS RAISEREGIMPORT,
  CAST(RAISEREGLOCALDISPATCH AS DOUBLE) AS RAISEREGLOCALDISPATCH,
  CAST(RAISEREGLOCALREQ AS DOUBLE) AS RAISEREGLOCALREQ,
  CAST(RAISEREGREQ AS DOUBLE) AS RAISEREGREQ,
  CAST(RAISE5MINLOCALVIOLATION AS DOUBLE) AS RAISE5MINLOCALVIOLATION,
  CAST(RAISEREGLOCALVIOLATION AS DOUBLE) AS RAISEREGLOCALVIOLATION,
  CAST(RAISE60SECLOCALVIOLATION AS DOUBLE) AS RAISE60SECLOCALVIOLATION,
  CAST(RAISE6SECLOCALVIOLATION AS DOUBLE) AS RAISE6SECLOCALVIOLATION,
  CAST(LOWER5MINLOCALVIOLATION AS DOUBLE) AS LOWER5MINLOCALVIOLATION,
  CAST(LOWERREGLOCALVIOLATION AS DOUBLE) AS LOWERREGLOCALVIOLATION,
  CAST(LOWER60SECLOCALVIOLATION AS DOUBLE) AS LOWER60SECLOCALVIOLATION,
  CAST(LOWER6SECLOCALVIOLATION AS DOUBLE) AS LOWER6SECLOCALVIOLATION,
  CAST(RAISE5MINVIOLATION AS DOUBLE) AS RAISE5MINVIOLATION,
  CAST(RAISEREGVIOLATION AS DOUBLE) AS RAISEREGVIOLATION,
  CAST(RAISE60SECVIOLATION AS DOUBLE) AS RAISE60SECVIOLATION,
  CAST(RAISE6SECVIOLATION AS DOUBLE) AS RAISE6SECVIOLATION,
  CAST(LOWER5MINVIOLATION AS DOUBLE) AS LOWER5MINVIOLATION,
  CAST(LOWERREGVIOLATION AS DOUBLE) AS LOWERREGVIOLATION,
  CAST(LOWER60SECVIOLATION AS DOUBLE) AS LOWER60SECVIOLATION,
  CAST(LOWER6SECVIOLATION AS DOUBLE) AS LOWER6SECVIOLATION,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  CAST(LORSURPLUS AS DOUBLE) AS LORSURPLUS,
  CAST(LRCSURPLUS AS DOUBLE) AS LRCSURPLUS,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m11:30:01.045489 [debug] [Thread-1 (]: SQL status: OK in 31.788 seconds
[0m11:30:01.045489 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: COMMIT
[0m11:30:01.045489 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price"
[0m11:30:01.045489 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: COMMIT
[0m11:30:01.111786 [debug] [Thread-1 (]: SQL status: OK in 0.069 seconds
[0m11:30:01.119814 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price: Close
[0m11:30:01.120162 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5d8ee1a-f5c0-477c-99c2-f94a09c62bf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A284C1690>]}
[0m11:30:01.120162 [info ] [Thread-1 (]: 4 of 8 OK created sql incremental model aemo.fct_price ......................... [[32mOK[0m in 35.32s]
[0m11:30:01.120162 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_price
[0m11:30:01.120162 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_price_today
[0m11:30:01.120162 [info ] [Thread-1 (]: 5 of 8 START sql incremental model aemo.fct_price_today ........................ [RUN]
[0m11:30:01.120162 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.fct_price, now model.aemo_electricity.fct_price_today)
[0m11:30:01.120162 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_price_today
[0m11:30:01.133479 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_price_today"
[0m11:30:01.135398 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_price_today
[0m11:30:01.141437 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price_today"
[0m11:30:01.142436 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: BEGIN
[0m11:30:01.142436 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:30:01.145734 [debug] [Thread-1 (]: SQL status: OK in 0.002 seconds
[0m11:30:01.145734 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price_today"
[0m11:30:01.145734 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price_today"} */

        SET VARIABLE price_today_paths = (SELECT COALESCE(NULLIF(list('zip://' || '/lakehouse/default/Files/csv' || '/price_today/day=' || substring(source_filename, 19, 8) || '/source_file=' || source_filename || '/data_0.zip/*.CSV'), []), ['']) FROM "ducklake"."aemo"."stg_csv_archive_log" WHERE source_type = 'price_today')
      
[0m11:30:01.195188 [debug] [Thread-1 (]: SQL status: OK in 0.047 seconds
[0m11:30:01.195188 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_price_today"
[0m11:30:01.195188 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price_today"
[0m11:30:01.195188 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_price_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_price_today"
  
    as (
      



WITH price_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('price_today_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'PRICE': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'RUNNO': 'VARCHAR',
      'REGIONID': 'VARCHAR',
      'DISPATCHINTERVAL': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'RRP': 'VARCHAR',
      'EEP': 'VARCHAR',
      'ROP': 'VARCHAR',
      'APCFLAG': 'VARCHAR',
      'MARKETSUSPENDEDFLAG': 'VARCHAR',
      'LASTCHANGED': 'VARCHAR',
      'RAISE6SECRRP': 'VARCHAR',
      'RAISE6SECROP': 'VARCHAR',
      'RAISE6SECAPCFLAG': 'VARCHAR',
      'RAISE60SECRRP': 'VARCHAR',
      'RAISE60SECROP': 'VARCHAR',
      'RAISE60SECAPCFLAG': 'VARCHAR',
      'RAISE5MINRRP': 'VARCHAR',
      'RAISE5MINROP': 'VARCHAR',
      'RAISE5MINAPCFLAG': 'VARCHAR',
      'RAISEREGRRP': 'VARCHAR',
      'RAISEREGROP': 'VARCHAR',
      'RAISEREGAPCFLAG': 'VARCHAR',
      'LOWER6SECRRP': 'VARCHAR',
      'LOWER6SECROP': 'VARCHAR',
      'LOWER6SECAPCFLAG': 'VARCHAR',
      'LOWER60SECRRP': 'VARCHAR',
      'LOWER60SECROP': 'VARCHAR',
      'LOWER60SECAPCFLAG': 'VARCHAR',
      'LOWER5MINRRP': 'VARCHAR',
      'LOWER5MINROP': 'VARCHAR',
      'LOWER5MINAPCFLAG': 'VARCHAR',
      'LOWERREGRRP': 'VARCHAR',
      'LOWERREGROP': 'VARCHAR',
      'LOWERREGAPCFLAG': 'VARCHAR',
      'PRICE_STATUS': 'VARCHAR',
      'PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'RAISE1SECRRP': 'VARCHAR',
      'RAISE1SECROP': 'VARCHAR',
      'RAISE1SECAPCFLAG': 'VARCHAR',
      'LOWER1SECRRP': 'VARCHAR',
      'LOWER1SECROP': 'VARCHAR',
      'LOWER1SECAPCFLAG': 'VARCHAR',
      'PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_ENERGY_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISEREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER6_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER60_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER5MIN_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWERREG_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_RAISE1_PRICE': 'VARCHAR',
      'CUMUL_PRE_AP_LOWER1_PRICE': 'VARCHAR',
      'OCD_STATUS': 'VARCHAR',
      'MII_STATUS': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND PRICE = 'PRICE'
)

SELECT
  REGIONID,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(DISPATCHINTERVAL AS DOUBLE) AS DISPATCHINTERVAL,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(RRP AS DOUBLE) AS RRP,
  CAST(EEP AS DOUBLE) AS EEP,
  CAST(ROP AS DOUBLE) AS ROP,
  CAST(APCFLAG AS DOUBLE) AS APCFLAG,
  CAST(MARKETSUSPENDEDFLAG AS DOUBLE) AS MARKETSUSPENDEDFLAG,
  CAST(RAISE6SECRRP AS DOUBLE) AS RAISE6SECRRP,
  CAST(RAISE6SECROP AS DOUBLE) AS RAISE6SECROP,
  CAST(RAISE6SECAPCFLAG AS DOUBLE) AS RAISE6SECAPCFLAG,
  CAST(RAISE60SECRRP AS DOUBLE) AS RAISE60SECRRP,
  CAST(RAISE60SECROP AS DOUBLE) AS RAISE60SECROP,
  CAST(RAISE60SECAPCFLAG AS DOUBLE) AS RAISE60SECAPCFLAG,
  CAST(RAISE5MINRRP AS DOUBLE) AS RAISE5MINRRP,
  CAST(RAISE5MINROP AS DOUBLE) AS RAISE5MINROP,
  CAST(RAISE5MINAPCFLAG AS DOUBLE) AS RAISE5MINAPCFLAG,
  CAST(RAISEREGRRP AS DOUBLE) AS RAISEREGRRP,
  CAST(RAISEREGROP AS DOUBLE) AS RAISEREGROP,
  CAST(RAISEREGAPCFLAG AS DOUBLE) AS RAISEREGAPCFLAG,
  CAST(LOWER6SECRRP AS DOUBLE) AS LOWER6SECRRP,
  CAST(LOWER6SECROP AS DOUBLE) AS LOWER6SECROP,
  CAST(LOWER6SECAPCFLAG AS DOUBLE) AS LOWER6SECAPCFLAG,
  CAST(LOWER60SECRRP AS DOUBLE) AS LOWER60SECRRP,
  CAST(LOWER60SECROP AS DOUBLE) AS LOWER60SECROP,
  CAST(LOWER60SECAPCFLAG AS DOUBLE) AS LOWER60SECAPCFLAG,
  CAST(LOWER5MINRRP AS DOUBLE) AS LOWER5MINRRP,
  CAST(LOWER5MINROP AS DOUBLE) AS LOWER5MINROP,
  CAST(LOWER5MINAPCFLAG AS DOUBLE) AS LOWER5MINAPCFLAG,
  CAST(LOWERREGRRP AS DOUBLE) AS LOWERREGRRP,
  CAST(LOWERREGROP AS DOUBLE) AS LOWERREGROP,
  CAST(LOWERREGAPCFLAG AS DOUBLE) AS LOWERREGAPCFLAG,
  CAST(PRE_AP_ENERGY_PRICE AS DOUBLE) AS PRE_AP_ENERGY_PRICE,
  CAST(PRE_AP_RAISE6_PRICE AS DOUBLE) AS PRE_AP_RAISE6_PRICE,
  CAST(PRE_AP_RAISE60_PRICE AS DOUBLE) AS PRE_AP_RAISE60_PRICE,
  CAST(PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS PRE_AP_RAISE5MIN_PRICE,
  CAST(PRE_AP_RAISEREG_PRICE AS DOUBLE) AS PRE_AP_RAISEREG_PRICE,
  CAST(PRE_AP_LOWER6_PRICE AS DOUBLE) AS PRE_AP_LOWER6_PRICE,
  CAST(PRE_AP_LOWER60_PRICE AS DOUBLE) AS PRE_AP_LOWER60_PRICE,
  CAST(PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS PRE_AP_LOWER5MIN_PRICE,
  CAST(PRE_AP_LOWERREG_PRICE AS DOUBLE) AS PRE_AP_LOWERREG_PRICE,
  CAST(RAISE1SECRRP AS DOUBLE) AS RAISE1SECRRP,
  CAST(RAISE1SECROP AS DOUBLE) AS RAISE1SECROP,
  CAST(RAISE1SECAPCFLAG AS DOUBLE) AS RAISE1SECAPCFLAG,
  CAST(LOWER1SECRRP AS DOUBLE) AS LOWER1SECRRP,
  CAST(LOWER1SECROP AS DOUBLE) AS LOWER1SECROP,
  CAST(LOWER1SECAPCFLAG AS DOUBLE) AS LOWER1SECAPCFLAG,
  CAST(PRE_AP_RAISE1_PRICE AS DOUBLE) AS PRE_AP_RAISE1_PRICE,
  CAST(PRE_AP_LOWER1_PRICE AS DOUBLE) AS PRE_AP_LOWER1_PRICE,
  CAST(CUMUL_PRE_AP_ENERGY_PRICE AS DOUBLE) AS CUMUL_PRE_AP_ENERGY_PRICE,
  CAST(CUMUL_PRE_AP_RAISE6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE6_PRICE,
  CAST(CUMUL_PRE_AP_RAISE60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE60_PRICE,
  CAST(CUMUL_PRE_AP_RAISE5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE5MIN_PRICE,
  CAST(CUMUL_PRE_AP_RAISEREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISEREG_PRICE,
  CAST(CUMUL_PRE_AP_LOWER6_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER6_PRICE,
  CAST(CUMUL_PRE_AP_LOWER60_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER60_PRICE,
  CAST(CUMUL_PRE_AP_LOWER5MIN_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER5MIN_PRICE,
  CAST(CUMUL_PRE_AP_LOWERREG_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWERREG_PRICE,
  CAST(CUMUL_PRE_AP_RAISE1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_RAISE1_PRICE,
  CAST(CUMUL_PRE_AP_LOWER1_PRICE AS DOUBLE) AS CUMUL_PRE_AP_LOWER1_PRICE,
  SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM price_staging
    );
  
  
  
[0m11:30:05.865829 [debug] [Thread-1 (]: SQL status: OK in 4.665 seconds
[0m11:30:05.865829 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: COMMIT
[0m11:30:05.865829 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_price_today"
[0m11:30:05.865829 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: COMMIT
[0m11:30:05.923204 [debug] [Thread-1 (]: SQL status: OK in 0.053 seconds
[0m11:30:05.925207 [debug] [Thread-1 (]: On model.aemo_electricity.fct_price_today: Close
[0m11:30:05.925804 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5d8ee1a-f5c0-477c-99c2-f94a09c62bf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A284BFAD0>]}
[0m11:30:05.926922 [info ] [Thread-1 (]: 5 of 8 OK created sql incremental model aemo.fct_price_today ................... [[32mOK[0m in 4.81s]
[0m11:30:05.928311 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_price_today
[0m11:30:05.929316 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_scada
[0m11:30:05.931318 [info ] [Thread-1 (]: 6 of 8 START sql incremental model aemo.fct_scada .............................. [RUN]
[0m11:30:05.932406 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.fct_price_today, now model.aemo_electricity.fct_scada)
[0m11:30:05.933408 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_scada
[0m11:30:05.940757 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_scada"
[0m11:30:05.944847 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_scada
[0m11:30:05.955106 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada"
[0m11:30:05.957119 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: BEGIN
[0m11:30:05.957969 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:30:05.958706 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:30:05.959839 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada"
[0m11:30:05.960314 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada"} */

        SET VARIABLE scada_daily_paths = (SELECT COALESCE(NULLIF(list('zip://' || '/lakehouse/default/Files/csv' || '/daily/year=' || substring(source_filename, 14, 4) || '/source_file=' || source_filename || '/data_0.zip/*.CSV'), []), ['']) FROM "ducklake"."aemo"."stg_csv_archive_log" WHERE source_type = 'daily')
      
[0m11:30:06.066824 [debug] [Thread-1 (]: SQL status: OK in 0.106 seconds
[0m11:30:06.070911 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_scada"
[0m11:30:06.073249 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada"
[0m11:30:06.078158 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada"
  
    as (
      



WITH scada_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('scada_daily_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'UNIT': 'VARCHAR',
      'XX': 'VARCHAR',
      'VERSION': 'VARCHAR',
      'SETTLEMENTDATE': 'VARCHAR',
      'RUNNO': 'VARCHAR',
      'DUID': 'VARCHAR',
      'INTERVENTION': 'VARCHAR',
      'DISPATCHMODE': 'VARCHAR',
      'AGCSTATUS': 'VARCHAR',
      'INITIALMW': 'VARCHAR',
      'TOTALCLEARED': 'VARCHAR',
      'RAMPDOWNRATE': 'VARCHAR',
      'RAMPUPRATE': 'VARCHAR',
      'LOWER5MIN': 'VARCHAR',
      'LOWER60SEC': 'VARCHAR',
      'LOWER6SEC': 'VARCHAR',
      'RAISE5MIN': 'VARCHAR',
      'RAISE60SEC': 'VARCHAR',
      'RAISE6SEC': 'VARCHAR',
      'MARGINAL5MINVALUE': 'VARCHAR',
      'MARGINAL60SECVALUE': 'VARCHAR',
      'MARGINAL6SECVALUE': 'VARCHAR',
      'MARGINALVALUE': 'VARCHAR',
      'VIOLATION5MINDEGREE': 'VARCHAR',
      'VIOLATION60SECDEGREE': 'VARCHAR',
      'VIOLATION6SECDEGREE': 'VARCHAR',
      'VIOLATIONDEGREE': 'VARCHAR',
      'LOWERREG': 'VARCHAR',
      'RAISEREG': 'VARCHAR',
      'AVAILABILITY': 'VARCHAR',
      'RAISE6SECFLAGS': 'VARCHAR',
      'RAISE60SECFLAGS': 'VARCHAR',
      'RAISE5MINFLAGS': 'VARCHAR',
      'RAISEREGFLAGS': 'VARCHAR',
      'LOWER6SECFLAGS': 'VARCHAR',
      'LOWER60SECFLAGS': 'VARCHAR',
      'LOWER5MINFLAGS': 'VARCHAR',
      'LOWERREGFLAGS': 'VARCHAR',
      'RAISEREGAVAILABILITY': 'VARCHAR',
      'RAISEREGENABLEMENTMAX': 'VARCHAR',
      'RAISEREGENABLEMENTMIN': 'VARCHAR',
      'LOWERREGAVAILABILITY': 'VARCHAR',
      'LOWERREGENABLEMENTMAX': 'VARCHAR',
      'LOWERREGENABLEMENTMIN': 'VARCHAR',
      'RAISE6SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE60SECACTUALAVAILABILITY': 'VARCHAR',
      'RAISE5MINACTUALAVAILABILITY': 'VARCHAR',
      'RAISEREGACTUALAVAILABILITY': 'VARCHAR',
      'LOWER6SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER60SECACTUALAVAILABILITY': 'VARCHAR',
      'LOWER5MINACTUALAVAILABILITY': 'VARCHAR',
      'LOWERREGACTUALAVAILABILITY': 'VARCHAR'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND UNIT = 'DUNIT' AND VERSION = '3'
)

SELECT
  UNIT,
  DUID,
  CAST(VERSION AS DOUBLE) AS VERSION,
  CAST(RUNNO AS DOUBLE) AS RUNNO,
  CAST(INTERVENTION AS DOUBLE) AS INTERVENTION,
  CAST(DISPATCHMODE AS DOUBLE) AS DISPATCHMODE,
  CAST(AGCSTATUS AS DOUBLE) AS AGCSTATUS,
  CAST(INITIALMW AS DOUBLE) AS INITIALMW,
  CAST(TOTALCLEARED AS DOUBLE) AS TOTALCLEARED,
  CAST(RAMPDOWNRATE AS DOUBLE) AS RAMPDOWNRATE,
  CAST(RAMPUPRATE AS DOUBLE) AS RAMPUPRATE,
  CAST(LOWER5MIN AS DOUBLE) AS LOWER5MIN,
  CAST(LOWER60SEC AS DOUBLE) AS LOWER60SEC,
  CAST(LOWER6SEC AS DOUBLE) AS LOWER6SEC,
  CAST(RAISE5MIN AS DOUBLE) AS RAISE5MIN,
  CAST(RAISE60SEC AS DOUBLE) AS RAISE60SEC,
  CAST(RAISE6SEC AS DOUBLE) AS RAISE6SEC,
  CAST(MARGINAL5MINVALUE AS DOUBLE) AS MARGINAL5MINVALUE,
  CAST(MARGINAL60SECVALUE AS DOUBLE) AS MARGINAL60SECVALUE,
  CAST(MARGINAL6SECVALUE AS DOUBLE) AS MARGINAL6SECVALUE,
  CAST(MARGINALVALUE AS DOUBLE) AS MARGINALVALUE,
  CAST(VIOLATION5MINDEGREE AS DOUBLE) AS VIOLATION5MINDEGREE,
  CAST(VIOLATION60SECDEGREE AS DOUBLE) AS VIOLATION60SECDEGREE,
  CAST(VIOLATION6SECDEGREE AS DOUBLE) AS VIOLATION6SECDEGREE,
  CAST(VIOLATIONDEGREE AS DOUBLE) AS VIOLATIONDEGREE,
  CAST(LOWERREG AS DOUBLE) AS LOWERREG,
  CAST(RAISEREG AS DOUBLE) AS RAISEREG,
  CAST(AVAILABILITY AS DOUBLE) AS AVAILABILITY,
  CAST(RAISE6SECFLAGS AS DOUBLE) AS RAISE6SECFLAGS,
  CAST(RAISE60SECFLAGS AS DOUBLE) AS RAISE60SECFLAGS,
  CAST(RAISE5MINFLAGS AS DOUBLE) AS RAISE5MINFLAGS,
  CAST(RAISEREGFLAGS AS DOUBLE) AS RAISEREGFLAGS,
  CAST(LOWER6SECFLAGS AS DOUBLE) AS LOWER6SECFLAGS,
  CAST(LOWER60SECFLAGS AS DOUBLE) AS LOWER60SECFLAGS,
  CAST(LOWER5MINFLAGS AS DOUBLE) AS LOWER5MINFLAGS,
  CAST(LOWERREGFLAGS AS DOUBLE) AS LOWERREGFLAGS,
  CAST(RAISEREGAVAILABILITY AS DOUBLE) AS RAISEREGAVAILABILITY,
  CAST(RAISEREGENABLEMENTMAX AS DOUBLE) AS RAISEREGENABLEMENTMAX,
  CAST(RAISEREGENABLEMENTMIN AS DOUBLE) AS RAISEREGENABLEMENTMIN,
  CAST(LOWERREGAVAILABILITY AS DOUBLE) AS LOWERREGAVAILABILITY,
  CAST(LOWERREGENABLEMENTMAX AS DOUBLE) AS LOWERREGENABLEMENTMAX,
  CAST(LOWERREGENABLEMENTMIN AS DOUBLE) AS LOWERREGENABLEMENTMIN,
  CAST(RAISE6SECACTUALAVAILABILITY AS DOUBLE) AS RAISE6SECACTUALAVAILABILITY,
  CAST(RAISE60SECACTUALAVAILABILITY AS DOUBLE) AS RAISE60SECACTUALAVAILABILITY,
  CAST(RAISE5MINACTUALAVAILABILITY AS DOUBLE) AS RAISE5MINACTUALAVAILABILITY,
  CAST(RAISEREGACTUALAVAILABILITY AS DOUBLE) AS RAISEREGACTUALAVAILABILITY,
  CAST(LOWER6SECACTUALAVAILABILITY AS DOUBLE) AS LOWER6SECACTUALAVAILABILITY,
  CAST(LOWER60SECACTUALAVAILABILITY AS DOUBLE) AS LOWER60SECACTUALAVAILABILITY,
  CAST(LOWER5MINACTUALAVAILABILITY AS DOUBLE) AS LOWER5MINACTUALAVAILABILITY,
  CAST(LOWERREGACTUALAVAILABILITY AS DOUBLE) AS LOWERREGACTUALAVAILABILITY,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  CAST(SETTLEMENTDATE AS TIMESTAMP) AS SETTLEMENTDATE,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(CAST(SETTLEMENTDATE AS TIMESTAMP)) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m11:35:38.209212 [debug] [Thread-1 (]: SQL status: OK in 332.129 seconds
[0m11:35:38.210955 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: COMMIT
[0m11:35:38.212099 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada"
[0m11:35:38.212639 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: COMMIT
[0m11:35:38.246765 [debug] [Thread-1 (]: SQL status: OK in 0.034 seconds
[0m11:35:38.247772 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada: Close
[0m11:35:38.248772 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5d8ee1a-f5c0-477c-99c2-f94a09c62bf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A26DD7110>]}
[0m11:35:38.249772 [info ] [Thread-1 (]: 6 of 8 OK created sql incremental model aemo.fct_scada ......................... [[32mOK[0m in 332.32s]
[0m11:35:38.250049 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_scada
[0m11:35:38.251059 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_scada_today
[0m11:35:38.252059 [info ] [Thread-1 (]: 7 of 8 START sql incremental model aemo.fct_scada_today ........................ [RUN]
[0m11:35:38.252059 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.fct_scada, now model.aemo_electricity.fct_scada_today)
[0m11:35:38.253059 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_scada_today
[0m11:35:38.256995 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_scada_today"
[0m11:35:38.257978 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_scada_today
[0m11:35:38.262978 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada_today"
[0m11:35:38.262978 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: BEGIN
[0m11:35:38.262978 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:35:38.262978 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:35:38.262978 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada_today"
[0m11:35:38.262978 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada_today"} */

        SET VARIABLE scada_today_paths = (SELECT COALESCE(NULLIF(list('zip://' || '/lakehouse/default/Files/csv' || '/scada_today/day=' || substring(source_filename, 22, 8) || '/source_file=' || source_filename || '/data_0.zip/*.CSV'), []), ['']) FROM "ducklake"."aemo"."stg_csv_archive_log" WHERE source_type = 'scada_today')
      
[0m11:35:38.312832 [debug] [Thread-1 (]: SQL status: OK in 0.049 seconds
[0m11:35:38.312832 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_scada_today"
[0m11:35:38.312832 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada_today"
[0m11:35:38.312832 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_scada_today"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_scada_today"
  
    as (
      



WITH scada_staging AS (
  SELECT *
  FROM read_csv(
    getvariable('scada_today_paths'),
    skip = 1,
    header = 0,
    all_varchar = 1,
    columns = {
      'I': 'VARCHAR',
      'DISPATCH': 'VARCHAR',
      'UNIT_SCADA': 'VARCHAR',
      'xx': 'VARCHAR',
      'SETTLEMENTDATE': 'timestamp',
      'DUID': 'VARCHAR',
      'SCADAVALUE': 'double',
      'LASTCHANGED': 'timestamp'
    },
    filename = 1,
    null_padding = true,
    ignore_errors = 1,
    auto_detect = false,
    hive_partitioning = false
  )
  WHERE I = 'D' AND SCADAVALUE != 0
)

SELECT
  DUID,
  SCADAVALUE AS INITIALMW,
  
    split_part(split_part(filename, '/', -1), '.', 1)
 AS file,
  SETTLEMENTDATE,
  LASTCHANGED,
  CAST(SETTLEMENTDATE AS DATE) AS DATE,
  CAST(YEAR(SETTLEMENTDATE) AS INT) AS YEAR
FROM scada_staging
    );
  
  
  
[0m11:35:46.148300 [debug] [Thread-1 (]: SQL status: OK in 7.828 seconds
[0m11:35:46.151328 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: COMMIT
[0m11:35:46.153345 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_scada_today"
[0m11:35:46.155360 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: COMMIT
[0m11:35:46.199308 [debug] [Thread-1 (]: SQL status: OK in 0.043 seconds
[0m11:35:46.203341 [debug] [Thread-1 (]: On model.aemo_electricity.fct_scada_today: Close
[0m11:35:46.205357 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5d8ee1a-f5c0-477c-99c2-f94a09c62bf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A26E6D9D0>]}
[0m11:35:46.207369 [info ] [Thread-1 (]: 7 of 8 OK created sql incremental model aemo.fct_scada_today ................... [[32mOK[0m in 7.95s]
[0m11:35:46.207369 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_scada_today
[0m11:35:46.207369 [debug] [Thread-1 (]: Began running node model.aemo_electricity.fct_summary
[0m11:35:46.207369 [info ] [Thread-1 (]: 8 of 8 START sql incremental model aemo.fct_summary ............................ [RUN]
[0m11:35:46.207369 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.aemo_electricity.fct_scada_today, now model.aemo_electricity.fct_summary)
[0m11:35:46.214673 [debug] [Thread-1 (]: Began compiling node model.aemo_electricity.fct_summary
[0m11:35:46.225150 [debug] [Thread-1 (]: Writing injected SQL for node "model.aemo_electricity.fct_summary"
[0m11:35:46.227079 [debug] [Thread-1 (]: Began executing node model.aemo_electricity.fct_summary
[0m11:35:46.232086 [debug] [Thread-1 (]: Writing runtime sql for node "model.aemo_electricity.fct_summary"
[0m11:35:46.234089 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_summary"
[0m11:35:46.235272 [debug] [Thread-1 (]: On model.aemo_electricity.fct_summary: BEGIN
[0m11:35:46.236280 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:35:46.237280 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m11:35:46.238280 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_summary"
[0m11:35:46.239279 [debug] [Thread-1 (]: On model.aemo_electricity.fct_summary: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "aemo_electricity", "target_name": "dev", "node_id": "model.aemo_electricity.fct_summary"} */

  
    
    

    create  table
      "ducklake"."aemo"."fct_summary"
  
    as (
      



-- Full refresh from daily data
WITH daily_summary AS (
  SELECT
    s.DATE as date,
    CAST(strftime(s.SETTLEMENTDATE, '%H%M') AS INT) as time,
    (SELECT MAX(CAST(SETTLEMENTDATE AS TIMESTAMP)) FROM "ducklake"."aemo"."fct_scada") as cutoff,
    s.DUID,
    MAX(s.INITIALMW) as mw,
    MAX(p.RRP) as price
  FROM "ducklake"."aemo"."fct_scada" s
  LEFT JOIN "ducklake"."aemo"."dim_duid" d ON s.DUID = d.DUID
  LEFT JOIN "ducklake"."aemo"."fct_price" p
    ON s.SETTLEMENTDATE = p.SETTLEMENTDATE AND d.Region = p.REGIONID
  WHERE
    s.INTERVENTION = 0
    AND s.INITIALMW <> 0
    AND p.INTERVENTION = 0
  GROUP BY ALL
)

SELECT
  date,
  time,
  DUID,
  CAST(mw AS DECIMAL(18, 4)) AS mw,
  CAST(price AS DECIMAL(18, 4)) AS price,
  cutoff
FROM daily_summary
ORDER BY date


    );
  
  
  
[0m11:36:14.105324 [debug] [Thread-1 (]: SQL status: OK in 27.866 seconds
[0m11:36:14.108231 [debug] [Thread-1 (]: On model.aemo_electricity.fct_summary: COMMIT
[0m11:36:14.109315 [debug] [Thread-1 (]: Using duckdb connection "model.aemo_electricity.fct_summary"
[0m11:36:14.111232 [debug] [Thread-1 (]: On model.aemo_electricity.fct_summary: COMMIT
[0m11:36:14.136013 [debug] [Thread-1 (]: SQL status: OK in 0.023 seconds
[0m11:36:14.138020 [debug] [Thread-1 (]: On model.aemo_electricity.fct_summary: Close
[0m11:36:14.140022 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5d8ee1a-f5c0-477c-99c2-f94a09c62bf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A2684D3D0>]}
[0m11:36:14.143029 [info ] [Thread-1 (]: 8 of 8 OK created sql incremental model aemo.fct_summary ....................... [[32mOK[0m in 27.93s]
[0m11:36:14.145024 [debug] [Thread-1 (]: Finished running node model.aemo_electricity.fct_summary
[0m11:36:14.149028 [debug] [MainThread]: Using duckdb connection "master"
[0m11:36:14.150025 [debug] [MainThread]: On master: BEGIN
[0m11:36:14.152026 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:36:14.154599 [debug] [MainThread]: SQL status: OK in 0.003 seconds
[0m11:36:14.156661 [debug] [MainThread]: On master: COMMIT
[0m11:36:14.157684 [debug] [MainThread]: Using duckdb connection "master"
[0m11:36:14.159595 [debug] [MainThread]: On master: COMMIT
[0m11:36:14.161740 [debug] [MainThread]: SQL status: OK in 0.001 seconds
[0m11:36:14.163985 [debug] [MainThread]: On master: Close
[0m11:36:14.164989 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:36:14.166980 [debug] [MainThread]: Connection 'create_ducklake_aemo' was properly closed.
[0m11:36:14.167986 [debug] [MainThread]: Connection 'list_ducklake_aemo' was properly closed.
[0m11:36:14.170000 [debug] [MainThread]: Connection 'model.aemo_electricity.fct_summary' was properly closed.
[0m11:36:14.171087 [info ] [MainThread]: 
[0m11:36:14.172349 [info ] [MainThread]: Finished running 6 incremental models, 2 table models in 0 hours 8 minutes and 1.22 seconds (481.22s).
[0m11:36:14.174968 [debug] [MainThread]: Command end result
[0m11:36:14.219618 [debug] [MainThread]: Wrote artifact WritableManifest to C:\lakehouse\default\Files\dbt\target\manifest.json
[0m11:36:14.226047 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\lakehouse\default\Files\dbt\target\semantic_manifest.json
[0m11:36:14.242673 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\lakehouse\default\Files\dbt\target\run_results.json
[0m11:36:14.242673 [info ] [MainThread]: 
[0m11:36:14.244956 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:36:14.244956 [info ] [MainThread]: 
[0m11:36:14.244956 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=8
[0m11:36:14.251102 [debug] [MainThread]: Command `dbt run` succeeded at 11:36:14.250219 after 483.92 seconds
[0m11:36:14.251102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A26386610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A26542590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023A266077D0>]}
[0m11:36:14.251102 [debug] [MainThread]: Flushing usage events
[0m11:36:15.489705 [debug] [MainThread]: An error was encountered while trying to flush usage events
